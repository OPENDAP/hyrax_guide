<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="OPeNDAP, Inc.">
<title>The Hyrax Data Server Installation and Configuration Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Hyrax Data Server Installation and Configuration Guide</h1>
<div class="details">
<span id="author" class="author">OPeNDAP, Inc.</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2020-12-30</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#_development_sponsored_by">Development Sponsored By</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
</ul>
</li>
<li><a href="#_hyrax_new_features_1_15_2">1. Hyrax New Features (1.15.2)</a>
<ul class="sectlevel2">
<li><a href="#site-conf">1.1. Custom Module Configuration with <em>site.conf</em></a></li>
<li><a href="#mds">1.2. MetaData Store (MDS)</a></li>
<li><a href="#cov-json">1.3. CoverageJSON</a></li>
<li><a href="#json-ld">1.4. JSON-LD</a></li>
</ul>
</li>
<li><a href="#hyrax-overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_features">2.1. Features</a></li>
<li><a href="#_modules">2.2. Modules</a></li>
<li><a href="#contact-us">2.3. Contact Us</a></li>
</ul>
</li>
<li><a href="#Download_and_Install_Hyrax">3. Installation</a>
<ul class="sectlevel2">
<li><a href="#_bes_installation">3.1. BES Installation</a></li>
<li><a href="#_olfs_installation">3.2. OLFS Installation</a></li>
<li><a href="#_wcs_installation">3.3. WCS Installation</a></li>
<li><a href="#_source_code_builds">3.4. Source Code Builds</a></li>
<li><a href="#Hyrax_Configuration">3.5. Configuration</a></li>
<li><a href="#OLFS-config">3.6. OLFS Configuration</a></li>
</ul>
</li>
<li><a href="#_customizing_hyrax">4. Customizing Hyrax</a>
<ul class="sectlevel2">
<li><a href="#_webpage_customization">4.1. Webpage Customization</a></li>
<li><a href="#_software_customization">4.2. Software Customization</a></li>
</ul>
</li>
<li><a href="#apache-integration">5. Apache Integration</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">5.1. Prerequisites</a></li>
<li><a href="#_connecting_tomcat_to_apache">5.2. Connecting Tomcat to Apache</a></li>
<li><a href="#apache-compressed-responses">5.3. Apache Compressed Responses</a></li>
<li><a href="#_apache_authentication">5.4. Apache Authentication</a></li>
</ul>
</li>
<li><a href="#_operation">6. Operation</a>
<ul class="sectlevel2">
<li><a href="#start-and-stop-BES">6.1. Starting and Stopping the BES</a></li>
<li><a href="#admin-interface">6.2. Hyrax Administrators Interface</a></li>
</ul>
</li>
<li><a href="#_hyrax_security">7. Hyrax Security</a>
<ul class="sectlevel2">
<li><a href="#_secure_installation_guidelines">7.1. Secure Installation Guidelines</a></li>
<li><a href="#_common_problems">7.2. Common Problems</a></li>
</ul>
</li>
<li><a href="#_tomcat_authentication_services_configuration">8. Tomcat Authentication Services Configuration</a>
<ul class="sectlevel2">
<li><a href="#_ldap_2">8.1. LDAP</a></li>
<li><a href="#_shibboleth">8.2. Shibboleth</a></li>
<li><a href="#_earthdata_login_oauth2">8.3. Earthdata Login OAuth2</a></li>
</ul>
</li>
<li><a href="#_authentication_for_dap_clients">9. Authentication For DAP Clients</a>
<ul class="sectlevel2">
<li><a href="#_overview">9.1. Overview</a></li>
<li><a href="#_earthdata_login_users">9.2. Earthdata Login Users</a></li>
<li><a href="#_curl_a_k_a_lib_curl">9.3. <em>curl</em> (a.k.a. <em>lib_curl</em>)</a></li>
<li><a href="#_wget">9.4. <em>wget</em></a></li>
<li><a href="#_ncdump">9.5. <em>ncdump</em></a></li>
<li><a href="#_integrated_data_viewer_idv">9.6. <em>Integrated Data Viewer (IDV)</em></a></li>
<li><a href="#_toolsui">9.7. <em>ToolsUI</em></a></li>
<li><a href="#_panoply">9.8. <em>Panoply</em></a></li>
<li><a href="#_matlab_ferret_other_applications_that_use_netcdf_c">9.9. Matlab, Ferret, Other applications that use NetCDF C</a></li>
<li><a href="#_pydap">9.10. PyDAP</a></li>
</ul>
</li>
<li><a href="#_hyrax_troubleshooting">10. Hyrax Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_hyrax_running_bescmdln_opendap_documentation">10.1. Hyrax - Running bescmdln - OPeNDAP Documentation</a></li>
<li><a href="#_bes_client_commands_introduction">10.2. BES Client Commands - Introduction</a></li>
</ul>
</li>
<li><a href="#_hyrax_appendix">11. Hyrax Appendix</a>
<ul class="sectlevel2">
<li><a href="#WMS_Service">Appendix A: Hyrax WMS Service</a></li>
<li><a href="#WCS_Service">Appendix B: Hyrax WCS Service</a></li>
<li><a href="#_hyrax_handlers">Appendix C: Hyrax Handlers</a></li>
<li><a href="#freeform-data-handler">Appendix D: The FreeForm Data Handler</a></li>
<li><a href="#_aggregation">Appendix E: Aggregation</a></li>
<li><a href="#user_specified_aggregation">Appendix F: User-Specified Aggregation</a></li>
<li><a href="#Server_Side_Processing_Functions">Appendix G: Server Side Processing Functions</a></li>
<li><a href="#BES_XML">Appendix H: BES XML Commands</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This manual describes the features and operation of the Hyrax data
server, a data server developed by OPeNDAP, Inc. as a reference server
for the Data Access Protocol, versions 2 and 4. the Hyrax server is
modular software with a number of <em>handlers</em> that are loaded into a
core framework based on the contents of configuration files. Each of
the server&#8217;s modules provides a distinct functional capability, such
as reading data from a certain kind of file, encoding data, or
processing data in different ways.</p>
</div>
<div class="paragraph">
<p>The text contained here was built up over several years as modules
were added to the system. Originally, the documentation was built using
a Wiki (because it was a collaborative writing tool for a distributed
group of people), where each component had a separate page. Over time,
as information was spread across many web pages and the Wiki, this became
unmanageable. We hope this new format reads more like a guide for people
who want to install and configure the server and less like a design document.</p>
</div>
<div class="sect2">
<h3 id="_development_sponsored_by">Development Sponsored By</h3>
<div class="paragraph">
<p><strong><a href="http://www.nsf.gov">National Science Foundation (NSF)</a></strong> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p><strong><a href="http://www.nasa.gov">National Aeronautics and Space Administration (NASA)</a></strong></p>
</div>
<div class="paragraph">
<p><strong><a href="http://www.noaa.gov">National Oceanic and Atmospheric Administration (NOAA)</a></strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p>The High Altitude Observatory at NCAR contributed the BES framework
that is the basis for the server&#8217;s data processing engine and modular
extensibility.</p>
</div>
<div class="paragraph">
<p>Keith Seyffarth extracted the Wiki&#8217;s text that forms the basis of this
manual, and Alexander Porrello and Leonard Porrello edited the text.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hyrax_new_features_1_15_2">1. Hyrax New Features (1.15.2)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#site-conf">site.conf</a></p>
</li>
<li>
<p><a href="#hyrax-standalone-earthdata-login-client">Hyrax Standalone Earthdata Login Client</a></p>
</li>
<li>
<p><a href="#mds">Metadata Store (MDS)</a></p>
</li>
<li>
<p><a href="#cov-json">Coverage JSON</a></p>
</li>
<li>
<p><a href="#json-ld">JSON-LD</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="site-conf">1.1. Custom Module Configuration with <em>site.conf</em></h3>
<div class="sect3">
<h4 id="_about">1.1.1. About</h4>
<div class="paragraph">
<p>Prior to Hyrax 1.15.2, if you wanted to customize a module’s configuration,
you had to modify its <em>.conf</em> file.
Unfortunately, <em>.conf</em> files do not persist through updates,
so you were responsible for restoring your custom configurations post-update.</p>
</div>
<div class="paragraph">
<p>Hyrax 1.15.2 introduces <em>site.conf</em>, a special configuration file
that persists through updates, where you can store custom module configurations.
To start using site.conf, see its
<a href="#site-conf-config">configuration instruction section</a>.</p>
</div>
<div class="paragraph">
<p>Beginning with release 1.15.3, Hyrax will include a template file,
<em>site.conf.proto</em>, that will include many commonly-modified settings.
For instructions on how to use the template, see its
<a href="#site-conf-proto-config">configuration instruction section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_theory_of_operation">1.1.2. Theory of Operation</h4>
<div class="paragraph">
<p>When you launch your server, the BES loads the module configuration files that reside within <code>/etc/bes/modules</code>.
The BES then loads <em>site.conf</em>, which resides in <code>/etc/bes</code>.</p>
</div>
<div class="paragraph">
<p>As the BES reads the custom-configured parameters that you have copied into <em>site.conf</em>,
the BES overrides the default configuration parameters that it loaded from
the individual module configuration files. For a detailed configuration example,
see <a href="#site-conf-example-configuration">the example configuration section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="site-conf-config">1.1.3. <em>site.conf</em> Configuration Instructions</h4>
<div class="paragraph">
<p>The following details how you can customize a module’s configuration with <em>site.conf</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <em>site.conf</em> in <code>\etc\bes</code> with the following command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">sudo touch site.conf</pre>
</div>
</div>
</li>
<li>
<p>Locate the .conf file for the module that you would like to customize.
All configuration files reside within <code>/etc/bes/modules</code>.</p>
</li>
<li>
<p>Copy the configuration parameters that you would like to customize
from the module’s configuration file into site.conf.
For a detailed configuration example, see <a href="#site-conf-example-configuration">the next section</a>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuration parameters are generally a key/value pair;
for example, the default server administrator email parameter is email:support@opendap.org,
where email is the key and <a href="mailto:support@opendap.org">support@opendap.org</a> is the value.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save your updates to <em>site.conf</em>.</p>
</li>
<li>
<p>Restart the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="site-conf-example-configuration">1.1.4. <em>site.conf</em> Configuration Example</h4>
<div class="paragraph">
<p>The following steps detail how you can update the BES’s
server administrator configuration parameters with your organization’s information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Locate the existing server administrator configuration in <code>/etc/bes/bes.conf</code>:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">BES.ServerAdministrator=email:support@opendap.org
BES.ServerAdministrator+=organization:OPeNDAP Inc.
BES.ServerAdministrator+=street:165 NW Dean Knauss Dr.
BES.ServerAdministrator+=city:Narragansett
BES.ServerAdministrator+=region:RI
BES.ServerAdministrator+=postalCode:02882
BES.ServerAdministrator+=country:US
BES.ServerAdministrator+=telephone:+1.401.575.4835
BES.ServerAdministrator+=website:http://www.opendap.org</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When adding parameters to the ServerAdministrator configuration,
notice how, following the first line, we use += instead of just<br>
to add new key/value pairs. += indicates to the BES that we are
adding new configuration parameters, rather than replacing those
that were already loaded. Had we used just + in the above example,
the only configured parameter would have been website.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Copy the above block of text from its default <em>.conf</em> file to <em>site.conf</em>.</p>
</li>
<li>
<p>In <em>site.conf</em>, update the block of text with your organization’s information; for example&#8230;&#8203;</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">BES.ServerAdministrator=email:smootchy@woof.org
BES.ServerAdministrator+=organization:Mogogogo Inc.
BES.ServerAdministrator+=street:165 Buzzknucker Blvd.
BES.ServerAdministrator+=city: KnockBuzzer
BES.ServerAdministrator+=region:OW
BES.ServerAdministrator+=postalCode:00007
BES.ServerAdministrator+=country:MG
BES.ServerAdministrator+=telephone:+1.800.555.1212
BES.ServerAdministrator+=website:http://www.mogogogo.org</pre>
</div>
</div>
</li>
<li>
<p>Save your changes to <em>site.conf</em>.</p>
</li>
<li>
<p>Restart the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="site-conf-proto-config">1.1.5. <em>site.conf.proto</em> Configuration Instructions</h4>
<div class="paragraph">
<p>The <em>site.conf.proto</em> template resides in <code>\etc\bes</code>.
If you want to take advantage of the template,
copy <em>site.conf.proto</em> into <em>site.conf</em> with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">cp site.conf.proto site.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Uncomment the configuration parameters that you want to modify and update them.
For a site.conf configuration example, see
<a href="#site-conf-example-configuration">the previous section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hyrax-standalone-earthdata-login-client">1.1.6. Earthdata Login OAuth2</h4>
<div class="paragraph">
<p>If you wanted to secure the data on your server with
NASA’s OAuth2 Earthdata Login services prior to Hyrax 1.15.2,
your only option was <code>mod_auth_urs</code>.
While <code>mod_auth_urs</code> is robust and thoroughly tested,
it is inconvenient for some in that it must be bound
to an instance of Apache webserver, which is not required to run Hyrax.</p>
</div>
<div class="paragraph">
<p>If you do not need Apache webserver but would still like to
take advantage of NASA’s OAuth2 Earthdata login services,
also known as the User Registration System (URS),
Hyrax 1.15.2 offers a standalone implementation
of the Earthdata Login Client that can deployed
using only Tomcat or a preferred servlet engine.</p>
</div>
<div class="paragraph">
<p>If you require a robust security solution that has undergone
thorough testing, you should implement mod_auth_urs.
You can find instructions for configuring mod_auth_urs
in the Apache/URS section of this manual.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To take advantage of this feature,
you must create an Earthdata Login Application.
If you have not yet done this, see the
Nasa’s Earthdata Login - OAuth2 (mod_auth_urs) section of this manual.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_enabling_hyraxs_standalone_earthdata_login_client_implementation">Enabling Hyrax&#8217;s Standalone Earthdata Login Client Implementation</h5>
<div class="paragraph">
<p>To enable Hyrax’s standalone implementation of the Earthdata login,
you need to first modify a few lines of code in <em>web.xml</em>.
If you installed Tomcat using the instructions in this manual (via <code>YUM</code>),
you can locate <em>web.xml</em> at the following location:
<code>/usr/share/tomcat/webapps/opendap/WEB-INF/</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should generally avoid editing <em>web.xml</em>,
since the file is overwritten whenever you upgrade to a new version of Hyrax;
however, in the software’s current iteration,
the only way to enable Hyrax’s standalone implementation of the
Earthdata login client is by modifying <em>web.xml</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After navigating to <code>/usr/share/tomcat/webapps/opendap/WEB-INF/</code>&#8230;&#8203;</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <em>web.xml</em>.</p>
</li>
<li>
<p>Scroll down until you locate the Identity Provider (IdP)
filter and the Policy Enforcement Point (PEP) filter, both of which are commented.</p>
</li>
<li>
<p>Remove the comments around these filters:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">    &lt;!-- Uncomment These two filters to enable access control.
    &lt;filter&gt;
        &lt;filter-name&gt;IdP&lt;/filter-name&gt;
        &lt;filter-class&gt;opendap.auth.IdFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;IdP&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;


    &lt;filter&gt;
        &lt;filter-name&gt;PEP&lt;/filter-name&gt;
        &lt;filter-class&gt;opendap.auth.PEPFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;PEP&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    --&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The IdP filter is responsible for figuring out who users are,
and the PEP filter determines what users can or cannot do.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_the_identification_provider">Configuring the Identification Provider</h5>
<div class="paragraph">
<p>After uncommenting the <code>IdP</code> and <code>PEP</code> filters in <em>web.xml</em>,
you must link your server to your Earthdata Login Application
by configuring the identification provider.</p>
</div>
<div class="paragraph">
<p>You must first modify a few lines of code in user-access.xml. If you installed Tomcat via YUM, user-access.xml can be found in one of the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/olfs</p>
</li>
<li>
<p>/usr/share/olfs</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If neither of these directories exist, see the
<a href="https://opendap.github.io/hyrax_guide/Master_Hyrax_Guide.html#_localizing_the_olfs_configuration_under_selinux">Localizing the OLFS Configuration</a> section of this manual
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After accessing the file, scroll down until you locate the
<code>IdProvider</code> element:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;IdProvider class="opendap.auth.UrsIdP"&gt;
        &lt;authContext&gt;urs&lt;/authContext&gt;
        &lt;isDefault /&gt;
        &lt;UrsClientId&gt;iPlEjZjMvrdwLUlnbaKxWQ&lt;/UrsClientId&gt;
        &lt;UrsClientAuthCode&gt;aVBsRWpaak12cmR3TFVsbmJhS3hXUTpKSEdqa2hmZzY3OA==&lt;/UrsClientAuthCode&gt;
        &lt;UrsUrl&gt;https://uat.urs.earthdata.nasa.gov&lt;/UrsUrl&gt;
&lt;/IdProvider&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Configure your identification provider by updating the following child elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authContex</code>: Determines whether you are using the production (<code>urs</code>) or test (<code>uat</code>) service.
Only NASA-authorized applications can use the production service.</p>
</li>
<li>
<p><code>UrsClientID</code>: The Client ID can be located on your application’s
Application Administration page.</p>
</li>
<li>
<p><code>UrsClientAuthCode</code>: You must generate the authorization code
using your Earthdata Login Application’s Client ID and password.
See <a href="#compute-urs-code">the following section</a> for more information.</p>
</li>
<li>
<p><code>UrsUrl</code>: Depending on the authContext, should be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>https://<strong>uat.urs</strong>.earthdata.nasa.gov</p>
</li>
<li>
<p>https://<strong>urs</strong>.earthdata.nasa.gov</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="compute-urs-code">Compute <code>&lt;URSClientAuthCode&gt;</code></h5>
<div class="paragraph">
<p>You can compute the URS client authorization code with one of the following methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shell Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">echo -n "&lt;cid&gt;:&lt;pw&gt;" | base64</pre>
</div>
</div>
</li>
<li>
<p>Perl Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">perl -e 'use MIME::Base64; print encode_base64("&lt;cid&gt;:&lt;pw&gt;");'</pre>
</div>
</div>
</li>
<li>
<p>PHP Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">php -r 'echo base64_encode("&lt;cid&gt;:&lt;pw&gt;");'</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the above examples, <code>&lt;cid&gt;</code> is the Client ID (found on your application&#8217;s
<em>Application Administration</em> page), and <code>&lt;pw&gt;</code> is your application&#8217;s password.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mds">1.2. MetaData Store (MDS)</h3>
<div class="paragraph">
<p>A new cache, the MetaData Store (MDS), has been added to the BES for
metadata responses. This cache is unlike the other
BES caches in that it is intended to be operated as either a "cache"
or a "store." In the latter case, added items will never be removed.
It is an open-ended place where metadata response objects
are kept indefinitely. The contents of the MDS (as a cache or a store)
will persist through Hyrax restarts.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The MDS is especially important for scenarios where data is
not as close as you need it to be. By using the MDS, you can reduce
the time it takes to look through files
and make quick decisions based on the metadata that the MDS has saved;
however, because the underlying data in the MDS does not update automatically,
the metadata may be out of sync with the actual data.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_enable_or_disable_the_mds">1.2.1. Enable or Disable the MDS</h4>
<div class="paragraph">
<p>To enable or disable the MDS, access <code>dap.conf</code> in the
<code>/etc/bes/modules</code> directory, and remove the comment before
the following line of code:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">DAP.GlobalMetadataStore.path = /usr/share/mds</pre>
</div>
</div>
<div class="paragraph">
<p>See the code block below for the MDS section of <code>dap.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#-----------------------------------------------------------------------#
# Metadata Store parameters                                             #
#-----------------------------------------------------------------------#

# Control the Metadata Response Store. Here, DAP metadata responses
# are stored/cached so that they can be returned by the server w/o
# having to touch the data files/objects. Setting the 'path' to null
# disables uses of the MDS. Setting 'size' to zero makes the MDS
# hold objects forever; setting a positive non-zero size makes the
# MDS behave like a cache, purging responses when the size is exceeded.

#DAP.GlobalMetadataStore.path = /usr/share/mds
DAP.GlobalMetadataStore.prefix = mds

# Size in MB
DAP.GlobalMetadataStore.size = 200

# The MDS writes a ledger of additions and removals. By default the
# ledger is kept in 'mds_ledger.txt' in the directory used to start
# the BES.

DAP.GlobalMetadataStore.ledger = /usr/share/mds_ledger.txt

# This tells the BES Framework's DAP module to use the DMR++
# handler for data requests if it find a DMR++ response in the MDS
# for a given granule.

# DAP.Use.Dmrpp = yes</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_mds">1.2.2. Configure the MDS</h4>
<div class="paragraph">
<p>The MDS' parameters should be configured in <code>site.conf</code>.
For more information, please see <a href="#site-conf">the site.conf section</a>.</p>
</div>
<div class="paragraph">
<p>To configure the MDS to work as a store, rather than a cache,
set the <code>Dap.GlobalMetadataSote.size</code> to 0.
To configure the MDS as a cache, set it to your desired size.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cache_ejection_strategy">1.2.3. Cache Ejection Strategy</h4>
<div class="paragraph">
<p>The MDS caches complete metadata responses and serves those directly.</p>
</div>
<div class="paragraph">
<p>The MDS can be configured to not exceed a certain size.
When the configured size is met, the MDS ejects
the metadata files in the cache that were least recently accessed.</p>
</div>
<div class="paragraph">
<p>By default the metadata files are stored in <code>usr/share/mds</code>.
You can change this location by modifying the
<code>DAP.GlobalMetadataStore.path</code>. You can modify this parameter
in <em>dap.conf</em>, but you should modify it in <em>site.conf</em>.
For more information, please see <a href="#site-conf">the site.conf section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cov-json">1.3. CoverageJSON</h3>
<div class="paragraph">
<p>CoverageJSON uses heuristics to determine if a data set is suitable for CoverageJSON expression.
You can take advantage of the CoverageJSON feature in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <em>Get as CoverageJSON</em> button in the Data Request Form:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/covjson_button.png" alt="CovJSON file" width="500" height="auto"></span></p>
</div>
</li>
<li>
<p>Append <code>.covjson</code> to the URL:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Before:</strong>
<a href="http://test.opendap.org:8080/opendap/data/nc/coads_climatology.nc" class="bare">http://test.opendap.org:8080/opendap/data/nc/coads_climatology.nc</a></p>
</li>
<li>
<p><strong>After:</strong>
<a href="http://test.opendap.org:8080/opendap/data/nc/coads_climatology.nc.covjson" class="bare">http://test.opendap.org:8080/opendap/data/nc/coads_climatology.nc.covjson</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="json-ld">1.4. JSON-LD</h3>
<div class="paragraph">
<p>This release Hyrax adds <a href="https://json-ld.org">JSON-LD</a>
content to every browser-navigable catalog page
(i.e. <em>*/contents.html</em>") and to every dataset/granule OPeNDAP
Data Access Form. Along with the site map generation,
this feature can be used to assist search engines to
catalog, index, and find the data that you want the world to access.</p>
</div>
<div class="sect3">
<h4 id="_theory_of_operation_2">1.4.1. Theory of Operation</h4>
<div class="paragraph">
<p>The JSON-LD is dynamically built from the metadata. It uses the MDS metadata if it is there; otherwise, it loads it from the file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_instructions">1.4.2. Configuration Instructions</h4>
<div class="paragraph">
<p>The server ships with this feature enabled. By default the publisher information
is set to OPeNDAP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.ServerAdministrator=email:support@opendap.org
BES.ServerAdministrator+=organization:OPeNDAP Inc.
BES.ServerAdministrator+=street:165 NW Dean Knauss Dr.
BES.ServerAdministrator+=city:Narragansett
BES.ServerAdministrator+=region:RI
BES.ServerAdministrator+=postalCode:02882
BES.ServerAdministrator+=country:US
BES.ServerAdministrator+=telephone:+1.401.575.4835
BES.ServerAdministrator+=website:http://www.opendap.org</pre>
</div>
</div>
<div class="paragraph">
<p>This information can and should be updated to your organization&#8217;s information.
You can update the information in <code>/etc/bes/bes.conf</code>;
however, you should configure the parameters in <code>site.conf</code>.
For more information, see the <a href="#site-conf">site.conf section</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hyrax-overview">2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>and operation of the <em>Hyrax Data server</em>, a data server that integrates
structured data with the world wide web. Hyrax is one example of a
number of data servers that implement OPeNDAP&#8217;s Data Access Protocol (DAP).</p>
</div>
<div class="paragraph">
<p>For information on how to get Hyrax downloaded and running, please see the
<a href="#Download_and_Install_Hyrax">Hyrax Downloading and Installation guide</a>
that appears later in this manual.</p>
</div>
<div class="paragraph">
<p>Hyrax uses the Java servlet mechanism to hand off requests from a
general web daemon to DAP format-specific software. This provides
higher performance for small requests. The servlet front end, which we
call the <strong>O</strong>PeNDAP <strong>L</strong>ightweight <strong>F</strong>ront end <strong>S</strong>erver (OLFS)
looks at each request and formulates a query to a second server (which
may or may not on the same machine as the OLFS) called the <strong>B</strong>ack
<strong>E</strong>nd <strong>S</strong>erver (BES).</p>
</div>
<div class="paragraph">
<p>The BES is the high-performance server software from HAO. It reads
data from the data stores and returns DAP-compliant responses to the
OLFS. In turn, the OLFS may pass these response back to the requestor
with little or no modification, or it may use them to build more
complex responses. The nature of the Inter Process Communication (IPC)
between the OLFS and BES is such that they should both be on the same
machine or able to communicate over a very high-bandwidth channel.</p>
</div>
<div class="paragraph">
<p>The OLFS and the BES will run and serve test data immediately
after a default installation. Additional configuration is required for
them to serve site specific data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/HyraxArchitecture.jpg" alt="HyraxArchitecture">
</div>
</div>
<div class="sect2">
<h3 id="_features">2.1. Features</h3>
<div class="ulist">
<ul>
<li>
<p><strong>THREDDS Catalog Support:</strong>
Hyrax supports the THREDDS catalogs. It can serve user supplied static
catalogs and it will dynamically generate THREDDS catalogs of it&#8217;s
internal holdings.</p>
</li>
<li>
<p><strong>Dataset Aggregation:</strong>
Collections of related data resources can be collected into a single
dataset using the aggregation features. Typically these are formed for
geographic tiles, time series, etc.</p>
</li>
<li>
<p><strong>Adding/modifying dataset content.:</strong>
Datasets can be modified by the server without having to actually
change the underlying files. These views are independently accessible
from the original data. Both dataset metadata and data values may be
added or changed.</p>
</li>
<li>
<p><strong>Supports multiple source data formats:</strong>
Server can ingest source data stored as HDF4, HDF4-EOS, HDF5,
HDF5-EOS, NetCDF-3, NetCDF-4, CEDAR, FITS, Comma Separated Values, and
raw ASCII and Binary formats. Because of Hyrax&#8217;s extensible design,
it&#8217;s easy to add new source data formats.</p>
</li>
<li>
<p><strong>Supports data retrieval in multiple return formats:</strong>
Hyrax is able to return data in DAP, DAP4, NetCDF-3, NetCDF-4, JSON,
CSV, and ASCII formats, Or, you can add your own response types.</p>
</li>
<li>
<p><strong>Gateway:</strong>
Hyrax supports a gateway feature that allows it to provide DAP (and
other Hyrax) services for remotely held datasets that are stored in
any of Hyrax&#8217;s source data formats.</p>
</li>
<li>
<p><strong>RDF:</strong>
Hyrax provides RDF descriptions of it&#8217;s data holdings. These can
enable semantic web tools to operate upon the metadata content held in
the server.</p>
</li>
<li>
<p><strong>Server Side Functions:</strong>
Hyrax supports a number of <a href="#Server_Side_Processing_Functions">Server side
functions</a> out of the box including (but not limited to):</p>
<div class="ulist">
<ul>
<li>
<p><strong><em><a href="#SSF_geogrid">geogrid</a></em>:</strong>
Subset applicable DAP Grids using latitude and longitude values.</p>
</li>
<li>
<p><strong><em><a href="#SSF_grid">grid</a></em>:</strong>
Subset any DAP Grid object using the values of it&#8217;s map vectors.</p>
</li>
<li>
<p><strong><em><a href="#SSF_linear_scale">linear_scale</a></em>:</strong>
Apply a linear equation to the data returned, including automatic use
of CF attributes.</p>
</li>
<li>
<p><strong><em><a href="#SSF_version">version</a></em>:</strong>
The version function provides a list of the server-side processing
functions available.</p>
</li>
<li>
<p>New ones are easy to add.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Extensible WebStart functionality for data clients:</strong>
Hyrax provides WebStart functionality for a number of Java based DAP
clients. It&#8217;s simple to add new clients to the list that Hyrax
supports.</p>
</li>
<li>
<p><strong>Extensible/Configurable web interface:</strong>
The web interface for both Hyrax and the administrator&#8217;s interface can
be customized using CSS and XSL. You can add your organizations logo
and specialize the colors and fonts in the presentation of data sets.</p>
</li>
<li>
<p><strong>Administrator&#8217;s interface:</strong>
Control and dynamically update Hyrax from a convenient web interface.
<a href="#admin-interface">See the Admin interface documentation</a>.</p>
</li>
<li>
<p><strong>WMS services:</strong>
<a href="#WMS_Service">Hyrax now supports WMS services via integration with ncWMS.</a></p>
</li>
<li>
<p><strong>JSON responses:</strong>
<a href="#hyrax-json">Both metadata and data are now available in a JSON encoding.</a></p>
</li>
<li>
<p><strong>w10n:</strong>
Hyrax comes with a complete w10n service stack. W10n navigation is
supported through the default catalog where all datasets and
"structure" variables appear as graph nodes. Data can be acquired for
atomic types or arrays of atomic types in a number of formats.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Feature Request:</strong>
If there is a feature you would like to see but don&#8217;t, let us know:
<a href="mailto:support@opendap.org">support@opendap.org</a> or <a href="mailto:opendap-tech@opendap.org">opendap-tech@opendap.org</a>. (You need to
<a href="http://mailman.opendap.org/mailman/listinfo/opendap-tech">subscribe</a>
first.)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_modules">2.2. Modules</h3>
<div class="paragraph">
<p>Hyrax has a number of modules that provide the actual functionality of
the server: Reading data files, building different kinds of responses
and performing different kinds of server processing operations. Most of
these modules work with the BES but some are part of the front (web
facing) part of the server.</p>
</div>
<div class="sect3">
<h4 id="_bes_modules">2.2.1. BES modules</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#netcdf-handler">NetCDF data handler</a></p>
</li>
<li>
<p><a href="#hdf4-handler">HDF4 data handler</a></p>
</li>
<li>
<p><a href="#hdf5-handler">HDF5 data handler</a></p>
</li>
<li>
<p><a href="#freeform-data-handler">FreeForm data handler</a></p>
</li>
<li>
<p><a href="#gateway-module">Gateway handler</a> (Interoperability between Hyrax and other web services)</p>
</li>
<li>
<p><a href="#csv-handler">CSV handler</a></p>
</li>
<li>
<p><a href="#file-out-netcdf">NetCDF File Response handler</a></p>
</li>
<li>
<p><a href="#file-out-gdal">GDAL (GeoTIFF, JPEG2000) File Response handler</a></p>
</li>
<li>
<p><a href="#sql-handler">SQL handler</a> (Unsupported)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_additional_java_modules_that_use_the_bes">Additional Java Modules that use the BES</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#WMS_Service">WMS</a> - Web Mapping Service via integration with ncWMS.</p>
</li>
<li>
<p><a href="#user_specified_aggregation">Aggregation enhancements</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="for-developers">2.2.2. For Software Developers</h4>
<div class="paragraph">
<p>If you would like to build Hyrax from source code, you can get signed
source distributions from the
<a href="https://www.opendap.org/software/hyrax-data-server">download page</a>
referenced above. In addition, you can get the source code for the
server from GitHub, either using the
<a href="https://github.com/opendap/hyrax">Hyrax project</a> or by following the
<a href="http://docs.opendap.org/index.php/Hyrax_GitHub_Source_Build">directions
on our developer&#8217;s wiki</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.opendap.org/index.php/How_to_use_Eclipse_with_Hyrax_Source_Code">How to use
Eclipse with Hyrax Source Code</a>. Note that this is a a work in progress,
but it will help with some of the odd steps that Eclipse seems to require.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_bes_development_information">BES Development Information</h5>
<div class="paragraph">
<p>We maintain a wiki with a section deveoted to
<a href="http://docs.opendap.org/index.php/Developer_Info">Developer
Information</a> specific to our software and development process. You can
find information there about developing your own modules for Hyrax.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reference_documentation">Reference Documentation</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://opendap.github.io/libdap4/html/">libdap Reference</a></p>
</li>
<li>
<p><a href="https://opendap.github.io/bes/html/">BES Reference</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contact-us">2.3. Contact Us</h3>
<div class="paragraph">
<p>We hope you find this software useful, and we welcome your
questions and comments.</p>
</div>
<div class="paragraph">
<p><strong>Technical Support:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="mailto:support@opendap.org">support@opendap.org</a></p>
</li>
<li>
<p><a href="mailto:opendap-tech@opendap.org">opendap-tech@opendap.org</a> (You need to
<a href="http://mailman.opendap.org/mailman/listinfo">subscribe</a> first.)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Download_and_Install_Hyrax">3. Installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.opendap.org/software/hyrax-data-server">Download the
latest Hyrax release</a> usually composed of:</p>
<div class="ulist">
<ul>
<li>
<p>2 RPM files (one for <em>libdap</em>, one for the <em>BES</em>).</p>
</li>
<li>
<p>The OLFS binary distribution file.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install the <em>libdap</em> RPM.</p>
</li>
<li>
<p>Install the <em>BES</em> RPM.</p>
</li>
<li>
<p>Unpack the OLFS distribution file, and install the <em>opendap.war</em>
file into your Tomcat instance&#8217;s <em>webapps</em> directory.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The detailed download and installation instructions for Hyrax are
published on the download page for each release of the server. Find
the latest release and its associated installation details on
<a href="https://www.opendap.org/software/hyrax-data-server">the Hyrax downloads
page</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_bes_installation">3.1. BES Installation</h3>
<div class="sect3">
<h4 id="_download">3.1.1. Download</h4>
<div class="paragraph">
<p>It is necessary that you download and install both the <em>libdap</em> and <em>BES</em> binaries.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit the
<a href="https://www.opendap.org/software/hyrax-data-server#block-hyraxversions-menu">Hyrax
Data Server Page</a>.</p>
</li>
<li>
<p>Select the most recent in the list of <strong>Available Versions</strong>.</p>
</li>
<li>
<p>Scroll down the following page until you reach the section entitled
<strong>Binaries for Hyrax x.x.x</strong>, then continue scrolling until you
see the heading titled <strong>BES</strong>.</p>
</li>
<li>
<p>You need to download both the <em>libdap</em> and <em>BES</em> RPMs which should be named
<em>libdap-x.x.x</em> and <em>bes-x.x.x</em>.</p>
</li>
<li>
<p>The downloaded files should be named something like
<em>libdap-x.x.x.el6.x86_64.rpm</em> and <em>bes-x.x.x.static.el6.x86_64.rpm</em>.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In order to install the RPMs on your system, you <strong>must</strong> be running
a 64bit OS. If you are running 32bit OS, attempting to install the
<em>libdap</em> and <em>BES</em> RPMs will result in errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_install">3.1.2. Install</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use yum to install the libdap and bes RPMs:<br>
<code>sudo yum install libdap-3.x.x.rpm bes-3.x.x.rpm</code>).</p>
</li>
<li>
<p>At this point you can test the BES by typing the following into a terminal:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>start it:<br>
<code>sudo service besd start</code><br>
(Or use the script in <em>/etc/init.d with sudo</em>: <em>/etc/init.d/besd start</em>)</p>
</li>
<li>
<p>connect using a simple client:<br>
<code>bescmdln</code></p>
</li>
<li>
<p>get version information:<br>
<code>BESClient&gt; show version</code></p>
</li>
<li>
<p>exit from <code>bescmdln</code>:<br>
<code>BESClient&gt; exit</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>If you are upgrading to Hyrax 1.13.4 or newer from an existing installation
older than 1.13.0,</strong> in the bes.conf file the keys <em>BES.CacheDir</em>,
<em>BES.CacheSize</em>, and <em>BES.CachePrefix</em> have been replaced with
<em>BES.UncompressCache.dir</em>, <em>BES.UncompressCache.size</em>, and
<em>BES.UncompressCache.prefix</em> respectively. Other changes include the gateway
cache configuration (<em>gateway.conf</em>) which now uses the keys <em>Gateway.Cache.dir</em>,
<em>Gateway.Cache.size</em>, and <em>Gateway.Cache.prefix</em> to configure its cache. Changing
the names enabled the BES to use separate parameters for each of its several
caches, which fixes the problem of 'cache collisions.'
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_olfs_installation">3.2. OLFS Installation</h3>
<div class="sect3">
<h4 id="_introduction">3.2.1. Introduction</h4>
<div class="paragraph">
<p>The OLFS comes with a default configuration that is compatible with the
default configuration of the BES. If you perform a default installation
of both, you should get a running Hyrax server that will be pre-populated
with test data suitable for running integrity tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_tomcat">3.2.2. Install Tomcat</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use yum to install tomcat.noarch: <code>sudo yum install tomcat.noarch</code>.</p>
</li>
<li>
<p>Create the directory <code>/etc/olfs</code>, change its group to tomcat,
and set it <em>group writable:</em></p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mkdir /etc/olfs
chgrp tomcat /etc/olfs
chmod g+w /etc/olfs)</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, get Apache Tomcat-8.x from the Apache Software Foundation and
install it wherever you&#8217;d like&#8212;&#8203;for example, <code>/usr/local/</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_download_2">3.2.3. Download</h4>
<div class="paragraph">
<p>Follow the steps below to download the latest OLFS distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit the
<a href="https://www.opendap.org/software/hyrax-data-server#block-hyraxversions-menu">Hyrax
Data Server Page</a>.</p>
</li>
<li>
<p>Select the most recent in the list of <em>Available Versions</em>.</p>
</li>
<li>
<p>Scroll down the following page until you reach the section titled
<em>Binaries for Hyrax x.x.x</em>.</p>
</li>
<li>
<p>Directly underneath, you should see the OLFS download link,
named something like <em>OLFS_x.x.x._Web_Archive_File</em>. Click to download.</p>
</li>
<li>
<p>The downloaded file will be named something like: <em>olfs-x.x.x-webapp.tgz</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_unpack">3.2.4. Unpack</h4>
<div class="paragraph">
<p>Unpack the jar file with the command <code>tar -xvf olfs-x.x.x-webapp.tgz</code>,
which will unpack the files directory called <em>olfs-x.x.x-webapp</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_2">3.2.5. Install</h4>
<div class="paragraph">
<p>Inside of the <em>olfs-x.x.x-webapp</em> directory, locate opendap.war and copy it into
Tomcat&#8217;s <em>webapps</em> directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">cp opendap.war /usr/share/tomcat/webapps</pre>
</div>
</div>
<div class="paragraph">
<p>Or, if you installed tomcat from the ASF distribution, its web application directory, for example&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">/usr/local/apache-tomcat-8.5.34/webapps</pre>
</div>
</div>
<div class="sect4">
<h5 id="_centos_7selinux_and_yum_installed_tomcat">CentOS-7/SELinux and Yum installed Tomcat</h5>
<div class="paragraph">
<p>Recent versions of CentOS-7 are shipped with default SELinux settings that prohibit Tomcat from reading or opening the <strong>opendap.war</strong> file. This can be addressed by issuing the following two commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">sudo semanage fcontext -a -t tomcat_var_lib_t /var/lib/tomcat/webapps/opendap.war
sudo restorecon -rv /var/lib/tomcat/webapps/</pre>
</div>
</div>
<div class="paragraph">
<p>After this you will need to restart Tomcat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">sudo service tomcat restart</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starting_and_stopping_the_olfstomcat">3.2.6. Starting and Stopping the OLFS/Tomcat</h4>
<div class="paragraph">
<p>If you followed this tutorial and are using a YUM-installed Tomcat,
it should already be integrated into the system with a <code>tomcat</code> entry
in <code>/etc/init.d</code> and you should be able to&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Start Tomcat</strong>: <code>sudo service tomcat start</code></p>
</li>
<li>
<p><strong>Stop  Tomcat</strong>: <code>sudo service tomcat stop</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can verify that the server is running by visiting <a href="http://localhost:8080/opendap/" class="bare">http://localhost:8080/opendap/</a>.
If you have installed Hyrax on a virtual machine, replace <em>localhost</em> with the
virtual machine&#8217;s IP address.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wcs_installation">3.3. WCS Installation</h3>
<div class="paragraph">
<p>The WCS 2 service comes bundled as part of Hyrax-1.14.0 and newer.
For more information about configuring WCS with your installation of Hyrax,
please refer to the <a href="#WCS_installation_guide">WCS Installation Guide</a> that
appears later in this document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_code_builds">3.4. Source Code Builds</h3>
<div class="paragraph">
<p>If you are interested in working on Hyrax or want to build the
server from source code (as opposed to using the prebuilt binaries that we
provide), you can get signed source distributions from the
<a href="https://www.opendap.org/software/hyrax-data-server">download page</a>
referenced above. See also the <a href="#for-developers">For Software Developers</a>
section below.</p>
</div>
</div>
<div class="sect2">
<h3 id="Hyrax_Configuration">3.5. Configuration</h3>
<div class="paragraph">
<p>When you install Hyrax for the first time it is pre-configured
to serve test data sets that come with each of the installed
data handlers. This will allow you to test the server and
make sure it is functioning correctly. After that you can customize it for your data.</p>
</div>
<div class="sect3">
<h4 id="_deploying_robots_for_hyrax">3.5.1. Deploying Robots for Hyrax</h4>
<div class="paragraph">
<p>Deploying a robots.txt file for Hyrax is synonymous with deploying it for Tomcat. This means that your robots.txt file must be
accessible here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   http://you.host:port/robots.txt</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   http://www.opendap.org/robots.txt</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Placing robots.txt lower in the URL path does not seem to work</p>
</div>
<div class="paragraph">
<p>In order to get Tomcat to serve the file from that location you must
place it in <em>$CATALINA_HOME/webapps/ROOT</em>.</p>
</div>
<div class="paragraph">
<p>If you find that you system is still burdened with robot
traffic then you might want to try the
<a href="#bot-blocker">BotBlocker handler for the OLFS</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bess-configuration">3.5.2. BES Configuration</h4>
<div class="paragraph">
<p>Building the BES and its data handlers from source (or installing from
the Linux RPMs) will provide the default installation with data and a
valid configuration. This is suitable for testing. The following details
how you go about customizing it for your data.</p>
</div>
<div class="sect4">
<h5 id="_location_of_the_bes_configuation_file">Location of the BES Configuation File</h5>
<div class="paragraph">
<p>The BES configuration file is called <em>bes.conf</em> and can be found in
<em>$prefix/etc/bes/</em> if you built the software from source or in
<em>/etc/bes/</em> if you used our RPM packages. By default <em>$prefix</em> is in
<em>/usr/local</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_basic_format_of_parameters">Basic format of parameters</h5>
<div class="paragraph">
<p>Parameters set in the BES configuration file have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Name=Value</pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to add to the value of a parameter, then you would use +=
instead of =</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Name=Value1
Name+=Value2</pre>
</div>
</div>
<div class="paragraph">
<p>The above would return the values Value1 and Value2 in the software.</p>
</div>
<div class="paragraph">
<p>And if you would like to include another configuration file you would
use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Include=/path/to/configuration/file/blee.conf</pre>
</div>
</div>
<div class="paragraph">
<p>The bes.conf file includes all .conf files in the modules directory with
the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Include=modules/.*\.conf$</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Regular expressions can be used in the <em>Include</em> parameter to
match a set of files.</p>
</div>
</div>
<div class="sect4">
<h5 id="_administration_logging">Administration &amp; Logging</h5>
<div class="paragraph">
<p>In the bes.conf file, the <em>BES.ServerAdministrator</em>
parameter is the address used in various mail messages returned to
clients. Set this so that the email&#8217;s recipient will be able to fix
problems and/or respond to user questions. Also set the log file and log
level. If the <em>BES.LogName</em> is set to a relative path, it will be treated
as relative to the directory where the BES is started. (That is, if the
BES is installed in <em>/usr/local/bin</em> but you start it in your home
directory using the parameter value below, the log file will be
<em>bes.log</em> in your home directory.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.ServerAdministrator=webmaster@some.place.edu
BES.LogName=./bes.log
BES.LogVerbose=no</pre>
</div>
</div>
<div class="paragraph">
<p>Because the BES is a server in its own right, you will need to tell it
which network port and interface to use. Assuming you are running the
BES and OLFS (i.e., all of Hyrax) on one machine, do the following:</p>
</div>
<div class="sect5">
<h6 id="_user_and_group_parameters">User and Group Parameters</h6>
<div class="paragraph">
<p>In the bes.conf file, the BES must be started as root. One
of the things that the BES does first is to start a listener that
listens for requests to the BES. This listener is started as root, but
then the <em>User</em> and <em>Group</em> of the process is set using parameters in the
BES configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.User=user_name
BES.Group=group_name</pre>
</div>
</div>
<div class="paragraph">
<p>You can also set these to a user id and a group id. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.User=#172
BES.Group=#14</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_setting_the_networking_parameters">Setting the Networking Parameters</h6>
<div class="paragraph">
<p>In the bes.conf configuration file, we have settings for how the BES
should listen for requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.ServerPort=10022
# BES.ServerUnixSocket=/tmp/opendap.socket</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>BES.ServerPort</em> tells the BES which TCP/IP port to use when
listening for commands. Unless you need to use a different port, use the
default. Ports with numbers less than 1024 are special, otherwise you
can use any number under 65536. That being said, stick with the default unless
you know you need to change it.</p>
</div>
<div class="paragraph">
<p>In the default bes.conf file we have commented the <em>ServerUnixSocket</em>
parameter, which disables I/O over that device. If you need
UNIX socket I/O, uncomment this line, otherwise leave it commented.
The fewer open network I/O ports, the easier it is to make sure the
server is secure.</p>
</div>
<div class="paragraph">
<p>If both <em>ServerPort</em> and <em>ServerUnixSocket</em> are defined, the BES listens
on both the TCP port and the Unix Socket. Local clients on the same
machine as the BES can use the unix socket for a faster connection.
Otherwise, clients on other machines will connect to the BES using the
<em>BES.ServerPort</em> value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The OLFS always uses only the TCP socket, even if the UNIX
socket is present.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_debugging_tip">Debugging Tip</h5>
<div class="paragraph">
<p>In <em>bes.conf</em>, use the <em>BES.ProcessManagerMethod</em>
parameter to control whether the BES acts like a normal Unix server.
The default value of <code>multiple</code> causes the BES to accept many
connections at once, like a typical server. The value <code>single</code> causes it
to accept a single connection (process the commands sent to it and exit),
greatly simplifying troubleshooting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.ProcessManagerMethod=multiple</pre>
</div>
</div>
<div class="sect5">
<h6 id="_controlling_how_compressed_files_are_treated">Controlling how compressed files are treated</h6>
<div class="paragraph">
<p>Compression parameters are configured in the bes.conf configuration
file.</p>
</div>
<div class="paragraph">
<p>The BES will automatically recognize compressed files using the <em>bz2</em>,
<em>gzip</em>, and Unix compress (<em>Z</em>) compression schemes. However, you need to
configure the BES to accept these file types as valid data by making
sure that the filenames are associated with a data handler. For
example, if you&#8217;re serving netCDF files, you would set
<code>BES.Catalog.catalog.TypeMatch</code> so that it includes
<code>nc:.*\.(nc|NC)(\.gz|\.bz2|\.Z)?$;</code>. The first part of the regular
expression must match both the filename and the '.nc' extension, and the second
part must match the suffix, indicating the file is compressed (either <em>.gz</em>,
<em>.bz2</em> or <em>.Z</em>).</p>
</div>
<div class="paragraph">
<p>When the BES is asked to serve a file that has been compressed, it first
must decompress it before passing it to the correct data handler (except
for those formats which support 'internal' compression, such as HDF4).
The <em>BES.CacheDir</em> parameter tells the BES where to store the
uncompressed file. Note that the default value of <em>/tmp</em> is probably less
safe than a directory that is used only by the BES for this purpose.
You might, for example, want to set this to <code>&lt;prefix&gt;/var/bes/cache</code>.</p>
</div>
<div class="paragraph">
<p>The <em>BES.CachePrefix</em> parameter is used to set a prefix for the cached
files so that when a directory like /tmp is used, it is easy for the BES
to recognize which files are its responsibility.</p>
</div>
<div class="paragraph">
<p>The <em>BES.CacheSize</em> parameter sets the size of the cache in megabytes.
When the size of the cached files exceeds this value, the cache will be
purged using a least-recently-used approach, where the file&#8217;s access time is the
'use time'. Because it is usually impossible to determine the
sizes of data files before decompressing them, there may be times when
the cache holds more data than this value. Ideally this value should be
several times the size of the largest file you plan to serve.</p>
</div>
</div>
<div class="sect5">
<h6 id="Loading_Modules">Loading Software Modules</h6>
<div class="paragraph">
<p>Virtually all of the BES&#8217;s functions are contained in modules that are
loaded when the server starts up. Each module is a shared-object
library. The configuration for each of these modules is contained in its
own configuration file and is stored in a directory called <em>modules</em>.
This directory is located in the same directory as the bes.conf file:
<em>$prefix/etc/bes/modules/</em>.</p>
</div>
<div class="paragraph">
<p>By default, all .conf files located in the modules are loaded by the BES
per this parameter in the bes.conf configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Include=modules/.*\.conf$</pre>
</div>
</div>
<div class="paragraph">
<p>So, if you don&#8217;t want one of the modules to be loaded, simply change its
name to, say, nc.conf.sav and it won&#8217;t be loaded.</p>
</div>
<div class="paragraph">
<p>For example, if you are installing the general purpose server module
(the dap-server module) then a dap-server.conf file will be installed in
the <em>modules</em> directory. Also, most installations will include the dap
module, allowing the BES to serve OPeNDAP data. This configuration file,
called dap.conf, is also included in the <em>modules</em> directory. For a
data handler, say netcdf, there will be an nc.conf file located in the
modules directory.</p>
</div>
<div class="paragraph">
<p>Each module should contain within it a line that tells the BES to
load the module at startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.modules+=nc
BES.module.nc=/usr/local/lib/bes/libnc_module.so</pre>
</div>
</div>
<div class="paragraph">
<p>Module specific parameters will be included in its own configuration
file. For example, any parameters specific to the netcdf data handler
will be included in the <em>nc.conf</em> file.</p>
</div>
</div>
<div class="sect5">
<h6 id="Pointing_to_data">Pointing to data</h6>
<div class="paragraph">
<p>There are two parameters that can be used to tell the BES where your
data are stored. Which one you use depends on whether you are setting up
the BES to work as part of Hyrax (and thus with THREDDS catalogs) or as
a standalone server. In either case, set the value of the
<em>.RootDirectory</em> parameter to point to the root directory of your data
files (only one may be specified). If the BES is being used as part of Hyrax,
use <em>BES.Catalog.catalog.RootDirectory</em> in dap.conf, which is stored
in the <em>modules</em> directory; otherwise, use <em>BES.Data.RootDirectory</em> in bes.conf itself.
So, if you are setting up Hyrax, set the value of
<em>BES.Catalog.catalog.RootDirectory</em> but be <strong>sure</strong> to set <em>BES.Data.RootDirectory</em>
to some value or the BES will not start.</p>
</div>
<div class="paragraph">
<p>In bes.conf set the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Data.RootDirectory=/full/path/data/root/directory</pre>
</div>
</div>
<div class="paragraph">
<p>Also in bes.conf set the following if using Hyrax (usually the case):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.RootDirectory=/full/path/data/root/directory</pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <em>RootDirectory</em> parameters are set to point to the test
data supplied with the data handlers.</p>
</div>
<div class="paragraph">
<p>Next, configure the mapping between data source names and data handlers.
This is usually taken care of for you already, so you probably won&#8217;t
have to set this parameter. Each data handler module (<em>netcdf</em>, <em>hdf4</em>,
<em>hdf5</em>, <em>freeform</em>, etc&#8230;&#8203;) will have this set depending on the extension of
the data files for the data.</p>
</div>
<div class="paragraph">
<p>For example, in nc.conf, for the netcdf data handler module, you&#8217;ll find
the line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.TypeMatch+=nc:.*\.nc(\.bz2|\.gz|\.Z)?$;</pre>
</div>
</div>
<div class="paragraph">
<p>When the BES is asked to perform some commands on a particular data
source, it uses regular expressions to figure out which data handler
should be used to carry out the commands. The value of the
<em>BES.Catalog.catalog.TypeMatch</em> parameter holds the set of regular
expressions. The value of this parameter is a list of handlers and
expressions in the form handler <em>expression;</em>. Note that these regular
expressions are like those used by <code>grep</code> on Unix and are somewhat
cryptic, but once you see the pattern it&#8217;s not that bad. Below, the
<em>TypeMatch</em> parameter is being told the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any data source with a name that ends in <code>.nc</code> should be handled by
the <em>nc</em> (netcdf) handler (see <em>BES.module.nc</em> above)</p>
</li>
<li>
<p>Any file with a <code>.hdf</code>, <code>.HDF</code> or <code>.eos</code> suffix should be processed
using the HDF4 handler (note that case matters)</p>
</li>
<li>
<p>Data sources ending in <code>.dat</code> should use the FreeForm handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s the one for the hdf4 data handler module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.TypeMatch+=h4:.*\.(hdf|HDF|eos)(\.bz2|\.gz|\.Z)?$;</pre>
</div>
</div>
<div class="paragraph">
<p>And for the FreeForm handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.TypeMatch+=ff:.*\.dat(\.bz2|\.gz|\.Z)?$;</pre>
</div>
</div>
<div class="paragraph">
<p>If you fail to configure this correctly, the BES will return error
messages stating that the type information has to be provided. It won&#8217;t
tell you this, however when it starts, only when the OLFS (or some other
software) makes a data request. This is because it is possible
to use BES commands in place of these regular expressions, although the
Hyrax won&#8217;t.</p>
</div>
</div>
<div class="sect5">
<h6 id="_including_and_excluding_files_and_directories">Including and Excluding files and directories</h6>
<div class="paragraph">
<p>Finally, you can configure the types of information that the BES sends
back when a client requests catalog information. The <em>Include</em> and
<em>Exclude</em> parameters provide this mechanism, also using a list of
regular expressions (with each element of the list separated by a
semicolon). In the example below, files that begin with a dot are
excluded. These parameters are set in the dap.conf configuration file.</p>
</div>
<div class="paragraph">
<p>The <em>Include</em> expressions are applied to the node first, followed by the
<em>Exclude</em> expressions. For collections of nodes, only the Exclude
expressions are applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.Include=;
BES.Catalog.catalog.Exclude=^\..*;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_symbolic_links">Symbolic Links</h6>
<div class="paragraph">
<p>If you would like symbolic links to be followed when retrieving data
and for viewing catalog entries, then you need to set the following two
parameters: the <em>BES.FollowSymLinks</em> parameter and the <em>BES.RootDirectory</em>
parameter. The <em>BES.FollowSymLinks</em> parameter is for non-catalog
containers and is used in conjunction with the <em>BES.RootDirectory</em>
parameter. It is <strong>not</strong> a general setting. The
<em>BES.Catalog.catalog.FollowSymLinks</em> is for catalog requests and data
containers in the catalog. It is used in conjunction with the
<em>BES.Catalog.catalog.RootDirectory</em> parameter above. The default is set
to <em>No</em> in the installed configuration file. To allow for symbolic links
to be followed you need to set this to <em>Yes</em>.</p>
</div>
<div class="paragraph">
<p>The following is set in the bes.conf file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.FollowSymLinks=No|Yes</pre>
</div>
</div>
<div class="paragraph">
<p>And this one is set in the dap.conf file in the modules directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES.Catalog.catalog.FollowSymLinks=No|Yes</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_parameters_for_specific_handlers">Parameters for Specific Handlers</h6>
<div class="paragraph">
<p>Parameters for specific modules can be added to the BES configuration
file for that specific module. No module-specific parameters should be
added to bes.conf.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="OLFS-config">3.6. OLFS Configuration</h3>
<div class="paragraph">
<p>The OLFS is the outward facing component of the Hyrax server. This section
provides OLFS configuration instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The OLFS web application relies on one or more instances of the
<a href="#bess-configuration">BES</a> to provide it with
data access and basic catalog metadata.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The OLFS web application stores its configuration state in a number of
files. You can change the server&#8217;s default configuration by modifying
the content of one or more of these files and then restarting Tomcat
or the web application. These configuration files include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>olfs.xml</code>: Contains the primary OLFS configuration, such as
BES associations, directory view instructions, gateway service location,
and static THREDDS catalog behavior. Located at <code>/etc/olfs/olfs.xml</code>.
For more information about <code>olfs.xml</code>, please see
<a href="#olfs-config">the <code>olfs.xml</code> configuration section.</a></p>
</li>
<li>
<p><code>catalog.xml</code>: Master(top-level) THREDDS catalog content for static THREDDS
catalogs. Located at <code>/etc/olfs/catalog.xml</code>.</p>
</li>
<li>
<p><code>viewers.xml</code>: Contains the localized viewers configuration.
Located at <code>/etc/olfs/viewers.xml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generally, you can meet your configuration needs by making changes to
<code>olfs.xml</code> and <code>catalog.xml</code>. For more information about where these files
might be located, please see the following section, <a href="#OLFS-config-location">OLFS Configuration Files</a>.</p>
</div>
<div class="sect3">
<h4 id="OLFS-config-location">3.6.1. OLFS Configuration Files</h4>
<div class="paragraph">
<p>If the default configuration of the OLFS works for your intended use,
there is no need to create a persistent localized configuration;
however, if you need to change the configuration, we strongly recommend
that you enable a persistent local configuration. This way,
updating the web application won&#8217;t override your custom configuration.</p>
</div>
<div class="paragraph">
<p>The OLFS locates its configuration file by looking at the value of
the <code>OLFS_CONFIG_DIR</code> user environment variable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the variable is set and its value is the pathname of an existing directory
that is both readable and writable by Tomcat, the OLFS will use it.</p>
</li>
<li>
<p>If the directory <code>/etc/olfs</code> exists and is readable and writable by
Tomcat, the OLFS will use it.</p>
</li>
<li>
<p>If the directory <code>/usr/share/olfs</code> exists and is readable and writable
by Tomcat, then the OLFS will use it. (This was added for Hyrax 1.14.1.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If none of the above directories exist or the variable has not been set,
the OLFS uses the default configuration bundled in the web application
web archive file (<code>opendap.war</code>). In this way, the OLFS can start
without a persistent local configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_persistent_local_configuration">3.6.2. Create a Persistent Local Configuration</h4>
<div class="paragraph">
<p>You can easily enable a persistent local configuration for the OLFS by
creating an empty directory and identifying it with the
<code>OLFS_CONFIG_DIR</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">export OLFS_CONFIG_DIR="/home/tomcat/hyrax"</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, you can create <code>/etc/olfs</code> or <code>/usr/share/olfs</code>.</p>
</div>
<div class="paragraph">
<p>Once you have created the directory (and, in the first case, set the
environment variable), restart Tomcat. Restarting Tomcat prompts the OLFS
move a copy of its default configuration into the empty directory and
then use it. You can then edit the local copy.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The directory that you create <em>must</em> be both readable and writable
by the user who is running Tomcat.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="olfs-config">3.6.3. <code>olfs.xml</code> Configuration File</h4>
<div class="paragraph">
<p>The <code>olfs.xml</code> file contains the core configuration of the Hyrax
front-end service. The following subsections detailed its contents.</p>
</div>
<div class="paragraph">
<p>At the document&#8217;s root is the <code>&lt;OLFSConfig&gt;</code> element. It contains several
elements that supply the configuration for the OLFS.
The following is an example OLFS Configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;OLFSConfig&gt;

    &lt;BESManager&gt;
        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;localhost&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
 
            &lt;timeOut&gt;300&lt;/timeOut&gt;
 
            &lt;adminPort&gt;11002&lt;/adminPort&gt;
 
            &lt;maxResponseSize&gt;0&lt;/maxResponseSize&gt;
            &lt;ClientPool maximum="200" maxCmds="2000" /&gt;
        &lt;/BES&gt;
        &lt;NodeCache maxEntries="20000" refreshInterval="600"/&gt;
        &lt;SiteMapCache refreshInterval="600" /&gt;
    &lt;/BESManager&gt;


    &lt;ThreddsService  prefix="thredds" useMemoryCache="true" allowRemote="true" /&gt;
    &lt;GatewayService  prefix="gateway" useMemoryCache="true" /&gt;
    &lt;UseDAP2ResourceUrlResponse /&gt;
    &lt;HttpPost enabled="true" max="2000000"/&gt;

    &lt;!-- AddFileoutTypeSuffixToDownloadFilename / --&gt;
    &lt;!-- AllowDirectDataSourceAccess / --&gt;
    &lt;!-- PreloadNcmlIntoBes --&gt;

    &lt;!-- CatalogCache&gt;
        &lt;maxEntries&gt;10000&lt;/maxEntries&gt;
        &lt;updateIntervalSeconds&gt;10000&lt;/updateIntervalSeconds&gt;
    &lt;/CatalogCache --&gt;

    &lt;!--
       'Bot Blocker' is used to block access from specific IP addresses
       and by a range of IP addresses using a regular expression.
    --&gt;
    &lt;!-- BotBlocker --&gt;
    &lt;!-- &lt;IpAddress&gt;127.0.0.1&lt;/IpAddress&gt; --&gt;
    &lt;!-- This matches all IPv4 addresses, work yours out from here.... --&gt;
    &lt;!-- &lt;IpMatch&gt;[012]?\d?\d\.[012]?\d?\d\.[012]?\d?\d\.[012]?\d?\d&lt;/IpMatch&gt; --&gt;
    &lt;!-- Any IP starting with 65.55 (MSN bots the don't respect robots.txt  --&gt;
    &lt;!-- &lt;IpMatch&gt;65\.55\.[012]?\d?\d\.[012]?\d?\d&lt;/IpMatch&gt;   --&gt;
    &lt;!-- /BotBlocker --&gt;


    &lt;!--
      'Timer' enables or disables the generation of internal timing metrics for the OLFS
      If commented out the timing is disabled. If you want timing metrics to be output
      to the log then uncomment the Timer and set the enabled attribute's value to "true"
      WARNING: There is some performance cost to utilizing the Timer.
    --&gt;
    &lt;!-- Timer enabled="false" / --&gt;


&lt;/OLFSConfig&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_besmanager_element_required"><code>&lt;BESManager&gt;</code> Element (required)</h5>
<div class="paragraph">
<p>The BESManager information is used whenever the software needs to access the BES&#8217;s services.
This configuration is key to the function of Hyrax, for in it
is defined each BES instance that is connected to a given Hyrax installation. The following examples
will show a single BES example. For more information on configuring Hyrax to use multiple BESs
<a href="#config-hyrax-mult-BESs">look here</a>.</p>
</div>
<div class="paragraph">
<p>Each BES is identified using a seperate <code>&lt;BES&gt;</code> child element inside
of the <code>&lt;BESManager&gt;</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;BESManager&gt;
    &lt;BES&gt;
        &lt;prefix&gt;/&lt;/prefix&gt;
        &lt;host&gt;localhost&lt;/host&gt;
        &lt;port&gt;10022&lt;/port&gt;
        &lt;timeOut&gt;300&lt;/timeOut&gt;
        &lt;maxResponseSize&gt;0&lt;/maxResponseSize&gt;
        &lt;ClientPool maximum="10" maxCmds="2000" /&gt;
        &lt;adminPort&gt;11002&lt;/adminPort&gt;
    &lt;/BES&gt;
    &lt;NodeCache maxEntries="20000" refreshInterval="600"/&gt;
    &lt;SiteMapCache cacheFile="/tmp/SiteMap.cache" refreshInterval="600" /&gt;
&lt;/BESManager&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_bes_child_elements"><code>&lt;BES&gt;</code> Child Elements</h6>
<div class="paragraph">
<p>The <code>&lt;BES&gt;</code> child elements provide the OLFS with connection and control
information for a BES. There are three required child elements
within a <code>&lt;BES&gt;</code> element and four optional child elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>&lt;prefix&gt;</code> element (required)</strong>:
This element contains the URL prefix that the OLFS will associate with this BES.
It also maps this BES to the URI space that the OLFS services.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The prefix is a token that is placed between the
<code>host:port/context/</code> part of the Hyrax URL and the catalog root.
The catalog root is used to designate a particular BES instance in the
event that multiple BESs are available to a single OLFS.</p>
</div>
<div class="paragraph">
<p>If you have maintained the default configuration of a single BES,
the tag must be designated by a forward slash: <code>&lt;prefix&gt;/&lt;/prefix&gt;</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
There must be at least one <code>BES</code> element in the <code>BESManager</code>
handler configuration whose prefix has a value of <code>/</code>.
There may be more than one <code>&lt;BES&gt;</code>, but only this one is required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using multiple BESs, each BES must have an exposed mount point
as a directory (aka collection) in the URI space where it is going
to appear. It is important to note that the prefix string <strong>must</strong>
always begin with the slash (<code>/</code>) character: <code>&lt;prefix&gt;/data/nc&lt;/prefix&gt;</code>.
For more information, see
<a href="#config-hyrax-mult-BESs">Configuring With Multiple BESs</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p><strong><code>&lt;host&gt;</code> element (required)</strong>:
Contains the host name or IP address of the BES,
such as <code>&lt;host&gt;test.opendap.org&lt;/host&gt;</code>.</p>
</li>
<li>
<p><strong><code>&lt;port&gt;</code> element (required)</strong>:
Contains port number on which the BES is listening,
such as <code>&lt;port&gt;10022&lt;/port&gt;</code>.</p>
</li>
<li>
<p><strong><code>&lt;timeOut&gt;</code> element (optional)</strong>:
Contains the timeout time, in seconds, for the OLFS to wait
for this BES to respond, such as <code>&lt;timeOut&gt;600&lt;/timeOut&gt;</code>.
Its default value is 300.</p>
</li>
<li>
<p><strong><code>&lt;maxResponseSize&gt;</code> element (optional)</strong>:
Contains in bytes the maximum response size allowed for this BES.
Requests that produce a larger response will receive an error.
Its default value of zero indicates that there is no imposed limit:
<code>&lt;maxResponseSize&gt;0&lt;/maxResponseSize&gt;</code>.</p>
</li>
<li>
<p><strong><code>&lt;ClientPool&gt;</code> element (optional)</strong>:
Configures the behavior of the pool of client connections that the OLFS
maintains with this particular BES. These connections are pooled for
efficiency and speed: <code>&lt;ClientPool maximum="200" maxCmds="2000" /&gt;</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Notice that this element has two attributes, <code>maximum</code> and <code>maxCmds</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>maximum</code> attribute specifies the maximum number of concurrent
BES client connections that the OLFS can make. Its default value is 200.</p>
</li>
<li>
<p>The <code>maxCmds</code> attribute specifies the maximum number of commands that
can be issued over a particular <code>BESClient</code> connection. The default is 2000.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>&lt;ClientPool&gt;</code> element is missing, the pool (<code>maximum</code>) size defaults
to 200 and <code>maxCmds</code> defaults to 2000.</p>
</div>
</div>
</div>
</li>
<li>
<p><strong><code>&lt;adminPort&gt;</code> element (optional)</strong>:
Contains the port on the BES system that can be used by the Hyrax Admin Interface
to control the BES, such as <code>&lt;adminPort&gt;11002&lt;/adminPort&gt;</code>.
The BES must also be configured to open and use this admin port.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nodecache_child_element_optional"><code>&lt;NodeCache&gt;</code> Child Element (optional)</h5>
<div class="paragraph">
<p>The NodeCache element controls the state of the in-memory LRU cache for BES
catalog/node responses. It has two attributes, <code>refreshInterval</code> and
<code>maxEntries</code>.</p>
</div>
<div class="paragraph">
<p>The <code>refreshInterval</code> attribute specifies the time (in seconds) that any
particular item remains in the cache. If the underlying system has a lot of
change (model result output etc) then making this number smaller will increase
the rate at which the change becomes "available" through the Hyrax service, at
the expense of more cache churn and slower responses. If the underlying system
is fairly stable (undergoes little change) then refreshInterval can be larger
which will mean less cache churn and faster responses.</p>
</div>
<div class="paragraph">
<p>The <code>maxEntries</code> attribute defines the maximum number of entries to allowed in
the cache. If the serviced collection is large then making this larger will
definitely improve response times for catalogs etc.</p>
</div>
<div class="paragraph">
<p><em>Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;NodeCache maxEntries="20000" refreshInterval="600"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sitemapcache_child_element_optional"><code>&lt;SiteMapCache&gt;</code> Child Element (optional)</h5>
<div class="paragraph">
<p>The <code>SiteMapCache</code> element defines the location and life span of the SiteMap
response cache. A cache for the BES SiteMap response can be time consuming to
produce for larger systems (~4 minutes for a system with 110k directories and
560k files) This configuration element addresses this by providing a location
and refresh interval for a SiteMap cache. <code>SiteMapCache</code> has two attributes,
<code>cacheFile</code> and <code>refreshInterval</code>.</p>
</div>
<div class="paragraph">
<p>The optional <code>cacheFile</code> attribute may be used to identify a particular location
for the SiteMap cache file, if not provided it will be placed by default into
cache directory located in the active OLFS configuration directory.</p>
</div>
<div class="paragraph">
<p>The <code>refreshInterval</code> attribute expresses, in seconds, the time that a SiteMap
is held in the cache before the system generates a new one.</p>
</div>
<div class="paragraph">
<p><em>Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;SiteMapCache cacheFile="/tmp/SiteMap.cache" refreshInterval="600" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_threddsservice_element_optional"><code>&lt;ThreddsService&gt;</code> Element (optional)</h5>
<div class="paragraph">
<p>This configuration parameter controls the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The location of the static THREDDS catalog root in the
URI space serviced by Hyrax.</p>
</li>
<li>
<p>Whether the static THREDDS catalogs are held in memory or
read from disk for each request.</p>
</li>
<li>
<p>If the server will broker remote THREDDS catalogs and their data by following
<code>thredds:catalogRef</code> links that point to THREDDS catalogs on other systems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example configuration for the <code>&lt;ThreddsService&gt;</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;ThreddsService  prefix="thredds" useMemoryCache="true" allowRemote="false" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>&lt;ThreddsService&gt;</code> has several attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>prefix</code> attribute (optional)</strong>: Sets the name of the static THREDDS
catalogs' root in Hyrax. For example,
if the prefix is <code>thredds</code>, then <code><a href="http://localhost:8080/opendap/thredds/" class="bare">http://localhost:8080/opendap/thredds/</a></code>
will give you the top-level static catalog,
which is typically the contents of the file <code>/etc/olfs/opendap/catalog.xml</code>.
This attribute&#8217;s default value is <code>thredds</code>.</p>
</li>
</ul>
</div>
<div id="useMemoryCacheAttribute" class="ulist">
<ul>
<li>
<p><strong><code>useMemoryCache</code> attribute (optional)</strong>: This is a boolean value with a
default value of <code>true</code>.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If the value of this attribute is set to <code>true</code>,
the servlet will ingest all of the static
catalog files at startup and hold their contents in memory,
which is faster but more memory intensive.</p>
</li>
<li>
<p>If set to <code>false</code>, each request for a static THREDDS catalog
will cause the server to read and parse the catalog from disk,
which is slower but uses less memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#THREDDS-config">this page</a> for more information about the memory caching operations.</p>
</div>
</div>
</div>
</li>
<li>
<p><strong><code>allowRemote</code> attribute (optional)</strong>:
If this attribute is present and its value is set to <code>true</code>, then the server
will "broker" remote THREDDS catalogs and the data that they serve.
This means that the server, not the client, will perform the following steps:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the remote catalogs.</p>
</li>
<li>
<p>Render them for the requesting client.</p>
</li>
<li>
<p>Provide an interface for retrieving the remote data.</p>
</li>
<li>
<p>Allow Hyrax to perform any subsequent processing
before returning the result to the requesting client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This attribute has a default value of <code>false</code>.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_gatewayservice_optional"><code>&lt;GatewayService&gt;</code> (optional)</h5>
<div class="paragraph">
<p>Directs requests to the <a href="#gateway-service">Gateway Service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;GatewayService  prefix="gateway" useMemoryCache="true" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the attributes of <code>&lt;GatewayService&gt;</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>prefix</code> attribute (optional)</strong>: Sets location of the gateway service
in the URI space serviced by Hyrax. For example, if the prefix is <code>gateway</code>,
then <code><a href="http://localhost:8080/opendap/gateway/" class="bare">http://localhost:8080/opendap/gateway/</a></code> should give you the
Gateway Service page. This attribute&#8217;s default value is <code>gateway</code>.</p>
</li>
<li>
<p><strong><code>useMemoryCache</code> attribute (optional)</strong>:
See <a href="#useMemoryCacheAttribute">the previous section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_usedap2resourceurlresponse_element_optional"><code>&lt;UseDAP2ResourceUrlResponse /&gt;</code> element (optional)</h5>
<div class="paragraph">
<p>This element controls the type of response that Hyrax will provide to a client&#8217;s request
for the data resource URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;UseDAP2ResourceUrlResponse /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this element is present, the server will respond to
requests for data resource URLs by returning the DAP2 response
(either an error or the underlying data object). Commenting out or removing
the <code>&lt;UseDAP2ResourceUrlResponse /&gt;</code> element will cause the server to return the
DAP4 DSR response when a dataset resource URL is requested.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
DAP2 responses are not clearly defined by any specification, whereas DAP4 DSR
responses are well-defined by a specification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This element has no attributes or child elements and is enabled by default.</p>
</div>
</div>
<div class="sect4">
<h5 id="_addfileouttypesuffixtodownloadfilename_element_optional"><code>&lt;AddFileoutTypeSuffixToDownloadFilename /&gt;</code> element (optional)</h5>
<div class="paragraph">
<p>This optional element controls how the server constructs the download file name that
is transmitted in the HTTP Content-Disposition header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;AddFileoutTypeSuffixToDownloadFilename /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, suppose the <code>&lt;AddFileoutTypeSuffixToDownloadFilename /&gt;</code> element is
either commented out or not present. When a user requests a data response from
<code>somedatafile.hdf</code> in netCDF-3 format, the HTTP Content-Disposition header will be set
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Content-Disposition: attachment; filename="somedatafile.hdf"</pre>
</div>
</div>
<div class="paragraph">
<p>However, if the <code>&lt;AddFileoutTypeSuffixToDownloadFilename /&gt;</code> is present, then the
resulting response will have an HTTP Content-Disposition header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Content-Disposition: attachment; filename="somedatafile.hdf.nc"</pre>
</div>
</div>
<div class="paragraph">
<p>By default the server ships with this disabled.</p>
</div>
</div>
<div class="sect4">
<h5 id="_allowdirectdatasourceaccess_element_optional"><code>&lt;AllowDirectDataSourceAccess/&gt;</code> element (optional)</h5>
<div class="paragraph">
<p>The <code>&lt;AllowDirectDataSourceAccess/&gt;</code> element controls the user&#8217;s
ability to directly access data sources via the Hyrax web interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;!-- AllowDirectDataSourceAccess / --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this element is present and not commented out, a
client can retrieve an entire data source (such as an HDF file) by
requesting it through the HTTP URL interface.</p>
</div>
<div class="paragraph">
<p>This element has no attributes or child elements and is disabled by default.
We recommend that you leave it unchanged, unless you want users to be able
to circumvent the OPeNDAP request interface and have direct access to the data products
stored on your server.</p>
</div>
</div>
<div class="sect4">
<h5 id="bot-blocker"><code>&lt;BotBlocker&gt;</code> (optional)</h5>
<div class="paragraph">
<p>This optional element can be used to block access from specific IP
addresses or a range of IP addresses using regular expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;BotBlocker&gt;
    &lt;IpAddress&gt;128.193.64.33&lt;/IpAddress&gt;
    &lt;IpMatch&gt;65\.55\.[012]?\d?\d\.[012]?\d?\d&lt;/IpMatch&gt;
&lt;/BotBlocker&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;BotBlocker&gt;</code> has the following child elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>&lt;IpAddress&gt;</code> element</strong>: The text value of this element
should be the IP address of a system that you would like to
block from accessing your service. For example, <code>&lt;IpAddress&gt;128.193.64.33&lt;/IPAddress&gt;</code>
Will block the system located at <code>128.193.64.33</code> from accessing your server.</p>
<div class="paragraph">
<p>There can be zero or more <code>&lt;IpAddress&gt;</code> child elements in the <code>&lt;BotBlocker&gt;</code> element.</p>
</div>
</li>
<li>
<p><strong><code>&lt;IpMatch&gt;</code> element</strong>: The text value of this element
should be the regular expression that will be used to match
the IP addresses of clients attempting to access Hyrax.
For example, <code>&lt;IpMatch&gt;65\.55\.[012]?\d?\d\.[012]?\d?\d&lt;/IpMatch&gt;</code> matches
all IP addresses beginning with <code>65.55</code>, and thus blocks access for
clients whose IP addresses lie in that range.</p>
<div class="paragraph">
<p>There can be zero or more <code>&lt;IpMatch&gt;</code> child  elements in <code>&lt;BotBlocker</code> element.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="developer-options">Developer Options</h5>
<div class="paragraph">
<p>These configuration options are intended to be used by developers
that are engaged in code developement for components of Hyrax.
They are <strong>not meant to be enabled</strong> in any kind of production environment.
They are included here for transparency and to help
potential contributors to the Hyrax project.</p>
</div>
<div class="sect5">
<h6 id="_timer"><code>&lt;Timer&gt;</code></h6>
<div class="paragraph">
<p>The <code>&lt;Timer&gt;</code> attribute enables or disables the generation of internal timing metrics for the OLFS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;Timer enabled="true"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>Timer</code> has a single attribute, <code>enabled</code>, which is a boolean value.
Uncommenting this value and setting it to <code>true</code> will output timing metrics to the log.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Enabling the <code>Timer</code> will impose significant performance overhead on the
server&#8217;s operation and should ony be done in an effort to understand the
relative times spent in different operations--<strong>not</strong> as a mechanism for
measuring the server&#8217;s objective performance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_ingesttransformfile_child_element_developer"><code>&lt;ingestTransformFile&gt;</code> child element (developer)</h6>
<div class="paragraph">
<p>This child element of the <code>ThreddsService</code> element is a special code development option
that allows a developer to specify the fully qualified path to an XSLT file that will be
used to preprocess each THREDDS catalog file read from disk:</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;ingestTransformFile&gt;/fully/qualified/path/to/transfrm.xsl&lt;/ingestTransformFile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default version of this file, found in
<code>$CATALINA_HOME/webapps/opendap/xsl/threddsCatalogIngest.xsl</code>,
processes the <code>thredds:datasetScan</code> elements in each THREDDS catalog
so that they contain specific content for Hyrax.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_viewers_service_viewers_xml_file">3.6.4. Viewers Service (<code>viewers.xml</code> file)</h4>
<div class="paragraph">
<p>The Viewers service provides, for each dataset, an HTML page that contains
links to Java WebStart applications and to WebServices, such as WMS and WCS,
that can be used in conjunction with the dataset. The Viewers
service is configured via the contents of the <code>viewers.xml</code> file, typically located
at the following location: <code>/etc/olfs/viewers.xml</code>.</p>
</div>
<div class="sect4">
<h5 id="_viewers_xml_configuration_file"><code>viewers.xml</code> Configuration File</h5>
<div class="paragraph">
<p>The <code>viewers.xml</code> contains a list of two types of elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;JwsHandler&gt;</code> elements</p>
</li>
<li>
<p><code>&lt;WebServiceHandler&gt;</code> elements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The details of these are discussed elsewhere in the documentation.
The following is an example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;ViewersConfig&gt;
 
    &lt;JwsHandler className="opendap.webstart.IdvViewerRequestHandler"&gt;
        &lt;JnlpFileName&gt;idv.jnlp&lt;/JnlpFileName&gt;
    &lt;/JwsHandler&gt;
 
    &lt;JwsHandler className="opendap.webstart.NetCdfToolsViewerRequestHandler"&gt;
        &lt;JnlpFileName&gt;idv.jnlp&lt;/JnlpFileName&gt;
    &lt;/JwsHandler&gt;
 
    &lt;JwsHandler className="opendap.webstart.AutoplotRequestHandler" /&gt;
 
    &lt;WebServiceHandler className="opendap.viewers.NcWmsService" serviceId="ncWms"&gt;
        &lt;applicationName&gt;Web Mapping Service&lt;/applicationName&gt;
        &lt;NcWmsService href="/ncWMS/wms" base="/ncWMS/wms" ncWmsDynamicServiceId="lds" /&gt;
    &lt;/WebServiceHandler&gt;
 
    &lt;WebServiceHandler className="opendap.viewers.GodivaWebService" serviceId="godiva"&gt;
        &lt;applicationName&gt;Godiva WMS GUI&lt;/applicationName&gt;
        &lt;NcWmsService href="http://localhost:8080/ncWMS/wms" base="/ncWMS/wms" ncWmsDynamicServiceId="lds"/&gt;
        &lt;Godiva href="/ncWMS/godiva2.html" base="/ncWMS/godiva2.html"/&gt;
    &lt;/WebServiceHandler&gt;
 
&lt;/ViewersConfig&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logging">3.6.5. Logging</h4>
<div class="paragraph">
<p>For information about logging, see the
<a href="#logging-configuration">Hyrax Logging Configuration Documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_and_authorization">3.6.6. Authentication and Authorization</h4>
<div class="paragraph">
<p>The following subsections detail authentication and authorization.</p>
</div>
<div class="sect4">
<h5 id="_apache_web_server_httpd">Apache Web Server (httpd)</h5>
<div class="paragraph">
<p>If your organization desires secure access and authentication layers
for Hyrax, the recommended method is to use Hyrax in conjunction the
Apache Web Server (httpd).</p>
</div>
<div class="paragraph">
<p>Most organizations that use secure access and authentication for
their web presence are already doing so via Apache Web Server, and Hyrax
can be integrated nicely with this existing infrastructure.</p>
</div>
<div class="paragraph">
<p>More about integrating Hyrax with Apache Web Server can be found at
these pages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#apache-integration">Integrating Hyrax with Apache Web Server</a></p>
</li>
<li>
<p><a href="#user-authentication">Configuring Hyrax and Apache for User Authentication and
Authorization</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_tomcat">Tomcat</h5>
<div class="paragraph">
<p>Hyrax may be used with the security features implemented by Tomcat for
authentication and authorization services.
We recommend that you read carefully and understand the Tomcat
security documentation.</p>
</div>
<div class="paragraph">
<p>For Tomcat 7.x see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tomcat.apache.org/tomcat-7.0-doc/index.html">Tomcat 7.x
Documentation</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://tomcat.apache.org/tomcat-7.0-doc/realm-howto.html">Section 7:
Realm Configuration HOW-TO</a></p>
</li>
<li>
<p><a href="https://tomcat.apache.org/tomcat-7.0-doc/ssl-howto.html">Section 13:
SSL/TLS Configuration HOW-TO</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Tomcat 8.5.x see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://tomcat.apache.org/tomcat-8.5-doc/index.html">Tomcat 8.5.x
Documentation</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://tomcat.apache.org/tomcat-8.5-doc/realm-howto.html">Section 7:
Realm Configuration HOW-TO</a></p>
</li>
<li>
<p><a href="https://tomcat.apache.org/tomcat-8.5-doc/ssl-howto.html">Section 13:
SSL/TLS Configuration HOW-TO</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We also recommend that you read chapter 12 of the
<a href="http://jcp.org/aboutJava/communityprocess/final/jsr154/index.html">Java
Servlet Specification 2.4</a> that decribes how to configure security
constraints at the web-application-level.</p>
</div>
<div class="paragraph">
<p>Tomcat security requires fairly extensive additions to the <code>web.xml</code>
file located here: <code>${CATALINA_HOME}/webapps/opendap/WEB-INF/web.xml</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong><em>Altering the <code>&lt;servlet&gt;</code> definitions may render your Hyrax
server inoperable.</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples of security content for the <code>web.xml</code> file can be found in the
persistent content directory of the Hyrax server, which by default is
located here <code>$CATALINA_HOME/webapps/opendap/WEB-INF/conf/TomcatSecurityExample.xml</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_limitations">Limitations</h5>
<div class="paragraph">
<p>Tomcat security officially supports <em>context</em>-level authentication. This
means that you can restrict access to the collection of servlets
running in a single web application (i.e. all of the stuff
that is defined in a single <em>web.xml</em> file). You can call out different
authentication rules for different `&lt;url-pattern&gt;`s within the web
application, but only clients that do not cache ANY security
information will be able to easily access the different areas.</p>
</div>
<div class="paragraph">
<p>For example, in your <em>web.xml</em> file you might have the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;fnoc1&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/hyrax/nc/fnoc1.txt&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;fn1&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;
 
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
             &lt;web-resource-name&gt;fnoc2&lt;/web-resource-name&gt;
             &lt;url-pattern&gt;/hyrax/nc/fnoc2.txt&lt;/url-pattern&gt;
         &lt;/web-resource-collection&gt;
         &lt;auth-constraint&gt;
             &lt;role-name&gt;fn2&lt;/role-name&gt;
          &lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;
 
    &lt;login-config&gt;
        &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
        &lt;realm-name&gt;MyApplicationRealm&lt;/realm-name&gt;
    &lt;/login-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the security roles fn1 and fn2 (defined in the <strong>tomcat-users.xml</strong>
file) have no common members.</p>
</div>
<div class="paragraph">
<p>The complete URI&#8217;s would be&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://localhost:8080/mycontext/hyrax/nc/fnoc1.txt
http://localhost:8080/mycontext/hyrax/nc/fnoc2.txt</pre>
</div>
</div>
<div class="paragraph">
<p>This works for clients that do not cache anything; however, if you access
these URLs with a typical internet browser, authenticating one URI
would lock you out of the other URI until you "reset" the browser by
purging all caches.
This happens, because, in the exchange between Tomcat and the
client, Tomcat sends the header
<code>WWW-Authenticate: Basic realm="MyApplicationRealm"</code>,
and the client authenticates.</p>
</div>
<div class="paragraph">
<p>When you access the second URI, Tomcat sends the same authentication challenge
with the same <code>WWW-Authenticate</code> header. The client, having recently authenticated to
this <em>realm-name</em> (defined in the <code>&lt;login-config&gt;</code> element in the
web.xml file - see above), resends the authentication information, and,
since it is not valid for that url pattern, the request is denied.</p>
</div>
</div>
<div class="sect4">
<h5 id="_persistence">Persistence</h5>
<div class="paragraph">
<p>Be sure to back up your modified <em>web.xml</em> file to a
location outside of the <em>$CATALINA_HOME/webapps/opendap</em> directory, as
newly-installed versions of Hyrax will overwrite it.</p>
</div>
<div class="paragraph">
<p>You could, for example, use an <em>XML ENTITY</em> and an <em>entity reference</em> in the <em>web.xml</em>.
This will cause a local file containing the security configuration to be included in the
<code>web.xml</code>. For example&#8230;&#8203;</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the <em>ENTITY</em></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[&lt;!ENTITY securityConfig SYSTEM "file:/fully/qualified/path/to/your/security/config.xml"&gt;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>to the <em>!DOCTYPE</em> declaration at the top of the <em>web.xml</em>.</p>
</div>
</li>
<li>
<p>Add an <em>entity reference</em> (<code>&securityConfig;</code>) to the content of
the <em>web-app</em> element. This would cause your external
security configuration to be included in the <em>web.xml</em> file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following is an example <em>ENTITY</em> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;

    &lt;!DOCTYPE web-app
        PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"
        "http://java.sun.com/j2ee/dtds/web-app_2_2.dtd"
        [&lt;!ENTITY securityConfig      SYSTEM "file:/fully/qualified/path/to/your/security/config.xml"&gt;]
    &gt;
    &lt;web-app&gt;

        &lt;!--
            Loads a persistent security configuration from the content directory.
            This configuration may be empty, in which case no security constraints will be
            applied by Tomcat.
        --&gt;
        &amp;securityConfig;

        .
        .
        .

    &lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will not prevent you from losing your <em>web.xml</em> file when a new
version of Hyrax is installed, but adding the <em>ENTITY</em> to the new
<em>web.xml</em> file is easier than remembering an extensive security
configuration.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compressed_responses_and_tomcat">3.6.7. Compressed Responses and Tomcat</h4>
<div class="paragraph">
<p>Many OPeNDAP clients accept compressed responses. This can greatly
increase the efficiency of the client/server interaction by diminishing
the number of bytes actually transmitted over "the wire." Tomcat
provides native compression support for the GZIP compression mechanism;
however, it is NOT turned on by default.</p>
</div>
<div class="paragraph">
<p>The following example is based on Tomcat 7.0.76. We recommend that you
carefully read the Tomcat documentation related to this topic before
proceeding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://tomcat.apache.org/">Tomcat Home</a></p>
</li>
<li>
<p><a href="https://tomcat.apache.org/tomcat-7.0-doc/config/http.html">Tomcat 7.x
documentation for the HTTP Connector</a> (see Standard Implementation section)</p>
</li>
<li>
<p><a href="https://tomcat.apache.org/tomcat-8.5-doc/config/http.html">Tomcat 8.5.x
documentation for the HTTP/1.1 Connector</a>(see Standard Implementation section)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_details">Details</h5>
<div class="paragraph">
<p>To enable compression, you will need to edit the <em>$CATALINA_HOME/conf/server.xml</em> file.
Locate the <code>&lt;Connector&gt;</code> element associated with your server. It is typically
the only <code>&lt;Connector&gt;</code> element whose <em>port</em> attribute is set equal to 8080.
You will need to add or change several of its attributes to enable compression.</p>
</div>
<div class="paragraph">
<p>With our Tomcat 7.0.76 distribution, we found this default <code>&lt;Connector&gt;</code>
element definition in our <em>server.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;Connector
        port="8080"
        protocol="HTTP/1.1"
        connectionTimeout="20000"
        redirectPort="8443"
    /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need to add four attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">compression="force"
compressionMinSize="2048"
compressableMimeType="text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/octet-stream,application/vnd.opendap.dap4.dataset-services+xml,application/vnd.opendap.dap4.dataset-metadata+xml,application/vnd.opendap.dap4.data,application/vnd.opendap.dap4.error+xml,application/json,application/prs.coverage+json,application/rdf+xml,application/x-netcdf;ver=4,application/x-netcdf,image/tiff;application=geotiff"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of compressible MIME types includes all known response types for Hyrax.
The <code>compression</code> attribute may have the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>compression="no"</code></strong>: Nothing is compressed (default if not provided).</p>
</li>
<li>
<p><strong><code>compression="yes"</code></strong>: Only the compressible MIME types are compressed.</p>
</li>
<li>
<p><strong><code>compression="force"</code></strong>: Everything gets compressed (assuming the
client accepts gzip and the response is bigger than compressionMinSize).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You <strong>must</strong> set <code>compression="force"</code> for compression to work with the
OPeNDAP data transport.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you are finished, your <code>&lt;Connector&gt;</code> element should look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">    &lt;Connector
        port="8080"
        protocol="HTTP/1.1"
        connectionTimeout="20000"
        redirectPort="8443"
        compression="force"
        compressionMinSize="2048"
        compressableMimeType="text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/octet-stream,application/vnd.opendap.dap4.dataset-services+xml,application/vnd.opendap.dap4.dataset-metadata+xml,application/vnd.opendap.dap4.data,application/vnd.opendap.dap4.error+xml,application/json,application/prs.coverage+json,application/rdf+xml,application/x-netcdf;ver=4,application/x-netcdf,image/tiff;application=geotiff"
     /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart Tomcat for these changes to take effect.</p>
</div>
<div class="paragraph">
<p>You can verify the change by using curl as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">curl -H "Accept-Encoding: gzip" -I http://localhost:8080/opendap/data/nc/fnoc1.nc.ascii</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above URL is for Hyrax running on your local system and accessing a dataset that ships with the server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You&#8217;ll know that compression is enabled if the response to the curl command contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Content-Encoding: gzip</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using Tomcat in conjunction with the Apache Web Server
(our friend httpd) via AJP, you will need to also
<a href="#apache-compressed-responses">configure Apache to deliver compressed responses</a>
Tomcat will not compress content sent over the AJP connection.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pitfalls_with_centos_7_x_andor_selinux">3.6.8. Pitfalls with CentOS-7.x and/or SELinux</h4>
<div class="paragraph">
<p>SELinux (bundled by default with CentOS-7) will create some new challenges for those
not familiar with the changes it brings to the system environment. For one, Tomcat runs as a
<em>confined</em> user. Here we&#8217;ll examine how these changes affect the OLFS.</p>
</div>
<div class="sect5">
<h6 id="_localizing_the_olfs_configuration_under_selinux">Localizing the OLFS Configuration under SELinux</h6>
<div class="paragraph">
<p>When using a <code>yum</code>-installed Tomcat on CentOS-7.x (or any other Linux
environment that is essentially an <strong>SELinux</strong> variant), neither the <code>/etc/olfs</code>
or the <code>/usr/share/olfs</code> configuration locations will work without taking extra steps.
You must alter the SELinux access policies to give the Tomcat user
permission to read and write to one of these directories.</p>
</div>
<div class="paragraph">
<p>The following code block will configures the <code>/usr/share/olfs</code> directory for reading
and writing by the Tomcat user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#!/bin/sh
# You must be the super user to do this stuff...
sudo -s

# Create the location for the local configuration
mkdir -p /usr/share/olfs

# Change the group ownership to the tomcat group.
# (SELinux will not allow you make the owner tomcat.)
chgrp tomcat /usr/share/olfs

# Make it writable by the tomcat group
sudo chmod g+w /usr/share/olfs

# Use semanage to change the context of the target
# directory and any (future) child dirs
semanage fcontext -a -t tomcat_var_lib_t "/usr/share/olfs(/.*)?"

# Use restorecon to commit/do the labeling.
restorecon -rv /usr/share/olfs</pre>
</div>
</div>
<div class="paragraph">
<p>For further reading about SELinux and its permissions issues, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.centos.org/HowTos/SELinux" class="bare">https://wiki.centos.org/HowTos/SELinux</a></p>
</li>
<li>
<p><a href="https://noobient.com/post/165842438861/selinux-crash-course" class="bare">https://noobient.com/post/165842438861/selinux-crash-course</a></p>
</li>
<li>
<p><a href="https://noobient.com/post/165972214381/selinux-woes-with-tomcat-on-centos-74" class="bare">https://noobient.com/post/165972214381/selinux-woes-with-tomcat-on-centos-74</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_tomcat_logs">Tomcat Logs</h5>
<div class="paragraph">
<p>In SELinux the <code>yum</code>-installed Tomcat does not produce a <code>catalina.out</code> file;
rather, the output is sent to the <strong><em>journal</em></strong> and can be viewed with the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">journalctl -u tomcat</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config-hyrax-mult-BESs">3.6.9. Configuring The OLFS To Work With Multiple BES&#8217;s</h4>
<div class="paragraph">
<p>Configuring Hyrax to use multiple BES backends is straight forward. It
will require that you edit the <strong>olfs.xml</strong> file and possible the
<strong>catalog.xml</strong> file.</p>
</div>
<div class="sect4">
<h5 id="_top_level_root_bes">Top Level (<em>root</em>) BES</h5>
<div class="paragraph">
<p>Every installation of Hyrax requires a top level (or <em>root</em> level)
BES. This BES has a <em>prefix</em> of "/" (the forward slash character). The
prefix is a URL token between the server address/port and catalog root
used to designate a particular BES instance in the case that multiple
Back-End-Servers are available to a single OLFS. The default (for a
single BES) is no additional tag, designated by "/". The prefix is used
to provide a mapping for each BES connected to the OLFS to URI space
serviced by the OLFS.</p>
</div>
<div class="paragraph">
<p>In a single BES deployment this BES would contain all of the data
resources to be made visible in Hyrax. In the THREDDS <em>catalog.xml</em> file
each top level directory/collection would have it&#8217;s own
&lt;<em>datasetScan</em>&gt; element.</p>
</div>
<div class="paragraph">
<p><em>Note:</em> The word <em>root</em> here has <strong>absolutely nothing</strong> to do with
the login account called root associated with the super user or system
administrator.</p>
</div>
</div>
<div class="sect4">
<h5 id="_single_bes_example_default">Single BES Example (Default)</h5>
<div class="paragraph">
<p>Here is the &lt;<em>Handler</em>&gt; element in an <strong>olfs.xml</strong> that defines the
opendap.bes.BESManager file that configures the OLFS to use a single
BES, the default configuration arrangement for Hyrax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;
        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;localhost&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;
    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The BES is running on the same system as the OLFS, and it&#8217;s prefix is
correctly set to "/". This BES will handle all data requests directed at
the OLFS and will expose it&#8217;s top level directory/collection/catalog in
the URI space of the OLFS here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://localhost:8080/opendap/</pre>
</div>
</div>
<div class="paragraph">
<p>The THREDDS <strong>catalog.xml</strong> file for this should contain a
&lt;<em>datasetScan</em>&gt; element for each of the top level directories |
collections | catalogs that the BES exposes at the above URI.</p>
</div>
<div class="paragraph">
<p><em>*Remember*</em>: There <strong>must</strong> be one (but only one) BES configured with
the &lt;<em>prefix</em>&gt; set to "/" in your <strong>olf.xml</strong> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_bes_examples">Multiple BES examples</h5>
<div class="paragraph">
<p>Here is a BESManager &lt;<em>Handler</em>&gt; element that defines two BES&#8217;s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;localhost&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;comet.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The first one is running on the same system as the OLFS, the second on
<em>comet. test.org</em>. The second BES is mapped to the prefix /sst. So the
URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://localhost:8080/opendap/</pre>
</div>
</div>
<div class="paragraph">
<p>Will return the directory view at the top level of the first BES,
running on the same system as the OLFS. The URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://localhost:8080/opendap/sst</pre>
</div>
</div>
<div class="paragraph">
<p>Will return the directory view at the top level of the second BES,
running on <em>comet.test.org</em>.</p>
</div>
<div class="paragraph">
<p>You can repeat this pattern to add more BES&#8217;s to the configuration. This
next example shows a configuration with 4 BES&#8217;s: The <em>root</em> BES, and 3
others:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;server1.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/chl-a&lt;/prefix&gt;
            &lt;host&gt;server2.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/salinity&lt;/prefix&gt;
            &lt;host&gt;server3.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <em>root</em> BES is not necessarily running on the same host as the
OLFS.</p>
</li>
<li>
<p>Every BES has a different prefix.</p>
</li>
<li>
<p>The OLFS would direct requests so that requests to:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://localhost:8080/opendap/sst/*" class="bare">http://localhost:8080/opendap/sst/*</a> are handled by the BES at
server1.test.org</p>
</li>
<li>
<p><a href="http://localhost:8080/opendap/chl-a/*" class="bare">http://localhost:8080/opendap/chl-a/*</a> are handled by the BES at
server2.test.org</p>
</li>
<li>
<p><a href="http://localhost:8080/opendap/salinity/*" class="bare">http://localhost:8080/opendap/salinity/*</a> are handled by the BES at
server3.test.org</p>
</li>
<li>
<p>The BES at server0.test.org would handle everything else.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_mount_points">Mount Points</h5>
<div class="paragraph">
<p>In a multiple BES installation each additional BES must have a <em>mount
point</em> within the exposed hierarchy of collections for it to be visible
in Hyrax.</p>
</div>
<div class="paragraph">
<p>Consider, if you have this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>And the top level directory for the <em>root</em> BES looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/TopDir.png" alt="TopDir">
</div>
</div>
<div class="paragraph">
<p>If you add another BES, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;server5.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>It will not appear in the top level directory unless you create a
<em>mount point</em>.</strong> This simply means that on the file system served by
the <em>root</em> BES you would need to create a directory called "sst" in the
top of the directory tree that the <em>root</em> BES is exposing. In other
words, simply create a directory called "sst" in the same directory that
contains the "Test" and "data" directories on server0.test.org. After
you did that your top level directory would look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/TopDir2.png" alt="TopDir2">
</div>
</div>
<div class="paragraph">
<p>This holds true for any arrangement of BESs that you make. The location
of the <em>mount point</em> will depend on your configuration, and how you
organize things. Here is a more complex example.</p>
</div>
<div class="paragraph">
<p>Consider this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Handler className="opendap.bes.BESManager"&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature &lt;/prefix&gt;
            &lt;host&gt;server1.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica&lt;/prefix&gt;
            &lt;host&gt;server2.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica/Canada &lt;/prefix&gt;
            &lt;host&gt;server3.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica/USA &lt;/prefix&gt;
            &lt;host&gt;server4.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/Europe/France &lt;/prefix&gt;
            &lt;host&gt;server4.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum="10" /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>mount point</em> "GlobalTemperature" must be in the top of the
directory tree that the <em>root</em> BES on server0.test.org is exposing.</p>
</li>
<li>
<p>The <em>mount point</em> "NorthAmerica" must be in the top of the directory
tree that the BES on server1.test.org is exposing.</p>
</li>
<li>
<p>The <em>mount point</em> "Canada" must be in the top of the directory tree
that the BES on server2.test.org is exposing.</p>
</li>
<li>
<p>The <em>mount point</em> "USA" must be in the top of the directory tree that
the BES on server2.test.org is exposing.</p>
</li>
<li>
<p>The <em>mount point</em> "France" must be located at
"GlobalTemperature/Europe/France" relative to the top of the directory
tree that the BES on server0.test.org is exposing.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_complete_olfs_xml_with_multiple_bes_installations_example">Complete olfs.xml with multiple BES installations example</h5>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;OLFSConfig&gt;

    &lt;DispatchHandlers&gt;

        &lt;HttpGetHandlers&gt;

            &lt;Handler className="opendap.bes.BESManager"&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/&lt;/prefix&gt;
                    &lt;host&gt;server0.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature &lt;/prefix&gt;
                    &lt;host&gt;server1.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica&lt;/prefix&gt;
                    &lt;host&gt;server2.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica/Canada &lt;/prefix&gt;
                    &lt;host&gt;server3.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica/USA &lt;/prefix&gt;
                    &lt;host&gt;server4.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/Europe/France &lt;/prefix&gt;
                    &lt;host&gt;server4.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum="10" /&gt;
                &lt;/BES&gt;

            &lt;/Handler&gt;

            &lt;Handler className="opendap.coreServlet.SpecialRequestDispatchHandler" /&gt;

            &lt;Handler className="opendap.bes.VersionDispatchHandler" /&gt;

            &lt;Handler className="opendap.bes.DirectoryDispatchHandler"&gt;
                &lt;DefaultDirectoryView&gt;OPeNDAP&lt;/DefaultDirectoryView&gt;
            &lt;/Handler&gt;

            &lt;Handler className="opendap.bes.DapDispatchHandler" /&gt;

            &lt;Handler className="opendap.bes.FileDispatchHandler" &gt;
                &lt;!-- &lt;AllowDirectDataSourceAccess /&gt; --&gt;
            &lt;/Handler&gt;

            &lt;Handler className="opendap.bes.ThreddsDispatchHandler" /&gt;

        &lt;/HttpGetHandlers&gt;

        &lt;HttpPostHandlers&gt;
            &lt;Handler className="opendap.coreServlet.SOAPRequestDispatcher" &gt;
                &lt;OpendapSoapDispatchHandler&gt;opendap.bes.SoapDispatchHandler&lt;/OpendapSoapDispatchHandler&gt;
            &lt;/Handler&gt;
        &lt;/HttpPostHandlers&gt;

    &lt;/DispatchHandlers&gt;

&lt;/OLFSConfig&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logging-configuration">3.6.10. Logging Configuration Introduction</h4>
<div class="paragraph">
<p>We see logging activities falling into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Access Logging</strong> - Is used to monitor server usage, server performance,
and to see which resources are receiving the most attention. Tomcat has
a very nice built-in Access Logging mechanism; all you have to do is
turn it on.</p>
</li>
<li>
<p><strong>Informational and debug logging</strong> - Most developers (myself included)
rely on a collection of imbedded "instrumentation" that allows them to
monitor their code and see what parts are being executed. Typically we
like to design this instrumentation so that it can be enabled or disabled
at runtime. Hyrax has this type of debugging instrumentation and ships
with it disabled, but you could enable it. If you were to encounter an
internal problem with Hyrax, you should enable different aspects of
the instrumentation at you site, so that we can review the output to
determine the issue.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_access_logging">Access Logging</h5>
<div class="paragraph">
<p>Many people will want to record access logs for their Hyrax server. <strong>We</strong>
want you to keep access logs for your Hyrax server. The easiest way to
get a simple access log for Hyrax is to utilize the Tomcat/Catalina
<a href="http://tomcat.apache.org/tomcat-5.0-doc/config/valve.html">Valve
Component</a>.</p>
</div>
<div class="sect5">
<h6 id="_accesslogvalve">AccessLogValve</h6>
<div class="paragraph">
<p>Since Hyrax&#8217;s public facade is provided by the OLFS running inside of
the Tomcat servlet container, you may utilize Tomcat&#8217;s handy access
logging which relies on the
<a href="http://tomcat.apache.org/tomcat-5.0-doc/catalina/docs/api/org/apache/catalina/valves/AccessLogValve.html">org.apache.catalina.valves.AccessLogValve
class</a> class. By default Tomcat comes with this turned off.</p>
</div>
<div class="paragraph">
<p>To turn it on,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Locate the file $CATALINA_HOME/conf/servlet.html.</p>
</li>
<li>
<p>Find the commented out section for the access log inside the &lt;Host&gt;
element. The server.xml file contains a good deal of comments, both for
instruction and containing code examples. The part you are looking for
is nested inside of the &lt;Service&gt; and the &lt;Engine&gt; elements. Typically
it will look like:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Service ...&gt;
    .
    .
    .
    &lt;Engine...&gt;
        .
        .
        .
        &lt;Host name="localhost" appBase="webapps"
            unpackWARs="true" autoDeploy="true"
            xmlValidation="false" xmlNamespaceAware="false"&gt;
            .
            .
            .
            &lt;!-- Access log processes all requests for this virtual host.
                 By default, log files are created in the "logs"
                 directory relative to $CATALINA_HOME.  If you wish, you can
                 specify a different directory with the "directory"
                 attribute.  Specify either a relative (to $CATALINA_HOME)
                 or absolute path to the desired directory. --&gt;

            &lt;!--
            &lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                   directory="logs"  prefix="localhost_access_log." suffix=".txt"
                   pattern="common" resolveHosts="false"/&gt;
            --/&gt;
            .
            .
            .
        &lt;/Host&gt;
        .
        .
        .
    &lt;/Engine&gt;
    .
    .
    .
&lt;/Service&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can uncomment the &lt;<em>Valve</em>&gt; element to enable it, and you can
change the values of the various attributes to suite your localization.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">            &lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                   directory="logs"
                   prefix="access_log."
                   suffix=".log"
                   pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b %D"
                   resolveHosts="false"/&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Save the file.</p>
</li>
<li>
<p>Restart Tomcat.</p>
</li>
<li>
<p>Read your log files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note</strong> that the <em>pattern</em> atribute allows you to customize the
content of the access log entries. It is documented in the
<a href="http://tomcat.apache.org/tomcat-5.0-doc/catalina/docs/api/index.html">javadocs
for Tomcat/Catalina</a> as part of the
<a href="http://tomcat.apache.org/tomcat-5.0-doc/catalina/docs/api/org/apache/catalina/valves/AccessLogValve.html">org.apache.catalina.valves.AccessLogValve</a>
class and here in the
<a href="http://tomcat.apache.org/tomcat-5.0-doc/config/valve.html">Server
Configuration Reference</a>. The pattern shown above will provide log
output that looks like the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">        69.59.200.52 - - [05/Mar/2007:16:29:14 -0800] "GET /opendap/data/nc/contents.html HTTP/1.1" 200 13014 234
        69.59.200.52 - - [05/Mar/2007:16:29:14 -0800] "GET /opendap/docs/images/logo.gif HTTP/1.1" 200 8114 2
        69.59.200.52 - - [05/Mar/2007:16:29:51 -0800] "GET /opendap/data/nc/TestPatDbl.nc.html HTTP/1.1" 200 11565 137
        69.59.200.52 - - [05/Mar/2007:16:29:56 -0800] "GET /opendap/data/nc/data.nc.ddx HTTP/1.1" 200 2167 121</pre>
</div>
</div>
<div class="paragraph">
<p>The last column is the time in milliseconds it took to service the
request and the next to the last column is the number of bytes returned.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_informational_and_debug_logging_using_the_logback_implementation_of_log4j">Informational and Debug Logging (Using the Logback implementation of Log4j)</h5>
<div class="paragraph">
<p>In general you shouldn&#8217;t have to modify the default logging
configuration for Hyrax. It may become necessary if you encounter
problems, but otherwise we suggest you leave it be.</p>
</div>
<div class="paragraph">
<p>Having said that, Hyrax uses the Logback logging package to provide an
easily configurable and flexible logging environment. All "console"
output is routed through the Logback package and can be controlled using
the Logback configuration file.</p>
</div>
<div class="paragraph">
<p>There are several logging levels available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TRACE</p>
</li>
<li>
<p>DEBUG</p>
</li>
<li>
<p>INFO</p>
</li>
<li>
<p>WARN</p>
</li>
<li>
<p>ERROR</p>
</li>
<li>
<p>FATAL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hyrax ships with a default logging level of <strong>ERROR</strong>.</p>
</div>
<div class="paragraph">
<p>Additionally, Hyrax maintains its own access log using Logback.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We strongly recommend that you take the time to
<a href="http://logback.qos.ch/manual/index.html">read about Logback and Log4j</a>
before you attempt to manipulate the Logback configuration.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_configuration_file_location">Configuration File Location</h6>
<div class="paragraph">
<p>Logback gets its configuration from an XML file. Hyrax locates this
file in the following manner:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Checks the &lt;init-parameter&gt; list for the hyrax servlet (in the
web.xml) for a an &lt;init-parameter&gt; called "logbackConfig". If found, the
value of this parameter is assumed to be a fully qualified path name for
the file. This can be used to specify alternate Logback config files.<br>
<strong>Note:</strong> This configuration will not be persistent across new
installations of Hyrax. We do <strong>not</strong> recommend setting this parameter, as
doing so is not persistent&#8212;&#8203;it will be overridden the next time the Web
ARchive file is deployed.</p>
</li>
<li>
<p>Failing 1: Hyrax then checks in the persistent content directory
(<a href="#OLFS-config-location">set by either the OLFS_CONFIG_DIR environment variable or in /etc/olfs</a>)
for the file "logback-test.xml". If this file is present then it will be
used to configure logging, and new installations of Hyrax will detect and
use this logging configuration automatically.</p>
</li>
<li>
<p>Failing 2: Hyrax then checks in the persistent content directory
(<a href="#OLFS-config-location">set by either the OLFS_CONFIG_DIR environment variable or in /etc/olfs</a>)
for the file "logback.xml". If this file is present then it will be used to
configure logging, and new installations of Hyrax will detect and use
this logging configuration automatically.</p>
</li>
<li>
<p>Failing 3: Hyrax falls back to the logback.xml file shipped with the
distribution which is located in the
<em>$CATALINA_HOME/webapps/opendap/WEB-INF</em> directory. Changes made to this
file will be lost when a new version of Hyrax is installed or the
opendap.war Web ARchive file is redeployed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So - if you want to customize your Hyrax logging and have it be
persistent, do it by copying the distributed logback.xml file
(<em>$CATALINA_HOME/webapps/opendap/WEB-INF/logback.xml</em>) to the
persistent content directory
(<a href="#OLFS-config-location">set by either the OLFS_CONFIG_DIR environment variable or in /etc/olfs</a>)
and editing that copy.</p>
</div>
</div>
<div class="sect5">
<h6 id="_configuration">Configuration</h6>
<div class="paragraph">
<p>Did you <a href="http://logback.qos.ch/manual/index.html">read about LogBack and
Log4j</a>? Great!</p>
</div>
<div class="paragraph">
<p>There are a number of <em>Appenders</em> defined in the Hyrax <em>log4j.xml</em> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>stdout</strong> - Loggers using this Appender will send everything to the
console/stdout - which in a Tomcat environment will get shunted into the
file <em>$TOMCAT_HOME/logs/catalina.out</em>.</p>
</li>
<li>
<p><strong>devNull</strong> - Loggers using this Appender will not log. All messages
will be discarded. This is the Log4j equivalent of piping your output
into <em>/dev/null</em> in a UNIX environment.</p>
</li>
<li>
<p><strong>ErrorLog</strong> - Loggers using this Appender will have their log output
placed in the error log file in the persistent content directory:
<em>$TOMCAT_HOME/content/opendap/logs/error.log</em>.</p>
</li>
<li>
<p><strong>HyraxAccessLog</strong> - Loggers using this Appender will have their log
output placed in the access log file in the persistent content
directory: <em>$TOMCAT_HOME/content/opendap/logs/HyraxAccess.log</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default configuration pushes <strong>ERROR</strong> level (and higher) messages
into the <strong>ErrorLog</strong>, and logs accesses using <strong>HyraxAccessLog</strong>. You
can turn on debugging level logging by changing the log level to <strong>DEBUG</strong>
for the software components you are interested in. All of the OPeNDAP
code is in the "opendap" package. The following configuration
will cause all log messages of <strong>ERROR</strong> level or higher to be sent to the
error log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;logger name="opendap" level="error"/&gt;
        &lt;appender-ref ref="ErrorLog"/&gt;
    &lt;/logger&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration
will cause all messages of level <strong>INFO'</strong> or higher to be sent to
<strong>stdout</strong>, which (in Tomcat) means that they will get stuck in the file
<em>$TOMCAT_HOME/logs/catalina.out</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;logger name="opendap" level="info"/&gt;
        &lt;appender-ref ref="stdout"/&gt;
    &lt;/logger&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to get in touch if you have further questions about the logging
configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="THREDDS-config">3.6.11. THREDDS Configuration Overview</h4>
<div class="paragraph">
<p>Hyrax now uses its own implementation of the THREDDS catalog services
and supports most of the THREDDS catalog service stack. The
implementation relies on two DispatchHandlers in the OLFS and utilizes
XSLT to provide HTML versions (presentation views) for human
consumption.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dynamic THREDDS catalogs for holdings provided by the BES are
provided by the <em>opendap.bes.BESThreddsDispatchHandler</em>.</p>
</li>
<li>
<p>Static THREDDS catalogs are provided by the
<em>opendap.threddsHandler.StaticCatalogDispatch</em>. The static catalogs allow
catalog "graphs" to be decoupled from the filesystem "graph" of the data
holdings, thus allowing data providers the ability to present and
organize data collections independently of how they are organized in the
underlying filesystem.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Static THREDDS catalogs are "rooted" in a master catalog file,
<em>catalog.xml</em>, located in the (persistent) content directory for the
OLFS (Typically <em>$CATALINA_HOME/content/opendap</em>). The default
<em>catalog.xml</em> that comes with Hyrax contains a simple <em>catalogRef</em> element
that points to the dynamic THREDDS catalogs generated from the BES
holdings. The default catalog example also contains a (commented out)
datasetScan element that provides (if enabled) a simple demonstration of
the datasetScan capabilities. Additional catalog components may be added
to the <em>catalog.xml</em> file to build (potentially large) static catalogs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
THREDDS datasetScan elements are now fully supported and can be used
as a tool for altering the catalog presentation of any part of the BES
catalog. These alterations include (but are not limited too) renaming,
auto proxy generation, filtering, and metadata injection.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_thredds_catalogs_using_xslt">THREDDS Catalogs using XSLT</h5>
<div class="paragraph">
<p>Prior to Hyrax 1.5 THREDDS catalog functionality in Hyrax was provided
using an imported implementation of THREDDS. This was a large and
complex dependancy for Hyrax, and the implementation had significant
scalability problems for large catalogs. (Catalogs with 20k or more
entries would consume all available memory.)</p>
</div>
<div class="paragraph">
<p>In response to this, we have written new code for Hyrax. We have replaced
the imported code with 2 OLFS handlers.</p>
</div>
<div class="sect5">
<h6 id="_bes_thredds_handler">BES THREDDS Handler</h6>
<div class="paragraph">
<p>The <em>opendap.bes.BESThreddsDispatchHandler</em> provides THREDDS catalogs
for all data served from a BES. It requires no configuration. Simply
adding it to the OLFS configuration file:
<em>$CATALINA_HOME/content/opendap/olfs.xml</em> will provide THREDDS
catalogs for data served from the BES.</p>
</div>
<div class="paragraph">
<p>This handler uses XSL transforms to convert the BES &lt;showCatalog&gt;
response into a THREDDS catalog.</p>
</div>
<div class="sect6">
<h7 id="_default_configuration">Default Configuration</h7>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;Handler className="opendap.bes.BESThreddsDispatchHandler" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_thredds_dispatch_handler">THREDDS Dispatch Handler</h6>
<div class="paragraph">
<p>The <em>opendap.threddsHandler.Dispatch</em> handler provides THREDDS catalog
functionality for static THREDDS catalogs located on the system with the
OLFS. The handler uses XSL transforms to provide HTML presentation views
of both the catalogs and individual datasets within the catalog. Much
like the <strong>TDS</strong>, data access links are available on the dataset pages (if
the catalog contains the information for the access links).</p>
</div>
<div class="sect6">
<h7 id="_memory_caching">Memory Caching</h7>
<div class="paragraph">
<p>The implementation can be configured to use memory caching of THREDDS
catalogs to improve speed and reduce disk thrashing.</p>
</div>
<div class="paragraph">
<p>When memory caching is enabled, the handler will traverse the local
THREDDS catalogs at startup. Each catalog file will be read into a
memory buffer and cached. The memory buffer is parsed to verify that the
catalog represents valid XML, but the resulting document is not saved.
When a <em>thredds:catalogRef</em> element is encountered during the traversal,
its <em>href</em> is evaluated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <em>href</em> is a relative URL (does not begin with a "/" or
"http://__") then the catalog is traversed and cached.</p>
</li>
<li>
<p>If the <em>href</em> begins with a "/" character, it is assumed that the
catalog is being provided by another service on the same system, and it
is not traversed or cached.</p>
</li>
<li>
<p>If the <em>href</em> begins with a "http://", it is assumed to be a remotely
hosted catalog provided by another service on a different system, and it
is not traversed or cached.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a client asks for an XML catalog response, the entire cached buffer
for the catalog is dumped to the client in a single write command. Since
an already existing byte buffer it written to the response stream, this
should be very fast.</p>
</div>
<div class="paragraph">
<p>If the client asks for an HTML view of the catalog, the buffer is
parsed and passed through an XSL transform to generate the HTML page.
The thinking behind this is as follows: machines traversing the XML
files require fast response times. Humans will be traversing
the HTML views of the catalog. We figure that the latency generated
by parsing and performing transforms will be acceptable to most users.</p>
</div>
<div class="paragraph">
<p>If memory caching is disabled, then the startup remains the same,
except no data is cached. Subsequent client requests for THREDDS
products are handled in the same manner as before, only the catalog
content is read from disk each time. While this means that the XML
responses will be much slower, it will scale to handle much larger
static catalog collections.</p>
</div>
<div class="sect7">
<h8 id="_cache_updates">Cache Updates</h8>
<div class="paragraph">
<p>Each time a catalog request is processed, the source file&#8217;s last modified
date is checked. If the catalog in memory was cached prior to the last
modified date, it and all of its descendants in the catalog hierarchy
are purged from the cache and reloaded.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_prefix_element"><em>prefix</em> element</h7>
<div class="paragraph">
<p>This handler requires a prefix element in the configuration:
<code>&lt;prefix&gt;thredds&lt;/prefix&gt;</code>. The value of the prefix element is used by the
handler to identify requests intended for it. Basically, it will claim
any request whose path begins with the prefix.</p>
</div>
<div class="paragraph">
<p>For example, if the prefix is set to "thredds", then the request
<em><a href="http://localhost:8080/opendap/thredds/catalog.xml" class="bare">http://localhost:8080/opendap/thredds/catalog.xml</a></em>
will be claimed by the handler, while this request:
<em><a href="http://localhost:8080/opendap/catalog.xml" class="bare">http://localhost:8080/opendap/catalog.xml</a></em>
will not. (Although it would be claimed by the BES THREDDS Handler.)</p>
</div>
</div>
<div class="sect6">
<h7 id="_presentation_view_html">Presentation View (HTML)</h7>
<div class="paragraph">
<p>Supplanting the <em>.xml</em> at the end of a catalog&#8217;s name with <em>.html</em> will
cause the <em>opendap.threddsHandler.Dispatch</em> to return an HTML presentation
view of the catalog. This is accomplished by parsing the catalog.xml
document (either from memory if cached or from disk if not) and running
the resulting document through an XSL transform. All the metadata for
all <em>thredds:dataset</em> elements can be inspected in a separate HTML page
that details the dataset. This page is also generated by an XSL
transform applied to the catalog XML document.</p>
</div>
</div>
<div class="sect6">
<h7 id="_default_configuration_2">Default configuration</h7>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;Handler className="opendap.threddsHandler.Dispatch"&gt;
    &lt;prefix&gt;thredds&lt;/prefix&gt;
    &lt;useMemoryCache&gt;true&lt;/useMemoryCache&gt;
&lt;/Handler&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_thredds_catalog_documentation">THREDDS Catalog Documentation</h5>
<div class="paragraph">
<p>Rather than provide an exhaustive explanation of the THREDDS catalog
functionality and configuration, we will appeal to the existing documents
provided by our fine colleagues at UNIDATA:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/TDS.html#Catalogs">Catalog
Basics</a></p>
</li>
<li>
<p><a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/catalog/InvCatalogSpec.html">Client
Catalog Specification</a> Describes what THREDDS catalog components should
be produced by servers.</p>
</li>
<li>
<p><a href="http://www.unidata.ucar.edu/software/thredds/current/tds/tutorial/CatalogPrimer.html">Catalog
Primer</a></p>
</li>
<li>
<p><a href="http://www.unidata.ucar.edu/software/thredds/v4.6/tds/catalog/InvCatalogServerSpec.html#datasetScan_Element">Server
catalog specification</a> can help you understand the rules for
constructing proper datasetScan elements in your catalog.</p>
</li>
<li>
<p><a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/catalog/InvCatalogSpec.html#dataset"><em>dataset</em>
Element</a></p>
</li>
<li>
<p><a href="http://www.unidata.ucar.edu/software/thredds/v4.6/tds/reference/DatasetScan.html"><em>datasetScan</em>
configuration</a> (applies to Hyrax as well).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_instructions_2">Configuration Instructions</h5>
<div class="ulist">
<ul>
<li>
<p>The current default (<a href="#OLFS-config">olfs.xml</a>)
file comes with THREDDS configured correctly.</p>
</li>
<li>
<p>The THREDDS master catalog is stored in the file
<em>$CATALINA_HOME/content/opendap/catalog.xml</em>. It can be edited to provide
additional static catalog access.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_datasetscan_support">datasetScan Support</h5>
<div class="paragraph">
<p>The <em>datasetScan</em> element is a powerful tool that can be used to sculpt
the catalog&#8217;s presentation of the BES catalog content. The Hyrax
implementation has a couple of key points that need to be considered
when developing an instance of the <em>datasetScan</em> element in your THREDDS
catalog.</p>
</div>
<div class="sect5">
<h6 id="_location_attribute"><em>location</em> attribute</h6>
<div class="paragraph">
<p>The <em>location</em> attribute specifies the place in the BES catalog graph
where the <em>datasetScan</em> will be rooted. This value <em>must be</em> expressed
relative to the BES catalog root (<em>BES.Catalog.catalog.RootDirectory</em>) and
not in terms of the underlying BES host file system.</p>
</div>
<div class="paragraph">
<p>For example, if <em>BES.Catalog.catalog.RootDirectory=/usr/share/hyrax</em> and the data
directory to which you wish to apply the <em>datasetScan</em> is (in
filesystem terms) located at <em>/Users/share/hyrax/data/nc</em>, then the
associated <em>datasetScan</em> element&#8217;s <em>location</em> attribute would have a
value of <em>/data/nc</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;datasetScan name="DatasetScanExample" path="hyrax" location="/data/nc"&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_name_attribute"><em>name</em> attribute</h6>
<div class="paragraph">
<p>The <em>name</em> attribute specifies the name that will be used in the
presentation (HTML) view for the catalog containing the <em>datasetScan</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_path_attribute"><em>path</em> attribute</h6>
<div class="paragraph">
<p>The <em>path</em> attribute specifies the place in the THREDDS catalog graph
that the <em>datasetScan</em> will be rooted. It is effectively a relative URL
for the service. If <em>path</em> begins with a "/", then it is an absolute path
rooted at the server and port of the web server. The values of the
<em>path</em> attribute should <strong>never</strong> contain "catalog.xml" or "catalog.html".
The service will create these endpoints dynamically.</p>
</div>
<div class="sect6">
<h7 id="_relative_path_example">Relative path example</h7>
<div class="paragraph">
<p>Consider a catalog accessed with the URL
<a href="http://localhost:8080/opendap/thredds/v27/Landsat/catalog.xml" class="bare">http://localhost:8080/opendap/thredds/v27/Landsat/catalog.xml</a> and that
contains this <em>datasetScan</em> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;datasetScan name="DatasetScanExample" path="hyrax" location="/data/nc"
/&gt; &lt;/source&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the client catalog, the <em>datasetScan</em> becomes this <em>catalogRef</em>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;thredds:catalogRef
    name="DatasetScanExample"
    xlink:title="DatasetScanExample"
    xlink:href="hyrax/catalog.xml"
    xlink:type="simple"
/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>And the top of <em>datasetScan</em> catalog graph will be found at the URL
<a href="http://localhost:8080/opendap/thredds/v27/Landsat/hyrax/catalog.xml" class="bare">http://localhost:8080/opendap/thredds/v27/Landsat/hyrax/catalog.xml</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_absolute_path_examples">Absolute path examples</h7>
<div class="paragraph">
<p>Consider a catalog accessed with the URL
<a href="http://localhost:8080/opendap/thredds/v27/Landsat/catalog.xml" class="bare">http://localhost:8080/opendap/thredds/v27/Landsat/catalog.xml</a> and that
contains this <em>datasetScan</em> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;datasetScan name="DatasetScanExample" path="/hyrax" location="/data/nc" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the client catalog the <em>datasetScan</em> becomes this <em>catalogRef</em>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;thredds:catalogRef
     name="DatasetScanExample"
     xlink:title="DatasetScanExample"
     xlink:href="/hyrax/catalog.xml"
     xlink:type="simple"
/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Then the top of <em>datasetScan</em> catalog graph will be found at the URL
<a href="http://localhost:8080/hyrax/catalog.xml" class="bare">http://localhost:8080/hyrax/catalog.xml</a>,
<strong><em>which is probably not what you want!</em></strong> This <em>catalogRef</em> directs the
catalog crawler away from the Hyrax THREDDS service and to an undefined
(as far as Hyrax is concerned) endpoint, one that will most likely
generate a 404 (Not Found) response from the Web Server.</p>
</div>
<div class="paragraph">
<p>When using absolute paths you must be sure to prefix the path with the
Hyrax THREDDS service path, or you will direct the clients away from the
service. In these examples the Hyrax THREDDS service path would be
<em>/opendap/thredds/</em> (look at the URLs in the above examples). If we
change the <em>datasetScan</em> path attribute value to
<em>/opendap/thredds/myDatasetScan</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;datasetScan name="DatasetScanExample" path="'/opendap/thredds/myDatasetScan" location="/data/nc" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the client catalog the <strong>datasetScan</strong> becomes this <strong>catalogRef</strong>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;thredds:catalogRef
    name="DatasetScanExample"
    xlink:title="DatasetScanExample"
    xlink:href="/opendap/thredds/myDatasetScan/catalog.xml"
    xlink:type="simple"
/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Now the top of the <em>datasetScan</em> catalog graph will be found at the URL
<a href="http://localhost:8080/opendap/thredds/myDatasetScan/catalog.xml" class="bare">http://localhost:8080/opendap/thredds/myDatasetScan/catalog.xml</a>,
which keeps the URL referencing the Hyrax THREDDS service and not some
other part of the web service stack.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_usehyraxservices_attribute"><em>useHyraxServices</em> attribute</h6>
<div class="paragraph">
<p>The Hyrax version of the <em>datasetScan</em> element employs the extra
attribute <em>useHyraxServices</em>. This allows the <em>datasetScan</em> to
automatically generate Hyrax data services definitions and access links
for datasets in the catalog. The <em>datasetScan</em> can be used to augment
the list of services (when <em>useHyraxServices</em> is set to true) or it can
be used to completely replace the Hyrax service stack (when
<em>useHyraxServices</em> is set to false).</p>
</div>
<div class="paragraph">
<p>Keep the following in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no services are referenced in the <em>datasetScan</em> and
<em>useHyraxServices</em> is set to true, then Hyrax will provide catalogs with
service definitions and access elements for all the datasets that the
BES identifies as data.</p>
</li>
<li>
<p>If no services are referenced in the <em>datasetScan</em> and
<em>useHyraxServices</em> is set to false, then the catalogs generated by the
<em>datasetScan</em> will have <em>no service definitions or access elements</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default <em>useHyraxServices</em> is set to true.</p>
</div>
</div>
<div class="sect5">
<h6 id="_functions">Functions</h6>
<div class="paragraph">
<p><a href="http://www.unidata.ucar.edu/software/thredds/v4.6/tds/reference/DatasetScan.html">DatasetScan
allows you to apply the following functions to the names of the datasets
in the datasetScan catalog graph.</a></p>
</div>
<div class="sect6">
<h7 id="_filter"><em>filter</em></h7>
<div class="paragraph">
<p>A datasetScan element can specify which files and directories it will
include with a filter element (also
<a href="http://www.unidata.ucar.edu/software/thredds/v4.6/tds/catalog/InvCatalogServerSpec.html">see
THREDDS server catalog spec</a> for details). The filter element allows
users to specify which datasets are to be included in the generated
catalogs. A filter element can contain any number of include and exclude
elements. Each include or exclude element may contain either a wildcard
or a regExp attribute. If the given wildcard pattern or regular
expression matches a dataset name, that dataset is included or excluded
as specified. By default, includes and excludes apply only to atomic
datasets (regular files). You can specify that they apply to atomic
and/or collection datasets (directories) by using the atomic and
collection attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;filter&gt;
    &lt;exclude wildcard="*not_currently_supported" /&gt;
    &lt;include regExp="/data/h5/dir2" collection="true" /&gt;
&lt;/filter&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_sort"><em>sort</em></h7>
<div class="paragraph">
<p>Datasets at each collection level are listed in ascending order by name.
With a sort element you can specify that they are to be sorted in
reverse order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;sort&gt;
    &lt;lexigraphicByName increasing="false" /&gt;
&lt;/sort&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_namer"><em>namer</em></h7>
<div class="paragraph">
<p>If no namer element is specified, all datasets are named with the
corresponding BES catalog dataset name. By adding a namer element, you
can specify more human readable dataset names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;namer&gt;
    &lt;regExpOnName regExp="/data/he/dir1" replaceString="AVHRR" /&gt;
    &lt;regExpOnName regExp="(.*)\.h5" replaceString="$1.hdf5" /&gt;
    &lt;regExpOnName regExp="(.*)\.he5" replaceString="$1.hdf5_eos" /&gt;
    &lt;regExpOnName regExp="(.*)\.nc" replaceString="$1.netcdf" /&gt;
&lt;/namer&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_addtimecoverage"><em>addTimeCoverage</em></h7>
<div class="paragraph">
<p>A datasetScan element may contain an addTimeCoverage element. The
addTimeCoverage element indicates that a timeCoverage metadata element
should be added to each dataset in the collection and describes how to
determine the time coverage for each dataset in the collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;addTimeCoverage
    datasetNameMatchPattern="([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})_gfs_211.nc$"
    startTimeSubstitutionPattern="$1-$2-$3T$4:00:00"
    duration="60 hours"
/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for the dataset named <strong>2005071812_gfs_211.nc</strong>, results in the
following timeCoverage element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;timeCoverage&gt;
    &lt;start&gt;2005-07-18T12:00:00&lt;/start&gt;
    &lt;duration&gt;60 hours&lt;/duration&gt;
  &lt;/timeCoverage&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_addproxies"><em>addProxies</em></h7>
<div class="paragraph">
<p>For real-time data you may want to have a special link that points to
the "latest" data in the collection. Here, latest is simply means the
last filename in a list sorted by name, so its only the latest if the
time stamp is in the filename and the name sorts correctly by time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;addProxies&gt;
    &lt;simpleLatest name="simpleLatest" /&gt;
    &lt;latestComplete name="latestComplete" lastModifiedLimit="60.0" /&gt;
&lt;/addProxies&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_hyrax">4. Customizing Hyrax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several ways in which Hyrax can be customized:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web interface look and feel can be changed, as can the pages served.</p>
</li>
<li>
<p>Custom DispatchHandlers for the OLFS</p>
</li>
<li>
<p>Custom RequestHandlers for the BES.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_webpage_customization">4.1. Webpage Customization</h3>
<div class="paragraph">
<p>Hyrax&#8217;s public "face" is the web pages that are produced by servlets
running in the Tomcat servlet engine. Almost all of these pages can be
completely customized by the site administrator by editing a combination
of HTML, XSLT, and CSS files.</p>
</div>
<div class="sect3">
<h4 id="_where_to_make_the_changes">4.1.1. Where To Make the Changes</h4>
<div class="paragraph">
<p>All of the default versions of the HTML, XSLT, and CSS files come
bundled with Hyrax in the <em>$CATALINA_HOME/webapps/opendap/docs</em>
directory. You can make changes there, but installing new versions of
the OLFS software will overwrite your modifications.</p>
</div>
<div class="paragraph">
<p>However, if the <em>docs</em> directory is copied (preserving its structure) to
<em>$CATALINA_HOME/content/opendap/</em> (creating the directory
<em>$CATALINA_HOME/content/opendap/docs</em>), then Hyrax will serve the
files from the new location.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do NOT remove files from this new directory (or the old one).
Each file, in its location, is required by Hyrax. You can
make changes to the files but you should not rename or remove them.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Beacuse nothing inside the <em>$CATALINA_HOME/content</em> directory is
(automatically) changed when installing new versions of Hyrax, changes
you make to files in the <em>content</em> directory will persist when you
upgrade Hyrax.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>The rest of these instructions are written with the assumption that a
copy of the <em>docs</em> directory has been made as described above.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_what_to_change">4.1.2. What to Change</h4>
<div class="sect4">
<h5 id="_html_files">HTML Files</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. The HTML files provide the static content of a Hyrax server</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top"> Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>index.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The documentation web page for the top level of Hyrax. As shipped it
contains a description of Hyrax and links to documentation and funders.
The contents.html pages (aka the OPeNDAP directories) links to this
document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error400.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates a <strong>Bad Request</strong> error (Associated with an HTML status of 400)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error403.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates a <strong>Forbidden</strong> error. (Associated with an HTML status of 403)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error404.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates a <strong>Not Found</strong> error. (Associated with an HTML status of 404)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error500.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates an <strong>Internal Server Error</strong>. (Associated with an HTML status of 500)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error501.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates an <strong>Not Implemented</strong>. (Associated with an HTML status of 501)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error502.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the default error page that Hyrax will return when the client request
generates an <strong>Bad Gateway</strong>. (Associated with an HTML status of 502)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_css_files">CSS Files</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. The CSS Files provide style information for the HTML pages</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>contents.css</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/css</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The contents.css style sheet provides the default colors and fonts used in
the Hyrax site. It is referenced by all of the HTML and XSL files to
coordinate the visual aspects of the site.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>thredds.css</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/css</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The thredds.css style sheet provides the default colors and fonts used by
the THREDDS component of Hyrax.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are a number of image files shipped with Hyrax. Simply replacing
key image files will allow you to customize the icons and logos
associated with the Hyrax server.</p>
</div>
</div>
<div class="sect4">
<h5 id="_image_files">Image Files</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. The Image Files provide a way to change logos and other images</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>logo.gif</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/images</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main Logo for the directory view (produced by contents.css and contents.xsl)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>favicon.ico</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/images</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cute little icon preceding the URL in the address bar of your browser.
To be used, this file needs to be installed into Tomcat.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BadDapRequest.gif, BadGateway.png,<br>
 favicon.ico, folder.png,<br>
 forbidden.png, largeEarth.jpg,<br>
 logo.gif, nasa-logo.jpg,<br>
 noaa-logo.jpg, nsf-logo.png,<br>
 smallEarth.jpg, sml-folder.png,<br>
 superman.jpg</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/images</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These files are referenced by the default collection of web content files
 (described above) that ship with Hyrax.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xsl_transform_files">XSL Transform Files</h5>
<div class="paragraph">
<p>These files are used to transform XML documents used by Hyrax. Some
transforms operate on source XML from internal documents such as BES
responses. Other transforms change things like THREDDS catalogs into
HTML for browsers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
All of these XSLT files are software and should be treated as such.
They are intimately tied to the functions of Hyrax. The likelihood that
you can change these files and not break Hyrax is fairly low.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Current Operational XSLT</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>catalog.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The catalog.xsl file contains the XSLT transformation that is used to
transform BES showCatalog responses into THREDDS catalogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>contents.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The contents.xsl file contains the XSLT transformation that is used to build
the <a href="http://docs.opendap.org/index.php/ServerDispatchOperations">OPeNDAP
Directory Response</a> <span class="image"><img src="./images/DirectoryView.png" alt="DirectoryView"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataset.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This transform is used to in conjunction with the opendap.threddsHandler code
to produce HTML pages of THREDDS catalog dataset element details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error400.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The error400.xsl contains the XSLT transformation that is used to build the
web page that is returned when the server generates a Bad Request (400)
HTTP status code. If for some reason this page cannot be generated, then
the HTML version (<em>$CATALINA_HOME/content/opendap/docs/error400.html</em>)
will be sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>error500.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The error400.xsl contains the XSLT transformation that is used to build the
web page that is returned when the server generates a Internal Server
Error (500) HTTP status code. If for some reason this page cannot be
generated then the HTML version
(<em>$CATALINA_HOME/content/opendap/docs/error500.html</em>) will be sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>thredds.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This transform is used to in conjunction with the opendap.threddsHandler code
to produce HTML pages of THREDDS catalog details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This transform is used to provide a single location for the Hyrax version
number shown in the public interface.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Experimental XSLT</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dapAttributePromoter.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT file can be used to promote DAP Attributes
whose names contain a namespace prefix to XML elements of the same name
as the Attribute. <em>Not currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dapAttributesToXml.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT file might be used to promote DAP Attributes
encoded with special XML attributes to represent any XML to the XML the
Attribute was encoded to represent. <em>Not currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dap_2.0_ddxToRdfTriples.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT can be used to produce an RDF representation
of a DAP2 DDX. <em>Not currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dap_3.2_ddxToRdfTriples.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT is used to produce an RDF representation of a DAP 3.2 DDX.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dap_3.3_ddxToRdfTriples.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT can be used to produce an RDF representation
of a DAP 3.3 DDX. <em>Not currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespaceFilter.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT can be used to filter documents so that only
elements in a particular namespace are returned. <em>Not currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>wcs_coveragePage.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT is used by the prototype CEOP WCS gateway
client to produce an HTML page with coverage details. <em>Not currently in
use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>wcs_coveragesList.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT is used by the prototype CEOP WCS gateway
client to produce an HTML page with a list of available coverages. <em>Not
currently in use.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>xmlToDapAttributes.xsl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>$CATALINA_HOME/content/opendap/docs/xsl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This XSLT can be used to covert any XML content into a
set of specially encoded DAP Attributes. The resulting Attribute
elements have XML <em>type</em> attributes that are not currently recognized by
any OPeNDAP software. <em>Not currently in use.</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_software_customization">4.2. Software Customization</h3>
<div class="sect3">
<h4 id="_olfs_customization">4.2.1. OLFS Customization</h4>
<div class="paragraph">
<p><a href="http://www.opendap.org/support/bom_sdw/SDW_2r0_OLFSExtensions.ppt">Power
Point Presentation From the 2007 Software Development Workshop hosted by
the Australian Bureau of Meteorology.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_bes_customization">4.2.2. BES Customization</h4>
<div class="paragraph">
<p><a href="http://www.opendap.org/support/bom_sdw/SDW_4r0_BESExtensibility.ppt">Power
Point Presentation From the 2007 Software Development Workshop hosted by
the Australian Bureau of Meteorology.</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="apache-integration">5. Apache Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The problem of linking Tomcat with Apache has been greatly reduced as of
Apache 2.2. In previous incarnations of Apache &amp; Tomcat, it was fairly
complex. What follows are the instructions for Apache
2.2 and Tomcat 6.x.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites">5.1. Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Apace 2.2 or greater</p>
</li>
<li>
<p>Tomcat 6.x or greater</p>
</li>
<li>
<p>mod_proxy_ajp installed in Apache (typically this is present in 2.2+)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_tomcat_to_apache">5.2. Connecting Tomcat to Apache</h3>
<div class="sect3">
<h4 id="_tomcat_2">5.2.1. Tomcat</h4>
<div class="paragraph">
<p>You have to create the AJP connector in the <em>conf/server.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;
    &lt;Connector
        port="8009"
        protocol="AJP/1.3"
        redirectPort="443" &lt;!-- Redirect to the Apache Web Server secure port --&gt;
        scheme="https" &lt;!-- Use TLS to connect --&gt;
        address="127.0.0.1" &lt;!-- Only allow connections from this host --&gt;
        &lt;!-- Setting tomcatAuthentication to 'false' will allow tomcat web applications
                to get user session information from Apache, such as uid and other user properties. --&gt;
        tomcatAuthentication="true"
        /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This line will enable AJP connections to the 8009 port of your tomcat
server (localhost for example).</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache">5.2.2. Apache</h4>
<div class="paragraph">
<p>In the example below, pay special attention to the <em>protocol</em> part of
the proxy URL - it uses <strong>ajp://</strong> and not 'http://'.<br>
 Add this to Apache&#8217;s <em>httpd.conf</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Proxy *&gt;
    AddDefaultCharset Off
    Order deny,allow
    Allow from all
&lt;/Proxy&gt;
 
ProxyPass /opendap ajp://localhost:8009/opendap
ProxyPassReverse /opendap ajp://localhost:8009/opendap</pre>
</div>
</div>
<div class="paragraph">
<p>NB: It&#8217;s possible to embed these in a <em>VirtualHost</em> directive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_it_works">5.2.3. How It Works</h4>
<div class="paragraph">
<p>ProxyPass and ProxyPassReverse are classic reverse proxy directives used
to forward the stream to another location. <em>ajp://&#8230;&#8203;</em> is the AJP
connector location (your tomcat&#8217;s server host/port)</p>
</div>
<div class="paragraph">
<p>A web client will connect through HTTP to <em><a href="http://localhost/" class="bare">http://localhost/</a></em> (supposing
your apache2 server is running on localhost), the <em>mod_proxy_ajp</em> will
forward you request transparently using the AJP protocol to the tomcat
application server on localhost:8009.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apache-compressed-responses">5.3. Apache Compressed Responses</h3>
<div class="paragraph">
<p>Many OPeNDAP clients accept compressed responses. This can greatly
increase the efficiency of the client/server interaction by diminishing
the number of bytes actually transmitted over "the wire". Compression
can reduce the number of bytes transmitted by an order of magnitude for
many datasets!</p>
</div>
<div class="paragraph">
<p>Tomcat provides native compression support for the GZIP compression
mechanism, however it is NOT turned on by default. More perversely, even
if you have configured Tomcat to provide compressed responses, if you
are using AJP to proxy Tomcat through the Apache web server compression
will not be enabled unless you configure the Apache web server to
compress responses. This is because Tomcat NEVER compresses responses
sent over AJP.</p>
</div>
<div class="paragraph">
<p>When you configure your Apache web server to provide compressed
responses you will probably want to make sure that Apache doesn&#8217;t apply
compression to images (In general images are already compressed and
there is little to gain by attempting to compress them and a lot of CPU
cycles to burn if you try)</p>
</div>
<div class="paragraph">
<p><a href="http://httpd.apache.org/docs/2.0/mod/mod_deflate.html">Apache compression
module</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.askapache.com/htaccess/apache-speed-compression.html">AskApache
Speed Tips</a></p>
</div>
<div class="paragraph">
<p><a href="http://betterexplained.com/articles/how-to-optimize-your-site-with-gzip-compression/">BetterExplained
explains Apache Compression</a></p>
</div>
<div class="sect3">
<h4 id="_httpd_conf">5.3.1. httpd.conf</h4>
<div class="paragraph">
<p>You will need to add (something like) the following to your Apache web
server&#8217;s httpd.conf file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#
# Compress everything except images.
#
&lt;Location /&gt;
    # Insert filter
    SetOutputFilter DEFLATE
 
    # Netscape 4.x has some problems...
    BrowserMatch ^Mozilla/4 gzip-only-text/html
 
    # Netscape 4.06-4.08 have some more problems
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
 
    # MSIE masquerades as Netscape, but it is fine
    # BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
 
    # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
    # the above regex won't work. You can use the following
    # workaround to get the desired effect:
    BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html
 
    # Don't compress images
    SetEnvIfNoCase Request_URI \
    \.(?:gif|jpe?g|png)$ no-gzip dont-vary
 
    # Make sure proxies don't deliver the wrong content
    Header append Vary User-Agent env=!dont-vary
&lt;/Location&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apache_authentication">5.4. Apache Authentication</h3>
<div class="paragraph">
<p>Hyrax may deployed into service stacks in which <em>httpd</em> is expected to
handle the work of authenticating users. In order for Tomcat (and thus
Hyrax) to be able to receive the users login name and attributes from
<em>httpd</em> the following things need to be done to the Tomcat
configuration.</p>
</div>
<div class="paragraph">
<p>In the <em>$CATALINA_HOME/conf/server.xml</em> file the default definition of
the AJP connector typically looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;
    &lt;Connector port="8009" protocol="AJP/1.3" redirectPort="8443" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This line may be "commented out," with &lt;!-- on a line before and -&#8594; on
a line after. If so, remove those lines. If you cannot find the AJP
connector element, simply create it from the code above. You will need
to add several attributes to the Connector element.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>tomcatAuthentication</code> attribute to "false", this must be done
in order to receive authentication information from Apache.</p>
</li>
<li>
<p>Configure the connector to use SSL - If your Apache web server is
using SSL/HTTPS (and it should be), you need to tell Tomcat about that
fact so that it can construct internal URLs correctly.</p>
<div class="ulist">
<ul>
<li>
<p>Set the <code>scheme</code> attribute to "https".</p>
</li>
<li>
<p>Set the <code>proxyPort</code> attribute to Apache httpd&#8217;s secure socket,
typically "443" (This ensures that secure traffic gets routed through
Apache httpd and and then through the AJP connector to Tomcat, allowing
httpd&#8217;s authentication/authorization stack to be invoked on the
request).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Restrict access to the AJP Connector. By disabling access to the
connector from anywhere but the local system you prevent system probing
from the greater world. To do this, set the <code>address</code> attribute to
"127.0.0.1".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you are finished making changes, your connector should look
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;
    &lt;Connector
        port="8009"
        protocol="AJP/1.3"
        redirectPort="443"
        scheme="https"
        address="127.0.0.1"
        tomcatAuthentication="false"
        /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Restart Tomcat to load the new configuration. Now Tomcat/Hyrax should
see all of the authentication attributes from <em>httpd</em>.</p>
</div>
<div class="paragraph">
<p>NB: You may wish review Tomcat documentation for the AJP Connector as
there many attributes/options that can be used to tune performance.
<a href="http://tomcat.apache.org/tomcat-7.0-doc/config/ajp.html">Here&#8217;s a link to
the Tomcat 7 AJP Connector docs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operation">6. Operation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="start-and-stop-BES">6.1. Starting and Stopping the BES</h3>
<div class="paragraph">
<p>There are two methods of controlling the BES, <code>besd</code> and <code>besctl</code>. The <code>besd</code> command is part of the init.d service architecture and provides system controls for the <strong>besdaemon</strong>. while <code>besctl</code> is the normative commandline control for the <strong>besdaemon</strong>.</p>
</div>
<div class="sect3">
<h4 id="_the_besd_command">6.1.1. The <em>besd</em> Command</h4>
<div class="paragraph">
<p>The <code>besd</code> command is used on Unix systems utilizing the init.d service architecture
to control the besdaemon. The controls are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Start BES</strong>: <code>service besd start</code></p>
</li>
<li>
<p><strong>Stop  BES</strong>: <code>service besd stop</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_starting_the_bes_at_boot_time">Starting the BES At Boot Time</h5>
<div class="paragraph">
<p>In Linux, if you want Hyrax to start at boot time then you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the BES to the startup process:<br>
<code>chkconfig --add besd</code><br></p>
</li>
<li>
<p>Confirm that this worked:<br>
<code>chkconfig --list besd</code><br>
You should get something like this back:<br>
<code>besd           	0:off	1:off	2:on	3:on	4:on	5:on	6:off</code></p>
</li>
<li>
<p>You can turn it off like this:<br>
<code>chkconfig besd off</code></p>
</li>
<li>
<p>And you can remove it from the chkconfig management like this:<br>
<code>chkconfig --del besd</code><br>
<em>"The service is removed from chkconfig management, and any symbolic links in /etc/rc[0-6].d which pertain to it are removed."</em> - chkconfig manpage</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_besctl_command">6.1.2. The <em>besctl</em> Command</h4>
<div class="paragraph">
<p>The <em>besctl</em> command is used to control the BES daemon. For Hyrax
version 1.7 and earlier, this the only way to control the BES.
Starting with Hyrax 1.8 (release date tentatively set for fall 2011)
the <a href="#admin-interface">Hyrax Admin Interface</a>
can be used to start, stop, reconfigure and debug the BES
once the master daemon is started using this command. The Hyrax Admin
Interface also provides for both hard and soft restarts of Hyrax while
the <em>besctl</em> command does not.</p>
</div>
</div>
<div class="sect3">
<h4 id="_most_common_uses_of_besctl">6.1.3. Most Common Uses of <em>besctl</em></h4>
<div class="paragraph">
<p>To start and stop the BES, use the <em>besctl</em> command. The besctl command
has a number of options, but the most important are the <em>start</em> and
<em>stop</em> arguments. To start the BES use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl start</pre>
</div>
</div>
<div class="paragraph">
<p>and to stop it, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl stop</pre>
</div>
</div>
<div class="paragraph">
<p>The general form for the <em>besctl</em> command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl (help|start|stop|restart|status|pids|kill) [options]</pre>
</div>
</div>
<div class="paragraph">
<p>where <em>options</em> are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-i back-end server installation directory
-c use back-end server configuration file CONFIG
-d send debugging for CONTEXT to cerr or &lt;filename&gt;
-h show the help information and exit
-p set port to PORT
-r bes.pid file stored in directory PID_DIR
-s specifies a secure server using SLL authentication
-u set unix socket to UNIX_SOCKET
-v echos version and exit</pre>
</div>
</div>
<div class="paragraph">
<p>These options are used only in special circumstances; of them all the
<em>-d</em> option to turn on debugging is the most useful. The syntax for
run-time debugging/diagnostic output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-d "&lt;output sink&gt;,&lt;context 1&gt;, ...,&lt;context n&gt;"</pre>
</div>
</div>
<div class="paragraph">
<p>where a typical example would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-d "cerr,ascii,netcdf,besdaemon"</pre>
</div>
</div>
<div class="paragraph">
<p>which would tell the daemon to send diagnostic output from the ASCII
handler, the NetCDF handler and the BES daemon itself to the terminal&#8217;s
standard error output.</p>
</div>
</div>
<div class="sect3">
<h4 id="_about_each_of_the_arguments_to_besctl">6.1.4. About Each of the Arguments to <em>besctl</em></h4>
<div class="paragraph">
<p>The besctl command accepts a total of seven arguments.</p>
</div>
<div class="sect4">
<h5 id="_help">help</h5>
<div class="paragraph">
<p>Display help information for the besctl command. The help argument
displays, among other things, all of the main <em>centexts</em> that can be
used with the debug (<em>-d</em>) option.</p>
</div>
</div>
<div class="sect4">
<h5 id="_start">start</h5>
<div class="paragraph">
<p>Start the BES</p>
</div>
</div>
<div class="sect4">
<h5 id="_stop">stop</h5>
<div class="paragraph">
<p>Stop the BES. This is a 'hard' stop and any active connections will be
dropped.</p>
</div>
</div>
<div class="sect4">
<h5 id="_restart">restart</h5>
<div class="paragraph">
<p>This is the same as using the stop and start commands separately. If you
want to issue a 'soft' restart of Hyrax, use the Hyrax Admin Interface,
which will be available in Hyrax 1.8.</p>
</div>
</div>
<div class="sect4">
<h5 id="_status">status</h5>
<div class="paragraph">
<p>This returns the master BES daemon process id number and the user id
under which it is running.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pids">pids</h5>
<div class="paragraph">
<p>The BES is actually a collection of processes; use this argument to find
the process id numbers for them all.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kill">kill</h5>
<div class="paragraph">
<p>Sometimes the <em>stop</em> or <em>restart</em> arguments don&#8217;t work. Use this
argument to stop all the processes. The <em>stop</em> command works by sending
the TERM signal to the master BES daemon process which then sends that
signal to all of the subordinate BES daemon processes, but processes can
ignore this signal in certain circumstances. Using the <em>kill</em> argument
to besctl sends the KILL signal to all of the processes; KILL cannot be
ignored by a process, so this is certain to stop the server.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_about_the_options_accepted_by_besctl">6.1.5. About the Options Accepted by <em>besctl</em></h4>
<div class="sect4">
<h5 id="_server_installation_directory">server installation directory</h5>
<div class="paragraph">
<p>Use the <em>-i</em> option to force besctl to use a specific directory as the
server&#8217;s root directory. This option is useful if you have several BES
daemons running on one machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-i &lt;directory&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_server_configuration_file">server configuration file</h5>
<div class="paragraph">
<p>Use the <em>-c</em> option to force the daemon to use a specific <em>bes.conf</em>
file instead of the file found at <em>server root</em>/etc/bes/bes.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-c &lt;configuration file path&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>An alternative to usign this option is to use the BES_CONF environment
variable to point to a configuration file. Set the value of the
environment variable to the path of the configuration file. Be sure to
export the environment variable. Also note that as of Hyrax 1.6, the BES
reads a significant amount of configuration information from the
<em>server root</em>/etc/bes/conf.d directory. You can disable this by
editing the bes.conf file; look for the <em>Includes</em> directive.</p>
</div>
</div>
<div class="sect4">
<h5 id="_debugging">debugging</h5>
<div class="paragraph">
<p>Use the <em>-d</em> option to achieve fine-grained control over the server&#8217;s
diagnostic output. The -d option takes a single double-quoted string
which must contain the name of the output sink for the diagnostic
information and a comma separated list of 'debug contexts'. The sink may
be either an open stream (e.g., <em>cerr</em>) or a file while the contexts
are defined by/in the BES source code. All modules define a context that
matches their name and you can see this using the <em>help</em> argument to
besctl, although most define additional contexts. The best way to find
out about the contexts available is to look at the source code for the
server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-d "cerr,besdaemon"</pre>
</div>
</div>
<div class="paragraph">
<p>Use the special context <em>all</em> to see output from all of the contexts.
This will produce very verbose output.</p>
</div>
</div>
<div class="sect4">
<h5 id="_help_2">help</h5>
<div class="paragraph">
<p>The <em>-h</em> option prints a short online help message which lists the
option switches. Note that this option doesn&#8217;t work when you supply an
argument like <em>start</em>, <em>stop</em>, et c., except for <em>help</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-h</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_port">port</h5>
<div class="paragraph">
<p>Use the <em>-p</em> option to set the port the daemon uses for communication
with the Hyrax front-end.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-p &lt;number&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pid_file">PID file</h5>
<div class="paragraph">
<p>Use the <em>-r</em> option to tell the BES where to store the master daemon&#8217;s
process id number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-r &lt;directory&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sll_authentication">SLL authentication</h5>
<div class="paragraph">
<p>Use the <em>-s</em> option to force the server to use SSL authentication. This
option is not used with Hyrax. To configure Hyrax for use with SSL, see
information about running ht efront-end of the server with SSL. This is
typically done by securing a Tomcat or Apache server and is standard
procedure used by many general web sites.</p>
</div>
</div>
<div class="sect4">
<h5 id="_unix_socket">unix socket</h5>
<div class="paragraph">
<p>Use the <em>-u</em> option to force the BES to use a Unix socket for
communication with the front-end instead of the TCP socket. We rarely
use this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-u &lt;socket&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_verbose">verbose</h5>
<div class="paragraph">
<p>use the <em>-v</em> option to see the version of the bes. The server does not
start, &#8230;&#8203;, et cetera.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-v</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="admin-interface">6.2. Hyrax Administrators Interface</h3>
<div class="paragraph">
<p>The Hyrax Administrator&#8217;s Interface (HAI) is a graphical interface to
the configuration files and run-time logs of the Hyrax data server. It
provides a way to start and stop different parts of Hyrax and to change
their configuration files on the fly. Because Hyrax can run on several
different hosts, it can be a challenge to manage; the HAI provides a
single tabbed interface where the logs and configuration files for those
different hosts can easily be tracked.</p>
</div>
<div class="paragraph">
<p>The HAI is a web based interface, so it can be used from any computer
that can access the server using a secure connection.</p>
</div>
<div class="paragraph">
<p>The following describes the installation and configuration of the HAI
followed by an explanation of its features. Note that the interface is
very simple to configure in most cases - most of the steps described for
Tomcat are not necessary for many sites since it&#8217;s often the case that
the servlet engine is already configured for SSL and has one or more
users in Tomcat&#8217;s <em>manager</em> role. Using the interface is very intuitive.</p>
</div>
<div class="sect3">
<h4 id="_installation_and_configuration">6.2.1. Installation and Configuration</h4>
<div class="paragraph">
<p>When Hyrax and Tomcat are installed all of the software needed to run
the Hyrax Administrative Interface (HAI) is in place. However, you will
need to do three simple steps in order to turn it in and use it. First
you will need to configure Tomcat to use Secure Sockets Layer (SSL,
https) and add a user who can login to use the interface. Then you will
need to perform minimal additional configuration steps in the two parts
of Hyrax - the BES and OLFS. Be sure to skim the Configuration Notes
subsection.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites_2">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>Tomcat 6 installed and working, and</p>
</li>
<li>
<p>Hyrax has been installed and simple responses work.</p>
</li>
<li>
<p>It&#8217;s very likely that newer versions of Tomcat will work and it&#8217;s also
likely that you can use another servlet engine, but the specifics of the
SSL/https configuration may be different.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_tomcat">Configuring Tomcat</h5>
<div class="paragraph">
<p>In order to use the HAI you will need to configure your tomcat instance
to enable SSL. This is very simple for most sites, and it might already
be configured for you. We use SSL/https for communication with the HAI
because we want to be sure that your server is secure and only those
people who you want to control it can. There is a much more detailed
document that describes the
<a href="http://tomcat.apache.org/tomcat-7.0-doc/ssl-howto.html">SSL/https
configuration</a> for tomcat 7 at the Apache web site.</p>
</div>
<div class="paragraph">
<p>Make a Certificate 'keystore'</p>
</div>
<div class="paragraph">
<p>Use the command "keytool -genkey -alias tomcat -keyalg RSA" to make a
<em>keystore</em> - a place where SSL certificates are stored so they can be
used by the server - and add a single <em>self signed</em> certificate in it.
Make sure to remember the password for the keystore! If your
installation of Tomcat is already configured for SSL, skip this step -
you don&#8217;t need to make the keystore or the self-signed certificate. Also
note that if the <em>keytool</em> program cannot be run from a terminal, try
using it&#8217;s full path with is <em>$JAVA_HOME/bin/keytool</em> (Unix/OSX) or
<em>%JAVA_HOME%\bin\keytool</em> (Windows).</p>
</div>
<div class="paragraph">
<p>Turn on SSL/https</p>
</div>
<div class="paragraph">
<p>In the file <em>$CATALINA_BASE/conf/server.xml</em> remove the comment
surrounding the "SSL HTTP/1.1 Connector" entry. For Tomcat 7, add
attributes for the keystore and keystore password (e.g.,
<em>keystoreFile="$\{user.home}/.keystore" keystorePass="changeit"</em>) to
SSL HTTP/1.1 Connector entry.</p>
</div>
<div class="paragraph">
<p>Add a Tomcat user</p>
</div>
<div class="paragraph">
<p>Open the file <em>$CATALINA_HOME/conf/tomcat-users.xml</em> and add a user for
the interface. Hyrax uses, by default, the <em>role</em> 'manager', so if you
already have a user in that role an want them to use the HAI, you are
all set. If you don&#8217;t have anyone set in the manager role, or you want a
new user, add a line like the following: <em>&lt;user username="admin"
password="hai" roles="manager"/&gt;</em>. If you don&#8217;t have the role 'manager'
defined, add it too: <em>&lt;role rolename="manager"/&gt;</em></p>
</div>
<div class="paragraph">
<p>Restart Tomcat</p>
</div>
</div>
<div class="sect4">
<h5 id="_bes">BES</h5>
<div class="paragraph">
<p>Edit the file <em>$HYRAX_HOME/etc/bes.conf</em> and remove the comments from
the line <em>BES.DaemonPort=11002</em></p>
</div>
<div class="paragraph">
<p>Restart the BES.</p>
</div>
</div>
<div class="sect4">
<h5 id="_olfs">OLFS</h5>
<div class="paragraph">
<p>Edit the file <em>$CATALINA_HOME/content/opendap/olfs.xml</em> and remove the
comments around the line <em>&lt;adminPort&gt;11002&lt;/adminPort&gt;</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_notes">Configuration Notes</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Note that because the HAI is a web-based interface, with secure
logins using SSL, you can use the interface with your server from
anywhere in the world. It might be a good idea, however, to limit the IP
addresses that can access the HAI.</p>
</li>
<li>
<p>Using a self-signed certificate is fine, but you will see a warning
box when you log in because self-signed certs are not trusted by
browsers by default. Most browsers have an option that will suppress
that warning or, although it involves some expense, you can get a
certificate signed by a Certificate Authority and install that in the
keystore</p>
</li>
<li>
<p>More about tomcat users: Tomcat supports several authentication
Realms including Memory realms, databases and LDAP. We document using
memory realms here because other techniques, while better in some ways,
are more cumbersome. If you are using memory realms, be sure to protect
the <em>tomcat-users.xml</em> file because it contains plain text passwords.</p>
</li>
<li>
<p>The <em>&lt;security-constraint&gt;</em> element in the
<em>$CATALINA_HOME/opendap/WEB-INF/web.xml</em> configuration file controls the
level of access control for the HAI</p>
</li>
<li>
<p>The role used by the HAI is set in the
<em>$CATALINA_HOME/opendap/WEB-INF/web.xml</em> configuration file using the
<em>&lt;auth-constraint&gt;</em> element. You can switch roles by changing the
<em>&lt;role-name&gt;</em>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_hyrax_administrators_interface">6.2.2. Using the Hyrax Administrator&#8217;s Interface</h4>
<div class="paragraph">
<p>To access the Hyrax Administrator&#8217;s Interface, go to the base page for
your server (http://<em>you server</em>/opendap) and follow the link to the
<em>Hyrax Admin Interface</em>. Following that link will present a page where
you login to the interface proper. Use the username and password for a
user assigned to the <em>manager</em> role for your Tomcat server (see the
configuration information above for more information about Tomcat users
and roles). Once logged in to the HAI, you will see a page with two main
links; one for the Hyrax front-end and one link for the back-end
servers. Together the front-end and the back-end servers make up one
installation of Hyrax and they can be spread across several machines.
Generally the front-end is run on a host that is outside your
institution&#8217;s firewall, while the back-end servers are inside that
firewall on hosts where data are located. It may be helpful to review
how <a href="#hyrax-overview">Hyrax</a> is structured: Hyrax is
composed of one <a href="#OLFS-config">front-end server (OLFS)</a> and one or more
<a href="#bess-configuration">back-end server (BES)</a> process.</p>
</div>
<div class="paragraph">
<p>Since there is just one instance of the front-end, it has a fairly
simple control panel. The back-end servers' control panel is a little
more complex because there can be many different back-end servers all
part of one Hyrax installation. Use the tabs at the top of the interface
to select different back-end server instances. The following sections
describe both parts of the interface.</p>
</div>
<div class="sect4">
<h5 id="_olfs_log_viewer">OLFS Log Viewer</h5>
<div class="paragraph">
<p>The OLFS control panel provides access to the log for the front-end of
Hyrax. Note that the control panel provides a way to set the logging
level for individual classes that make up the front end of the server;
this is very useful for debugging and testing new front-end plugins but
it rarely needed in an operation setting. The default logging level
shipped with the server is generally the most useful level of detail. By
default the log lines are not displayed - just click the start button to
see them.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide12.jpg" alt="Hai Slide12"></span></p>
</div>
<div class="sect5">
<h6 id="_log_viewer_controls">Log Viewer Controls</h6>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide13.jpg" alt="Hai Slide13"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide14.jpg" alt="Hai Slide14"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_setting_logging_levels">Setting Logging Levels</h6>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide15.jpg" alt="Hai Slide15"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide16.jpg" alt="Hai Slide16"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide17.jpg" alt="Hai Slide17"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide18.jpg" alt="Hai Slide18"></span></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bes_controls">BES Controls</h5>
<div class="paragraph">
<p>The BES control panel provides one tab for each back-end server in this
instance of Hyrax. Note that in these pictures we have only one BES
running and it is called '/' (slash) meaning it is the default BES.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Besctl-01.jpg" alt="Besctl 01"></span></p>
</div>
<div class="paragraph">
<p>Beneath the "BES Management " banner you will see one or more tabs. You
will always see a tab with the title of "/". This is the default BES for
this Hyrax. If the particular installation of Hyrax has multiple BES
configured in its OLFS they will appear here as tabs where the "prefix"
for the BES from the olfs.xml file will be used as the tab title.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide02.jpg" alt="Admin Page Tour 1"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide03.jpg" alt="Admin Page Tour 2"></span></p>
</div>
<div class="sect5">
<h6 id="_bes_configuration">BES Configuration</h6>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide04.jpg" alt="Hai Slide04"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide05.jpg" alt="Hai Slide05"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_bes_logging">BES Logging</h6>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide06.jpg" alt="BES Logging 1"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide07.jpg" alt="BES Logging 2"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide08.jpg" alt="BES Logging Configuration 1"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide09.jpg" alt="BES Logging 3"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_olfs_connections">OLFS Connections</h6>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide10.jpg" alt="OLFS Connections 1"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Hai-Slide11.jpg" alt="OLFS Connections 2"></span></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hyrax_security">7. Hyrax Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_secure_installation_guidelines">7.1. Secure Installation Guidelines</h3>
<div class="paragraph">
<p>Security is an important and unfortunately complex issue. Any computer
security expert will tell you that the best way to keep your systems
secure is to never, ever, let them have network access. Obviously that&#8217;s
not really what you had in mind or you wouldn&#8217;t be thinking about
installing Hyrax. You can improve the security of Hyrax using a number
of mechanisms, from following best practices for installation, to
requiring secure authentication for the entire server.</p>
</div>
<div class="paragraph">
<p><strong>Disclaimer:</strong> At OPeNDAP we consider security to be a top priority.
However, we are not security experts. What follows is a summary of what
we currently know to be the most effective methods for securing your
Hyrax installation.</p>
</div>
<div class="sect3">
<h4 id="_best_practices_for_secure_installation">7.1.1. Best Practices For Secure Installation</h4>
<div class="paragraph">
<p><strong>Always use a firewall</strong> - Keep your Hyrax server behind a firewall and
configure the firewall to only forward requests to the appropriate port
(typically 8080 for Tomcat and 80 for Apache) on your Hyrax system. Be
sure to have the firewall block direct access to the BES.</p>
</div>
<div class="paragraph">
<p><strong>Separate the BES and the OLFS</strong> - We feel that it is better to run the
BES on a second machine where <strong>only</strong> the BES port is open, and where the
BES system is completely blocked by the firewall.</p>
</div>
<div class="paragraph">
<p><strong>Restrict Log and Configuration File Access</strong> - It is an unfortunate fact
that many (if not most) IT security problems arise from within an
organization and not from outside attacks. Given this situation it is
important to restrict access to the log files generated, and the
configuration files used, by Hyrax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Log Files</em> - Logs can reveal how the code works and allow a hostile
observer to interact with the server and view important details about
the resulting effect.</p>
</li>
<li>
<p><em>Configuration Files</em> - By default Hyrax comes with logging set up to
record access and errors. This can be further reduced if one desires.
However unrestricted access to the Hyrax configuration files could allow
a hostile individual to turn on extensive logging in order to learn more
about the system.</p>
</li>
<li>
<p><em>*Secure the logs, secure the configuration.*</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Run Hyrax as a Restricted user.</strong> - We strongly recommend that you run
Hyrax as a restricted user. Running Hyrax as <em>root</em> or the <em>super user</em>
is actively discouraged, as doing so creates the potential for dire
consequences. What this means is that you should create a special user
for bot the BES and Tomcat. These users should have restricted
privileges and should only be allowed to write to the directories
required by Tomcat and the BES.</p>
</div>
<div class="paragraph">
<p><strong>Additional articles:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open Web Application Security Project (OWASP) article on how to secure
Tomcat:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.owasp.org/index.php/Securing_tomcat" class="bare">http://www.owasp.org/index.php/Securing_tomcat</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat 6 uses a different directory structure, has some logging
changes, and has done away with the need for a deployment descriptor for
a web app. There&#8217;s an overview in this Covalent presentation:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://www.springsource.com/files/uploads/all/pdf_files/news_event/Intro_to_Tomcat6.pdf" class="bare">http://www.springsource.com/files/uploads/all/pdf_files/news_event/Intro_to_Tomcat6.pdf</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_restricting_system_access">7.1.2. Restricting System Access</h4>
<div class="paragraph">
<p>One may also choose to restrict user access to Hyrax. This can be done
by configuring Tomcat to demand user authentication, and if required,
<a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer">TSL/SSL</a>.</p>
</div>
<div class="paragraph">
<p>For Tomcat 5.x see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#OLFS-config">Our instructions for enabling Tomcat User Autentication</a></p>
</li>
<li>
<p><a href="http://tomcat.apache.org/tomcat-5.5-doc/index.html">Tomcat 5.x
Documentation</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="http://tomcat.apache.org/tomcat-5.5-doc/realm-howto.html">Section 6:
Configuring/Managing User Realms</a></p>
</li>
<li>
<p><a href="http://tomcat.apache.org/tomcat-5.5-doc/ssl-howto.html">Section 12:
Configuring SSL</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Tomcat 6.x see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://tomcat.apache.org/tomcat-6.0-doc/index.html">Tomcat 6.x
Documentation</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html">Section 6:
Configuring/Managing User Realms</a></p>
</li>
<li>
<p><a href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html">Section 12:
Configuring SSL</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Requiring user authentication and using SSL doesn&#8217;t actually change
Hyrax&#8217;s vulnerability to attack, but it willl increase the security of
your server by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Limiting the number of users to those with authentication credentials.</p>
</li>
<li>
<p>Protecting those authentication credentials by using SSL encryption.</p>
</li>
<li>
<p>Protecting data content by transmitting it in an encrypted form.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="user-authentication">7.1.3. User Authentication</h4>
<div class="paragraph">
<p>This document is intended to help those that have been asked to deploy
Hyrax into an environment where authentication of users is required. In
many such cases Hyrax will be integrated into an existing instance of
the Apache Web server (<em>httpd</em>) where authentication services are
already configured and in use. In other cases people will be setting up
a standalone instance of Tomcat and will be needing to configure it to
use one of the supported authentication services. This document means to
address both situations.</p>
</div>
<div class="sect4">
<h5 id="_terms">Terms</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="http://en.wikipedia.org/wiki/Authentication">Authentication</a> </dt>
<dd>
<p>This is the process of confirming the identity of the user. The end
result is a User ID (<em>uid</em> or <em>UID</em>) which may be accessed by the
software components via (both?) the Apache API (mod_*) and the Java
ServletAPI (Tomcat servlets) used to trigger authorization policy
chains or may be logged along with relevant request information.</p>
</dd>
<dt class="hdlist1"><a href="http://en.wikipedia.org/wiki/Identity_provider">Identity Provider (IdP)</a> </dt>
<dd>
<p>Also known as an <strong>Identity Assertion Provider</strong>, an <strong>Identity
Provider (IdP)</strong> is a service that provides authentication and identity
information services. An <strong>IdP</strong> is a kind of provider that creates,
maintains, and manages identity information for principals and
provides principal authentication to other service providers within a
federation, such as with web browser profiles.</p>
</dd>
<dt class="hdlist1">Service Provider (SP) </dt>
<dd>
<p>A <strong>Service Provider (SP)</strong> is a Web Service that utilizes an IdP
service to determine the identity of it&#8217;s users. Or more broadly, a
role donned by a system entity where the system entity provides
services to principals or other system entities.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With respect to this document Hyrax/Tomcat, and Hyrax/Tomcat/Apache each
become part of an <strong>SP</strong> through the installation and configuration of
software components such as mod_shib (shibboleth) .</p>
</div>
<div class="paragraph">
<p>See
<a href="http://www.thedotnetfactory.com/learningcenter/technologies/service-identity-providers">Service
Providers, Identity Providers &amp; Security Token Services explained</a> for
more.</p>
</div>
</div>
<div class="sect4">
<h5 id="apache-httpd-auth-services-config">Apache <em>httpd</em> Authentication Services Configuration</h5>
<div class="paragraph">
<p>There are many authentication methods available for use with our friend
<em>httpd</em> and each of the three illustrated here has a unique installation
and configuration activity. There are some common changes that must be
made to the Tomcat configuration regardless of the authentication method
employed by Apache. We&#8217;ll cover those first and then examine LDAP,
Shibboleth, and NASA URS IdP configurations for Apache <em>httpd</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are deploying Hyrax with an existing Apache service then
it is likely that all you have to do is configure <em>httpd</em> and Tomcat
to work together and define and then define a security constraint for
<em>httpd</em> that enforces a login requirement (valid-user) for Hyrax.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="config-apache-tomcat-w-t">Configure Apache httpd and Tomcat to work together</h6>
<div class="paragraph">
<p>In this part we configure Tomcat and Apache <em>httpd</em> to work together so
that <em>httpd</em> can provide proxy and authentication services for Hyrax.</p>
</div>
<div class="sect6">
<h7 id="_configure_apache">Configure Apache</h7>
<div class="paragraph">
<p>In <code>/etc/httpd/conf.d</code> create a file called <strong>hyrax.conf</strong> . Edit the file
and add following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Proxy *&gt;
    AddDefaultCharset Off
    Order deny,allow
    Allow from all
&lt;/Proxy&gt;
 
ProxyPass /opendap ajp://localhost:8009/opendap
ProxyPassReverse /opendap ajp://localhost:8009/opendap</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The ProxyPass and ProxyPassReverse should be set to local host
unless a more complex deployment issuing attempted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will expose the web application "opendap" (aka Hyrax) through
Apache. Make sure that the AJP URLs both point to your deployment of
Hyrax.</p>
</div>
</div>
<div class="sect6">
<h7 id="_taking_advantage_of_apache_logging">Taking advantage of Apache Logging</h7>
<div class="paragraph">
<p>Often when authentication is needed, it is also necessary to log <em>who</em>
has logged in and <em>what</em> they have accessed. Apache has a very flexible
logging system; that can tell you what users asked for, where they came
from, and when they made the request - among other things. For specific
authentication technologies it may also be possible to log specific
information about UIDs, etc. See the sections below for information on
configuring Apache&#8217;s log to record that kind of technology-specific
data.</p>
</div>
</div>
<div class="sect6">
<h7 id="_add_ssl_capabilities_to_apache">Add SSL Capabilities to Apache</h7>
<div class="paragraph">
<p>This step is not absolutely necessary, but it&#8217;s quite likely you will
want to do this, particularly if you&#8217;re going to use <em>https</em> to access
the tomcat servlet engine running the Hyrax front-end. If you use https
in the AJP configuration as shown in the next section, you will need to
set up Apache to support https even if users don&#8217;t access the server
with that protocol (because internally, some of the server&#8217;s less
performance intensive functions work by making calls to itself, and
those will use https if you&#8217;ve set up tomcat to use https with AJP).
However, the configuration is very simple.</p>
</div>
<div class="paragraph">
<p>First, make sure you have mod_ssl installed. For CentOS 6, use <em>sudo yum
install mod_ssl</em></p>
</div>
<div class="paragraph">
<p>Next make the needed certs. Here&#8217;s how to make and install a self-signed
cert for CentOS 6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="shell"># Generate private key
openssl genrsa -out ca.key 2048
 
# Generate CSR
openssl req -new -key ca.key -out ca.csr
 
# Generate Self Signed Key
openssl x509 -req -days 365 -in ca.csr -signkey ca.key -out ca.crt
 
# Copy the files to the correct locations
cp ca.crt /etc/pki/tls/certs
cp ca.key /etc/pki/tls/private/ca.key
cp ca.csr /etc/pki/tls/private/ca.csr</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure httpd to use the newly installed certs and restart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the SSL configuration file: <code>/etc/httpd/conf.d/ssl.conf</code></p>
</li>
<li>
<p>Locate the following key value pairs and make sure the values are
correct with respect to your actions in the previous section:<br>
<code>SSLCertificateFile /etc/pki/tls/certs/ca.crt</code><br>
and:<br>
<code>SSLCertificateKeyFile /etc/pki/tls/private/ca.key</code></p>
</li>
<li>
<p>Restart the service: <code>sudo /usr/sbin/apachectl restart</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More complete instructions can be found here:
<a href="http://wiki.centos.org/HowTos/Https" class="bare">http://wiki.centos.org/HowTos/Https</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_configure_tomcat_hyrax">Configure Tomcat (Hyrax)</h7>
<div class="paragraph">
<p>The primary result of the Apache authentication (the <em>uid</em> string) must
be correctly transmitted to Tomcat. On the Tomcat side we have to open
the way for this by configuring a <code>AJP Connector</code> object. This is done
by editing the file:</p>
</div>
<div class="paragraph">
<p>$CATALINA_HOME/conf/server.xml</p>
</div>
<div class="paragraph">
<p>Edit the server.xml file, and find the AJP Connector element on port
8009. It should look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Connector port="8009" protocol="AJP/1.3" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This line may be "commented out," with &lt;!-- on a line before and -&#8594; on
a line after. If so, remove those lines. If you cannot find the AJP
connector element, simply create it from the code above.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In order to receive authentication information from Apache, you must
disable Tomcat&#8217;s native authentication. Set the tomcatAuthentication
attribute to "false" - see below for an example.</p>
</li>
<li>
<p>If your Apache web server is using SSL/HTTPS (<strong>and it should be</strong>),
you need to tell Tomcat about that fact so that it can construct
internal URLs correctly. Set the scheme attribute to "https" and the
proxyPort attribute to "443" - see below for an example.</p>
</li>
<li>
<p>For increased security, disable access to the connector from anywhere
but the local system. Set the address attribute to "127.0.0.1" - see
below for an example.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you are finished making changes, your connector should look
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Connector
        port="8009"
        protocol="AJP/1.3"
        redirectPort="443"
        scheme="https"
        address="127.0.0.1"
        enableLookups="false"
        tomcatAuthentication="false"
        /&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">port </dt>
<dd>
<p>The Connector will listen on port 8009.</p>
</dd>
<dt class="hdlist1">protocol </dt>
<dd>
<p>The protocol is <em>AJP/1.3</em>.</p>
</dd>
<dt class="hdlist1">redirectPort </dt>
<dd>
<p>Secure redirects to port <em>443</em> which is the nominal Apache HTTPS port,
rather than the default 8443 which is nominally directed to Tomcat.</p>
</dd>
<dt class="hdlist1">scheme </dt>
<dd>
<p>Ensures that the scheme is <em>HTTPS</em>. This is a best practice and is
simple enough if the server is already configured for HTTPS. If your
server is not configured to utilize HTTPS, then you&#8217;ll either need to
set the value of <em>scheme</em> to "http" or you can undertake to
<a href="http://httpd.apache.org/docs/2.2/ssl/">configure your instance of
Apache <em>httpd</em> to support for TLS/SSL transport</a>.</p>
</dd>
<dt class="hdlist1">address </dt>
<dd>
<p>The loopback address (127.0.0.1) ensures that only local requests for
the connection will be serviced.</p>
</dd>
<dt class="hdlist1">enableLookups </dt>
<dd>
<p>A value of <strong>true</strong> enables DNS look ups for Tomcat. This means that web
applications (like Hyrax) will see the client system as a host name
and not an IP address. Set this to <strong>false</strong> to improve performance.</p>
</dd>
<dt class="hdlist1">tomcatAuthentication </dt>
<dd>
<p>A value of <strong>false</strong> will allow the Tomcat engine to receive
authentication information (the <em>uid</em> and in some cases other
attributes) from Apache <em>httpd</em>. A value of <strong>true</strong> will cause Tomcat
to ignore Apache authentication results in favor of it&#8217;s own.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Restart Tomcat to load the new configuration. Now the Tomcat web
applications like Hyrax should see all of the Apache authentication
attributes. (These can be retrieved programmatically in the Java
sServlet API by using HttpServletRequest.getRemoteUser() or
HttpServletRequest.getAttribute("ATTRIBUTE NAME"). Note that
HttpServletRequest.getAttributeNames() may not list all available
attributes – you must request each attribute individually by name.)</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_second_configure_apache_httpd_to_authenticate">Second: Configure Apache httpd to authenticate</h6>
<div class="paragraph">
<p>Once Tomcat and Apache httpd are working together all that remains is to
configure a security restraint on the Hyrax web application and specify
the authentication mechanism which is to used to identify the user.</p>
</div>
<div class="paragraph">
<p>While the details of the Apache security constraints differ somewhat
from one <strong>IdP</strong> to the next what is consistent is that you will need to
define a security constraint on Hyrax inside the chain of <strong>httpd.conf</strong>
files. The most simple example, that you want all users of the Hyrax
instance to be authenticated, might look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># This is a simplified generic configuration example; see the sections below for the real
# examples for LDAP, Shibboleth or URS/OAuth2
&lt;Location /opendap&gt;
  AuthType YourFavoriteAuthTypeHere
  require valid-user
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Where the <code>require valid-user</code> attribute requires that all accessors be
authenticated and where <em>YourFavoriteAuthTypeHere</em> would be something
like <em>Basic</em>, <em>UrsOAuth2</em> or <em>shibboleth</em>.</p>
</div>
<div class="paragraph">
<p>Complete examples for LDAP, URS/OAuth2, and Shibboleth IdPs are
presented in the following sections.</p>
</div>
<div class="sect6">
<h7 id="_ldap">LDAP</h7>
<div class="paragraph">
<p>(<a href="http://httpd.apache.org/docs/2.2/mod/mod_ldap.html">mod_ldap</a>,
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html">mod_authnz_ldap</a>)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must first
<a href="#config-apache-tomcat-w-t">configure Apache and Tomcat (Hyrax) to work together</a>
prior to completion of this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to get Apache httpd to use LDAP authentication you will have
configure an Apache security constraint on the Hyrax web application.
For this example we will configure Apache to utilize the
<a href="http://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/">Forum
Systems public LDAP server</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>All user passwords are <em>password</em>.</p>
</li>
<li>
<p>Groups and Users:</p>
<div class="ulist">
<ul>
<li>
<p><strong>mathematicians</strong></p>
<div class="ulist">
<ul>
<li>
<p>riemann</p>
</li>
<li>
<p>gauss</p>
</li>
<li>
<p>euler</p>
</li>
<li>
<p>euclid</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>scientists</strong></p>
<div class="ulist">
<ul>
<li>
<p>einstein</p>
</li>
<li>
<p>newton</p>
</li>
<li>
<p>galieleo</p>
</li>
<li>
<p>tesla</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create and edit the file <code>/etc/httpd/conf.d/ldap.conf</code>.</p>
</div>
<div class="paragraph">
<p>Add the following at the end of the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># You may need to uncomment these two lines...
# LoadModule ldap_module modules/mod_ldap.so
# LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
 
# You may want to comment out this line once you have it working.
LogLevel debug
 
&lt;Location /opendap &gt;
   Order deny,allow
   Deny from all
   AuthType Basic
   AuthName "Forum Systems Public LDAP Server-  Login with user id"
   AuthBasicProvider ldap
   AuthzLDAPAuthoritative off
   AuthLDAPURL ldap://ldap.forumsys.com:389/dc=example,dc=com
   AuthLDAPBindDN "cn=read-only-admin,dc=example,dc=com"
   AuthLDAPBindPassword password
   AuthLDAPGroupAttributeIsDN off
   ErrorDocument 401 "Please use your username and password to login into this Hyrax server"
   Require valid-user
   Satisfy any
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Restart Apache httpd and you should now need to authenticate to access
anything in /opendap</p>
</div>
<div class="paragraph">
<p>What&#8217;s happening here? Let&#8217;s look at each of the components of the
<strong><code>&lt;Location&gt;</code></strong> directive:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;Location  /opendap&gt;</code> </dt>
<dd>
<p>The <a href="http://httpd.apache.org/docs/2.2/mod/core.html#location">Location</a>
directive limits the scope of the enclosed directives by URL or
URL-path. In our example it says that anything on the server that
begins with the URL path of /opendap will be the scope of the
directives contained within. Generally The <code>Location</code> directive is
applied to things outside of the filesystem used by Apache, such as a
Tomcat service (Hyrax).</p>
</dd>
<dt class="hdlist1"><code>Order deny,allow</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authz_host.html#order">Order</a>
directive, along with the Allow and Deny directives, controls a
three-pass access control system. The first pass processes either all
Allow or all Deny directives, as specified by the Order directive. The
second pass parses the rest of the directives (Deny or Allow). The
third pass applies to all requests which do not match either of the
first two. In this example first, all Deny directives are evaluated;
if any match, the request is denied unless it also matches an Allow
directive. Any requests which do not match any Allow or Deny
directives are permitted.</p>
</dd>
<dt class="hdlist1"><code>Deny from all</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authz_host.html#deny">Deny</a>
directive allows access to the server to be restricted based on
hostname, IP address, or environment variables. The arguments for the
Deny directive are identical to the arguments for the Allow directive.</p>
</dd>
<dt class="hdlist1"><code>AuthType Basic</code> </dt>
<dd>
<p>The <a href="http://httpd.apache.org/docs/2.2/mod/core.html#authtype">AuthType</a>
directive selects the type of user authentication for a directory. The
authentication types available are Basic (implemented by
<a href="http://httpd.apache.org/docs/2.2/mod/mod_auth_basic.html">mod_auth_basic</a>)
and Digest (implemented by
<a href="http://httpd.apache.org/docs/2.2/mod/mod_auth_digest.html">mod_auth_digest</a>).</p>
</dd>
<dt class="hdlist1"><code>AuthName "Forum Systems Public LDAP Server-  Login with user id"</code> </dt>
<dd>
<p>The <a href="http://httpd.apache.org/docs/2.2/mod/core.html#authname">AuthName</a>
directive sets the name of the authorization realm for a directory.
This realm is given to the client so that the user knows which
username and password to send.</p>
</dd>
<dt class="hdlist1"><code>AuthBasicProvider ldap</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_auth_basic.html#authbasicprovider">AuthBasicProvider</a>
directive sets which provider is used to authenticate the users for
this location. In this example we are saying that an LDAP service will
be configured to provide the authentication service.</p>
</dd>
<dt class="hdlist1"><code>AuthzLDAPAuthoritative off</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html#authzldapauthoritative">AuthzLDAPAuthoritative</a>
directive is used to prevent other authentication modules from
authenticating the user if this one fails. Set to <code>off</code> (as in this
example) if this module should let other authorization modules attempt
to authorize the user, should authorization with this module fail.
Control is only passed on to lower modules if there is no DN or rule
that matches the supplied user name (as passed by the client).</p>
</dd>
<dt class="hdlist1"><code>AuthLDAPURL ldap://ldap.forumsys.com:389/dc=example,dc=com</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html#authldapurl">AuthLDAPURL</a>
directive is used to define the URL specifying the LDAP search
parameters. In this example the service is hosted at
<em>`ldap.forumsys.com`</em>, on port <em>`389`</em>. The search will be for
anyone associated with the domain components <em>`example`</em> and <em>`com`</em>
(aka <em>`example.com`</em>).</p>
</dd>
<dt class="hdlist1"><code>AuthLDAPBindDN "cn=read-only-admin,dc=example,dc=com"</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html#authldapbinddn">AuthLDAPBindDN</a>
directive is an optional directive used to specify a
<em>`distinguished name`</em> (DN) when binding to the server. If not present
<strong><code>mod_authnz_ldap</code></strong> will use an anonymous bind. Many servers will not
allow an anonymous binding and will require that the Apache service
bind with a particular DN. In this example the server is instructed to
bind with the <em>common name</em> (CN) <em>`read-only-admin`</em> at
<em>`example.com`</em></p>
</dd>
<dt class="hdlist1"><code>AuthLDAPBindPassword password</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html#authldapbindpassword">AuthLDAPBindPassword</a>
directove specifies the password to be used in conjunction with the
<strong><code>AuthLDAPBindDN</code></strong>. In this example the password is the word
<em>`password`</em>.</p>
</dd>
<dt class="hdlist1"><code>AuthLDAPGroupAttributeIsDN off</code> </dt>
<dd>
<p>The
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html#authldapgroupattributeisdn">AuthLDAPGroupAttributeIsDN</a>
directive is a boolean valued directive that tells <em>`mod_authnz_ldap`</em>
wether or not to use the DN of the client username when checking for
group membership. In our example the value is set to <strong><code>off</code></strong> so the
clients <em>username</em> will be used to locate the clients group
membership.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>ErrorDocument 401 "Please use your username and password to login into this Hyrax server"</code>
::
  The
  <a href="http://httpd.apache.org/docs/2.2/mod/core.html#errordocument">ErrorDocument</a>
  directive specifies what message the server will return to the client
  in the event of an error. In this example we define a message to be
  returned for all 401 (Unauthorized) errors to help the client
  understand that they need to be authenticated to proceed.
 <code>Require valid-user</code> ::
  The <a href="http://httpd.apache.org/docs/2.2/mod/core.html#require">Require</a>
  directive selects which authenticated users can access a resource.
  Multiple instances of this directive are combined with a logical "OR",
  such that a user matching any Require line is granted access. In this
  case it&#8217;s effect is to say that any valid user that has authenticated
  (via the LDAP server ldap://ldap.forumsys.com:389 with the
  distinguished name components dc=example,dc=com) will be allowed
  access.
 <code>Satisfy any</code> ::
  The <a href="http://httpd.apache.org/docs/2.2/mod/core.html#satisfy">Satisfy</a>
  directive defines the interaction between host-level access control
  and user authentication. It may have a value of either <strong><code>Any</code></strong> or
  <strong><code>All</code></strong>. The any value indicates that the client will be admitted if
  they successfully authenticate using a username/password OR if they
  are coming from a host address that appears in an <strong><code>Allow from</code></strong>
  directive.</p>
</div>
<div class="sect7">
<h8 id="_ldap_authorization_constraints">LDAP Authorization Constraints</h8>
<div class="paragraph">
<p>The Apache module
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html">mod_authnz_ldap</a>
provides a fairly rich set of &#8220;Require&#8221; directives which can be used
to control (authorize) access to resources serviced by Apache. In the
example above the <strong><code>Require</code></strong> directive is quite simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   Require valid-user</pre>
</div>
</div>
<div class="paragraph">
<p>Which says (since the defined authentication mechanism for the enclosing
<strong><code>Location</code></strong> directive is LDAP) that any LDAP authenticated user may be
allowed access to anything that begins with the URL-path <strong><code>/opendap</code></strong>.
While that may be adequate for some sites, many others will be required
to have more complex access control policies in place. The LDAP module
<strong><code>mod_authnz_ldap</code></strong> provides a rich collection of <strong><code>Require</code></strong> directive
assertions that allow the administrator much more finely grained access
control. Rather than provide an exhaustive discussion of these options
here we will provide a few basic examples and refer the reader to
<a href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html">the
comprehensive documentation for the <em>`mod_authnz_ldap`</em> module at the
Apache project</a>.</p>
</div>
<div class="paragraph">
<p>Grant access to anyone in the <em>`mathematicians`</em> group in the
organization <em>`example.com`</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    AuthLDAPURL ldap://ldap.forumsys.com:389/dc=example,dc=com
    AuthLDAPGroupAttributeIsDN on
    Require ldap-group ou=mathematicians,dc=example,dc=com</pre>
</div>
</div>
<div class="paragraph">
<p>Grant access to anyone who has an LDAP attribute <em>`homeDirectory`</em> whose
value is <em>`home`</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    AuthLDAPURL ldap://ldap.forumsys.com:389/dc=example,dc=com
    Require ldap-attribute homeDirectory=home</pre>
</div>
</div>
<div class="paragraph">
<p>Combine the previous two examples to grant access to anyone who has an
LDAP attribute <em>`homeDirectory`</em> whose value is <em>`home`</em> and to anyone
in the <em>`mathematicians`</em> group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    AuthLDAPURL ldap://ldap.forumsys.com:389/dc=example,dc=com
    AuthLDAPGroupAttributeIsDN on
    Require ldap-group ou=mathematicians,dc=example,dc=com
    Require ldap-attribute homeDirectory=home</pre>
</div>
</div>
<div class="paragraph">
<p>The possibilities are vast, but it is certainly the case that the
contents of the LDAP service against which you are authenticating, and
the richness of the group and attribute entries will in a large part
determine the granularity of access control you will be able to provide.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="shibboleth">Shibboleth (mod_shib)</h7>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must
<a href="#config-apache-tomcat-w-t">configure Apache and Tomcat (Hyrax) to work together</a>
prior to completion of this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Shibboleth wiki provides excellent documentation on how to get
Shibboleth authentication services working with Tomcat. This is
primarily an Apache <em>httpd</em> activity.</p>
</div>
<div class="paragraph">
<p>Basically you need to
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall">follow
the instructions for a Native Java Install</a> and as you read, remember -
Hyrax does not use either Spring or Grails.</p>
</div>
<div class="sect7">
<h8 id="_installation">Installation</h8>
<div class="paragraph">
<p>The logical starting point for this is with the
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall">Native
Java SP Installation</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall" class="bare">https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But as far as the organization of the work is concerned it is really the
last page you need to process, as it will send you off to do a platform
dependent Shibboleth Native Service Provider for Apache installation
which needs to be completed, working, and configured before you&#8217;ll
return to the
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall">Native
Java SP Installation</a> to enable the part where Tomcat and <em>mod_shib</em>
pass authenticated user information into Tomcat.</p>
</div>
<div class="paragraph">
<p>The document path on the
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall">Natvie
Java Install wiki page</a> will send you off to do Shibboleth Native
Service Provider installation which is platform dependent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/Installation" class="bare">https://wiki.shibboleth.net/confluence/display/SHIB2/Installation</a></p>
<div class="ulist">
<ul>
<li>
<p>Install a <em>Native Service Provider</em> on your target system.</p>
</li>
<li>
<p>In the initial testing section for Linux they suggest accessing the
Status page <a href="https://localhost/Shibboleth.sso/Status" class="bare">https://localhost/Shibboleth.sso/Status</a>, but you may have to
use the loopback address to be able to do so:
<a href="https://127.0.0.1/Shibboleth.sso/Status" class="bare">https://127.0.0.1/Shibboleth.sso/Status</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Return to the
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPJavaInstall">Native
Java SP Installation</a> and complete the instructions there.</p>
</div>
</div>
<div class="sect7">
<h8 id="_configuration_2">Configuration</h8>
<div class="paragraph">
<p>Once the SP installation is completed go to the Native SP Configuration
page:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPConfiguration" class="bare">https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPConfiguration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read that page and then follow the link to the instructions for Apache:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig" class="bare">https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow those instructions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not be confused by the section
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig#NativeSPApacheConfig-MakingURLsUsedbymod_shibGetProperlyRouted">Making
URLs Used by mod_shib Get Properly Routed</a>. While you must add this
<em>Location</em> directive to "reveal" the shibboleth module to the world
don&#8217;t think the URL <a href="https://yourhost/Shibboleth.sso" class="bare">https://yourhost/Shibboleth.sso</a> is a valid access
point to the module. That URL may always return a Shibboleth error page
even if <em>mod_shib</em> and <em>shibd</em> are configured and working correctly.</p>
</li>
<li>
<p>Read and understand the section
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig#NativeSPApacheConfig-EnablingtheModuleforAuthentication">Enabling
the Module for Authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Shibboleth instructions should have had you add something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Location /opendap&gt;
  AuthType shibboleth
  ShibRequestSetting requireSession 1
  require valid-user
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>to <em>httpd.conf</em>. This will require users to authenticate to access any
part of Hyrax which may be exactly what you want. If you want more fine
grained control you may want use multiple <code>Location</code> elements with
different <code>require</code> attributes. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Location /opendap&gt;
  AuthType shibboleth
  ShibCompatWith24 On
  require shibboleth
&lt;/Location&gt;
&lt;Location /opendap/AVHRR&gt;
  AuthType shibboleth
  ShibCompatWith24 On
  ShibRequestSetting requireSession 1
  require valid-user
&lt;/Location&gt;
&lt;/apache&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the first <code>Location</code> establishes Shibboleth as the
authentication tool for the entire <em>/opendap</em> application path, and
enables the Shibboleth module over the entire Hyrax Server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Since there is no <code>ShibRequestSetting requireSession 1</code> line it does
not require a user to be logged in order to access the path.</p>
</li>
<li>
<p>The <code>require shibboleth</code> command activates mod_shib for all of Hyrax.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second <code>Location</code> states that only valid-users may have access
"/opendap/AVHRR" URL path.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>require valid-user</code> command requires user authentication.</p>
</li>
<li>
<p>The <code>AuthType</code> command is set to <code>shibboleth</code> so <em>mod_shib</em> will be
called upon to perform the authentication.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more examples and better understanding see the
<a href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig#NativeSPApacheConfig-AuthConfigOptions">Apache
Configuration section of the Shibboleth wiki.</a></p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_nasas_earthdata_login_oauth2_mod_auth_urs">Nasa&#8217;s Earthdata Login - OAuth2 (mod_auth_urs)</h7>
<div class="paragraph">
<p>Earthdata Login/OAuth2 is a Single Sign On (SSO) authentication flow that utilizes
HTTP redirects to guide client applications requesting an authenticated
resource to a central Earthdata Login authentication point where they are
authenticated, and them redirected back to their requested resource.
This way user credentials, however they may be exchanged, are only ever
exchanged with a single trusted service.</p>
</div>
<div class="paragraph">
<p>The Earthdata Login documentation, downloads, application registration, and
application approval all require Earthdata Login credentials to access. Obtaining
Earthdata Login credentials must be the very first activity for anyone wishing to
retrieve, configure and deploy <em>mod_auth_urs</em>.</p>
</div>
<div class="paragraph">
<p>Each new instance of <em>mod_auth_urs</em> deployed will need to have a set of
unique application credentials. These are generated by registering the
new instance as an new application with the Earthdata Login system. Because each
registered application is linked to a single <em>redirectUrl,</em> each
different running instance of <em>mod_auth_urs</em> will need to be registered
in order to successfully have the server redirect clients back from
their authentication activity.</p>
</div>
<div class="sect7">
<h8 id="_prerequisites_requirements">Prerequisites &amp; Requirements</h8>
<div class="ulist">
<ul>
<li>
<p>You must be a registered Earthdata Login user in order to perform this
configuration. (<strong>First. Do this first.</strong>)</p>
</li>
<li>
<p>You need mod_auth_urs (which you will likely have to build from
source; see below).</p>
</li>
<li>
<p>You must register a web application and authorize it. See
<a href="#obtain-app-creds">Obtain Earthdata Login Application Credentials</a>
below for more information on this. Note: You can register
your application with the
<a href="https://urs.earthdata.nasa.gov/profile">Earthdata Login System</a>.</p>
</li>
<li>
<p>You must complete the section
<a href="#config-apache-tomcat-w-t">Configure Apache and Tomcat (Hyrax) to work together</a>.</p>
</li>
<li>
<p>You will need the public facing domain name or IP address of your
server.</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_building_mod_auth_urs">Building mod_auth_urs</h8>
<div class="paragraph">
<p>The
<a href="https://wiki.earthdata.nasa.gov/display/URSFOUR/Apache+URS+Authentication+Module">documentation
for mod_auth_urs</a> describes how to build the module from a clone of the
git repo, however we found that on CentOS 6 that process had to be
modified to include linking with the ssl library. Since it is a fairly
simple build, we&#8217;ll duplicate it here with the caveat that a newer
version of the module might have a different build recipe, so if this
doesn&#8217;t work,
<a href="https://wiki.earthdata.nasa.gov/display/URSFOUR/Apache+URS+Authentication+Module">check
the official page</a>.</p>
</div>
<div class="paragraph">
<p>With that said, to build the module for CentOS 6:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure you have the httpd-devel and ssl-devel packages are loaded
onto your host</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">sudo yum install httpd-devel openssl-devel;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the mod_auth_urs git repo from the ECC system. You need a
Earthdata Login for this, but you need a Earthdata Login  for several
other steps in this configuration process as well.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">git clone https://&lt;username&gt;@git.earthdata.nasa.gov/scm/aam/apache-urs-authentication-module.git urs;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Build it using the apache extension build tool apxs in the <em>urs</em>
directory just made by the git clone command. Note that for CentOS 6 you
need to include the <em>ssl</em> library and that you&#8217;ll need to be root as it
installs libraries into apache.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cd urs;

apxs -i -c -n mod_auth_urs mod_auth_urs.c mod_auth_urs_cfg.c mod_auth_urs_session.c mod_auth_urs_ssl.c mod_auth_urs_http.c mod_auth_urs_json.c mod_auth_urs_crypto.c;</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="obtain-app-creds">Obtain Earthdata Login Application Credentials</h8>
<div class="sect8">
<h9 id="_create_earthdata_application">Create Earthdata Application</h9>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser, navigate to your Earthdata login profile page,
which will be either <code>uat.urs.earthdata.nasa.gov/profile</code> or
<code>urs.earthdata.nasa.gov/profile</code>, depending on whether
you are using the production or the test service.</p>
</li>
<li>
<p>In the menubar, click on the <em>Applications</em> dropdown and select
<em>My Applications</em> from the list of options:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/main-screen_cropped.PNG" alt="applications" width="400" height="auto"></span></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you don&#8217;t see the <em>My Applications</em> option, then you
need to contact your Earthdata Login administrator to request
Application Creator permission on their system.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On the <em>My Applications</em> page, click the <em>CREATE A NEW APPLICATION</em> button:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/create-new-app_cropped.PNG" alt="applications" width="400" height="auto"></span></p>
</div>
</li>
<li>
<p>Fill out and submit the form:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/register_a_new_app.PNG" alt="applications" width="400" height="auto"></span></p>
</div>
</li>
<li>
<p>Return to the <em>My Applications Page</em> to view the application that you just created:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/tesy_tesy_app.PNG" alt="applications" width="400" height="auto"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The application may show as <em>Pending</em>, or it may immediately
become <em>Active</em>; regardless, once your application registration request
passes through the approval process, its status will be changed
to <em>Active</em>. You should get two emails, one acknowledging your
application registration and another indicating that your
application has been activated. (In the past, it has taken
about twenty minutes to receive the activation notification.)</p>
</div>
</div>
<div class="sect8">
<h9 id="_approve_newly_created_earthdata_login_application">Approve Newly Created Earthdata Login Application</h9>
<div class="paragraph">
<p>Once your application is marked as <em>Active</em>, you will need to
approve it so that the Earthdata Login system knows that you
are okay with the application having access to your Earthdata Login
user profile information (not your password).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every single Earthdata Login user that is going to access your new server will need to do this too.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the menubar, click on the <em>Applications</em> dropdown and select
<em>Authorized Apps</em> from the list of options.</p>
</li>
<li>
<p>Click the <em>APPROVE MORE APPLICATIONS</em> button:</p>
</li>
<li>
<p>On the following page (titled <em>Approve Applications</em>), enter the
name of the application you previously created, and click the
<em>SEARCH</em> button:</p>
</li>
<li>
<p>When you have located the application you would like to approve,
click the <em>APPROVE</em> button to its right:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You will be returned to the <em>Approved Applications</em> page, where you
should see a green confirmation banner at the top of the page
and your newly-approved application in the list of approved apps.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compute_the_authorization_code_ursclientauthcode">Compute the Authorization Code (<code>&lt;URSClientAuthCode&gt;</code>)</h5>
<div class="paragraph">
<p>Before configuring <em>mod_auth_urs</em>, you must compute the authorization code
for your freshly registered application.
There are three methods for computing the URS client authorization code:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shell Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">echo -n "&lt;cid&gt;:&lt;pw&gt;" | base64</pre>
</div>
</div>
</li>
<li>
<p>Perl Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">perl -e 'use MIME::Base64; print encode_base64("&lt;cid&gt;:&lt;pw&gt;");'</pre>
</div>
</div>
</li>
<li>
<p>PHP Script:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">php -r 'echo base64_encode("&lt;cid&gt;:&lt;pw&gt;");'</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the above examples, <code>&lt;cid&gt;</code> is the Client ID (found on your application&#8217;s
<em>Application Administration</em> page), and <code>&lt;pw&gt;</code> is your application&#8217;s password.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_3">Configuration</h5>
<div class="paragraph">
<p>The instructions for configuring the Apache module <strong>mod_auth_urs</strong> can be
found here:</p>
</div>
<div class="paragraph">
<p><a href="https://wiki.earthdata.nasa.gov/display/URSFOUR/Apache+URS+Authentication+Module" class="bare">https://wiki.earthdata.nasa.gov/display/URSFOUR/Apache+URS+Authentication+Module</a></p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The instructions are clear and complete but you have to be a
registered Earthdata Login user with permissions to access that page in order to
read it.</p>
</li>
<li>
<p>Also note that the apxs tool used to build an apache module is part of
the <em>httpd-devel</em> package and won&#8217;t be available if you don&#8217;t have that
package installed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once I had it installed all that was needed was to create the file
<em>/etc/httpd/conf.d/urs.conf</em> and add the configuration content to the
file. The configuration file you&#8217;ll find below is annotated and you will
need to review and possibly edit the values of the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UrsAuthServer</p>
</li>
<li>
<p>AuthName</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And you MUST edit and provide your application credential information in
these fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UrsAuthGroup</p>
</li>
<li>
<p>UrsClientId</p>
</li>
<li>
<p>UrsAuthCode</p>
</li>
<li>
<p>UrsRedirectUrl</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And you should review and possibly edit this value to point to an
appropriate page on your server for failed authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UrsAccessErrorUrl</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <em>urs.conf</em> file for <em>httpd</em>:</div>
<div class="content">
<pre class="nowrap"># Load the URS module
LoadModule auth_urs_module    modules/mod_auth_urs.so
#
# Enable Debugging
# LogLevel debug
#
# START - URS module configuration
# The directory where session data will be stored
# NB: This directory MUST be readable and writable
# by the Apache httpd user!!!
#
UrsSessionStorePath /var/tmp/urs/session
#
# The address of the authentication server
# Where you registered your application/server.
#
UrsAuthServer        https://uat.urs.earthdata.nasa.gov
#
# The authentication endpoint
#
UrsAuthPath          /oauth/authorize?app_type=401
#
# The token exchange endpoint
#
UrsTokenPath         /oauth/token
#
#
# END - URS module configuration
 
# Place a URS security constraint on the Hyrax service
&lt;Location /opendap &gt;
 
    # Tells Apache to use URS/OAuth2 authentication in mod_auth_urs
    AuthType UrsOAuth2
 
    # This is a localization field and I think it shows up in
    # browser and GUI client generated authentication dialog boxes.
    AuthName "URS_AuthTest"
 
    # To access, a user must login.
    Require valid-user
 
    ##########################################################
    # UrsAuthGroup     This defines a name for a group of protected resources.
    # All resources with the same group will share authentication state. i.e. If a
    # user attempts to access one resource in a group and authenticates, then
    # the authentication will be valid for all other resources in the group (be
    # aware that the group name is also used as a cookie name).
    UrsAuthGroup       HyraxDataServer
 
    ##########################################################
    # UrsClientId     The ClientID that the URS application registration process
    #  assigned to your application
    UrsClientId        ******
 
    ##########################################################
    # UrsAuthCode     You compute this from the Client ID and application password
    UrsAuthCode        ******
 
    ##########################################################
    # UrsRedirectUrl  This is the redirection URL that was specified when
    # registering the application. This should include the scheme (http/https),
    # the outward facing domain (host)name (or IP address) of your server,
    # the port (if non-standard for the scheme), and path. Note
    # that the path does not need to refer to a real resource, since the module
    # will intercept it and redirect the user before Apache tries to find a
    # matching resource.
    UrsRedirectUrl     https://localhost/opendap/login
 
    ##########################################################
    # UrsAccessErrorUrl  If the users authentication at the URS service fails,
    # this is the page on your server to which they will redirected. If it does not
    # exist they'll get a 404 error instead of the 403.
    UrsAccessErrorUrl  /urs403.html
 
 
    UrsIdleTimeout     600
    UrsActiveTimeout   36000
    UrsIPCheckOctets   2
    UrsUserProfileEnv  uid              URS_USER
    UrsUserProfileEnv  email_address    URS_EMAIL
    UrsUserProfileEnv  first_name       URS_FIRST
    UrsUserProfileEnv  last_name        URS_LAST
 
 
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that you have also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Completed configuring <a href="#apache-integration">AJP proxy for Tomcat</a></p>
</li>
<li>
<p>Authorized your server (aka Application) to access your Earthdata Login profile.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simply restart Apache and Hyrax is ready to be accessed with your Earthdata Login
credentials.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logging_earthdata_login_information">7.1.4. Logging Earthdata Login information</h4>
<div class="paragraph">
<p>It is possible to get the Apache module to pull user profile information
into the request environment using the UrsUserProfileEnv configuration
directive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">UrsUserProfileEnv email_address URS_EMAIL
UrsUserProfileEnv user_type URS_TYPE</pre>
</div>
</div>
<div class="paragraph">
<p>This can be added to a custom log format by including:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LogFormat ... %{URS_EMAIL}e ... \"%{URS_TYPE}e\" ...'''</pre>
</div>
</div>
<div class="paragraph">
<p>Where we show the <em>URS_TYPE</em> environment variable in double quotes
because their values often contain spaces. Thanks to Peter Smith for
this information.</p>
</div>
<div class="paragraph">
<p>See the full Apache
<a href="http://httpd.apache.org/docs/2.2/mod/mod_log_config.html">LogFormat
documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_common_problems">7.2. Common Problems</h3>
<div class="sect3">
<h4 id="_clients_keep_getting_internal_server_error">7.2.1. Clients keep getting <strong>Internal Server Error</strong></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Problem</dt>
<dd>
<p>Everything seems to work fine but when the browser client is
redirected back to the originally requested resource it receives an
<strong>Internal Server Error</strong> from Apache httpd. In
<em>/var/log/httpd/ssl_error.log</em> you see this type of thing:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[Sun Mar 22 20:05:47 2015] [notice] [client 71.56.150.130] UrsAuth: Redirecting to URS for authentication, referer: https://52.1.74.222/opendap/data/contents.html
[Sun Mar 22 20:05:47 2015] [error] [client 71.56.150.130] UrsAuth: Redirection URL: https://uat.urs.earthdata.nasa.gov/oauth/authorize?app_type=401&amp;client_id=tNxluRHmczrTN1iSjXCMiA&amp;response_type=code&amp;redirect_uri=https%3A%2F%2F52.1.74.222%2FOPeNDAP%2Flogin&amp;state=aHR0cHM6Ly81Mi4xLjc0LjIyMi9vcGVuZGFwL2RhdGEvaGRmNC9jb250ZW50cy5odG1s, referer: https://52.1.74.222/opendap/data/contents.html
[Sun Mar 22 20:05:53 2015] [error] [client 71.56.150.130] UrsAuth: Failed to create new cookie, referer: https://uat.urs.earthdata.nasa.gov/oauth/authorize?app_type=401&amp;client_id=tNxluRHmczrTN1iSjXCMiA&amp;response_type=code&amp;redirect_uri=https%3A%2F%2F52.1.74.222%2FOPeNDAP%2Flogin&amp;state=aHR0cHM6Ly81Mi4xLjc0LjIyMi9vcGVuZGFwL2RhdGEvaGRmNC9jb250ZW50cy5odG1s</pre>
</div>
</div>
<div class="paragraph">
<p>This is often caused by the Apache httpd user not having read/write
permission on the directory specified by <strong>UrsSessionStorePath</strong> in the
httpd configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">UrsSessionStorePath /var/tmp/urs/session</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Solution </dt>
<dd>
<p>Check and repair the permissions of the directory specified by
<strong>UrsSessionStorePath</strong> as needed.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tomcat_authentication_services_configuration">8. Tomcat Authentication Services Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tomcat provides a number of authentication Realm implementations
including the JNDIRealm which provides LDAP SP services for Tomcat.
There is currently no Shibboleth realm implementation for Tomcat, and
it&#8217;s an open question for the author if there could be one for
Shibboleth or OAuth2 given the way that these protocols utilize 302
redirects away from the origin service.</p>
</div>
<div class="sect2">
<h3 id="_ldap_2">8.1. LDAP</h3>
<div class="paragraph">
<p>The
<a href="http://tomcat.apache.org/tomcat-7.0-doc/realm-howto.html#JNDIRealm">instructions
for configuring Tomcat to perform LDAP authentication are located here.</a>
It is clearly a benefit if you understand a fair bit about LDAP before
you undertake this.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to configure Tomcat to use LDAP
authentication.</p>
</div>
<div class="paragraph">
<p>In this example we configure a Tomcat JNDI realm to use
<a href="http://forumsys.com">the public LDAP service provided by ForumSys</a>.</p>
</div>
<div class="paragraph">
<p>In the <em>server.xml</em> file we added a JNDI Realm element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;Realm
    className="org.apache.catalina.realm.JNDIRealm"
    connectionURL="ldap://ldap.forumsys.com:389"
    connectionName="cn=read-only-admin,dc=example,dc=com"
    connectionPassword="password"
    userPattern="uid={0},dc=example,dc=com"
    roleBase="dc=example,dc=com"
    roleName="ou"
    roleSearch="(uniqueMember={0})"
/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Configured to work with the
<a href="http://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/">Forum
Systems test LDAP server</a>.</p>
</div>
<div class="paragraph">
<p>Then in the <em>opendap</em> web application we added the following security
constraint to the <em>WEB-INF/web.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
         &lt;web-resource-name&gt;Hyrax Server&lt;/web-resource-name&gt;
         &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
         &lt;role-name&gt;user&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
 
    &lt;user-data-constraint&gt;
         &lt;!-- this ensures that all efforts to access the admin interface nd resources must use HTTPS --&gt;
         &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap"> No changes were made to the _$CATALINA_HOME/conf/tomcat_users.xml_
file.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shibboleth">8.2. Shibboleth</h3>
<div class="paragraph">
<p>There is no actual Shibboleth integration with Tomcat beyond what is
provided by running the Apache <em>httpd</em> module mod_shib and connecting
Tomcat to <em>httpd</em> using AJP
<a href="#shibboleth">as described in the Apache/Shibboleth section on this page</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_earthdata_login_oauth2">8.3. Earthdata Login OAuth2</h3>
<div class="paragraph">
<p>There is no actual Earthdata Login integration with Tomcat beyond what is
provided by running the Apache httpd module mod_auth_urs and
connecting Tomcat to httpd using AJP
<a href="#apache-httpd-auth-services-config">as described in the Apache/URS section on this page</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_for_dap_clients">9. Authentication For DAP Clients</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">9.1. Overview</h3>
<div class="paragraph">
<p>Many users access DAP servers using a browser as their primary software interface. However there is also a growing group of users that utilize either:
* A "smart" tool. Where "smart" means that the tool understands how to interact with a DAP service and construct DAP queries for data and use that in higher level  client side activities like GUI based graphs, image display, selection, navigation etc.
* A command line tool such as "wget" or "curl" that can be used to extract data from a DAP service, but the URL construction is left to other software.
In both these examples we want these client software applications to be able to manage authentication without user intervention, otherwise the automation benefits of these tools is lost.</p>
</div>
</div>
<div class="sect2">
<h3 id="_earthdata_login_users">9.2. Earthdata Login Users</h3>
<div class="paragraph">
<p>Earthdata Login is a NASA run Single Sign-On service. In order to access NASA held data you will need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain (for free) your own set of <a href="https://urs.earthdata.nasa.gov/users/new">Earthdata Login credentials</a>.</p>
</li>
<li>
<p><em>Approve</em> the DAP server application that is serving the data you want. as described in the following section.</p>
</li>
<li>
<p>Use this guide to configure your DAP client of choice (<em>curl</em>, browser, etc.) to utilize these credentials.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Throughout this document NASA&#8217;s Earthdata Login is referred to as and is synonymous with <strong>URS</strong> (NASA changed the name of this service shortly before it&#8217;s use became mandatory for all data access requests.)
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_acquire_earthdata_login_credentials">9.2.1. Acquire Earthdata Login credentials</h4>
<div class="paragraph">
<p>Registering with Earthdata Login and getting a
user account is free. Point you browser at the <a href="https://urs.earthdata.nasa.gov/users/new">Earthdata Login New User</a> page and do the stuff that needs the doing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_approving_the_dap_server_application">9.2.2. Approving The DAP Server Application</h4>
<div class="paragraph">
<p>Regardless of which software client you decide to employ, before you can access any new Earthdata Login authenticated server you must first add that sever to the list of <strong>Approved Applications</strong> in your Earthdata Login profile.</p>
</div>
<div class="paragraph">
<p>To do this you will need the Earthdata Login Application name (aka UID) under which the DAP server is registered with Earthdata Login and your Earthdata Login credentials.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With your browser, navigate to your <a href="https://urs.earthdata.nasa.gov/profile">Earthdata Login profile page.</a></p>
</li>
<li>
<p>Click the <strong>My Applications</strong> tab.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On the <strong>My Applications</strong> page:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>Approve More Applications</strong> button.
This will display the application search page:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/UrsApplicationSearch.png" alt="Earthdata Login Approve Applications Page">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter some or all of the name you picked (which became the UID) of your new application and click the <strong>Search For Applications</strong> button, this will bring you to the Earthdata Login Application Approval page:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/UrsApproveApplication.png" alt="Earthdata Login Application Approval Page">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select your new application and click the <em>Approve Selected Applications</em> button.
You will be returned to the <strong>My Applications</strong> page where you should now see your new application on the list of <em>Approved Applications</em>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/UrsApprovedApplicationList.png" alt="Earthdata Login Approved Applications">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The application named <strong>tesy_tesy</strong> used in this example does not really exist and is for educational puspose only.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_curl_a_k_a_lib_curl">9.3. <em>curl</em> (a.k.a. <em>lib_curl</em>)</h3>
<div class="sect3">
<h4 id="_urs">9.3.1. URS</h4>
<div class="paragraph">
<p>I was able to use command line <em>curl</em> to retrieve URS authenticated  resources using the following technique.</p>
</div>
<div class="paragraph">
<p>First in my home directory I created a <em>.netrc</em> file and set its file permissions to read only for owner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[spooky:~] ndp% touch .netrc
[spooky:~] ndp% chmod 600 .netrc
[spooky:~] ndp% ls -l .netrc
-rw-------@ 1 ndp  staff  92 Nov 13 06:08 .netrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then I edited the <em>.netrc</em> file and associated my URS credentials with the URS IdP instance utilized by my target DAP server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine urs.earthdata.nasa.gov
    login your_urs_uid
    password your_urs_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>I could then retrieve a DDS object in the URS authentication enabled Hyrax server with the following <em>curl</em> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">curl -k -n -c ursCookies -b ursCookies -L --url https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is happening here?</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-k</dt>
<dd>
<p>This tells <em>curl</em> to accept self-signed certificates. This is ok for working with trusted (as in your own) "test" services but should be removed for working with production systems. Because: Security, Chain-Of-Trust, etc.</p>
</dd>
<dt class="hdlist1">-n</dt>
<dd>
<p>This tells <em>curl</em> to use that <em>~/.netrc</em> file I created.</p>
</dd>
<dt class="hdlist1">-c ursCookies</dt>
<dd>
<p>This tells <em>curl</em> to stash cookies in the file <em>ursCookies</em></p>
</dd>
<dt class="hdlist1">-b ursCookies</dt>
<dd>
<p>This tells <em>curl</em> to read cookies from the file <em>ursCookies</em></p>
</dd>
<dt class="hdlist1">-L</dt>
<dd>
<p>Also known as <em>--location</em>, this option tells <em>curl</em> to follow redirects, which is a must for any OAuth2 flow.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>--location-trusted</code> option should not be used as it will cause <em>curl</em> to spread user credentials to servers other than to which they were associated._
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">--url <a href="https://54.172.97.47/opendap" class="bare">https://54.172.97.47/opendap</a></dt>
<dd>
<p>The desired URL, protected by the Earthdata Login authentication flow.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In order to retrieve multiple URLs with out reauthenticating you can use multiple instances of the <em>--url</em> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">curl -k -n -c ursCookies -b ursCookies -L --url https://54.172.97.47/opendap --url https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds --url https://54.172.97.47/opendap/data/nc/coads_climatology.nc.dds</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, since <em>curl</em> is actually pretty smart about using cookies and such you can also make multiple <em>curl</em> requests with the same cookies and it won&#8217;t have to reauthenticate with URS once it&#8217;s authenticated the first time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">curl -k -n -c ursCookies -b ursCookies -L --url https://54.172.97.47/opendap
curl -k -n -c ursCookies -b ursCookies -L --url https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds
curl -k -n -c ursCookies -b ursCookies -L --url https://54.172.97.47/opendap/data/nc/coads_climatology.nc.dds</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_3">9.3.2. LDAP</h4>
<div class="paragraph">
<p>I was able to use command line <em>curl</em> to retrieve LDAP authenticated resources using the following technique.</p>
</div>
<div class="paragraph">
<p>First in my home directory I created a <em>.netrc</em> file and set its file permissions to read only for owner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[spooky:~] ndp% touch .netrc
[spooky:~] ndp% chmod 600 .netrc
[spooky:~] ndp% ls -l .netrc
-rw-------@ 1 ndp  staff  92 Nov 13 06:08 .netrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then I edited the <em>.netrc</em> file and associated my LDAP credentials with the LDAP authenticated DAP server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine 130.56.244.153
    login tesla
    password password</code></pre>
</div>
</div>
<div class="paragraph">
<p>I could then access the top level directory of the LDAP authentication enabled Hyrax server with the following <em>curl</em> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">curl -k -n -c ldapCookies -b ldapCookies  --url https://130.56.244.153/opendap</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is happening here?</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-k</dt>
<dd>
<p>This tells <em>curl</em> to accept self-signed certificates. This is ok for working with trusted (as in your own) "test" services but should be removed for working with production systems. Because: Security, Chain-Of-Trust, etc.</p>
</dd>
<dt class="hdlist1">-n</dt>
<dd>
<p>This tells <em>curl</em> to use that <em>~/.netrc</em> file I created.</p>
</dd>
<dt class="hdlist1">-c ldapCookies</dt>
<dd>
<p>This tells <em>curl</em> to stash cookies in the file <em>ldapCookies</em></p>
</dd>
<dt class="hdlist1">-b ldapCookies</dt>
<dd>
<p>This tells <em>curl</em> to read cookies from the file <em>ldapCookies</em></p>
</dd>
<dt class="hdlist1">--url <a href="https://130.56.244.153/opendap" class="bare">https://130.56.244.153/opendap</a></dt>
<dd>
<p>The desired URL, protected LDAP authentication.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that the credentials are sent with every request so secure transport is a must if user accounts are to be protected.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_2">9.3.3. Shibboleth</h4>
<div class="sect4">
<h5 id="_netrc">.netrc</h5>
<div class="paragraph">
<p>I was not able to use command line <em>curl</em> to retrieve Shibboleth authentication resources using the <em>.netrc</em> technique described in the LDAP and URS sections.</p>
</div>
<div class="paragraph">
<p>Analysis of the HTTP conversation between the idp.testshib.org  server and <em>curl</em> shows that curl correctly follows the series of 302 redirects issued to it, first by the Apache service bound to the Hyrax server and then from the idp.testshib.org server. In every request to the idp.testshib.org server the <em>curl</em> client correctly offers the credentials via the HTTP Authorization header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">0000: GET /idp/Authn/UserPassword HTTP/1.1
0026: Authorization: Basic bXlzZWxmOm15c2VsZg==
0051: User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.2
0091: 1.4 OpenSSL/0.9.8z zlib/1.2.5
00b0: Host: idp.testshib.org
00c8: Accept: */*
00d5: Cookie: _idp_authn_lc_key=efbb6e2a9d893b47fb802ed575329ce69c101b
0115: 3ea8beb6744fab64fc406c358f; JSESSIONID=5A1731EDE00613B13803968CF
0155: AF06284
015e:</pre>
</div>
</div>
<div class="paragraph">
<p>But the Shibboleth system doesn&#8217;t respond to them. This may be a simple configuration issue on the Shibboleth end, or it could be that the Shibboleth protocol specifically forbids accepting credentials via HTTP Authorization headers.</p>
</div>
</div>
<div class="sect4">
<h5 id="_certificates">certificates</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_wget">9.4. <em>wget</em></h3>
<div class="sect3">
<h4 id="_urs_2">9.4.1. URS</h4>
<div class="paragraph">
<p>The <em>wget</em> documentation indicates that <em>wget</em> understands to use the <em>.netrc</em> file that we created for <em>curl</em>, and happily it appears to work, as long as other things are in place.
Consider this <em>wget</em> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">wget  --load-cookies cookies --save-cookies cookies --keep-session-cookie --no-check-certificate https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s happening here?</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">--load-cookies cookies </dt>
<dd>
<p>Load cookies from the file "cookies"</p>
</dd>
<dt class="hdlist1">--save-cookies cookies </dt>
<dd>
<p>Save cookies to the file "cookies"</p>
</dd>
<dt class="hdlist1">--keep-session-cookie </dt>
<dd>
<p>Save session cookies.</p>
</dd>
<dt class="hdlist1">--no-check-certificate </dt>
<dd>
<p>Do not check the authenticity of the (self signed) certificates. This is good for testing against your own servers running with self-signed certificates in that this switch will allow you to experience success when interacting with such servers. However, this switch breaks the <strong>chain of trust</strong> and may allow bad things to happen if used on the open internets. Thus, for regular use, do not include this switch!</p>
</dd>
<dt class="hdlist1"><a href="https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds" class="bare">https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds</a></dt>
<dd>
<p>The URL to retrieve.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here&#8217;s the output of said <em>wget</em> request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[spooky:olfs/testsuite/urs] ndp% wget  --load-cookies cookies --save-cookies cookies --keep-session-cookie --no-check-certificate https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds
--2014-11-14 11:22:18--  https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds
Connecting to 54.172.97.47:443... connected.
WARNING: cannot verify 54.172.97.47's certificate, issued by `/C=US/ST=RI/L=Narragansett/O=OPeNDAP Inc./OU=Engineering/CN=54.172.97.47/emailAddress=support@opendap.org':
  Self-signed certificate encountered.
HTTP request sent, awaiting response... 302 Found
Location: https://uat.urs.earthdata.nasa.gov/oauth/authorize?app_type=401&amp;client_id=04xHKVaNdYNzCBG6KB7-Ig&amp;response_type=code&amp;redirect_uri=https%3A%2F%2F54.172.97.47%2Fopendap%2Flogin&amp;state=aHR0cHM6Ly81NC4xNzIuOTcuNDcvb3BlbmRhcC9kYXRhL25jL2Zub2MxLm5jLmRkcw [following]
--2014-11-14 11:22:19--  https://uat.urs.earthdata.nasa.gov/oauth/authorize?app_type=401&amp;client_id=04xHKVaNdYNzCBG6KB7-Ig&amp;response_type=code&amp;redirect_uri=https%3A%2F%2F54.172.97.47%2Fopendap%2Flogin&amp;state=aHR0cHM6Ly81NC4xNzIuOTcuNDcvb3BlbmRhcC9kYXRhL25jL2Zub2MxLm5jLmRkcw
Resolving uat.urs.earthdata.nasa.gov... 198.118.243.34, 2001:4d0:241a:4089::91
Connecting to uat.urs.earthdata.nasa.gov|198.118.243.34|:443... connected.
WARNING: certificate common name `uat.earthdata.nasa.gov' doesn't match requested host name `uat.urs.earthdata.nasa.gov'.
HTTP request sent, awaiting response... 401 Unauthorized
Connecting to uat.urs.earthdata.nasa.gov|198.118.243.34|:443... connected.
WARNING: certificate common name `uat.earthdata.nasa.gov' doesn't match requested host name `uat.urs.earthdata.nasa.gov'.
HTTP request sent, awaiting response... 302 Found
Location: https://54.172.97.47/opendap/login?code=a590cfc189783e29a7b8ab3ce1e0357618cbab3f590e7268a26e7ad1f7cf899d&amp;state=aHR0cHM6Ly81NC4xNzIuOTcuNDcvb3BlbmRhcC9kYXRhL25jL2Zub2MxLm5jLmRkcw [following]
--2014-11-14 11:22:20--  https://54.172.97.47/opendap/login?code=a590cfc189783e29a7b8ab3ce1e0357618cbab3f590e7268a26e7ad1f7cf899d&amp;state=aHR0cHM6Ly81NC4xNzIuOTcuNDcvb3BlbmRhcC9kYXRhL25jL2Zub2MxLm5jLmRkcw
Connecting to 54.172.97.47:443... connected.
WARNING: cannot verify 54.172.97.47's certificate, issued by `/C=US/ST=RI/L=Narragansett/O=OPeNDAP Inc./OU=Engineering/CN=54.172.97.47/emailAddress=support@opendap.org':
  Self-signed certificate encountered.
HTTP request sent, awaiting response... 302 Found
Location: https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds [following]
--2014-11-14 11:22:21--  https://54.172.97.47/opendap/data/nc/fnoc1.nc.dds
Connecting to 54.172.97.47:443... connected.
WARNING: cannot verify 54.172.97.47's certificate, issued by `/C=US/ST=RI/L=Narragansett/O=OPeNDAP Inc./OU=Engineering/CN=54.172.97.47/emailAddress=support@opendap.org':
  Self-signed certificate encountered.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/plain]
Saving to: `fnoc1.nc.dds'

    [ &lt;=&gt;                                                                                                                                                                                                            ] 197         --.-K/s   in 0s

2014-11-14 11:22:22 (7.23 MB/s) - `fnoc1.nc.dds' saved [197]

[spooky:olfs/testsuite/urs] ndp% more fnoc1.nc.dds
Dataset {
    Int16 u[time_a = 16][lat = 17][lon = 21];
    Int16 v[time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
} fnoc1.nc;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It appears that <em>wget</em> correctly followed the first redirect to <code>uat.urs.earthdata.nasa.gov</code>, where the URS server responded with a "401 Unauthorized" (thanks to the the app_type=401 query parameter in the redirect URL provided by mod_auth_urs). After getting the 401 <em>wget</em> resubmits the request with the authentication credentials and the URS server accepts them and redirects <em>wget</em> back to the <em>mod_auth_urs</em> server to complete the request.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_4">9.4.2. LDAP</h4>

</div>
<div class="sect3">
<h4 id="_shibboleth_3">9.4.3. Shibboleth</h4>

</div>
</div>
<div class="sect2">
<h3 id="_ncdump">9.5. <em>ncdump</em></h3>
<div class="paragraph">
<p>ncdump utilizes the NetCDF-C library to access DAP resources so ncdump is a litmus test for any command line application that uses the netCDF C library. Because the netCDF C library is the software component that is performing the authentication, the configuration steps outlined here should directly translate to any application that uses netCDF C. Note, however, that these steps were tested against the version of netCDF C retrieved from GitHub on 1 May 2105. That software likely corresponds to netCDF version 4.3.3.1 or later. Contact Unidata for the latest information.</p>
</div>
<div class="sect3">
<h4 id="_earth_data_login_urs">9.5.1. Earth Data Login (URS)</h4>
<div class="paragraph">
<p>The following works with the ncdump (and oc client) code bundled with NetCDF-4.3.3.1 Previous versions including 4.3.2 and 4.3.1 will not work.</p>
</div>
<div class="paragraph">
<p>Edit (create as needed) the file <em>.netrc</em> in your HOME directory, and set its file permissions to read only for owner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[spooky:~] ndp% touch .netrc
[spooky:~] ndp% chmod 600 .netrc
[spooky:~] ndp% ls -l . netrc
-rw-------@ 1 ndp  staff  92 Nov 13 06:08 . netrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add your Earth Data Login credentials to the <em>.netrc</em> file, associating them with the Earth Data Login server that you normally authenticate with, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine urs.earthdata.nasa.gov
    login your_urs_uid
    password you_urs_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, edit the <em>.dodsrc</em> file in your HOME directory so that it tells DAP clients to use the <em>.netrc</em> file for password information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">HTTP.COOKIEJAR=/Users/jimg/.cookies
HTTP.NETRC=/Users/jimg/.netrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a typical <em>.dodsrc</em> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache"># OPeNDAP client configuration file. See the OPeNDAP
# users guide for information.
USE_CACHE=0
# Cache and object size are given in megabytes (20 ==&gt; 20Mb).
MAX_CACHE_SIZE=20
MAX_CACHED_OBJ=5
IGNORE_EXPIRES=0
CACHE_ROOT=/Users/jimg/.dods_cache/
DEFAULT_EXPIRES=1
ALWAYS_VALIDATE=1
# Request servers compress responses if possible?
# 1 (yes) or 0 (false).
DEFLATE=0
# Proxy configuration:
# PROXY_SERVER=&lt;protocol&gt;,&lt;[username:password@]host[:port]&gt;
# NO_PROXY_FOR=&lt;protocol&gt;,&lt;host|domain&gt;
# AIS_DATABASE=&lt;file or="" url=""&gt;

# Earth Data Login and LDAP login information
HTTP.COOKIEJAR=/Users/jimg/.cookies
HTTP.NETRC=/Users/jimg/.netrc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_5">9.5.2. LDAP</h4>
<div class="paragraph">
<p>To configure ncdump (and thus just about every client application that uses netCDF C) for LDAP-back HTTP/S-Basic authentication, follow the same exact procedure as outline above for URS, except that in the <em>.netrc</em> file, use the OpenDAP server&#8217;s machine name or IP number in place of the URS authentication site. Here&#8217;s a summary, with an example:</p>
</div>
<div class="paragraph">
<p>Edit (create as needed) the file <em>.netrc</em> in your HOME directory, and set its file permissions to read only for owner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[spooky:~] ndp% touch .netrc
[spooky:~] ndp% chmod 600 .netrc
[spooky:~] ndp% ls -l . netrc
-rw-------@ 1 ndp  staff  92 Nov 13 06:08 . netrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add your LDAP credentials to the <em>.netrc</em> file, associating them with the DAP server that you want to access, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine opendap.server.using.ldap
    login your_ldap_login_name
    password your_ldap_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, edit the <em>.dodsrc</em> file in your HOME directory so that it tells DAP clients to use the <em>.netrc</em> file for password information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">HTTP.COOKIEJAR=/Users/jimg/.cookies
HTTP.NETRC=/Users/jimg/.netrc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_4">9.5.3. Shibboleth</h4>
<div class="paragraph">
<p>At the time of this writing the <em>ncdump</em> application and the NetCDF library do not support authentication using the Shibboleth ECP profile.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrated_data_viewer_idv">9.6. <em>Integrated Data Viewer (IDV)</em></h3>
<div class="paragraph">
<p>The Integrated Data Viewer is GUI driven data client that is based around the CDM/NetCDF data model and utilizes that NetCDF-Java (and thus the Java DAP implementation) to access remote DAP datasets. Because it has a GUI it can retrieve (and cache for later) users credentials directly from the user.
Since IDV utilizes the Java-NetCDF library to access DAP resources then in theory if it works for IDV then it should work for all the other clients that use the Java-NetCDF library.</p>
</div>
<div class="paragraph">
<p>I <a href="http://www.unidata.ucar.edu/downloads/idv/current/index.jsp">downloaded the latest version of IDV</a> (5.0u2 on 11/19/14) and installed it on my local system.</p>
</div>
<div class="sect3">
<h4 id="_urs_3">9.6.1. URS</h4>
<div class="paragraph">
<p>For URS testing I utilized my AWS test service, configured to require URS authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In IDV I attempted to choose a new dataset by starting with the "Data" menu: Data &gt; Choose Data &gt; From A Web Server</p>
</div>
<div class="paragraph">
<p>In the resulting pane I entered the AWS test service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://54.172.97.47/opendap/data/nc/coads_climatology.nc" class="bare">https://54.172.97.47/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) IDV popped up a dialog box that indicated that the <em>uat.urs.earthdata.nasa.gov</em> server wanted my credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/IDVAuthDialog.png" alt="IDV URS Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them, clicked the save password check box, and clicked the <em>OK</em> button. IDV was then able to access the requested resource. After the first successful access other resources at the AWS server were also available, but without an additional authentication challenge being presented to the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_6">9.6.2. LDAP</h4>
<div class="paragraph">
<p>For testing I utilized an ANU/NCI puppet instance configured to require LDAP authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In IDV I attempted to choose a new dataset by starting with the "Data" menu: Data &gt; Choose Data &gt; From A Web Server</p>
</div>
<div class="paragraph">
<p>In the resulting pane I entered the AWS test service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://130.56.244.153/opendap/data/nc/coads_climatology.nc" class="bare">https://130.56.244.153/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) IDV popped up a dialog box that indicated that the <em>130.56.244.153</em> server wanted my credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/IDV-LDAP.png" alt="IDV LDAP Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them, clicked the save password check box, and clicked the <em>OK</em> button. IDV was then able to access the requested resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_5">9.6.3. Shibboleth</h4>
<div class="paragraph">
<p><em>Summary: Failed To Authenticate</em></p>
</div>
<div class="paragraph">
<p>For Shibboleth testing I utilized an AWS VM, configured to require Shibboleth authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In IDV I attempted to choose a new dataset by starting with the "Data" menu: Data &gt; Choose Data &gt; From A Web Server</p>
</div>
<div class="paragraph">
<p>In the resulting pane I entered the AWS VM service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://54.174.13.127/opendap/data/nc/coads_climatology.nc" class="bare">https://54.174.13.127/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) IDV popped up a dialog box that indicated that there was an error loading the data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/IDV-Shibboleth.png" alt="IDV Shibboleth Authentication Failure Dialog">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_toolsui">9.7. <em>ToolsUI</em></h3>
<div class="paragraph">
<p>The ToolsUI application is a simple is GUI driven data client that is based around the CDM/NetCDF data model and utilizes that NetCDF-Java (and thus the Java DAP implementation) to access remote DAP datasets. Because it has a GUI it can retrieve (and cache for later) users credentials directly from the user.</p>
</div>
<div class="paragraph">
<p>I <a href="ftp://ftp.unidata.ucar.edu/pub/netcdf-java/v4.5/toolsUI-4.5.jar">downloaded the latest version of ToolsUI</a> (4.5 on 11/19/14) and installed it on my local system. I launched ToolsUI using the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">java -Xmx1g -jar toolsUI-4.5.jar</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_urs_4">9.7.1. URS</h4>
<div class="paragraph">
<p><em>Summary: Authentication Successful</em></p>
</div>
<div class="paragraph">
<p>For testing I utilized my AWS test service, configured to require URS authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In ToolsUI selected the <em>Viewer</em> tab, and entered the AWS test service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://54.172.97.47/opendap/data/nc/coads_climatology.nc" class="bare">https://54.172.97.47/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) ToolsUI popped up a dialog box that indicated that the <em>uat.urs.earthdata.nasa.gov</em> server wanted my credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ToolsUIAuthDialog.png" alt="ToolsUI URS Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them and clicked the <em>OK</em> button. ToolsUI was then able to access the requested resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_7">9.7.2. LDAP</h4>
<div class="paragraph">
<p><em>Summary: Authentication Successful</em></p>
</div>
<div class="paragraph">
<p>For testing I utilized an ANU/NCI puppet instance configured to require LDAP authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In ToolsUI selected the <em>Viewer</em> tab, and entered the AWS test service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://130.56.244.153/opendap/data/nc/coads_climatology.nc" class="bare">https://130.56.244.153/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) ToolsUI popped up a dialog box that indicated that the <em>uat.urs.earthdata.nasa.gov</em> server wanted my credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ToolsUI-LDAP.png" alt="ToolsUI LDAP Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them and clicked the <em>OK</em> button. ToolsUI was then able to access the requested resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_6">9.7.3. Shibboleth</h4>
<div class="paragraph">
<p><em>Summary: Failed To Authenticate</em></p>
</div>
<div class="paragraph">
<p>For Shibboleth testing I utilized an AWS VM, configured to require Shibboleth authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>In ToolsUI selected the <em>Viewer</em> tab, and entered the AWS test service URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://54.174.13.127/opendap/data/nc/coads_climatology.nc" class="bare">https://54.174.13.127/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) ToolsUI popped up a dialog box that indicated that there was an error loading the data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ToolsUI-Shibboleth.png" alt="ToolsUI Shibboleth Authentication Failure">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_panoply">9.8. <em>Panoply</em></h3>
<div class="paragraph">
<p>The Panoply application is a sophisticated GUI driven data client that is based around the CDM/NetCDF data model and utilizes that NetCDF-Java (and thus the Java DAP implementation) to access remote DAP datasets. Because it has a GUI it can retrieve (and cache for later) users credentials directly from the user.</p>
</div>
<div class="paragraph">
<p>I <a href="http://www.giss.nasa.gov/tools/panoply/download_mac.html">downloaded the latest version of Panoply</a> (4.0.5 on 11/20/14) and installed it on my local system. I launched Panoply (clicking it&#8217;s icon in my Applications folder)</p>
</div>
<div class="sect3">
<h4 id="_urs_5">9.8.1. URS</h4>
<div class="paragraph">
<p><em>Summary: Authentication Successful</em></p>
</div>
<div class="paragraph">
<p>For testing I utilized my AWS test service, configured to require URS authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>From the <em>File</em> menu, I selected "Open Remote Dataset.." and in the pop dialog I entered the URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://54.172.97.47/opendap/data/nc/coads_climatology.nc" class="bare">https://54.172.97.47/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) Panoply popped up a dialog box that indicated that the <em>uat.urs.earthdata.nasa.gov</em> server wanted my credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/PanoplyAuthDialog.png" alt="Panoply URS Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them, clicked the save password check box, and clicked the <em>OK</em> button. Panoply was then able to access the requested resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_8">9.8.2. LDAP</h4>
<div class="paragraph">
<p><em>Summary: Authentication Successful</em></p>
</div>
<div class="paragraph">
<p>For testing I utilized an ANU/NCI puppet instance configured to require LDAP authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>From the <em>File</em> menu, I selected "Open Remote Dataset.." and in the pop dialog I entered the URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://130.56.244.153/opendap/data/nc/coads_climatology.nc" class="bare">https://130.56.244.153/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) Panoply popped up a dialog box that indicated that the <em>uat.urs.earthdata.nasa.gov</em> server wanted my credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Panoply-LDAP.png" alt="Panoply LDAP Authentication Dialog">
</div>
</div>
<div class="paragraph">
<p>I entered them, clicked the save password check box, and clicked the <em>OK</em> button. Panoply was then able to access the requested resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_7">9.8.3. Shibboleth</h4>
<div class="paragraph">
<p><em>Summary: Failed To Authenticate</em></p>
</div>
<div class="paragraph">
<p>For Shibboleth testing I utilized an AWS VM, configured to require Shibboleth authentication for all access of Hyrax.</p>
</div>
<div class="paragraph">
<p>From the <em>File</em> menu, I selected "Open Remote Dataset.." and in the pop dialog I entered the URL for our friend <em>coads_climatology.nc</em>:</p>
</div>
<div class="paragraph">
<p><a href="https://130.56.244.153/opendap/data/nc/coads_climatology.nc" class="bare">https://130.56.244.153/opendap/data/nc/coads_climatology.nc</a></p>
</div>
<div class="paragraph">
<p>When I committed the edit (aka hit Enter) Panoply popped up a dialog box that indicated that there was an error loading the data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Panoply-Shibboleth.png" alt="Panoply Shibboleth Authentication Failure">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_matlab_ferret_other_applications_that_use_netcdf_c">9.9. Matlab, Ferret, Other applications that use NetCDF C</h3>
<div class="paragraph">
<p>Check the version of the netCDF C library that the application uses; once they have updated to 4.3.3.1 or later, authentication configuration should be the same as the <em>ncdump</em> example above. That is, both URS and LDAP-backed HTTP/S-Basic authentication should work by reading credentials from the <em>.netrc</em> file given that the <em>.dodsrc</em> file is set to point to them.</p>
</div>
<div class="sect3">
<h4 id="_urs_ldap">9.9.1. URS &amp; LDAP</h4>
<div class="paragraph">
<p>Here&#8217;s a short summary of the configuration
Add your URS/LDAP credentials to the <em>.netrc</em> file, associating them with the URS/OpenDAP server that you normally authenticate with, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine urs.earthdata.nasa.gov
login your_earthdata_login_user_name
password your_earthdata_login_password

machine opendap.server.using.ldap
    login your_ldap_login_name
    password your_ldap_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, edit the <em>.dodsrc</em> file in your HOME directory so that it tells DAP clients to use the <em>.netrc</em> file for password information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">HTTP.COOKIEJAR=/Users/jimg/.cookies
HTTP.NETRC=/Users/jimg/.netrc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_8">9.9.2. Shibboleth</h4>
<div class="paragraph">
<p>This is certain to not work until the netCDF C library is modified to explicitly support it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pydap">9.10. PyDAP</h3>
<div class="paragraph">
<p>The PyDAP software (pydap.org) provides one interface for python programs to read from OpenDAP servers (the other is the netCDF4 python module, which uses the netCDF-C library to actually access data, include data from OpenDAP servers). PyDAP includes an extension mechanism so that it can interact with different kinds of authentication systems. This system is very flexible and we were able to use it to add support for both LDAP-backed HTTP/S Basic authentication and ELA/URS. The same scheme could be used to add support for Shibboleth, although it would take additional development work (described in general below).</p>
</div>
<div class="sect3">
<h4 id="_urs_ldap_2">9.10.1. URS &amp; LDAP</h4>
<div class="paragraph">
<p>To use PyDAP with a server the requires either LDAP or ELA/URS authentication, first enter host, username and password credentials in the .netrc file stored in your home account. If it does not yet exist, make a file using a text editor. The format of this file is the following set of three lines repeated for each host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine server.that.accepts.credentials
    login your_login_name
    password your_password</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For LDAP-backed HTTP/S Basic authentication, each host that might prompt for credentials must be listed (and the username and password repeated, even if it is the same for several hosts). For ELA/URS, list only the ELA/URS site and the username and password you use for it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s an example <em>.netrc</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="apache">machine urs.earthdata.nasa.gov
login jhrg
password ****

machine uat.urs.earthdata.nasa.gov
login jhrg
password ****

machine 130.56.244.153
login tesla
password password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <em>.netrc</em> file is configured, start python, run the function install_basic_client() and then access servers. Here&#8217;s a python script that will open a PyDAP virtual connection to an authenticated server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="python"># Set up PyDAP to use the URS request() function

from pydap.util.urs import install_basic_client
install_basic_client()
from pydap.client import open_url
d = open_url('https://52.1.74.222/opendap/data/hdf4/S3096277.HDF')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shibboleth_9">9.10.2. Shibboleth</h4>
<div class="paragraph">
<p>This will require a new patch function, similar to <em>install_basic_client()</em> be written. It will be a bit more complex because of the increased complexity of Shibboleth, but the operation for end-users will likely be the same.
:leveloffset: +1</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hyrax_troubleshooting">10. Hyrax Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hyrax_running_bescmdln_opendap_documentation">10.1. Hyrax - Running bescmdln - OPeNDAP Documentation</h3>
<div class="paragraph">
<p>2020-12-30
:numbered:
:toc:</p>
</div>
<div class="sect3">
<h4 id="_running_bescmdln_basic_commands">10.1.1. Running bescmdln - Basic Commands</h4>
<div class="paragraph">
<p>First we will issue some simple commands to make sure that the client is
talking to the server. First, start the command-line client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">% bescmdln -h localhost -p 10022</pre>
</div>
</div>
<div class="paragraph">
<p>The -h option specifies the machine on which the BES is running. In this
case, it&#8217;s your local machine. The -p option specifies the port the BES
is running on. The default, set in the BES configuration file, is 10022.
If you changed this, or if you started the server with the -p option,
then you need to use that port number here.</p>
</div>
<div class="paragraph">
<p>If you just use these options then you will start using the command line
version of the client. There are other options, but we&#8217;ll start here.
From here you should get a prompt. Let&#8217;s try a simple command (remember
to terminate each command with a semicolon):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BESClient&gt; show status;</pre>
</div>
</div>
<div class="paragraph">
<p>You should get a response showing the status of the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Listener boot time: MDT Thu Jun  9 14:12:22 2005</pre>
</div>
</div>
<div class="paragraph">
<p>Try another one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BESClient &gt; show help;</pre>
</div>
</div>
<div class="paragraph">
<p>This one should show both the BES core commands, DAP commands, and your
help information.</p>
</div>
<div class="paragraph">
<p>If you have installed a data handler, let&#8217;s take a look at your data. By
executing this request you should see the root node of your data
directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BESClient &gt; show catalog;</pre>
</div>
</div>
<div class="paragraph">
<p>If you can&#8217;t see your data, then make sure that the RootDirectory
parameters in the <a href="#bess-configuration">BES Configuration file</a> are correct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BESClient &gt; exit</pre>
</div>
</div>
<div class="paragraph">
<p>This one will exit out of interactive mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_commands_for_hyrax_testing">10.1.2. Commands for Hyrax Testing</h4>
<div class="sect4">
<h5 id="_poke_around_in_the_rootdirectory_to_see_whats_actually_visible_to_the_bes">Poke around in the RootDirectory to see what&#8217;s actually visible to the BES</h5>
<div class="sect5">
<h6 id="_show_the_root_catalog">Show the Root Catalog</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">show catalog;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_will_show_the_contents_of_pathname">&#8230;&#8203;will show the contents of "pathname"</h6>
<div class="paragraph">
<p>For example, show catalog for "/data/nc"; will show all the stuff in the
/data/nc directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">show catalog for "pathname";</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_bes_to_return_a_dap_response_object">Get the BES to return a DAP response object</h5>
<div class="paragraph">
<p>You need three commands to do this:</p>
</div>
<div class="sect5">
<h6 id="_bind_the_dataset_to_a_container_in_a_catalog">Bind the dataset to a container in a catalog</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">set container in catalog values c,/data/nc/feb.nc;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_make_a_definition_so_you_can_access_that_container">Make a definition so you can access that container</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">define d as c;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_request_a_particular_response">Request a particular response</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">get ddx for d;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_command_line_options">10.1.3. Command line options</h4>
<div class="paragraph">
<p>Other command line options available to the bescmdln program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-u specifies the name of a Unix socket for connecting to the server.
-h specifies the name of a host for TCP/IP connection
-p specifies the port where the server is listening for TCP/IP connection.
-x makes the client execute a command and exit. This flag requires the -f flag.
-f sets the target file name for the return stream from the server.
-i sets the target file name for a sequence of input commands.
-t sets the timeout in seconds and is optional.
-d "cerr|&lt;filename&gt;,&lt;context&gt;" sets the client session for debugging and is optional.
-v forces the client to show the version and exit</pre>
</div>
</div>
<div class="paragraph">
<p>Connection Flags: -u or -p -h are required to connect to a server and
specify either a Unix socket or a TCP/IP socket.</p>
</div>
<div class="paragraph">
<p>Input/Output Flags: you can specify that the input is from the command
line with the -x flag or that the input must be read from a file with
the -i flag. If you specify either -x or -i you must specify the name of
a file for the output stream of the server with the -f flag. If neither
the -x nor the -i flags are specified then the client goes into
interactive mode. To exit out of interactive mode just type 'exit'
(without the quotes) at the BESClient&gt; prompt.</p>
</div>
<div class="paragraph">
<p>For debugging information either specify cerr to have debugging
information dump to standard error, or the name of a file. The context
option is a comma separated list of debugging context (component
debugging). Specify all to get debugging from all components.
= How to Debug the BES - OPeNDAP Documentation</p>
</div>
</div>
<div class="sect3">
<h4 id="_tricks">10.1.4. Tricks</h4>
<div class="ulist">
<ul>
<li>
<p>Set the beslistener to run in single, not multiprocess, mode. Do this
in the <em>bes.conf</em> file (use the <em>BES.ProcessManagerMethod</em> parameter).</p>
</li>
<li>
<p>Build the bes using <em>developer</em> mode (so it won&#8217;t need to be root,
among other things). Do this with <em>./configure --enable-developer</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_use_the_besdebug_macro">10.1.5. Use the BESDEBUG Macro</h4>
<div class="paragraph">
<p>Use the macro <em>BESDEBUG</em> defined in <em>BESDebug.h</em>.</p>
</div>
<div class="paragraph">
<p>Set the macro&#8217;s 'context' as "bes" (nominally, or you can make up
whatever you want) and then use the "cerr &lt;&lt; "text: " &lt;&lt; var &lt;&lt; endl"
style output <em>except</em> that you should leave off the initial "cerr &lt;&lt;"
and start with the first argument of the stuff to be output - the marco
will take care of getting the output sink and using the output operator.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#include &lt;BESDebug.h&gt;
...
BESDEBUG( "h4", "File Id:" &lt;&lt; _file_id &lt;&lt; endl);</pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You&#8217;ll need to include the BES_DAP_LIBS when you link an executable
or a libtool library and you&#8217;ll need BES_CPPFLAGS when you compile (for
libdap code)</p>
</li>
<li>
<p>The trailing semicolon is not needed but including it makes
automatic code indent software (eclipse, emacs, &#8230;&#8203;) much happier.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_start_the_bes_with_debuging_on">10.1.6. Start the BES with Debuging on</h4>
<div class="paragraph">
<p>Use the <em>-d</em> option to <em>besctl</em> and give <em>-d</em> one argument, a string,
with two parts: "&lt;output sink&gt;,&lt;context&gt;". For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl start -d "cerr,bes"</pre>
</div>
</div>
<div class="paragraph">
<p>would start up <em>beslistener</em> with the <em>bes</em> debug context active and
write all the debugging info to <em>cerr</em>, which is standard error. You
can provide several contexts. For example, you could say</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl start -d "./bes.dbg,bes,nc"</pre>
</div>
</div>
<div class="paragraph">
<p>This will send debug statements to the file ./bes.dbg for the context
bes and nc (netcdf_handler). You can also specify the context <em>all</em>,
that will send debugging statements for all context.</p>
</div>
<div class="paragraph">
<p>The BES has debug statements for <em>bes</em>, <em>ppt</em> and <em>server</em>. Each of
the modules that you install will also have debug context. And, you can
create your own context when writing your own module. In your Module
class you would register your context, so as to be available with the
help command, by using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    BESDebug::Register( "&lt;context&gt;" ) ;</pre>
</div>
</div>
<div class="paragraph">
<p>Where context is the string that will be used for your module&#8217;s debug
context. For example, nc for the netcdf_handler.</p>
</div>
<div class="paragraph">
<p>To see what debug context is available, when you start the BES using
<em>besctl</em>, use the help option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">besctl help</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BES install directory: /Users/westp/opendap/opendap
BES configuration file: /Users/westp/opendap/opendap/etc/bes/bes.conf
Developer Mode: not testing if BES is run by root
/Users/westp/opendap/opendap/bin/beslistener: -i &lt;INSTALL_DIR&gt; -c &lt;CONFIG&gt; -d &lt;STREAM&gt; -h -p &lt;PORT&gt; -s -u &lt;UNIX_SOCKET&gt; -v

-i back-end server installation directory
-c use back-end server configuration file CONFIG
-d set debugging to cerr or &lt;filename&gt;
-h show this help screen and exit
-p set port to PORT
-s specifies a secure server using SLL authentication
-u set unix socket to UNIX_SOCKET
-v echos version and exit

Debug help:

Set on the command line with -d "file_name|cerr,[-]context1,[-]context2,...,[-]contextn"
  context with dash (-) in front will be turned off

Possible context:
  ascii: off
  bes: off
  dap: off
  ff: off
  h4: off
  h5: off
  nc: off
  ppt: off
  server: off
  usage: off
  www: off

USAGE: besctl (help|start|stop|restart|status) [options]
where [options] are passed to besdaemon; see besdaemon -h</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_send_commands_to_the_bes">10.1.7. Send Commands to the BES</h4>
<div class="paragraph">
<p>Now run some commands using bescmdln. You should see debugging being
output to either cerr, or the file you specified when you started the
BES. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BESClient&gt; set context dap_format to dap2;
BESClient&gt; set container in catalog values c,/data/nc/fnoc1.nc;
BESClient&gt; define d as c;
BESClient&gt; get das for d;
Attributes {
    u {
        String units "meter per second";
        String long_name "Vector wind eastward component";</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bes_client_commands_introduction">10.2. BES Client Commands - Introduction</h3>
<div class="paragraph">
<p>These are the commands that the BES supports. Documented here are the
XML versions of the commands that are typed into the <em>bescmdln</em> client.
All of these have a non-XML version as well that might be easier to type
as the command line. However, if you&#8217;re making command files, these are
often the easiest to use because the SQL-like syntax of the 'text'
commands can be confusing.</p>
</div>
<div class="paragraph">
<p>If you want to find documentation on the XML document that the BES
expects to receive, look at the <a href="#BES_XML">BES XML Commands</a>
documentation. There you&#8217;ll see that the commands listed
here are generally sent as given to the <em>bescmdln</em> client but embedded
in other XML that provides the BES with information such as a request ID
and other bookkeeping information.</p>
</div>
<div class="sect3">
<h4 id="_current_core_commands_available_with_bes">10.2.1. Current Core Commands Available With BES</h4>
<div class="paragraph">
<p>NB: The BES supports both XML and a SQL-like syntax. Here we attempt to
document both.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;showHelp /&gt; or <em>show help;</em></p>
</li>
<li>
<p>shows this help</p>
</li>
<li>
<p>&lt;showVersion /&gt; or <em>show version;</em></p>
</li>
<li>
<p>shows the version of OPeNDAP and each data type served by this server</p>
</li>
<li>
<p>&lt;showProcess /&gt; or <em>show process;</em></p>
</li>
<li>
<p>shows the process number of this application. This command is only
available in developer mode.</p>
</li>
<li>
<p>&lt;showConfig /&gt; or <em>show config;</em></p>
</li>
<li>
<p>shows all key/value pairs defined in the bes configuration file. This
command is only available in developer mode.</p>
</li>
<li>
<p>&lt;showStatus /&gt; or <em>show status;</em></p>
</li>
<li>
<p>shows the status of the server</p>
</li>
<li>
<p>&lt;showContainers /&gt; or <em>show containers;</em></p>
</li>
<li>
<p>shows all containers currently defined</p>
</li>
<li>
<p>&lt;showDefinitions /&gt; or <em>show definitions;</em></p>
</li>
<li>
<p>shows all definitions currently defined</p>
</li>
<li>
<p>&lt;showContext /&gt; or <em>show context;</em></p>
</li>
<li>
<p>shows all context name/value pairs set in the BES</p>
</li>
<li>
<p>&lt;setContainer name="container_name" space="store_name"
type="data_type"&gt;real_name&lt;/setContainer&gt; or <em>set container in catalog
values <strong>c</strong>,<strong>/data/nc/fnoc1.nc</strong>;</em></p>
</li>
<li>
<p>defines a symbolic name representing a data container, usually a file,
to be used by definitions, described below</p>
</li>
<li>
<p>the space property is the name of the container storage and is
optional. Defaults to default volatile storage. Examples might include
database storage, volatile storage based on catalog information.</p>
</li>
<li>
<p>real_name is the full qualified location of the data container, for
example the full path to a data file.</p>
</li>
<li>
<p>data_type is the type of data that is in the dataset. For netcdf files
it is nc. For some container storage the data type is optional,
determined by the container storage.</p>
</li>
<li>
<p>&lt;setContext name="context_name"&gt;context_value&lt;/setContext&gt;</p>
</li>
<li>
<p>set the given context with the given value. No default context are
used in the BES</p>
</li>
<li>
<p>&lt;define &#8230;&#8203;&gt;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;define name="definition_name" space="store_name"&gt;
     &lt;container name="container_name"&gt;
         &lt;constraint&gt;legal_constraint&lt;/constraint&gt;
         &lt;attributes&gt;attribute_list&lt;/attributes&gt;
     &lt;/container&gt;
     &lt;aggregate handler="someHandler" cmd="someCommand" /&gt;
 &lt;/define&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>creates a definition using one or more containers, constraints for
each of the containers, attributes to be retrieved from each container,
and an aggregation. Constraints, attributes, and aggregation are all
optional.</p>
</li>
<li>
<p>There can be more than one container element</p>
</li>
<li>
<p>space is the name of the definition storage. Defaults to volatile
storage. Examples might include database storage.</p>
</li>
<li>
<p>&lt;deleteContainer name="container_name" space="store_name" /&gt;</p>
</li>
<li>
<p>deletes the specified container from the specified container storage
(defaults to volatile storage).</p>
</li>
<li>
<p>&lt;deleteContainers space="store_name" /&gt;</p>
</li>
<li>
<p>deletes all of the currently defined containers from the specified
container storage (defaults to volatile storage).</p>
</li>
<li>
<p>&lt;deleteDefinition name="definition_name" space="store_name" /&gt;</p>
</li>
<li>
<p>deletes the specified definition from the specified container storage
(defaults to volatile storage).</p>
</li>
<li>
<p>&lt;deleteDefinitions space="store_name" /&gt;</p>
</li>
<li>
<p>deletes all of the currently defined definitions from the specified
container storage (defaults to volatile storage).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_added_commands_for_dap_enabled_servers">10.2.2. Added commands for dap enabled servers</h4>
<div class="paragraph">
<p>If you are serving up OPeNDAP data responses (DAS, DDS, DataDDS) then
you will have loaded the dap commands in your configuration file. Here
are the available commands in the dap module.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;showCatalog node="node_name" /&gt; or <em>show catalog;</em> or <em>show catalog
for <a href="#node_name">[node_name]</a>;</em></p>
</li>
<li>
<p>Shows catalog information, including contents if a container. If node
is not specified then the root node information is returned. If node is
specified then that nodes information is returned.</p>
</li>
<li>
<p>&lt;showInfo node="node_name" /&gt;</p>
</li>
<li>
<p>Shows catalog information for just that node, the root node if no node
is specified. If the node is a container the contents are not displayed.</p>
</li>
<li>
<p>&lt;get type="das | dds | dods | ddx | dataddx | ascii"
definition="def_name" returnAs="returnAs" /&gt;</p>
</li>
<li>
<p>dds: request the data descriptor structure. Returned as text.</p>
</li>
<li>
<p>das: request the data attributes. Returned as text.</p>
</li>
<li>
<p>dods: request for the data stream, this output is an octet binary
stream made up of two parts and similar to a multipart MIME document
(but not a real MPM doc). The first part is the DDS that describes the
contents of this response; the separator is the text <em>Data:</em>; and the
data make up the third part. The data are represented using XDR-encoded
binary values. There is a a one-to-one mapping between variables, name
and types in the first part and the binary values in the second part. A
library such as libdap can easily decode this response.</p>
</li>
<li>
<p>ddx: request the data attributes and data descriptor structure
returned as an xml document</p>
</li>
<li>
<p>dataddx: This is the 'DAP4' counterpart to the <em>dods</em> response, just
as the <em>ddx</em> is the DAP4 counterpart to the <em>das</em> and <em>dds</em> responses
from DAP2. The dataddx response is a true multipart MIME document with
the first part a text/xml section that holds the ddx that describes the
data in the response and the second part an application/octet-stream
section that holds the matching XDR-encoded values.</p>
</li>
<li>
<p>ascii: request the data stream (i.e., dods) and then pass that through
a formatter to generate an ASCII representation of the data and return
it in a text/plain MIME document.</p>
</li>
<li>
<p>&lt;setContext name="errors"&gt;dap2 | xml | html | txt&lt;/setContext&gt;</p>
</li>
<li>
<p>set the context 'errors' to dap2 in order to have all exceptions and
errors formatted as dap2 error messages in the response.</p>
</li>
<li>
<p>&lt;setContext name="dap_format"&gt;dap2&lt;/setContext&gt;</p>
</li>
<li>
<p>set the context 'dap_format' to dap2 in order to suppress the addition
of an additional structure to the DDS/DDX whose elements are the
containers named in the setContainer element.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_bescmdln_client_to_test_the_bes">10.2.3. Using the <em>bescmdln</em> client to test the BES</h4>
<div class="paragraph">
<p>Here are some tricks/command sequences that are useful when you need to
test the BES without using a web browser. This section assumes that the
DAP commands have been loaded into the BES. In this section, the
examples use the older syntax because it&#8217;s a bit more amenable to a
command line environment. With the XML syntax, multiple commands cab be
grouped together and sent to the BES in one shot.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Find the versions of all the installed and running modules</dt>
<dd>
<p><em>show version;</em></p>
</dd>
<dt class="hdlist1">Show the status os the BES</dt>
<dd>
<p>  <em>show status;</em>
Poke around in the RootDirectory to see what&#8217;s actually visible to the</p>
</dd>
<dt class="hdlist1">BES</dt>
<dd>
<p><em>show catalog;</em> will show you the root catalog; <em>show catalog for
<strong>"pathname"</strong>;</em> will show the contents of <strong>"pathname"</strong> (e.g., <em>show
catalog for "/data/nc";</em> will show all the stuff in the /data/nc
directory).</p>
</dd>
<dt class="hdlist1">Get the BES to return a DAP response object</dt>
<dd>
<p>You need three commands to do this:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">bind the dataset to a container in a catalog</dt>
<dd>
<p><em>set container in catalog values <strong>c</strong>,<strong>/data/nc/feb.nc</strong>;</em></p>
</dd>
<dt class="hdlist1">make a definition so you can access that container</dt>
<dd>
<p><em>define <strong>d</strong> as <strong>c</strong>;</em></p>
</dd>
<dt class="hdlist1">a definition with a constraint</dt>
<dd>
<p><em>define <strong>d</strong> as <strong>c</strong> with <strong>c.constraint="lat"</strong>;</em></p>
</dd>
<dt class="hdlist1">request a particular response</dt>
<dd>
<p><em>get <strong>ddx</strong> for <strong>d</strong>;</em></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>**Note that there is a <em>set container</em> command but that does not use the
default catalog while the command here explicitly binds the dataset to a
container in the default catalog (which is called <em>catalog</em>). This
pathname is rooted in the directory set using the
<em>BES.Catalog.catalog.RootDirectory</em> configuration parameter in the
<em>bes.conf</em> file. The 'plain' <em>set container &#8230;&#8203;</em> command uses pathnames
rooted in the directory name by the <em>BES.Data.RootDirectory</em> parameter,
which is often null for Hyrax installations.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hyrax_appendix">11. Hyrax Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="WMS_Service">Appendix A: Hyrax WMS Service</h3>
<div class="paragraph">
<p>Using the Dynamic Services feature in the
<a href="http://www.resc.rdg.ac.uk/trac/ncWMS/">ncWMS2 WMS Server</a> from
<a href="http://www.resc.reading.ac.uk/">Reading e-Science Centre</a>, Hyrax can
provide WMS services for all of it&#8217;s appropriate holdings.</p>
</div>
<div class="sect3">
<h4 id="_theory_of_operation_3">11.A.1. Theory of Operation</h4>
<div class="paragraph">
<p>In an instance of the ncWMS2 WMS server, a Dynamic Service is configured
that points to a Hyrax server. This allows the ncWMS2 instance to access
all of the holdings of the DAP server. However, the ncWMS2 does not
"crawl" or "discover" or in any other way catalog or inventory the DAP
server. Instead, the user configures the Hyrax server to add the WMS
service to its catalogs and services content. Hyrax then directs WMS
traffic to the ncWMS2 instance. The ncWMS2 in turn retrieves the data
directly from Hyrax and services the request.</p>
</div>
<div class="paragraph">
<p>The ncWMS2 instance may be hosted anywhere, however for a significant
performance improvement we suggest you host your own ncWMS2 running in
the same Tomcat instance as Hyrax&#8217;s OLFS. With such a configuration, the
WMS response performance for datasets, backed by the DAP service, is
nearly as fast as the ncWMS2 response performance using direct file
access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_evaluating_candidate_datasets">11.A.2. Evaluating Candidate Datasets</h4>
<div class="paragraph">
<p>In order for ncWMS2 to recognize your dataset as valid for service, your
data must meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contain gridded data (as DAP Grid objects or DAP Array objects
utilizing shared dimensional coordinate arrays)
<strong><a href="http://www.unidata.ucar.edu/software/thredds/v4.3/netcdf-java/tutorial/GridDatatype.html">as
described by the Unidata Common Data Model</a></strong>.</p>
</li>
<li>
<p>The NetCDF-Java library (which is what provides data access services
for ncWMS2) utilizes the Common Data Model and must be able to identify
the coordinates system used. You can test this by using the
<strong><a href="http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/documentation.htm">Unidata
ToolsUI application</a></strong> (which is also based on the NetCDF-Java library).
Open your dataset with <strong>ToolsUI</strong>, and in the <strong>Feature Types &#8594; Grid
Panel</strong> there should be one or more variables shown with some kind of
coordinate system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/ToolsUI-GridView.png" alt="ToolsUI GridView"></span></p>
</div>
<div class="paragraph">
<p>ToolsUI Grid View</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ToolsUI supports opening both local files and remote (http accessible) datasets.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wms_installation_suggested">11.A.3. WMS Installation (suggested)</h4>
<div class="paragraph">
<p>The ncWMS2 web application is easy to install.</p>
</div>
<div class="paragraph">
<p>Simply&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve the latest stable release from
<a href="https://github.com/Reading-eScience-Centre/edal-java/releases" class="bare">https://github.com/Reading-eScience-Centre/edal-java/releases</a></p>
</li>
<li>
<p>Copy the WAR files <em>ncWMS2.war</em> and <em>opendap.war</em> into the
<em>$CATALINA_HOME/webapps</em> directory</p>
</li>
<li>
<p>Restart Tomcat</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_hyrax_installation">11.A.4. Hyrax Installation</h4>
<div class="paragraph">
<p>As of the release of Hyrax 1.11 (and in particular OLFS 1.13.0) the
support for WMS is built into the server. All that is required is a
(collocated) ncWMS2 instance and then the configuration steps as
detailed below. So - get the latest Hyrax (1.11.0 or later) install and
configure using the normal methods and then follow the configuration
steps detailed below.</p>
</div>
<div class="sect4">
<h5 id="_co_configuration">Co-Configuration</h5>
<div class="paragraph">
<p>The following sub sections assume that you have installed both Hyrax and
the ncWMS2 on your server in a single Tomcat instance running on port
8080. If your arrangement is different, you will need to adjust
accordingly.</p>
</div>
<div class="paragraph">
<p>For the following example sections we will use the following URLs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your Tomcat server: <a href="http://servername.org:8080/" class="bare">http://servername.org:8080/</a></p>
</li>
<li>
<p>Top level of DAP server: <a href="http://servername.org:8080/opendap" class="bare">http://servername.org:8080/opendap</a></p>
</li>
<li>
<p>Top Level of ncWMS2: <a href="http://servername.org:8080/ncWMS2" class="bare">http://servername.org:8080/ncWMS2</a></p>
</li>
<li>
<p>WMS Service: <a href="http://servername.org:8080/ncWMS2/wms" class="bare">http://servername.org:8080/ncWMS2/wms</a></p>
</li>
<li>
<p>Godiva: <a href="http://servername.org:8080/ncWMS2/Godiva3.html" class="bare">http://servername.org:8080/ncWMS2/Godiva3.html</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ncwms2_configuration">ncWMS2 configuration</h5>
<div class="sect5">
<h6 id="_authenticate_as_the_administrator">Authenticate as the Administrator</h6>
<div class="paragraph">
<p>In order to access the ncWMS2 administration page (which you must do in
oder to configure the server), you will need to configure authentication
and access control for the page, or you will need to temporarily disable
access control for the page in order to configure the server. (We strongly
recommend the former).</p>
</div>
<div class="paragraph">
<p>The default security configuration for ncWMS2 can be located (after
initial launch) in the file&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><code>$CATALINA_HOME/webapps/ncWMS2/WEB-INF/web.xml</code></p>
</div>
<div class="paragraph">
<p>This configuration stipulates that access to the <em>ncWMS2/admin</em> pages
must be over a secure transport and that there will be no access without
authentication  in the <strong><code>manager</code></strong> role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;!-- Define a Security Constraint on the Admin command and user interfaces --&gt;
&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;admin&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
 
    &lt;auth-constraint&gt;
        &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
 
    &lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Your choices</div>
<ol class="arabic">
<li>
<p><strong>Use Apache httpd to provide authentication services for your
installation.</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Comment out the <code>security-constraint</code> in the <code>web.xml</code> file for
ncWMS2.</p>
</li>
<li>
<p>Correctly integrate Tomcat and Apache using the AJP connector.</p>
</li>
<li>
<p>Configure an Apache httpd <code>&lt;Location&gt;</code> directive for the
<code>ncWMS2/admin</code> page.</p>
</li>
<li>
<p>Write the directive to restrict access to specific users.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Use Tomcat authentication.</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Leave the <code>security-constraint</code> in place.</p>
</li>
<li>
<p>Correctly configure Tomcat to use some type authentication (e.g.,
MemoryRealm).</p>
</li>
<li>
<p>Modify the <code>security-constraint</code> to reflect your authentication
configuration. (Different role? HTTPS? etc.)</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Temporarily Disable the <code>security-constraint</code>.</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Comment out the <code>security-constraint</code> in the <code>web.xml</code> file for
ncWMS2.</p>
</li>
<li>
<p>Finish the configuration steps below.</p>
</li>
<li>
<p>At the end, when it&#8217;s working, go back and un-comment the
<code>security-constraint</code> in the web.xml file for ncWMS2.</p>
</li>
<li>
<p>Restart Tomcat.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now that you can get to it, go to the ncWMS2 administration page:
<a href="http://servername.org:8080/ncWMS2/admin/" class="bare">http://servername.org:8080/ncWMS2/admin/</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any changes you make to the <code>web.xml</code> are volatile!
Installing/Upgrading/Reinstalling the web archive (.war) file will
overwrite <code>web.xml</code> file. Make a back-up copy of the <code>web.xml</code> in a
different, more durable location.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_configure_a_dynamic_service">Configure a Dynamic Service</h6>
<div class="paragraph">
<p>Once you have authenticated and can view the ncWMS2 admin page, scroll
down to the Dynamic Services section:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Screen_Shot_2014-08-11_at_12.34.19_PM.png" alt="Screen Shot 2014 08 11 at 12.34.19 PM"></span></p>
</div>
<div class="paragraph">
<p>Create a new Dynamic Service for Hyrax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose and enter a unique ID. (Using 'lds' will save you the trouble
of having to edit the olfs configuration viewers.xml file to adjust that
value.) Write down the string/name you use because you&#8217;ll need it later.</p>
</li>
<li>
<p>The value of the <em>Service URL</em> field will be the URL for the top level
of the Hyrax server.</p>
<div class="ulist">
<ul>
<li>
<p>If the Hyrax server and the ncWMS2 server are running together in a
single Tomcat instance then this URL <strong>should</strong> be expressed as:
<a href="http://localhost:8080/opendap" class="bare">http://localhost:8080/opendap</a></p>
</li>
<li>
<p>If the Hyrax server and the ncWMS2 server are running on separate
systems this URL <strong>must</strong> be a DAP server top level URL, and not a
localhost URL.</p>
</li>
<li>
<p><strong>Best WMS response performance will be achieved by running ncWMS2 and
Hyrax on the same server and providing the <em>localhost</em> URL here.</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>The Dataset Match Regex should be a regex that matches of all of the
data files you have for which WMS can prove services. If that&#8217;s too
cumbersome then just use '.*' (as in the example) which matches
everything.</p>
</li>
<li>
<p>Scroll to the bottom of the page and save the configuration.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Creating a Dynamic Services Entry for Hyrax in the ncWMS2 Admin Page</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Unique ID</th>
<th class="tableblock halign-left valign-top">Service URL</th>
<th class="tableblock halign-left valign-top">Dataset Match Regex</th>
<th class="tableblock halign-left valign-top">Disabled?</th>
<th class="tableblock halign-left valign-top">Remove</th>
<th class="tableblock halign-left valign-top">Data
Reading Class</th>
<th class="tableblock halign-left valign-top">Link to more info</th>
<th class="tableblock halign-left valign-top">Copyright Statement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/opendap" class="bare">http://localhost:8080/opendap</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_hyrax_configuration">Hyrax Configuration</h5>
<div class="paragraph">
<p>The Hyrax WMS configuration is contained in the file
<code>$OLFS_CONFIG_DIR/viewers.xml</code>. This file identifies data viewers and
Web Services that Hyrax can provide for datasets. There are two relevant
sections, the first defines Hyrax&#8217;s view of the WMS service and the
second enables Hyrax to provide access to the Godiva service that is
part of ncWMS.</p>
</div>
<div class="paragraph">
<p>Edit the file <code>$OLFS_CONFIG_DIR/viewers.xml</code></p>
</div>
<div class="paragraph">
<p>Uncomment the following sections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;!--
    &lt;WebServiceHandler className="opendap.viewers.NcWmsService" serviceId="ncWms" &gt;
        &lt;applicationName&gt;Web Mapping Service&lt;/applicationName&gt;
        &lt;NcWmsService href="/ncWMS2/wms" base="/ncWMS2/wms" ncWmsDynamicServiceId="lds" /&gt;
    &lt;/WebServiceHandler&gt;
 
    &lt;WebServiceHandler className="opendap.viewers.GodivaWebService" serviceId="godiva" &gt;
        &lt;applicationName&gt;Godiva WMS GUI&lt;/applicationName&gt;
        &lt;NcWmsService href="http://YourServersNameHere:8080/ncWMS2/wms" base="/ncWMS2/wms" ncWmsDynamicServiceId="lds"/&gt;
        &lt;Godiva href="/ncWMS2/Godiva3.html" base="/ncWMS2/Godiva3.html"/&gt;
    &lt;/WebServiceHandler&gt;
--&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ncwmsservce">NcWmsServce</h5>
<div class="paragraph">
<p>In the first section&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;WebServiceHandler className="opendap.viewers.NcWmsService" serviceId="ncWms" &gt;
    &lt;applicationName&gt;Web Mapping Service&lt;/applicationName&gt;
    &lt;NcWmsService href="/ncWMS2/wms" base="/ncWMS2/wms" ncWmsDynamicServiceId="lds" /&gt;
&lt;/WebServiceHandler&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit the <em>NcWmsService</em> element so that&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The value of the <em>ncWmsDynamicServiceId</em> matches the <em>Unique ID</em> of
the Dynamic Service you defined in ncWMS.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>href</em> and <em>base</em> attributes both use relative URL paths to
locate the ncWMS service. If the ncWMS instance is NOT running on the
same host as Hyrax, the values of the <em>href</em> and <em>base</em> attributes
must be converted to fully qualified URLs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_godivawebservice">GodivaWebService</h5>
<div class="paragraph">
<p>In the second section&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;WebServiceHandler className="opendap.viewers.GodivaWebService" serviceId="godiva" &gt;
    &lt;applicationName&gt;Godiva WMS GUI&lt;/applicationName&gt;
    &lt;NcWmsService href="http://yourNcWMSserver:8080/ncWMS2/wms" base="/ncWMS2/wms" ncWmsDynamicServiceId="lds"/&gt;
    &lt;Godiva href="/ncWMS2/Godiva3.html" base="/ncWMS2/Godiva3.html"/&gt;
&lt;/WebServiceHandler&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit the <em>NcWmsService</em> element so that&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The value of the <em>href</em> attribute is the fully qualified URL for
public access to your WMS service. The server name in this <em>href</em> should
not be <em>localhost</em> - Godiva won&#8217;t work for users on other computers if
you use <em>localhost</em> for the host name.</p>
</li>
<li>
<p>The value of the <em>ncWmsDynamicServiceId</em> matches the <em>Unique ID</em> of
the Dynamic Service you defined in ncWMS2.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Godiva</em> element&#8217;s <em>href</em> and <em>base</em> attributes both use relative
URL paths to locate the Godiva service. If the ncWMS2 instance is NOT
running on the same host as Hyrax then the values of the <em>href</em> and
<em>base</em> attributes must be converted to fully qualified URLs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_apache_configuration">Apache Configuration</h5>
<div class="paragraph">
<p>If you are running Hyrax with Apache linked to Tomcat (a fairly simple
configuration described here), then add the following to the
<em>httpd.conf</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># This is needed to configure ncWMS2 so that it will work when
# users access Hyrax using Apache (port 80). Because Godiva was
# configured in the olfs viewers.xml using &lt;hostname&gt;:8080, the
# Godiva WMS service works when Hyrax is accesed over port 8080
# too.
ProxyPass /ncWMS2 ajp://localhost:8009/ncWMS2</pre>
</div>
</div>
<div class="paragraph">
<p>This will form the linkage needed to access the Godiva interface when
people access your server using Apache. Note that by using port <em>8080</em>
in <em>yourNcWMSserver:8080</em> for the value of the <em>WebServiceHandler</em>
element, people will be able to access Godiva when talking to Hyrax
directly via Tomcat. This configuration covers both access options.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start_and_test">11.A.5. Start and Test</h4>
<div class="ulist">
<ul>
<li>
<p>Once the configuration steps are complete, restart your Tomcat server.</p>
</li>
<li>
<p>Point your browser at the Hyrax sever and navigate to a WMS-suitable
dataset.</p>
</li>
<li>
<p>Clicking the dataset&#8217;s <strong>Viewers</strong> link should return a page with both
WMS and Godiva links.</p>
</li>
<li>
<p>Try 'em.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_issues">11.A.6. Issues</h4>
<div class="sect4">
<h5 id="_known_logging_issue">Known Logging Issue</h5>
<div class="ulist">
<ul>
<li>
<p><em>Applies to ncWMS version 1.x</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a small issue with deploying this configuration onto some Linux
system in which everything has been installed from RPM (except maybe
Tomcat and it&#8217;s components including the ncWMS and Hyrax applications)</p>
</div>
<div class="sect5">
<h6 id="_the_symptom">The Symptom</h6>
<div class="paragraph">
<p>The issue appears in the Tomcat log as a failure to lock files
associated with the java.util.prefs.FileSystemPreferences:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Dec 12, 2014 1:17:28 PM java.util.prefs.FileSystemPreferences checkLockFile0ErrorCode
WARNING: Could not lock System prefs. Unix error code 32612.
Dec 12, 2014 1:17:28 PM java.util.prefs.FileSystemPreferences syncWorld
WARNING: Couldn't flush system prefs: java.util.prefs.BackingStoreException: Couldn't get file lock.
Dec 12, 2014 1:17:58 PM java.util.prefs.FileSystemPreferences checkLockFile0ErrorCode
WARNING: Could not lock System prefs. Unix error code 32612.
Dec 12, 2014 1:17:58 PM java.util.prefs.FileSystemPreferences syncWorld
WARNING: Couldn't flush system prefs: java.util.prefs.BackingStoreException: Couldn't get file lock.</pre>
</div>
</div>
<div class="paragraph">
<p>And is logged every 30 seconds or so. So the problem is the logs fill up
with this issue and not stuff we care about. The problem is that the
files/directories in question either don&#8217;t exist, or, if they do exist
the Tomcat user does not have read/write permissions on them.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_fix">The Fix</h6>
<div class="paragraph">
<p>We looked around and discovered that a number of people (including TDS
deployers) had experienced this issue. It&#8217;s a Linux problem and involves
the existence and permissions of a global system preferences directory.
We think this is only an issue on Linux systems in which everything is
installed via yum/rpm, which may be why we only see this problem on
certain systems, but we&#8217;re not 100% confident that the issue is limited only
to this type of installation.</p>
</div>
<div class="paragraph">
<p>We found and tested these two ways to solve it:</p>
</div>
<div class="paragraph">
<p>1) Create the global System Preference directory and set the owner to
the Tomcat user:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">   sudo mkdir -P /etc/.java/.systemPrefs
   sudo chown -R tomcat-user /etc/.java/.systemPrefs</pre>
</div>
</div>
<div class="paragraph">
<p>This could also be accomplished by changing the group ownership to the
tomcat-group and setting the group read/write flags.</p>
</div>
<div class="paragraph">
<p>2) Create a java System Preference directory for the "tomcat-user"
(adjust name that for your circumstance) and then set the JAVA_OPTS
environment variable so that the systemRoot value is set the new
directory.</p>
</div>
<div class="paragraph">
<p>Create the directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">   mkdir -P /home/tomcat-user/.java/.systemPrefs
   sudo chown -R tomcat-user /home/tomcat-user/.java/.systemPrefs</pre>
</div>
</div>
<div class="paragraph">
<p>Then, in each shell that launches Tomcat&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">   export JAVA_OPTS="-Djava.util.prefs.systemRoot=/home/tomcat-user/.java"
   $CATALINA_HOME/bin/startup.sh</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="WCS_Service">Appendix B: Hyrax WCS Service</h3>
<div class="paragraph">
<p>Hyrax includes an optional WCS-2 service (specifically version 2.0.1)
that can be used to access all of the geo-referenced data available to
the server that meet the requirements of the WCS 2 specification. This
appendix describes the the kinds of data that meet these requirements
along with the configuration process of the bundled WCS service.</p>
</div>
<div class="sect3">
<h4 id="_theory_of_operation_4">11.B.1. Theory of Operation</h4>
<div class="paragraph">
<p>The WCS utilizes a DAP server (e.g., Hyrax) to supply both coverage
metadata and binary data in response to WCS client requests. In this
operational model, each DAP dataset is considered a (potential) WCS
coverage and the variables within a dataset are (potential) WCS
coverage Field entities.</p>
</div>
<div class="paragraph">
<p>The WCS service attempts to dynamically map DAP datasets to WCS
coverages so that the data provider need not learn all of the details
of the WCS specifications. All the data provider will need to provide
is a simple template for each set of related datasets and coverages.
The amount of detail required in a template is a function of the
metadata available within a specific datatset. The template, called a
<em>DynamicService</em> definition, must provide the domain coordinate
details (Latitdue, Longitude, etc.) for a group of coverages and,
depending on available metadata, may also need to provide the
field/variable definitions. The template uses a regular expression to
create the association between the <em>DynamicService</em> definition and
files in the DAP server.</p>
</div>
<div class="sect4">
<h5 id="_wcs_definitions">WCS Definitions</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Hack definitions. Look at the <strong>OGC abstract documents</strong> for a
more comprehensive set of definitions.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Coverage:</strong> A mapping between a <em>domain</em> and a <em>range</em>. This might
sound familiar if you remember your first algebra class, because it is
the definition of a function. A <em>coverage</em> is a special case, because
the <em>domain</em> is often limited to a specific geographic area defined by
a range of latitude and longitude values.</p>
</li>
<li>
<p><strong>Domain Coordinate:</strong> In a <em>coverage</em>, a variable that provides the
values for the coverage&#8217;s domain. For example, the variable that
provides the latitude values.</p>
</li>
<li>
<p><strong>Spatial Reference System (SRS):</strong> The SRS&#8217;s axes define the <em>domain</em> of
the coverage, which are typically latitude and longitude. The SRS also
provides geo-referencing information that enables analysis tools to
account for irregularities in the Earth&#8217;s geoid.
<em>Coordinate Reference System (CRS)</em> is synonymous with this term.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wcs_versions_supported">11.B.2. WCS Versions Supported</h4>
<div class="paragraph">
<p>The Open Geospatial Consortium
(<a href="http://www.opengeospatial.org/">OGC</a>) has developed the Web
Coverage Service (WCS) as an open specification, and there is a suite
of standards documents that describe different aspects of the service.
Hyrax supports several of these standards beyond the basic WCS 2.0
core specification.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>Open Geospatial Consortium</em> has many documents that describe
the concept of a <em>coverage</em> and the different features of WCS. The
<a href="http://www.opengeospatial.org/standards/wcs">suite of
specifications that describe WCS</a> can be found on their website.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The WCS service bundled with Hyrax 1.14 supports the following WCS
specifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WCS Core Interface Core, version 2.0.1</p>
</li>
<li>
<p>Coverage Implementation Schema (CIS), version 1.0.1</p>
</li>
<li>
<p>Range Subsetting, version 1.0.0</p>
</li>
<li>
<p>KVP Protocol Binding, version 1.0.1</p>
</li>
<li>
<p>GeoTIFF Coverage Encoding Profile, version 1.0.1</p>
</li>
<li>
<p>JPEG2000 Coverage Encoding Profile, version 1.0.0</p>
</li>
<li>
<p>CF-netCDF 3.0 encoding using GML Coverage Application Schema,
version 2.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have partial implementations for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML/POST protocol Binding Extension, version 1.0.0</p>
</li>
<li>
<p>XML/SOAP Protocol Binding Extension, version 1.0.0</p>
</li>
<li>
<p>Scaling Extension, version 1.0.0</p>
</li>
<li>
<p>CRS Extension, version 1.0.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are interested in the <em>Earth Observation Application Profile</em>,
version 1.0.0, <a href="#contact-us">contact us</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_candidate_datasets">11.B.3. Candidate Datasets</h4>
<div class="paragraph">
<p>In order for the WCS service to work with a dataset served using DAP,
that dataset must contain one or more <em>coverages</em>. The dataset
variables must meet the WCS requirements for both structure and
metadata. To qualify as a <em>coverage</em>, a variable in a dataset must meet
the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The variable must have an associated <em>Spatial Reference System</em>
(SRS) that describes the organization of latitude and longitude for
the variable.</p>
</li>
<li>
<p>The variable must be a numeric array of at least two dimentsions.</p>
</li>
<li>
<p>The variable&#8217;s right-most dimensions must be axes defined by the SRS
(i.e., longitude and latitude), and they must match the SRS&#8217;s axis'
order.</p>
</li>
<li>
<p>Other dimensions of the variable must be 'to the left' of the
dimensions defined by the SRS.</p>
</li>
<li>
<p>The <em>range</em> of the coverage comprises the values of the
variable. These values must have an associated <em>unit of measure</em>.</p>
</li>
<li>
<p><em>Describe how variable shape affects whether a variable can be a
coverage. Or say whatever is correct.</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In practice, Hyrax is often used with data that have global
extent, which corresponds to the SRS <em>WGS84</em> (aka <em>EPSG 4326</em>), and the
current version of the WCS service only supports this SRS.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We&#8217;re interested in adding support for WCS 2.1, but we&#8217;d like to
gague the interest of potential users before we commit any development
resources. The standard metadata for WCS 2.0 is limited to
representing two-dimensional data, so variables in a dataset with
three or more dimensions cannot be completely described by the
<em>CoverageDescription</em> response. WCS 2.1, on the other hand,
can represent domains with more than two dimensions.
Please contact us if you are interested by sending a note to
<a href="mailto:support@opendap.org">support@opendap.org</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="WCS_installation_guide">11.B.4. WCS Installation</h4>
<div class="paragraph">
<p>The WCS 2 service comes bundled as part of Hyrax-1.14.0 and newer.
See the
<a href="#Download_and_Install_Hyrax">Hyrax download and installation guide</a>
included earlier in this document to get Hyrax installed and running,
and then return to this guide for WCS configuration information.</p>
</div>
<div class="paragraph">
<p>Assuming that you have Hyrax installed and running on your local system,
you should be able to quickly verify the WCS service is available by
pointing your browser at the default WCS endpoint:
<a href="http://localhost:8080/opendap/wcs" class="bare">http://localhost:8080/opendap/wcs</a>. This link should return a browser
renderable HTML page of the <em>Capabilities</em> document with a conspicuously
empty <em>Contents</em> section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/WCS-NoContents.png" alt="WCS NoContents">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_4">11.B.5. Configuration</h4>
<div class="paragraph">
<p>Because WCS requires certain metadata to work (whereas DAP can
function with nothing more than a variable&#8217;s name and type), our
service provides a way to use WCS with DAP datasets that natively lack
the required WCS metadata. We do this by creating mappings (DynamicService
instances) between collections of DAP datasets that have similar
domain coordinates and a WCS service for the resulting Coverages.
These relationships are expressed in the <em>wcs_service.xml</em> configuration
file, a simple XML document.</p>
</div>
<div class="listingblock">
<div class="title">wcs_service.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;WcsService&gt;
    &lt;WcsCatalog className="opendap.wcs.v2_0.DynamicServiceCatalog"&gt;

        &lt;DynamicService                                            <i class="conum" data-value="1"></i><b>(1)</b>
                prefix="M2SDNXSLV"                                 <i class="conum" data-value="2"></i><b>(2)</b>
                name="MERRA-2 M2SDNXSLV WCS Service"               <i class="conum" data-value="3"></i><b>(3)</b>
                pathMatch="^/testbed-13/M2SDNXSLV\.5\.12\.4/.*$"   <i class="conum" data-value="4"></i><b>(4)</b>
                srs="urn:ogc:def:crs:EPSG::4326" &gt;                 <i class="conum" data-value="5"></i><b>(5)</b>
            &lt;DomainCoordinate
                name="time"
                dapID="time"
                size="1"
                units="Days since 1900-01-01T00:00:00.000Z"
                min="690"
                max="690" /&gt;
            &lt;DomainCoordinate
                name="latitude"
                dapID="lat"
                size="361"
                units="deg"
                min="-90"
                max="90" /&gt;
            &lt;DomainCoordinate
                name="longitude"
                dapID="lon"
                size="576"
                units="deg"
                min="-180"
                max="180" /&gt;
        &lt;/DynamicService&gt;
    &lt;/WcsCatalog&gt;
&lt;/WcsService&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>DynamicService</em> creates a WCS by creating a link between DAP datasets
matching the regex and the WCS meta information provided in the DynamicService definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>prefix</strong>: This is a simple string used by the WcsCatalog implementation to
distinguish each DynamicService. Choosing a value that is in some way related to the
collection being serviced can be helpful to people if there are problems later.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>name</strong>: A human readable and meaningful name that will be used by the server when it
creates a link to the service in the <em>viewers</em> page.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><strong>pathMatch</strong>: The value of <code>pathMatch</code> contains a regular expression that
the server uses to determine which DAP datasets will be associated with this
DynamicService.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><strong>srs</strong>:  The <em>srs</em> attribute defines the expected SRS for the coverages associated
with this DynamicService. The SRS defines the axis labels, order, units and
minimum number of domain coordinate dimensions and will be used for any dataset
that does not contain an explicit SRS definition. Currently only
<em>urn:ogc:def:crs:EPSG::4326</em> is supported.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently the only supported SRS is <code>urn:ogc:def:crs:EPSG::4326</code>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_using_pathmatch">Using <code>pathMatch</code></h5>
<div class="paragraph">
<p>The <code>pathMatch</code> attribute is used to assign a WCS DynamicService definition
to some subset (or possibly all) of the Datasets available through the
Hyrax server. This is accomplished by applying the regular expression
contained in the value of the <code>pathMatch</code> attribute to the <em>local name</em>
(aka <em>local url</em>, <em>path part of url</em>, etc. ) of a candidate dataset.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For example in this URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc" class="bare">http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DAP service endpoint is:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://test.opendap.org:8080/opendap/" class="bare">http://test.opendap.org:8080/opendap/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And the <em>local name</em> is:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data/nc/fnoc1.nc</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So for this dataset, the string <code>/data/nc/fnoc1.nc</code> would be compared
to the  <code>pathMatch</code> regex when determing if a DynamicService  endpoint
should be advertised in the <code>viewers</code> page for the dataset.</p>
</div>
<div class="paragraph">
<p>In the previous example the <code>pathMatch</code> attribute is set like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">pathMatch="^/testbed-13/M2SDNXSLV\.5\.12\.4/.*$"</pre>
</div>
</div>
<div class="paragraph">
<p>This value tells the server to assocaiate this WCS definition with any
DAP dataset whose local path name on the server matches the regular
expression <code>^/testbed-13/M2SDNXSLV\.5\.12\.4/.*$</code>, which can be read as,
"<em>Anything that starts with</em> <code>/testbed-13/M2SDNXSLV.5.12.4/</code>."</p>
</div>
<div class="paragraph">
<p>Regular expressions are very flexible and it is possible to
use them to specify a number of things at a time.</p>
</div>
<div class="sect5">
<h6 id="_pathmatch_regular_expression_example_1"><code>pathMatch</code> Regular Expression Example 1</h6>
<div class="paragraph">
<p>Consider the following <code>pathMatch</code> regular expression:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">pathMatch="^.*coads.*\.nc$"</pre>
</div>
</div>
<div class="paragraph">
<p>This will match any dataset path that contains the word "coads"
and that ends with ".nc".</p>
</div>
</div>
<div class="sect5">
<h6 id="_pathmatch_regular_expression_example_2"><code>pathMatch</code> Regular Expression Example 2</h6>
<div class="paragraph">
<p>Consider the following <code>pathMatch</code> regular expression:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">pathMatch="^/gesdisc/(M2IMNXINT|M2TMNXCHM|M2SDNXSLV|M2I1NXASM|M2TMNPMST)\.5\.12\.4/.*$"</pre>
</div>
</div>
<div class="paragraph">
<p>This will match any dataset whose name begins with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/gesdisc/M2IMNXINT.5.12.4/</code></p>
</li>
<li>
<p><code>/gesdisc/M2TMNXCHM.5.12.4/</code></p>
</li>
<li>
<p><code>/gesdisc/M2SDNXSLV.5.12.4/</code></p>
</li>
<li>
<p><code>/gesdisc/M2I1NXASM.5.12.4/</code></p>
</li>
<li>
<p><code>/gesdisc/M2TMNPMST.5.12.4/</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>pathMatch</code> feature allows a DynamicService definition to be associated
with a sort of "virtual collection" of datasets on the server, which may
be related merely by the fact that their coverage representations are similar.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_domain_coordinate_definitions">Domain Coordinate Definitions</h5>
<div class="paragraph">
<p>The Hyrax WCS relies on the DynamicService definition to be responsible for
identifying the specific variables in the DAP datasets that are to be used
for the geo-referenced domain coordinates of the coverage. The domain
coordinates must appear in the order that they appear in the dimensions of
the DAP dataset. They must also match the order of axes represented in the SRS.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If there is an unresolvable conflict, the DAP dataset cannot
be served as a Coverage until a suitable SRS can be identified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many DAP datasets have variables with more than two dimensions, and in
general WCS 2.0 only supports 2D data. However, latitude, longitude,
and time are frequently seen as domain coordinates in scientific data.
These can be utilized in the WCS as long as the inner most (last)
two dimensions are in agreement with the SRS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the WCS data model <strong>time</strong> is not considered a "domain coordinate,"
and is therefore not represented in the SRS. Yet it does accomodate
transmitting the time domain to the client and subsetting the time domain
in the manner of latitude and longitude. The result is that 3D datasets
with time, latitude, and longitude fit easily into the WCS model.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the server we treat time like any other coordinate dimension, so if
there is a time dimension on the data, it needs to appear in the set of
DomainCoordinate definitions for the service.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the DomainCoordinate definitions from the example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;DomainCoordinate
    name="time"
    dapID="time"
    size="1"
    units="Days since 1900-01-01T00:00:00.000Z"
    min="690"
    max="690" /&gt;
&lt;DomainCoordinate
    name="latitude"
    dapID="lat"
    size="361"
    units="deg"
    min="-90"
    max="90" /&gt;
&lt;DomainCoordinate
    name="longitude"
    dapID="lon"
    size="576"
    units="deg"
    min="-180"
    max="180" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our friend EPSG:4326, we know that the axis order is
<code>latitude,longitude</code> and that&#8217;s the order in the example. There is
also an additional time coordinate which comes prior to the
defintions for <code>latitude</code> and <code>longitude</code>.</p>
</div>
<div class="paragraph">
<p>Consider the <code>latitude</code> DomainCoordinate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;DomainCoordinate name="latitude" dapID="lat" size="361" units="deg" min="-90.0" max="90.0"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells the service that the coordinate axis named <code>latitude</code> is
bound to the DAP variable <code>lat</code>, that a default value for <em>size</em> is
361 elements, the default <em>units</em> are degrees ("deg"), the default
minimum value is -90.0 and the default maximum value is 90.0. What
this means is that when the DynamicService processes a DAP dataset
into a coverage, it will check the dataset&#8217;s metadata for this type of
information. If any of these values can be determined from the dataset
metadata, then that value is used; otherwise the values expressed in
the DomainCoordinate definition are used.</p>
</div>
<div class="paragraph">
<p>Longitude and time are handled in the same way as latitude.</p>
</div>
</div>
<div class="sect4">
<h5 id="_providing_field_defintions">Providing Field defintions</h5>
<div class="paragraph">
<p>Many DAP datasets either lack the metadata for determining which
variables will make suitable coverages or the information may not be in an
expected form or location. In order to enable these datasets to be
exposed via WCS, Hyrax allows the definition of a field in the
<em>DynamicService</em> element.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WCS Field names have limitations on the kinds of characters they
can contain. Specifically, these field names must be
<a href="https://stackoverflow.com/questions/1631396/what-is-an-xsncname-type-and-when-should-it-be-used">NCNAMEs</a>,
which means that they cannot contain special symbols such as @, $, %,
&amp;, /, +, most punctuation, spaces, tabs, newlines or parentheses.
Furthermore, they cannot begin with a digit, dot (.) or minus (-),
although those can appear later in the name. Because DAP variables do
not have such a limitation, you may have to provide a new name for the
variable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following <em>DynamicService</em> definition, each variable in the
dataset is exposed as a WCS field and basic information required by
WCS is provided.</p>
</div>
<div class="listingblock">
<div class="title">A <em>DynamicService</em> definition with <em>field</em> elements</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;DynamicService
        prefix="coads"
        name="COADS WCS Service"
        pathMatch="^.*coads.*\.nc$"
        srs="urn:ogc:def:crs:EPSG::4326"&gt;

    &lt;DomainCoordinate
        name="time"
        dapID="TIME"
        size="12"
        units="hour since 0000-01-01 00:00:00"
        min="366.0"
        max="8401.335"/&gt;

    &lt;DomainCoordinate
        name="latitude"
        dapID="COADSY"
        size="90"
        units="deg"
        min="-90"
        max="90" /&gt;

    &lt;DomainCoordinate
        name="longitude"
        dapID="COADSX"
        size="180"
        units="deg"
        min="-180"
        max="180" /&gt;

    &lt;field
        name="SST"
        dapID="SST"
        description="SEA SURFACE TEMPERATURE"
        units="Deg C"
        min="-9.99999979e+33"
        max="9.99999979e+33"/&gt;

    &lt;field
        name="AIRT"
        dapID="AIRT"
        description="AIR TEMPERATURE"
        units="DEG C"
        min="-9.99999979e+33"
        max="9.99999979e+33"/&gt;

    &lt;field
        name="UWND"
        dapID="UWND"
        description="ZONAL WIND"
        units="M/S"
        min="-9.99999979e+33"
        max="9.99999979e+33"/&gt;

    &lt;field
        name="VWND"                    <i class="conum" data-value="1"></i><b>(1)</b>
        dapID="VWND"                   <i class="conum" data-value="2"></i><b>(2)</b>
        description="MERIDIONAL WIND"  <i class="conum" data-value="3"></i><b>(3)</b>
        units="M/S"                    <i class="conum" data-value="4"></i><b>(4)</b>
        min="-9.99999979e+33"          <i class="conum" data-value="5"></i><b>(5)</b>
        max="9.99999979e+33"/&gt;         <i class="conum" data-value="6"></i><b>(6)</b>
&lt;/DynamicService&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>name</strong> - The name of the WCS Field to associate with the
DAP variable. This value must be an NCNAME as described above.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>dapID</strong> - The name of the DAP variable that will provide the
data for the Field</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>description</strong> - A human readable description of the variable</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><strong>units</strong> - The units of the values returned</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><strong>min</strong> - The minimum value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><strong>max</strong> - The maximum value</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_remote_dap_server_example">11.B.6. Remote DAP Server Example</h4>
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hyrax_handlers">Appendix C: Hyrax Handlers</h3>
<div class="sect3">
<h4 id="csv-handler">11.C.1. CSV Handler</h4>
<div class="sect4">
<h5 id="_introduction_2">Introduction</h5>
<div class="paragraph">
<p>This handler will serve Comma-Separated Values type data. Form many
kinds of files, only very modifications to the data files are needed. If
you have very complex ASCII data (e.g., data with headers), take a look
at the FreeForm handler, too.</p>
</div>
<div class="sect5">
<h6 id="_data_file_configuration">Data File Configuration</h6>
<div class="paragraph">
<p>Given a simple CSV data file, such as would be written out by Excel, add
a single line at the start that provides a name and OpenDAP datatype for
each column. Just as the data values in a given row are separated by a
comma, so are the column names and types. Here is a small example data
file with the added <em>name&lt;type&gt;</em> configuration row.</p>
</div>
<div class="paragraph">
<p>"Station&lt;String&gt;","latitude&lt;Float32&gt;","longitude&lt;Float32&gt;","temperature_K&lt;Float32&gt;","Notes&lt;String&gt;"</p>
</div>
<div class="paragraph">
<p>"CMWM",-34.7,23.7,264.3,</p>
</div>
<div class="paragraph">
<p>"BWWJ",-34.2,21.5,262.1,"Foo"</p>
</div>
<div class="paragraph">
<p>"CWQK",-32.7,22.3,268.4,</p>
</div>
<div class="paragraph">
<p>"CRLM",-33.8,22.1,270.2,"Blah"</p>
</div>
<div class="paragraph">
<p>"FOOB",-32.9,23.4,269.69,"FOOBAR"</p>
</div>
<div class="sect6">
<h7 id="_supported_opendap_datatypes">Supported OpenDAP Datatypes</h7>
<div class="paragraph">
<p>The CSV handler supports the following DAP2 simple types: Int16, Int32,
Float32, Float64, String.</p>
</div>
</div>
<div class="sect6">
<h7 id="_dataset_representation">Dataset representation</h7>
<div class="paragraph">
<p>The CSV handler will return represent the columns in the dataset as
arrays with the named dimension <em>record</em>. For example, the sample data
shown above will be represented in DAP2 by this handler as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    String Station[record = 5];
    Float32 latitude[record = 5];
    Float32 longitude[record = 5];
    Float32 temperature_K[record = 5];
    String Notes[record = 5];
} temperature.csv;</pre>
</div>
</div>
<div class="paragraph">
<p>This is in contrast to the FreeForm handler that would represent these
data as a Sequence with five columns.</p>
</div>
<div class="paragraph">
<p>For each column, the corresponding Array in the OpenDAP dataset has one
attribute named <em>type</em> with a string value of <em>Int16</em>, &#8230;&#8203;,
<em>String</em>. However, see below for information on how to add custom
attributes to a dataset.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_known_problems">Known Problems</h6>
<div class="paragraph">
<p>There are no known problems.</p>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters">Configuration Parameters</h6>

</div>
<div class="sect5">
<h6 id="_configuring_the_handler">Configuring the Handler</h6>
<div class="paragraph">
<p>This handler has no specific configuration parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="_configuring_datasets">Configuring Datasets</h6>
<div class="paragraph">
<p>There are two ways to add custom attributes to a dataset. First, you can
use an <em>ancillary attribute</em> file in the same directory as the dataset.
Alternatively, you can use NcML to add new attributes, variables, etc.
See <a href="#NcML_Module">the NcML Handler documentation</a> for more information
on that option. Here we will describe how to set up an ancillary attribute file.</p>
</div>
<div class="sect6">
<h7 id="_simple_attribute_definitions">Simple Attribute Definitions</h7>
<div class="paragraph">
<p>For any OpenDAP dataset, it is possible to write an ancillary attributes
file like the following. If that file has the name <em>dataset</em>.<code>das</code>
then whenever Hyrax reads <em>dataset</em>, it will also read those
attributes, and return them when asked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
   Station {
      String bouy_type "flashing";
      Byte Age 53;
   }
   Global {
       String DateCompiled "11/17/98";
       String Conventions "CF-1.0", "CF-1.6";
   }
}</pre>
</div>
</div>
<div class="paragraph">
<p>The format of this file is very simple: Each variable in the dataset may
have a collection of attributes, each of which consists of a type, a
name and one or more values. In the above example, the variable
<em>Station</em> will have the additional attributes <em>bouy_type</em> and <em>Age</em> with
the respective types and values. Note that datasets may also define
global attributes - information about the dataset as a whole - by adding
a section with a name that doesn&#8217;t match the name of any variable in the
dataset. In this example, I used <em>Global</em> for this (because it&#8217;s
obvious) but I could have used <em>foo</em>. Also note the attribute
<em>Conventions</em> has two values, <em>CF-1.0</em> and <em>CF-1.6</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="geotiff-handler">11.C.2. GeoTiff, GRIB2, JPEG2000 Handler</h4>
<div class="sect4">
<h5 id="_introduction_3">Introduction</h5>
<div class="paragraph">
<p>This handler will serve data stored in files that can be read using the
GDAL GIS library, including GeoTIFF, JPEG2000 and GRIB2.</p>
</div>
<div class="sect5">
<h6 id="_dataset_representation_2">Dataset Representation</h6>
<div class="paragraph">
<p>These are all GIS datasets, so DAP2 responses will contains Grid
variables with latitude and longitude maps. For DAP4, the responses will
be coverages with latitude and longitude domain variables.</p>
</div>
</div>
<div class="sect5">
<h6 id="_known_problems_2">Known Problems</h6>
<div class="paragraph">
<p>Often the data returned when using nothing but a GeoTIFF, JPEG2000, or
GRIB2 file contains none of the metadata that make them useful for
people not extremely familiar with the particular dataset. Thus, in most
cases some extra work will have to be done either using NcML or an
ancillary DAS file to add metadata to the dataset.</p>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters_2">Configuration Parameters</h6>
<div class="paragraph">
<p>None.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hdf4-handler">11.C.3. The HDF4 Handler</h4>
<div class="sect4">
<h5 id="_introduction_4">Introduction</h5>
<div class="paragraph">
<p>This release of the server supports HDF4.2 and can read any file
readable using that version of the API. It also supports reading/parsing
HDF-EOS attribute information and provides some special mappings for
HDF-EOS files depeding on the handler&#8217;s build options.</p>
</div>
<div class="sect5">
<h6 id="_mappings_between_the_hdf4_data_model_and_dap2_data_types">Mappings Between the HDF4 Data Model and DAP2 Data Types</h6>
<div class="dlist">
<dl>
<dt class="hdlist1">SDS </dt>
<dd>
<p>This is mapped to a DAP2 Grid (if it has a dimension scale) or Array
(if it lacks a dim scale).</p>
</dd>
<dt class="hdlist1">Raster image</dt>
<dd>
<p>This is read via the HDF 4.0 General Raster interface and is mapped to
Array. Each component of a raster is mapped to a new dimension labeled
accordingly. For example, a 2-dimensional, 3-component raster is
mapped to an m x n x 3 Array.</p>
</dd>
<dt class="hdlist1">Vdata</dt>
<dd>
<p>This is mapped to a Sequence, each element of which is a Structure.
Each subfield of the Vdata is mapped to an element of the Structure.
Thus a Vdata with one field of order 3 would be mapped to a Sequence
of 1 Structure containing 3 base types. <strong>Note</strong>: Even though these
appear as Sequences, the data handler does not support applying
relational constraints to them. You can use the array notation to
request a range of elements.</p>
</dd>
<dt class="hdlist1">Attributes </dt>
<dd>
<p>HDF attributes on SDS, rasters are straight-forwardly mapped to DAP
attributes (HDF doesn&#8217;t yet support Vdata attributes). File attributes
(both SDS, raster) are mapped as attributes of a DAP variable called
"HDF_GLOBAL" (by analogy to the way DAP handles netCDF global
attributes, i.e., attaching them to "NC_GLOBAL").</p>
</dd>
<dt class="hdlist1">Annotations </dt>
<dd>
<p>HDF file annotations mapped in the DAP to attribute values of type
"String" attached to the fake DAP variable named "HDF_ANNOT". HDF
annotations on objects are currently not read by the server.</p>
</dd>
<dt class="hdlist1">Vgroups </dt>
<dd>
<p>Vgroups are straight-forwardly mapped to Structures.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_mappings_for_the_hdf_eos_data_model">Mappings for the HDF-EOS Data Model</h6>
<div class="paragraph">
<p><em>This needs to be documented.</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_special_characters_in_hdf_identifiers">Special Characters in HDF Identifiers</h6>
<div class="paragraph">
<p>A number of non-alphanumeric characters (e.g., space, #, +, -) used in
HDF identifiers are not allowed in the names of DAP objects, object
components or in URLs. The HDF4 data handler therefore deals internally
with translated versions of these identifiers. To translate the WWW
convention of escaping such characters by replacing them with "%"
followed by the hexadecimal value of their ASCII code is used. For
example, "Raster Image #1" becomes "Raster%20Image%20%231". These
translations should be transparent to users of the server (but they will
be visible in the DDS, DAS and in any applications which use a client
that does not translate the identifiers back to their original form).</p>
</div>
</div>
<div class="sect5">
<h6 id="_known_problems_3">Known Problems</h6>
<div class="sect6">
<h7 id="_handling_of_floating_point_attributes">Handling of Floating Point Attributes</h7>
<div class="paragraph">
<p>Because the DAP software encodes attribute values as ASCII strings there
will be a loss of accuracy for floating point attributes. This loss of
accuracy is dependent on the version of the C++ I/O library used in
compiling/linking the software (i.e., the amount of floating point
precision preserved when outputting to ASCII is dependent on the
library). Typically it is very small (e.g., at least six decimal places
are preserved).</p>
</div>
</div>
<div class="sect6">
<h7 id="_handling_of_global_attributes">Handling of Global attributes</h7>
<div class="ulist">
<ul>
<li>
<p>The server will merge the separate global attributes for the SD, GR
interfaces with any file annotations into one set of global attributes.
These will then be available through any of the global attribute access
functions.</p>
</li>
<li>
<p>If the client opens a constrained dataset (e.g., in SDstart), any
global attributes of the unconstrained dataset will not be accessible
because the constraint creates a "virtual dataset" which is a subset of
the original unconstrained dataset.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_install_cf_enabled_hdf4_handler_correctly">How to Install CF-enabled HDF4 Handler Correctly</h6>
<div class="paragraph">
<p>The first step of using the HDF4 handler with CF option is to install
the handler correctly because it has three different options. We&#8217;ll call
them default, generic, and hdfeos2 for convenience.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>default</strong>: This option gives the same output as the legacy handler.</p>
</li>
<li>
<p><strong>generic</strong>: This option gives the output that meets the basic CF
conventions regardless of HDF4 and HDF-EOS2 products. Some HDF4 products
can meet the extra CF conventions while most HDF-EOS2 products will fail
to meet the extra CF conventions.</p>
</li>
<li>
<p><strong>hdfeos2</strong>: This option treats HDF-EOS2 products differently so that
their output follows not only the basic CF conventions but also the
extra CF conventions. For HDF4 products, the output is same as the
generic option.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_pick_the_right_rpm_instead_of_building_from_source">Pick the Right RPM Instead of Building from Source</h7>
<div class="paragraph">
<p>If you use Linux system that supports RPM package manager and have a
super user privilege, the easiest way to install the HDF4 handler is
using RPMs provided by OPeNDAP, Inc. website.</p>
</div>
<div class="paragraph">
<p>The OPeNDAP&#8217;s download website provides two RPMs --- one with HDF-EOS
and one without HDF-EOS. You should pick the one with HDF-EOS if you
want to take advantage of the extra CF support provided by the handler.
If you pick one without HDF-EOS, please make sure that the H4.EnableCF
key is set "true" in h4.conf file. See section 3.1 below for the full
usage.</p>
</div>
<div class="paragraph">
<p>Here are two basic commands for deleting and adding RPMs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove any existing RPM package using 'rpm -e &lt;package_name&gt;'.</p>
</li>
<li>
<p>Install a new RPM package using 'rpm -i &lt;package_name.rpm&gt;'.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>1) Download and install the latest "libdap", "BES", and "General
purpose handlers (aka dap-server)" RPMs first from</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  http://opendap.org/download/hyrax</pre>
</div>
</div>
<div class="paragraph">
<p>3) Download and install the latest "hdf4_handler" RPM from</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  http://opendap.org/download/hyrax</pre>
</div>
</div>
<div class="paragraph">
<p>4) (Optional) Configure the handler after reading the section 3 below.</p>
</div>
<div class="paragraph">
<p>5) (Re)start the BES server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  %/usr/bin/besctl (re)start</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_build_with_the_hdf_eos2_library_if_you_plan_to_support_hdf_eos2_products">Build With the HDF-EOS2 Library If You Plan to Support HDF-EOS2 Products</h7>
<div class="paragraph">
<p>If you plan to build one instead of using RPMs and to support HDF-EOS2
products, please consider installing the HDF-EOS2 library first. Then,
build the handler by specifying
--with-hdfeos2=/path/to/hdfeos2-install-prefix during the configuration
stage like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  ./configure --with-hdf4=/usr/local --with-hdfeos2=/usr/local/</pre>
</div>
</div>
<div class="paragraph">
<p>Although the HDF-EOS2 library is not required to clean dataset names and
attributes that CF conventions require, visualization will fail for most
HDF-EOS2 products without the use of HDF-EOS2 library. Therefore, it is
strongly recommended to use --with-hdfeos2 configuration option if you
plan to serve NASA HDF-EOS2 data products. The --with-hdfeos2
configuration option will affect only the outputs of the HDF-EOS2 files
including hybrid files, not pure HDF4 files.</p>
</div>
<div class="paragraph">
<p>As long as the H4.EnableCF key is set to be true as described in section
3.1 below, the HDF4 handler will generate outputs that conform to the
basic CF conventions even though the HDF-EOS2 library is not specified
with the --with-hdfeos2 configuration option. All HDF-EOS2 objects will
be treated as pure HDF4 objects.</p>
</div>
<div class="paragraph">
<p>Please see the INSTALL document on step-by-step instruction on building
the handler.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters_3">Configuration Parameters</h6>
<div class="sect6">
<h7 id="_cf_conventions_and_how_they_are_related_to_the_new_hdf4_handler">CF Conventions and How they are Related to the New HDF4 Handler?</h7>
<div class="paragraph">
<p>Before we discuss the usage further, it&#8217;s very important to know what
the CF conventions are. The CF conventions precisely define metadata
that provide a description of physical, spatial, and temporal properties
of the data. This enables users of data from different sources to decide
which quantities are comparable, and facilitates building easy-to-use
visualization tools with maps in different projections.</p>
</div>
<div class="paragraph">
<p>Here, we define the two levels of meeting the CF conventions: basic and
extra.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Basic</strong>: CF conventions have basic (syntactic) rules in describing
the metadata itself correctly. For example, dimensions should have
names; certain characters are not allowed; no duplicate variable
dimension names are allowed.</p>
</li>
<li>
<p><strong>Extra</strong>: All physical, spatial, and temporal properties of the data
are correctly described so that visualization tools (e.g., IDV and
Panoply) can pick them up and display datasets correctly with the right
physical units. A good example is the use of "units" and "coordinates"
attributes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you look at NASA HDF4 and HDF-EOS2 products, they are very diverse in
self-describing data and fail to meet CF conventions in many ways. Thus,
the HDF4 handler aims to meet the conventions by correcting OPeNDAP
attribute(DAS)/description(DDS)/data outputs on the fly. Although we
tried our best effort to implement the "extra" level of meeting the CF
conventions, some products are inherently difficult to meet such level.
In those cases, we ended up meeting the basic level of meeting the CF
conventions.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_bes_keys_in_h4_conf">BES Keys in h4.conf</h6>
<div class="paragraph">
<p>You can control HDF4 handler&#8217;s output behavior significantly by changing
key values in a configuration file called "h4.conf".</p>
</div>
<div class="paragraph">
<p>If you used RPMs, you can find the h4.conf file in /etc/bes/modules/. If
you built one, you can find the h4.conf file in
{prefix}/etc/bes/modules.</p>
</div>
<div class="paragraph">
<p>The following 6 BES keys are newly added in the h4.conf file. The
default configuration values are specified in the parentheses.</p>
</div>
<div class="sect6">
<h7 id="_h4_enablecf_true">H4.EnableCF (true)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is false, the handler will behave same as the
default handler. The output will not follow basic CF conventions. Object
and attribute names will not be corrected to follow the CF conventions.
Most NASA products cannot be visualized by visualization tools that
follow the CF conventions. Such tools include IDV and Panoply.</p>
</div>
<div class="paragraph">
<p>The rest of keys below relies on this option. This key must be set to be
"true" to ensure other keys to be valid. Thus, this is the most
important key to be turned on.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablemodapsfilefalse">H4.EnableMODAPSFile(false)</h7>
<div class="paragraph">
<p>By turning EnableMODAPSFile to be true, when HDF-EOS2 library is used,
an extra HDF file handle(by calling SDstart) will be generated at the
beginning of DAS,DDS and Data build. This may be useful for a server
that mounts its data over the network. If you are not sure about your
server settings, always leave it as false or comment out this key. By
default this key is turned off.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablespecialeos_true">H4.EnableSpecialEOS (true)</h7>
<div class="paragraph">
<p>When turning on this key, the handler will handle AIRS level 3 version 6
products and MOD08_M3-like products in a speedy way by taking advantage
of the special data structures in these two products. Using this key
requires the use of HDF-EOS2 library now although HDF-EOS2 library will
not be called. By turning on this key, potentially HDF-EOS2 files that
provide dimension scales for all dimensions may also be handled quickly.
By default, this key should be set to true.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_disablescaleoffsetcomp_true">H4.DisableScaleOffsetComp (true)</h7>
<div class="paragraph">
<p>Some NASA HDF4(MODIS etc.) products don&#8217;t follow the CF rule to pack the
data. To avoid the confusion for OPeNDAP&#8217;s clients , the handler may
adopt the following two approaches:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Apply the scale and offset computation to the individual data point
if the scale and offset rule doesn&#8217;t follow CF in the handler.</p>
</li>
<li>
<p>If possible, transform the scale and offset rule to CF rule.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since approach 1) may degrade the performance of fetching large size
data by heavy computation, we recommend approach 2), which is indicated
by setting this key to be true. By default, this key should always be
true.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablecheckscaleoffsettype_true">H4.EnableCheckScaleOffsetType (true)</h7>
<div class="paragraph">
<p>By turning on this key, the handler will check if the datatype of
scale_factorand offset is the same. This is required by CF. If they
don&#8217;t share the same datatype, the handler will make the data type of
offset be the same as that of scale_factor.</p>
</div>
<div class="paragraph">
<p>Since we haven&#8217;t found the data type inconsistencies of scale_factor and
offset, in order not affect the performance,this key will be set to
false by default.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablehybridvdata_true">H4.EnableHybridVdata (true)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is false, additional Vdata such as "Level 1B Swath
Metadta" in LAADS MYD021KM product will not be processed and visible in
the DAS/DDS output. Those additional Vdatas are added directly using
HDF4 APIs and HDF-EOS2 APIs cannot access them.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enableceresvdata_false">H4.EnableCERESVdata (false)</h7>
<div class="paragraph">
<p>Some CERES products(CER_AVG,CER_ES4,CER_SRB and CER_ZAVG, see
description in the HDFSP.h) have many SDS fields and some Vdata fields.
Correspondingly, the DDS and DAS page may be very long. The performance
of accessing such products with visualization clients may be greatly
affected. It may potentially even choke netCDF java clients.</p>
</div>
<div class="paragraph">
<p>To avoid such cases, we will not map vdata to DAP in such products by
default. Users can turn on this key to check vdata information of some
CERES products. This key will not affect the access of other products.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablevdata_to_attr_true">H4.EnableVdata_to_Attr (true)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is false, small vdata datasets will be mapped to
arrays in DDS output instead of attributes in DAS.</p>
</div>
<div class="paragraph">
<p>If this key&#8217;s value is true, vdata is mapped to attribute if there are
less than or equal to 10 records.</p>
</div>
<div class="paragraph">
<p>For example, the DAS output of TRMM data 1B21 will show vdata as an
attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  DATA_GRANULE_PR_CAL_COEF {
       String hdf4_vd_desc "This is an HDF4 Vdata.";
       Float32 Vdata_field_transCoef -0.5199999809;
       Float32 Vdata_field_receptCoef 0.9900000095;
       Float32 Vdata_field_fcifIOchar 0.000000000, 0.3790999949, 0.000000000,
       -102.7460022, 0.000000000, 24.00000000, 0.000000000, 226.0000000, 0.000000000,
       0.3790999949, 0.000000000, -102.7460022, 0.000000000, 24.00000000, 0.000000000,
       226.0000000;
   }</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enableceresmerrashortname_true">H4.EnableCERESMERRAShortName (true)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is false, the object name will be prefixed by the
vgroup path and the fullpath attribute will not be printed in DAS
output. This key only affects NASA CERES and MERRA products we support.</p>
</div>
<div class="paragraph">
<p>For example, the DAS output for Region_Number dataset</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    Region_Number {
        String coordinates "Colatitude Longitude";
        String fullpath "/Monthly Hourly Averages/Time And Position/Region Number";
   }</pre>
</div>
</div>
<div class="paragraph">
<p>becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   Monthly_Hourly_Averages_Time_And_Position_Region_Number {
        String coordinates "Monthly_Hourly_Averages_Time_And_Position_Colatitude Monthly_Hourly_Averages_Time_And_Position_Longitude";
   }</pre>
</div>
</div>
<div class="paragraph">
<p>in CER_AVG_Aqua-FM3-MODIS_Edition2B_007005.200510.hdf.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_disablevdatanameclashingcheck_true">H4.DisableVdataNameclashingCheck (true)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is false, the handler will check if there&#8217;s any
vdata that has the same name as SDS. We haven&#8217;t found such a case in
NASA products so it&#8217;s safe to disable this to improve performance.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablevdatadescattr_false">H4.EnableVdataDescAttr (false)</h7>
<div class="paragraph">
<p>If this key&#8217;s value is true, the handler will generate vdata&#8217;s
attributes. By default, it&#8217;s turned off because most NASA hybrid
products do not seem to store important information in vdata attributes.
If you serve pure HDF4 files, it&#8217;s recommended to turn this value to
true so that users can see all data. This key will not affect the
behavior of the handler triggered by the H4.EnableVdata_to_Attr key in
section 3.3 except the vdata attributes of small vdatas that are mapped
to attributes in DAS instead of arrays in DDS. That is, only attributes
of small vdatas will be also turned off from the DAS output if this key
is turned off, not the values of vdatas. If a vdata doesn&#8217;t have any
attribute or field attribute, the description</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">       String hdf4_vd_desc "This is an HDF4 Vdata.";</pre>
</div>
</div>
<div class="paragraph">
<p>will not appear in the attribute for that vdata although the key is
true. The attribute container of the vdata will always appear regardless
of this key&#8217;s value.</p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_enablecheckmodisgeofile_false">H4.EnableCheckMODISGeoFile (false)</h7>
<div class="paragraph">
<p>For MODIS swath data products that use the dimension map, if this key&#8217;s
value is true and a MODIS geo-location product such as MOD03 is present
and under the same directory as the swath product, the geolocation
values will be retrieved using the geolocation fields in MOD03/MYD03
file instead of using the interpolation according to the dimension map
formula.</p>
</div>
<div class="paragraph">
<p>We feel this is a more accurate approach since additional corrections
may be done for geo-location values stored in those files [1] although
we&#8217;ve done a case study that shows the differences between the
interpolated values and the values stored in the geo-location file are
very small.</p>
</div>
<div class="paragraph">
<p>For example, when the handler serves&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">       "MOD05_L2.A2010001.0000.005.2010005211557.hdf"</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;file, it will first look for a geo-location file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">       "MOD03.A2010001.0000.005.2010003235220.hdf"</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;first from the SAME DIRECTORY where MOD05_L2 file exists.</p>
</div>
<div class="paragraph">
<p>Please note that the "A2010001.0000" in the middle of the name is the
"Acquisition Date" of the data so the geo-location file name should have
exactly the same string. Handler uses this string to identify if a MODIS
geo-location file exists or not.</p>
</div>
<div class="paragraph">
<p>This feature works only with HDF-EOS2 MODIS products. It will not work
on the pure HDF4 MODIS product like MOD14 that requires the MOD03
geo-location product. That is, putting the MOD03 file with MOD14 in the
same directory will not affect the handler&#8217;s DAS/DDS/DDX output of the
MOD14 product.</p>
</div>
<div class="paragraph">
<p>[1] <a href="http://modis.gsfc.nasa.gov/data/dataprod/nontech/MOD0203.php" class="bare">http://modis.gsfc.nasa.gov/data/dataprod/nontech/MOD0203.php</a></p>
</div>
</div>
<div class="sect6">
<h7 id="_h4_cachedir_no_longer_supported">H4.CacheDir (no longer supported)</h7>
<div class="paragraph">
<p>The HDF4 handler used to support caching its response objects, but that
feature has been removed do to problems with it and datasets where
multiple SDS objects had arrays with the same names. This parameter is
now ignored. Note that no error message is generated if your h4.conf
file includes this, but it&#8217;s ignored by hyrax 1.7 and later.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hdf5-handler">11.C.4. The HDF5 Handler</h4>
<div class="sect4">
<h5 id="_introduction_5">Introduction</h5>
<div class="paragraph">
<p>This release of the server supports HDF5 files written using any version
of the HDF5 API. The handler should be built/linked with version 1.8.x
of the API.</p>
</div>
<div class="sect5">
<h6 id="_mappings_between_the_hdf5_data_model_and_dap2_data_types">Mappings Between the HDF5 Data Model and DAP2 Data Types</h6>
<div class="paragraph">
<p>The mapping between the HDF5 and HDF-EOS5 data model and DAP2 is
documented in a NASA Technical Note
(<a href="http://www.esdswg.org/spg/rfc/esds-rfc-017">ESDS-RFC-017</a>). This note is
quite detailed; a summary from its appendix is provided below.</p>
</div>
</div>
<div class="sect5">
<h6 id="_special_characters_in_hdf_identifiers_2">Special Characters in HDF Identifiers</h6>
<div class="paragraph">
<p>A number of non-alphanumeric characters (e.g., space, #, +, -) used in
HDF identifiers are not allowed in the names of DAP objects, object
components or in URLs. The HDF5 data handler therefore deals internally
with translated versions of these identifiers. To translate the WWW
convention of escaping such characters by replacing them with "%"
followed by the hexadecimal value of their ASCII code is used. For
example, "Raster Image #1" becomes "Raster%20Image%20%231". These
translations should be transparent to users of the server (but they will
be visible in the DDS, DAS and in any applications which use a client
that does not translate the identifiers back to their original form).</p>
</div>
</div>
<div class="sect5">
<h6 id="_known_problems_4">Known Problems</h6>
<div class="sect6">
<h7 id="_handling_of_floating_point_attributes_2">Handling of Floating Point Attributes</h7>
<div class="paragraph">
<p>Because the DAP software encodes attribute values as ASCII strings there
will be a loss of accuracy for floating point attributes. This loss of
accuracy is dependent on the version of the C++ I/O library used in
compiling/linking the software (i.e., the amount of floating point
precision preserved when outputting to ASCII is dependent on the
library). Typically it is very small (e.g., at least six decimal places
are preserved).</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters_4">Configuration Parameters</h6>
<div class="dlist">
<dl>
<dt class="hdlist1">H5.EnableCF</dt>
<dd>
<p>This is an option to support NASA HDF5/HDF-EOS5 data products. The
HDF5/HDF-EOS5 data products do not follow CF conventions. However,
hdf5_handler can make them follow the conventions if you turn on this
option. The key benefit of this option is to allow OPeNDAP
visualization clients to display remote data seamlessly. Please visit
<a href="http://hdfeos.org/software/hdf5_handler/doc/cf.php">here</a> for details.</p>
</dd>
<dt class="hdlist1">H5.IgnoreUnknownTypes</dt>
<dd>
<p>Ignore variables that use data types the handler cannot process. In
practice this means 64-bit integers. DAP2 does not support the 64-bit
integer type; using this parameter (i.e., setting its value to <em>yes</em>
or <em>true</em>) means that 64-bit integer variables are ignored and the
rest of the variables in the file can be read. The default value of
this parameter (<em>no</em> or <em>false</em>) configures the handler to return
an error when a 64-bit integer variable is found.</p>
</dd>
<dt class="hdlist1">H5.EnableCheckNameClashing</dt>
<dd>
<p>This option checks if there are duplicate variable names when group
information is removed and some characters are replaced with
underscore character. Although this option is required to ensure that
no two variable names are same, the operation is quite costly and thus
can degrade the performance significantly. If you are certain that
your HDF5 data won&#8217;t have any duplicate name, you can turn this off to
gain the performance of the server. For the NASA HDF5/HDF-EOS5
products we tested (AURA OMI/HIRDLS/MLS/TES, MEaSUREs SeaWiFS/Ozone,
Aquarius, GOSAT/acos, SMAP), we did not find any name clashing for
those objects. So the name clashing check seems unnecessary and this
option is turned off by default. The handler will check the name
clashing for any products not tested regardless of turning this option
on or off.</p>
</dd>
<dt class="hdlist1">H5.EnableAddPathAttr</dt>
<dd>
<p>When this option is turned off, the HDF5 handler will not insert the
<strong>fullnamepath</strong> and <strong>origname</strong> attribute in DAS output. For example,
the DAS output like below:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">     temperature {
        String units "K";
        String origname "temperature";
        String fullnamepath "/HDFEOS/GRIDS/GeoGrid/Data Fields/temperature";
        String orig_dimname_list "XDim ";
      }</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will change to&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">     temperature {
        String units "K";
        String orig_dimname_list "XDim ";
     }</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">H5.EnableDropLongString</dt>
<dd>
<p>NetCDF Java client cannot handle string size bigger than 32767 and
will throw an error if such variable is seen. Thus, the HDF5 handler
need to hide such long string variables from DAS and DDS output.
Setting this option to true will ensure that NetCDF Java OPeNDAP
visualization clients such as IDV and Panoply can visualize other
important variables.</p>
</dd>
<dt class="hdlist1">H5.DisableStructMetaAttr</dt>
<dd>
<p>When this option is true, StructMetadata attribute will not be
generated in DAS output.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_hdf5_and_hdf_eos_to_dap_type_mappings">HDF5 and HDF-EOS to DAP Type Mappings</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>The complete set of mappings for the types in the HDF5 and HDF-EOS5
data model</em></p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF5 data type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAP2 data name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt16</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results in an error unless
H5.IgnoreUnknownTypes is true. See above.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; H5.IgnoreUnknownTypes &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float64</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object/region reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF5 compound can be mapped to DAP2 under the
condition that the base members (excluding object/region references) of
compound can be mapped to DAP2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF5 dataset can be mapped to DAP2 under the
condition that the datatype of the HDF5dataset can be mapped to DAP2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF5 attribute can be mapped to DAP2 under the
condition that the datatype of the HDF5 dataset can be mapped to DAP2,
and the data is either scalar or one-dimensional array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">naming convention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A special attribute <em>HDF5_ROOT_GROUP</em> is used
to represent the HDF5 group structure; The absolute path of the HDF5
dataset as the DAP2 variable name; HDF5 group can be mapped to DAP2
under the condition that the file structure is a tree structure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF-EOS5 grid w/1-D projection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The latitude and longitude are
encoded according to CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF-EOS5 grid w/2-D projection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arrays</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map data variables to DAP2
Arrays; generate DAP2 Arrays for latitude and longitude (following CF);
add a <em>coordinates</em> attribute for each variable providing the names of
the coordinate variables (following CF).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDF-EOS5 Swath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arrays</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Follow the same prescription as with HDF-EOS5
2-D grids</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="netcdf-handler">11.C.5. The NetCDF Handler</h4>
<div class="sect4">
<h5 id="_introduction_6">Introduction</h5>
<div class="paragraph">
<p>There are several versions of the netCDF software for reading and
writing data and using those different versions, it&#8217;s possible to make
several different kinds of data files. For the most part, netCDF strives
to maintain compatibility so that any older file can be read using any
newer version of the library. To ensure that the netCDF handler can read
(almost) any valid netCDF data file, you should make sure to use the
latest version of the netCDF library when you build or install the
handler.</p>
</div>
<div class="paragraph">
<p>However, as of netCDF 4, there are some new data model components in
netCDF that are hard to represent in DAP2 (hence the 'almost' in the
preceding paragraph). If the handler, as of version 3.10.x, is linked
with netCDF 4.1.x or later, you will be able to read any netCDF file
that fits the 'classic' model of netCDF (as defined by
<a href="http://www.unidata.ucar.edu/software/netcdf/docs/netcdf/Which-Format.html#Which-Format">Unidata&#8217;s
documentation</a>) which essentially means any file that uses only data
types present in the netCDF 3.x API but with the addition that these
files can employ both internal compression and chunking.</p>
</div>
<div class="paragraph">
<p>The new data types present in the netCDF data model present more of a
challenge. However, as of version 3.10.x, the Hyrax data handler will
serve most of the new cardinal types and the more commonly used 'user
defined types'.</p>
</div>
<div class="sect5">
<h6 id="_mappings_between_netcdf_version_4_data_model_and_dap2_data_types">Mappings Between NetCDF Version 4 Data Model and DAP2 Data Types</h6>
<div class="paragraph">
<p>All of the cardinal types in the netCDF 4 data model map directly to
types in DAP2 except for the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NC_BYTE</dt>
<dd>
<p>There is no 'signed byte' type in DAP2 so these map to an unsigned
byte or signed Int16, depending on the value of the option
NC.PromoteByteToShort (see below where the configuration parameters
are described).</p>
</dd>
<dt class="hdlist1">NC_CHAR</dt>
<dd>
<p>There is no 'character' type in DAP2 so these map to DAP Strings of
length one. Arrays of <em>N</em> characters in netCDF map to arrays of <em>N-1</em>
Strings in DAP</p>
</dd>
<dt class="hdlist1">NC_INT64, NC_UINT64</dt>
<dd>
<p>DAP2 does not support 64-bit integers (this will be added soon to the
next version of the protocol).</p>
</dd>
</dl>
</div>
<div class="sect6">
<h7 id="_mappings_for_netcdf_4s_user_defined_types">Mappings for netCDF 4&#8217;s User Defined types</h7>
<div class="paragraph">
<p>In the netCDF documentation, types such as Compound (which is
effectively C&#8217;s <em>struct</em> type), et c., are called <em>User Defined</em> types.
Unlike the cardinal types, netCDF 4&#8217;S user defined types don&#8217;t always
have a simple mapping to DAP2&#8217;s types. However, the most important of
the user defined types, NC_COMPOUND, does map directly to DAP2&#8217;s
Structure. Here&#8217;s how the user defined types are mapped by the handler
as of version 3.10:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NC_COMPOUND</dt>
<dd>
<p>This maps directly to a DAP2 Structure. The handler works with both
compound variables and attributes. For attributes, the handler only
recognizes scalar and vector (one-dimensional) compounds. For
variables scalar and array compounds are supported including compounds
within compounds and compounds with fields that are arrays.</p>
</dd>
<dt class="hdlist1">NC_VLEN</dt>
<dd>
<p>Not supported</p>
</dd>
<dt class="hdlist1">NC_ENUM</dt>
<dd>
<p>Supported so long as the 'base type' is not a 64-bit integer. We add
extra attributes to help the downstream user. We add
<em>DAP2_OriginalNetCDFBaseType</em> with the value <em>NC_ENUM</em> and
<em>DAP2_OriginalNetCDFTypeName</em> with the name of the type from the file
(Enums in netCDF are user-defined types, so they have names set y the
folks who wrote the file). We also add two attributes that provide
information about the integral values and they names (e.g., Clear = 0,
Cumulonimbus = 1, Stratus = 2, &#8230;&#8203;, Missing = 255) using two
attributes: <em>DAP2_EnumValues</em> and <em>DAP2_EnumNames</em>.</p>
</dd>
<dt class="hdlist1">NC_OPAQUE</dt>
<dd>
<p>This type is mapped to an array of Bytes (so the scalar NC_OPAQUE
becomes a one-dimensional array in DAP2). If a netCDf file contains an
array (with <em>M</em> dimensions) of NC_OPAQUE vars, then the DAP response
will contain a Byte array with <em>M+1</em> dimensions. In addition, the
handler adds an attribute <em>DAP2_OriginalNetCDFBaseType</em> with the value
<em>NC_OPAQUE</em> and <em>DAP2_OriginalNetCDFTypeName</em> with the name of the
type from the file to the Byte variable so that savvy clients can see
what&#8217;s going on. Even though the DAP2 object for an NC_OPAQUE is an
array, it cannot be subset (but arrays of NC_OPAQUEs can be subset
with the restriction that <em>M+1</em> dimensional DAP2 Byte array can only
be subset in the original NC_OPAQUE&#8217;s <em>M</em> dimensions).</p>
</dd>
</dl>
</div>
</div>
<div class="sect6">
<h7 id="_netcdf_4s_group">NetCDF 4&#8217;s Group</h7>
<div class="paragraph">
<p>The netCDF handler currently reads only from the root group.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters_5">Configuration parameters</h6>
<div class="sect6">
<h7 id="_ignoreunknowntypes">IgnoreUnknownTypes</h7>
<div class="paragraph">
<p>When the handler reads a type that it does not recognize, it will
normally signal an error and stop processing. Setting this parameter to
true will cause it to silently ignore the unknown type (an error message
may be written to the bes log file).</p>
</div>
<div class="paragraph">
<p>Accepted values: true,yes|false,no, defaults to false.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NC.IgnoreUnknownTypes=true</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_showshareddimensions">ShowSharedDimensions</h7>
<div class="paragraph">
<p>Include shared dimensions as separate variables. This feature is
included to support older clients based on the netCDF library. Some
versions of the library depend on the shared dimensions appearing as
variables at the 'top' of the file.</p>
</div>
<div class="paragraph">
<p>Clients that announce to the server that they understand newer versions
of the DAP (3.2 and up) won&#8217;t need these extra variables, while older
ones likely will. In the 3.10.0 version of the handler, the DAP version
that clients announce they can accept will determine how the handler
responses <em>unless</em> this parameter is set, in which case, the value set
in the configuration file will override that default behavior.</p>
</div>
<div class="paragraph">
<p>Accepted values: true,yes|false,no, defaults to false.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NC.ShowSharedDimensions=false</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_promotebytetoshort">PromoteByteToShort</h7>
<div class="paragraph">
<p>This option first appears in Hyrax 1.8; version 3.10.0 of the
netcdf_handler.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Hyrax version 1.8 ships with this turned on in the netcdf
handler&#8217;s configuration file, even though the default for the option is
<em>off</em>.</p>
</div>
<div class="paragraph">
<p>Use this option to promote DAP2 <em>Byte</em> variables and attributes to
<em>Int16</em>, noting that Byte is unsigned and Int16 is signed, so this is
a way to preserve the sign of netCDF&#8217;s <em>signed Byte</em> data type.</p>
</div>
<div class="paragraph">
<p>For netcdf4 files, this option behaves the same except that NC_OPAQUE
variables are externalized as DAP Bytes regardless of the option&#8217;s
value; their Byte attributes, on the other hand, as promoted to Int16
when the option is <em>true</em>.</p>
</div>
<div class="paragraph">
<p>Backstory: In NetCDF the <em>Byte</em> data type is signed while in DAP2 it is
unsigned. For data (i.e., variables) this often makes no real difference
because byte data are often read from the network and dumped into an
array where their sign is interpreted (correctly or not) by the client
software - in other words byte-data is often a special case. However,
this is, strictly speaking, wrong. In addition, and maybe more
importantly, with attributes the values are interpreted by the server
and represented in ASCII (and sent to the client as text), so the sign
is interpreted by the server and and the resulting text is converted
into a binary value by the client; the simple trick of letting the
default C types handle the value&#8217;s sign won&#8217;t work. One way around this
incompatibility is to promote <em>Byte</em> in DAP2 to <em>Int16</em>, which is a
signed type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Accepted values: true,yes|false,no, defaults to false, the server's original behavior.</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NC.PromoteByteToShort=true</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_netcdf_to_dap_type_mappings">NetCDF to DAP Type Mappings</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>_The complete set of mappings for the types in the netCDF 4 data
model<br>
_ (entries in gray are new types not currently supported; entries in
green are new types that are supported)</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">netCDF type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">netCDF type description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAP2 type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAP2 type
description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_BYTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_byte<br>
<em>dods_int16</em> (see note)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit unsigned integer<br>
<em>16-bit signed int</em> (see note)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DAP2 type is unsigned; This mapping
can be changed so that netcdf Byte mapps to DAP2 Int16 (which will
preserve the netCDF Byte&#8217;s sign bit (see the NC.PromoteByteToShort
configuration parameter).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_UBYTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_str</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">variable length character
string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Treated as character data; arrays are treated specially (see
text)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_SHORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_int16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_USHORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_uint16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit unsigned
integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_int32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_INT64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_UINT64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit unsigned integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_FLOAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_float32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit floating point</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_DOUBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit floating point</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">variable length character string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_str</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">variable length
character string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In DAP2 it&#8217;s impossible to distinguish this from an
array of NC_CHAR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_COMPOUND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user defined type similar to C&#8217;s struct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A DAP Structure; similar to C&#8217;s struct</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_OPAQUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A BLOB data type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an array of bytes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The handler adds two attributes (<em>DAP2_OriginalNetCDFBaseType</em> with
the value NC_OPAQUE<br></p>
</div>
<div class="paragraph">
<p>and <em>DAP2_OriginalNetCDFTypeName</em> with the type&#8217;s name) that provide
info for savvy clients;<br>
 see text above about subsetting details</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_ENUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to C&#8217;s enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dods_byte, &#8230;&#8203;, dods_uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any integral
type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The handler chooses an integral type depending on the type used in the
NetCDF file.<br></p>
</div>
<div class="paragraph">
<p>It adds the <em>DAP2_OriginalNetCDFBaseType</em> and
<em>DAP2_OriginalNetCDFTypeName</em> attributes<br>
 as with NC_OPAQUE and also <em>DAP2_EnumNames</em> and <em>DAP2_EnumValues</em>.
Enums with 64-bit<br>
 integer base types are not supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NC_VLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">variable length arrays</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sql-handler">11.C.6. The SQL Hander</h4>
<div class="sect4">
<h5 id="_introduction_7">Introduction</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This handler is not included with the source or binary versions
od Hyrax we distribute as our official releases. You must download
the software and build it yourself at this time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This handler will serve data stored in a relational database if that
database is configured to be accessed using ODBC. The handler has been
tested using both the unixODBC and iODBC driver managers on Linux and
OS/X, respectively. While our testing has been limited to the MySQL and
Postgres database servers, the handler is not specific to either of
those severs; it should work with any database that can be accessed
using an ODBC driver.</p>
</div>
<div class="paragraph">
<p>The handler can be configured to combine information from several tables
and provide access to it as a single dataset, including performing the
full range of SQL operations. At the same time, the SQL database server
is never exposed to the web using this handler, so the database contents
are safe.</p>
</div>
<div class="sect5">
<h6 id="_mappings_between_the_odbc_data_types_and_dap2_data_types">Mappings Between the ODBC Data Types and DAP2 Data Types</h6>
<div class="paragraph">
<p>The SQL Handler maps the datatypes defined by SQL into types defined by
DAP. In most cases the mapping is obvious. Here we document each of the
supported SQL types and their corresponding DAP type. Note that any
types not listed here causes a runtime fatal error. That is, if you
include in the <em>[select]</em> part of the dataset file the name of a column
with an unsupported data type, the handler will return an error saying
<em>SQL Handler: The datatype read from the Data Source is not supported.
The problem type code is: &lt;type code&gt;</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. The Mapping between ODBC and DAP datatypes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ODBC Type</th>
<th class="tableblock halign-left valign-top">DAP Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Str</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_SLONG, SQL_C_LONG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_SHORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_FLOAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_DOUBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_NUMERIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_DEFAULT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Str</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_DATE, SQL_C_TIME, SQL_C_TIMESTAMP,<br>
SQL_C_TYPE_DATE, SQL_C_TYPE_TIME, SQL_C_TYPE_TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Str</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_BINARY, SQL_C_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_SBIGINT, SQL_C_UBIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_TINYINT, SQL_C_SSHORT, SQL_C_STINYINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_ULONG, SQL_C_USHORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_UTINYINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Str</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_C_CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Str</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. The Mapping between SQL and ODBC datatypes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SQL Type</th>
<th class="tableblock halign-left valign-top">ODBC Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_CHAR, SQL_VARCHAR, SQL_LONGVARCHAR</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_WCHAR, SQL_WVARCHAR, SQL_WCHAR</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL_DECIMAL, SQL_NUMERIC</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_known_problems_5">Known Problems</h6>
<div class="paragraph">
<p>It&#8217;s not exactly a <em>problem</em>, but the configuration of this handler
is dependent on correctly configuring the ODBC driver and these
drivers vary by operating system and implementation. This does not
simplify the configuration this component of the server!</p>
</div>
</div>
<div class="sect5">
<h6 id="_configuration_parameters_6">Configuration Parameters</h6>
<div class="sect6">
<h7 id="_configuring_the_odbc_driver">Configuring the ODBC Driver</h7>
<div class="paragraph">
<p>To configure the handler the handler itself must be told which tables,
or parts of tables, should be accessed and the ODBC driver must be
configured. In general, ODBC drivers are pretty easy to configure and,
while each driver has its idiosyncrasies, most of the setup is the same
for any driver/database combination. Both <em>unixODBC</em> and <em>iODBC</em> use two
configuration fills: <em>/etc/odbcinst.ini</em> and <em>/etc/odbc.ini</em>. The
driver should have documentation on these files and their setup. There
is one parameter you will need to know to make use of the sql handler.
In the <em>odbc.ini</em> file, the parameter <em>database</em> is used to reference
the actual database that is matched to particular <em>Data Source Name</em>
(DSN). You will need to know the DSN since programs that use ODBC to
access a database use the DSN and not the name of the database. In
addition, there is a <em>user</em> and <em>password</em> parameter set defined for a
particular DSN; the sql handler will likely need that too (NB: This
might not actually be needed 9/9/12).</p>
</div>
<div class="paragraph">
<p>What the configuration files look like on OSX:</p>
</div>
<div class="listingblock">
<div class="title">odbcinst.ini</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[ODBC Drivers]
MySQL ODBC 5.1 Driver = Installed
psqlODBC              = Installed
 
[ODBC Connection Pooling]
PerfMon    = 0
Retry Wait =
 
[psqlODBC]
Description = PostgreSQL ODBC driver
Driver      = /Library/PostgreSQL/psqlODBC/lib/psqlodbcw.so
 
[MySQL ODBC 5.1 Driver]
Driver = /usr/local/lib/libmyodbc5.so</code></pre>
</div>
</div>
<div class="paragraph">
<p>This file holds information about the database name and the Data Source
Name (DSN). Here it&#8217;s creatively named 'test'.</p>
</div>
<div class="listingblock">
<div class="title">odbc.ini:</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[ODBC Data Sources]
data_source_name = test
 
[ODBC]
Trace         = 0
TraceAutoStop = 0
TraceFile     =
TraceLibrary  =
 
[test]
Description = MySQL test database
Trace       = Yes
TraceFile   = sql.log
Driver      = MySQL ODBC 5.1 Driver
Server      = localhost
User        = jimg
Password    =
Port        = 3306
DATABASE    = test
Socket      = /tmp/mysql.sock</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_configuring_the_handler_2">Configuring the Handler</h6>
<div class="sect6">
<h7 id="_sql_checkpoint">SQL.CheckPoint</h7>
<div class="paragraph">
<p>Checkpoints in the SQL handler are phases of the database access process
where error conditions can be tested for and reported. If these are
activated using the <em>SQL.CheckPoint</em> parameter and an error is found,
then a message will be printed in the bes.log and an exception will be
thrown. There are five checkpoints supported by the handler:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CONNECT</dt>
<dd>
<p>1 (Fatal error)</p>
</dd>
<dt class="hdlist1">CLOSE</dt>
<dd>
<p>2</p>
</dd>
<dt class="hdlist1">QUERY</dt>
<dd>
<p>3</p>
</dd>
<dt class="hdlist1">GET_NEXT</dt>
<dd>
<p>4 (Recoverable error)</p>
</dd>
<dt class="hdlist1">NEXT_ROW</dt>
<dd>
<p>5</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The default for the handler is to test for and report all errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">SQL.CheckPoint=1,2,3,4,5</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_configuring_datasets_2">Configuring Datasets</h7>
<div class="paragraph">
<p>One aspect of the SQL handler that sets it appart from other handlers is
that the datasets it serves are not files or collections of files.
Instead they are values read from one or more tables in a database. The
handler uses one file for each dataset it serves; we call them <em>dataset
files</em>. Within a dataset file there are several sections that define
which Data Set Name (DSN) to use (recall that the DSN is set in the
<em>odbc.ini</em> file which maps the DSN to a particular database, user and
password), which tables, how to combine them and which columns to
<em>select</em> and if any other constraints should be applied when retrieving
the values from the database server. As a data provider, you should plan
on having a dataset file for each dataset you want people to access,
even if those all come from the same table.</p>
</div>
<div class="paragraph">
<p>A dataset file has five sections:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">section</dt>
<dd>
<p>This is where the DSN and other information are given</p>
</dd>
<dt class="hdlist1">select</dt>
<dd>
<p>Here the arguments to passed to select are given. This may be <em>*</em> or
the names of columns, just as with an SQL <em>SELECT</em> statement</p>
</dd>
<dt class="hdlist1">from</dt>
<dd>
<p>The names of the tables. This is just like the <em>FROM</em> part of an SQL
<em>SELECT</em> statement.</p>
</dd>
<dt class="hdlist1">where</dt>
<dd>
<p>You&#8217;re probably seeing a pattern by now: SELECT &#8230;&#8203; FROM &#8230;&#8203; WHERE</p>
</dd>
<dt class="hdlist1">other</dt>
<dd>
<p>Driver-specific parameters</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each of the sections is denoted by starting a line in the dataset file
with its name in square brackets such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[section]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[select]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_information_in_the_section_part_of_the_dataset_file">Information in the <em>section</em> Part of the Dataset File</h7>
<div class="paragraph">
<p>There are six parameters that may be set in the <em>select</em> part of the
dataset file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">api</dt>
<dd>
<p>Currently this must be <em>odbc</em></p>
</dd>
<dt class="hdlist1">server</dt>
<dd>
<p>The DSN.</p>
</dd>
<dt class="hdlist1">user, pass, dbname, port</dt>
<dd>
<p>Unused. These are detected by the code, however, and can be used by a
new submodule that connects to a database using a scheme other than
ODBC. For example, if you were to specialize the connection mechanism
so that it used a database&#8217;s native API, these keywords could be used
to set the database name, user, etc., in place of the ODBC DSN. In
that case the value of <em>api</em> would need to be the base name of the new
connection specialization.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that a dataset file may have several [section] parts, each which
lists a different DSN. This provides a failover capability so that if
the same information (or similar enough to be accessible using the same
SQL statement) exists both locally and remotely, both sources can be
given. For example, suppose that your institution maintains a database
with many thousands of observations and you want to serve a subset of
those. You have a copy of those data on your own computer too, but you
would rather have people access the data from the institution&#8217;s high
performance hardware. You can list both DSNs, knowing that the first
listed will get preference.</p>
</div>
<div class="sect7">
<h8 id="_the_select_part">The <em>select</em> Part</h8>
<div class="paragraph">
<p>This part lists the columns to include as you would write them in an SQL
SELECT statement. Each column name has to be unique. You can use aliases
(defined in the preamble of the dataset file) to define different names
for two columns from different database tables that are the same. For
example, you could define aliases like these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>table1.theColumn as col1
table2.theColumn as col2</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then use <em>col1,col2</em> in the select part of the dataset file</p>
</div>
</div>
<div class="sect7">
<h8 id="_the_from_and_where_parts">The <em>from</em> and <em>where</em> Parts</h8>
<div class="paragraph">
<p>Each of these parts are simply substituted and passed to the database
just as you would expect. Note that you do not include the actual words
<em>FROM</em> or <em>WHERE</em>, just the contents of those parts of the SQL
statement.</p>
</div>
</div>
<div class="sect7">
<h8 id="_the_other_part">The <em>other</em> Part</h8>
<div class="paragraph">
<p>Entries in this parts should be of the form <em>key = value</em>, one per
line. They are taken as a group and passed to the ODBC driver. Use this
section to provide any parameters that are specific to a particular
driver.</p>
</div>
</div>
<div class="sect7">
<h8 id="_using_variables">Using Variables</h8>
<div class="paragraph">
<p>The dataset files also support 'variables' that can be used to define a
name once and then use it repeatedly by simply using the variable name
instead. Then if you decide to read from a different table, only the
variable definition needs to be changed. Variables are defined as the
beginning o the dataset file, before the <em>section</em> part. The syntax for
variable is simple: <em>define $variable$ = value</em>, one per line (the <em>$</em>
characters are literal, as is the word <em>define</em>). To reference a
variable, use <em>$variable$</em> wherever you would otherwise use a literal.</p>
</div>
</div>
<div class="sect7">
<h8 id="_some_example_dataset_files">Some Example Dataset Files</h8>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[section]
#  Required.
api=odbc

# This is the name of the configured DSN
server=MySQL_DSN

[select]
# The attribute list to query
# NOTE: The order used here will be kept in the results
id, wind_chill, description

[from]
# The table to use can be a complex FROM clause
wind_08_2010

[where]
# this is optional constraint which will be applied to ALL
# the requests and can be used to limit the shared data.
id&lt;100</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following two descriptions of the File Out NetCDF code need to be combined.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file-out-netcdf">11.C.7. NetCDF file responses</h4>
<div class="sect4">
<h5 id="_introduction_8">Introduction</h5>
<div class="paragraph">
<p>The File Out NetCDF module provides the ability to return OPeNDAP
DataDDS objects as netcdf files. The module takes an OPeNDAP DataDDS and
translates the attributes, data structure, and data into a netcdf file
and streams the resulting file back to the caller. Currently, simple
types, arrays, structures and grids are supported. Sequences are not yet
supported.<br></p>
</div>
<div class="sect5">
<h6 id="_services_handled">Services Handled</h6>
<div class="paragraph">
<p>This module does not handle any services but adds to an existing service.</p>
</div>
</div>
<div class="sect5">
<h6 id="_services_provided">Services Provided</h6>
<div class="paragraph">
<p>The module provides an additional format to the <code>dap</code> service&#8217;s <code>dods</code>
command. The format is used to specify a "returnAs" format. Typically
you will see responses of the dap2 format. This module provides the
additional format of returning the OPenDAP data object as a netcdf file.</p>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_the_module">How to Use the Module</h6>
<div class="paragraph">
<p>Once installed, the fonc.conf file is installed in the BES
etc/bes/modules directory and is automatically loaded by the BES at
startup. There is a configuration option that you can change for this
module. The <code>FONc.Tempdir</code> parameter in the fonc.conf configuration file
tells the module where to store the netcdf files generated by the module
until the file is streamed back to the caller. The default value for
this parameter is the /tmp directory. You should change this to a
location where there is plenty of disk space/quota that is owned by the
user set to run the BES.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FONc.Tempdir=/tmp</pre>
</div>
</div>
<div class="paragraph">
<p>Other BES keys that can be used to control the handler&#8217;s behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FONc.UseCompression=true</pre>
</div>
</div>
<div class="paragraph">
<p>Use compression when making netCDF4 files; true by default</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FONc.ChunkSize=4096</pre>
</div>
</div>
<div class="paragraph">
<p>The default chunk size when making netCDF4 files, in KBytes (4k by
default)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FONc.ClassicModel=true</pre>
</div>
</div>
<div class="paragraph">
<p>When making a netCDF4 file, use only the 'classic' netCDF data model;
true by default.</p>
</div>
<div class="paragraph">
<p>The next time the BES is started it will load this module. And, once
installed, the OLFS will know that it can use this module to transform
your data. Next to a dataset you will see the list of data products
provided for that dataset. This will include a link for File Out Netcdf.</p>
</div>
<div class="paragraph">
<p>If not using the OLFS to serve your data, for example if using the
bescmdln, you would run a command file that would look something like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;request reqID="some_unique_value" &gt;
    &lt;setContext name="dap_format"&gt;dap2&lt;/setContext&gt;
    &lt;setContainer name="c" space="catalog"&gt;data/nc/fnoc1.nc&lt;/setContainer&gt;
    &lt;define name="d"&gt;
    &lt;container name="c" /&gt;
    &lt;/define&gt;
    &lt;get type="dods" definition="d" returnAs="netcdf"/&gt;
&lt;/request&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_background_on_returning_netcdf">11.C.8. Background on Returning NetCDF</h4>
<div class="sect4">
<h5 id="_general_questions_and_assumptions">General Questions and Assumptions</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This appendix holds general <em>design</em> information that we used
when first implementing the Hyrax netCDF response. The fundemental
problem that needs to be solved in the software is to map the full
spectrum of OPeNDAP datasets to the netCDF 3 and 4 data models.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>What version of netCDF will this support? Hyrax supports returing
both Version 3 and 4 netCDF files.</p>
</li>
<li>
<p>Should I traverse the data structure to see if there are any
sequences? Yes. An initial version should note their presence and add
an attribute noting that they have been elided.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_how_to_flatten_hierarchical_types">How to Flatten Hierarchical Types</h6>
<div class="paragraph">
<p>For a structure such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Structure {
    Int x;
    Int y;
} Point;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;represent that as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Point.x
Point.y</pre>
</div>
</div>
<div class="paragraph">
<p>Explicitly including the dot seems ugly and like a kludge and so on, but
it means that the new variable name can be feed back into the server to
get the data. That is, a client can look at the name of the variable and
figure out how to ask for it again without knowing anything about the
translation process.</p>
</div>
<div class="paragraph">
<p>Because this is hardly a lossless scheme (a variable might have a dot in
its name&#8230;&#8203;), we should also add an attribute that contains the original
real name of the variable - information that this is the result of a
flattening operation, that the parent variable was a Structure, Sequence
or Grid and its name was <em>xyz</em>. Given that, it should be easy to sort
out how to make a future request for the data in the translated
variable.</p>
</div>
<div class="paragraph">
<p>This in some way obviates the need for the dot, but it&#8217;s best to use it anyway.</p>
</div>
<div class="sect6">
<h7 id="_attributes_of_flattened_typesvariables">Attributes of Flattened Types/Variables</h7>
<div class="paragraph">
<p>If the structure <em>Point</em> has attributes, those should be copied to
both the new variables (<em>Point.x</em> and <em>Point.y</em>). It&#8217;s redundant
but this way the recipient of the file gets all of the information
held in the original data source 96 January 2009 (PST) Added based on
email from Patrick).</p>
</div>
<div class="paragraph">
<p>The name of the attributes should be Point.name for any attributes of
the structure Point, and just the name of the attribute for the
variables x and y. So, if x has attributes a1 and a2 and Point has
attributes a1 and a3 then the new variable Point.x will have attributes
a1, a2, Point,a1 and Point.a3.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_extra_data_to_be_included">Extra Data To Be Included</h6>
<div class="paragraph">
<p>For a file format like netCDF it is possible to include data about the
source data using it&#8217;s original data model as expressed using DAP. We
could then describe where each variable in the file came from. This
would be a good thing if we can do it in a light-weight way. It
would also be a good thing to add an attribute to each variable that
names where in the original data it came from so that client apps &amp;
users don&#8217;t have to work too hard to sort out what has been changed to
make the file.</p>
</div>
</div>
<div class="sect5">
<h6 id="_information_about_specific_types">Information About Specific Types</h6>
<div class="sect6">
<h7 id="_strings">Strings</h7>
<div class="ulist">
<ul>
<li>
<p>Add dimension representing the max length of the string with name
varname_len.</p>
</li>
<li>
<p>For scalar there will be a dimension for the length and the value
written using nc_put_vara_text with type NC_CHAR</p>
</li>
<li>
<p>For arrays add an additional dimension for the max length and the
value written using nc_put_vara_text with type NC_CHAR</p>
</li>
</ul>
</div>
<div class="quoteblock">
<div class="title">7 January 2008 (MST) Received message from Russ Rew</div>
<blockquote>
Yes, that&#8217;s fine and follows a loose convention for names of
string-length dimensions for netCDF-3 character arrays.
For netCDF-4, of course, no string-length dimension is needed, as strings
are supported as a netCDF data type.
</blockquote>
</div>
</div>
<div class="sect6">
<h7 id="_structures">Structures</h7>
<div class="ulist">
<ul>
<li>
<p>Flatten</p>
</li>
<li>
<p>Prepend name of structure with a dot followed by the variable name.
Keep track as there might be embedded structures, grids, et cetera.</p>
</li>
</ul>
</div>
<div class="quoteblock">
<div class="title">18 December 2008 (PST) James Gallagher</div>
<blockquote>
I would use a dot even though I
know that dots in variable names are, in general, a bad idea. If we
use underscores then it maybe hard for clients to form a name that can
be used to access values from a server based on the information in the
file.
</blockquote>
</div>
</div>
<div class="sect6">
<h7 id="_grid">Grid</h7>
<div class="ulist">
<ul>
<li>
<p>Flatten.</p>
</li>
<li>
<p>Use the name of the grid for the array of values</p>
</li>
<li>
<p>Prepend the name of the grid plus a dot to the names of each of the
map vectors.</p>
</li>
</ul>
</div>
<div class="quoteblock">
<div class="title">21 December 2008 (PST) James Gallagher</div>
<blockquote>
A more sophisticated version might look at the values of two or more
grids that use the same names and have the same type (e.g., Float64
lon[360]) and if they are the same, make them shared dimensions.
</blockquote>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">More information about Grid translation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.unidata.ucar.edu/software/netcdf/guidec/guidec-7.html">netcdf
guide on components</a></p>
</li>
<li>
<p><a href="http://opendap.org/pdf/ESE-RFC-004v1.1.pdf">DAP 2 spec</a> on Grids and
look for naming conventions</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The idea here is that each of the map vectors will become an array with
one dimension, the name of the dimension the same as the name of the
variable (be careful about nested maps, see flatten). Then the grid
array of values uses the same dimensions as those used in the map
variables.</p>
</div>
<div class="paragraph">
<p>If there are multiple grids then they either use the same map variables
and dimensions or they use different variables with different
dimensions. In other words, if one grid has a map called x with
dimension x, and another grid has a map called x then it better be the
same variable with the same dimension and values. If not, it&#8217;s an error,
it should be using a map called y that gets written out as variable y
with dimension y.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the dap spec on grids and see if this is the convention.</p>
</li>
<li>
<p>Read the netcdf component guide (section 2.2.1 and 2.3.1)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">coads_climatology.nc (4 grids, same maps and dimensions)</div>
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Float32 X[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } X;
    Grid {
      Array:
        Float32 Y[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } Y;
    Grid {
      Array:
        Float32 Z[TIME = 14][COADSY = 75][COADSX = 75];
      Maps:
        Float64 TIME[TIME = 14];
        Float64 COADSY[COADSY = 75];
        Float64 COADSX[COADSX = 75];
    } Z;
    Grid {
      Array:
        Float32 T[TIME = 14][COADSY = 75][COADSX = 90];
      Maps:
        Float64 TIME[TIME = 14];
        Float64 COADSY[COADSY = 75];
        Float64 COADSX[COADSX = 90];
    } T;
} coads_climatology.nc;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_array">Array</h7>
<div class="ulist">
<ul>
<li>
<p>write_array appears to be working just fine.</p>
</li>
<li>
<p>If array of complex types?</p>
</li>
</ul>
</div>
<div class="quoteblock">
<div class="title">16:43, 8 January 2008 (MST) Patrick West</div>
<blockquote>
DAP allows
for the array dimensions to not have names, but NetCDF does not allow
this. If the dimension name is empty then create the dimension name
using the name of the variable + "_dim" + dim_num. So, for example, if
array a has three dimensions, and none have names, then the names will
be a_dim1, a_dim2, a_dim3.
</blockquote>
</div>
</div>
<div class="sect6">
<h7 id="_sequences">Sequences</h7>
<div class="ulist">
<ul>
<li>
<p>For now throw an exception</p>
</li>
<li>
<p>To translate a Sequence, there are several cases to consider:</p>
<div class="ulist">
<ul>
<li>
<p>A Sequence of simple types only (which means a one-level sequence):
translate to a set of arrays using a name-prefix flattening scheme.</p>
</li>
<li>
<p>A nested sequence (otherwise with only simple types) should first be
flattened to a one level sequence and then that should be flattened.</p>
</li>
<li>
<p>A Sequence with a Structure or Grid should be flattened by
recursively applying the flattening logic to the components.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="quoteblock">
<div class="title">21 December 2008 (PST) James Gallagher</div>
<blockquote>
Initial version should elide [sequences] because
there are important cases where they appear as part of a dataset but
not the main part. We can represent these as arrays easily in the
future.
</blockquote>
</div>
</div>
<div class="sect6">
<h7 id="_attributes">Attributes</h7>
<div class="ulist">
<ul>
<li>
<p>Global Attributes?</p>
<div class="ulist">
<ul>
<li>
<p>For single container DDS (no embedded structure) just write out the
global attributes to the netcdf file</p>
</li>
<li>
<p>For multi-container DDS (multiple files each in an embedded
Structure), take the global attributes from each of the containers and
add them as global attributes to the target netcdf file. If the value
already exists for the attribute then discard the value. If not then add
the value to the attribute as attributes can have multiple values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Variable Attributes</p>
<div class="ulist">
<ul>
<li>
<p>This is the way attributes should be stored in the DAS. In the entry
class/structure there is a vector of strings. Each of these strings
should contain one value for the attribute. If the attribute is a list
of 10 int values then there will be 10 strings in the vector, each
string representing one of the int values for the attribute.</p>
</li>
<li>
<p>What about attributes for structures? Should these attributes be
created for each of the variables in the structure? So, if there is a
structure Point with variables x and y then the attributes for a will be
attributes for Point.x and Point.y? Or are there attributes for each of
the variables in the structure? <em>6 January 2009 (PST) James Gallagher
See above under the information about hierarchical types.</em></p>
</li>
<li>
<p>For multi-dimensional datasets there will be a structure for each
container, and each of these containers will have global attributes.</p>
</li>
<li>
<p>Attribute containers should be treated just as structures. The
attributes will be flattened with dot separation of the names. For
example, if there is an attribute a that is a container of attributes
with attributes b and c then we will create an attribute a.b and a.c for
that variable.</p>
</li>
<li>
<p>Attributes with multiple string values will be handled like so. The
individual values will be put together with a newline character at the
end of each, making one single value.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_added_attributes">Added Attributes</h7>
<div class="quoteblock">
<div class="title">14 January, 2009 Patrick West</div>
<blockquote>
This feature will not be added as part of [Hyrax] 1.5, but a future release.
</blockquote>
</div>
<div class="paragraph">
<p>After doing some kind of translation, whether with constraints,
aggregation, file out, whatever, we need to add information to the
resulting data product telling how we came about this result. Version of
the software, version of the translation (file out), version of the
aggregation engine, whatever. How do we do that?</p>
</div>
<div class="paragraph">
<p>The ideas might be not to have all of this information in, say, the
GLOBAL attributes section of the data product, or in the attributes of
the opendap data product (DDX, DataDDX, whatever) but instead a URI
pointing to this information. Perhaps this information is stored at
OPeNDAP, provenance information for the different software components.
Perhaps the provenance information for this data product is stored
locally, referenced in the data product, and this provenance information
references software component provenance.</p>
</div>
<div class="paragraph">
<p><a href="http://www.opendap.org/provenance?id=xxxxxx" class="bare">http://www.opendap.org/provenance?id=xxxxxx</a></p>
</div>
<div class="paragraph">
<p>might be something referenced in the local provenance. The local
provenance would keep track of&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>containers used to generate the data product</p>
</li>
<li>
<p>constraints (server side functions, projections, etc&#8230;&#8203;)</p>
</li>
<li>
<p>aggregation handler and command</p>
</li>
<li>
<p>data product requested</p>
</li>
<li>
<p>software component versions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Peter Fox mentions that we need to be careful of this sort of thing
(storing provenance information locally) as this was tried with log
information. Referencing this kind of information is dangerous.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_support_for_cf">Support for CF</h6>
<div class="paragraph">
<p>If we can recognize and support files that contain CF-compliant
information, we should strive to make sure that the resulting netCDF
files built by this module from those files are also CF compliant. This
will have a number of benefits, most of which are likely unknown right
now because acceptance of CF is not complete. But one example is that
ArcGIS understands CF, so that means that returning a netCDF file that
follows CF provides a way to get information from our servers directly
into this application without any modification to the app itself.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a link to information about <a href="http://cfconventions.org/">CF</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file-out-gdal">11.C.9. Returning GeoTiff and JPEG2000</h4>
<div class="sect4">
<h5 id="_introduction_9">Introduction</h5>
<div class="paragraph">
<p>The File Out GDAL module provides the ability to return various kinds of
GIS data files as responses from Hyrax. The handler currently supports
returning GeoTIFF and JPEG2000 files. Not every dataset served by Hyrax
can be returned as a GIS dataset, either because it lacks
latitude/longitude information or because it is not organized so that
the latitude and longitude values are recognized by this module.</p>
</div>
<div class="paragraph">
<p>Most GIS data include information about their coordinate reference
systems, but how that information is encoded can vary widely. This
handler looks for geographical information that follows the CF-1.4
standard for [grid mappings and projections
<a href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.6/build/cf-conventions.html#grid-mappings-and-projections" class="bare">http://cfconventions.org/Data/cf-conventions/cf-conventions-1.6/build/cf-conventions.html#grid-mappings-and-projections</a>]
(note that the link is actually to the CF-1.6 standard; it seems the
CF-1.4 site from LLNL is no longer available). It will recognize either
the EPSG:4047 or WGS84 Geographical Coordinate systems (GCS) and
provides an option to set the default GCS using a parameter (described
below).</p>
</div>
<div class="sect5">
<h6 id="_services_handled_2">Services Handled</h6>
<div class="paragraph">
<p>This module does not handle any services but adds to an existing service</p>
</div>
</div>
<div class="sect5">
<h6 id="_services_provided_2">Services Provided</h6>
<div class="paragraph">
<p>The module provides an additional format to the <code>dap</code> service&#8217;s <code>dods</code>
command. The format is used to specify a "returnAs" format. This module
provides the additional format of returning the OPenDAP data object as a
GeoTIFF or JPEG2000 file.</p>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_the_module_2">How to Use the Module</h6>
<div class="paragraph">
<p>Once installed, the <em>fong.conf</em> file is installed in the BES
etc/bes/modules directory and is automatically loaded by the BES at
startup. There is a configuration option that you can change for this
module. The <em>FONg.Tempdir' parameter in the</em> fong.conf <em>configuration
file tells the module where to store the files generated by the module
until the file is streamed back to the caller. The default value for
this parameter is the /tmp directory. You should change this to a
location where there is plenty of disk space/quota that is owned by the
user set to run the BES.</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FONg.Tempdir=/tmp</pre>
</div>
</div>
<div class="paragraph">
<p>The next time the BES is started it will load this module. And, once
installed, the OLFS will know that it can use this module to transform
your data. You can get GeoTIFF or JPEG2000 responses for applicable
datasets by appending the extensions <em>.tiff</em> or <em>.jp2</em> to the dataset&#8217;s
OpenDAP URL.</p>
</div>
<div class="paragraph">
<p>If not using the OLFS to serve your data, for example if using the
bescmdln, you would run a command file that would look something like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;request reqID="some_unique_value" &gt;
    &lt;setContext name="dap_format"&gt;dap2&lt;/setContext&gt;
    &lt;setContainer name="c" space="catalog"&gt;data/nc/coads_climatology.nc&lt;/setContainer&gt;
    &lt;define name="d"&gt;
    &lt;container name="c" /&gt;
    &lt;/define&gt;
    &lt;get type="dods" definition="d" returnAs="tiff"/&gt;
&lt;/request&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to setting the directory where the response file is
initially built, you can use the <em>FONg.default_gcs</em> configuration
parameter to set the default Geographical Coordinate System (GCS) for
the handler. This GCS will be used when the dataset&#8217;s metadata
provides information GCS that the handler can not recognize.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hyrax-json">11.C.10. JSON Responses</h4>
<div class="sect4">
<h5 id="_overview_2">Overview</h5>
<div class="paragraph">
<p>With funding from the Australian Bureau of Meteorology we have developed
prototype JSON data and metadata responses for Hyrax. After reviewing
some the existing JSON encodings for DAP content we chose to implement
two prototype encodings.</p>
</div>
<div class="paragraph">
<p>The first, and most likely the most useful, is based on the
<a href="http://w10n.org/spec/">w10n specification</a> as
<a href="http://podaac-w10n.jpl.nasa.gov/tutorial/">realized by the good folks at
JPL</a>. This encoding utilizes an <em>abstract</em> model to capture the
structure of the dataset and it&#8217;s metadata. In this model the properties
of the JSON object are made of a controlled vocabulary. This means that
clients utilizing these responses can always "know" what to look for in
each returned object. No matter what dataset is being accessed the
client has a consistent mechanism for extracting variable names and
values.</p>
</div>
<div class="paragraph">
<p>The second encoding utilizes an "instance" representation model wherein
the datasets variable names are used to create the properties of the
returned object. This means that each dataset potentially has a
different set of properties and that client software must be written to
navigate each dataset. For data providers with large sets of homogeneous
holdings this representation allows the quick development of targeted
clients that can work with these data. However since the variable names
form the dataset become JSON properties there is no promise that the
JSON objects will actually be valid as variable names in DAP datasets
have few content restriction and the JSON property names must be valid
Javascript variable names. Because of this this second representation
probably doesn&#8217;t have the required flexibility to become an official
JSON representation for the DAP.</p>
</div>
<div class="paragraph">
<p>The intention is to develop this work (in particular the w10n
representation) into a DAP4 extension that defines the JSON
representation for the DAP4 data and metadata responses.</p>
</div>
<div class="sect5">
<h6 id="_details_2">Details</h6>
<div class="sect6">
<h7 id="_data_type_transform">Data Type Transform</h7>
<div class="dlist">
<dl>
<dt class="hdlist1">w10n </dt>
<dd>
<p>The w10n data model views the world as a directed graph of <strong>nodes</strong> and
<strong>leaves</strong>. This view starts at the catalog level and continues into
the structure of the datasets.
+</p>
<div class="ulist">
<ul>
<li>
<p>Only leaves are allowed to have data.</p>
</li>
<li>
<p>Both nodes and leaves have metadata (attributes).</p>
</li>
<li>
<p>Leaf data must be transmittable as either a single value, or an
N-dimensional array of values, of a simple type.
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Simple Types </dt>
<dd>
<p><strong>f</strong> - Floating point value</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This means that only DAP arrays of simple types and instances of simple
types may be represented as leaves. Everything else must be a node.</p>
</div>
<div class="paragraph">
<p>Since the DAP data model also can be seen as a directed graph the
mapping is nearly complete.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There may be incomplete matching with type space of the simple types
supported in both models.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Simple Types Type Map</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAP Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">w10n Type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt16</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float64</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Url</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(<strong>Needed</strong>: <em>A complete type list from w10n - In
<a href="http://w10n.org/spec/w10n-draft-20091228.html#anchor17">section 5.2.2 of
the w10n spec.</a> the <strong>type</strong> property for the leaf response is identified
but there is no listing of the allowed values presented. We are
expecting to get this information from JPL by 08/18/2014 at which point
I will complete this section and update the code to reflect the mapping
as stated here.</em>)</p>
</div>
<div class="sect7">
<h8 id="_unmapped_types">Unmapped Types</h8>
<div class="ulist">
<ul>
<li>
<p>The DAP allows arrays of complex types like structures and grids. No
w10n representation for this if offered.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_navigation">Navigation</h7>
<div class="paragraph">
<p>W10n defines a navigation component that allows the user to traverse the
directed graph of a collection of dataset holdings on the server. This
work is focused not on implementing the collection navigation aspects of
the w10n standard but rather on the JSON data and metadata
representations. Thus, DAP request URLs (and alternately HTTP Accepts
headers received from the requesting client) are used here to solicit
JSON encoded responses from the server. The use of DAP constraint
expressions (i.e. query strings) in the regular DAP manner in
conjunction with the DAP URL will have the typical effects on the
result. Subsetting by index, selection of variables, and subsetting by
value (where supported) will control what variables and what parts of
variables will be returned in the response.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_installation_2">Installation</h6>
<div class="paragraph">
<p>The JSON functionality is implemented as components of the OLFS and the
BES. The OLFS JSON code is built into the OLFS and is not an add-on. In
the BES the JSON support is contained in the
<a href="https://scm.opendap.org/svn/trunk/fileout_json/">fileout_json module</a>.
The file out_json module is now part of the Hyrax trunk (the
<a href="https://scm.opendap.org/trac/browser/trunk/shrew">shrew</a> project) and
part of the
<a href="https://scm.opendap.org/trac/browser/branch/shrew/hyrax_1.9_release">Hyrax-1.9
release</a> branch. The next minor release of the Hyrax server will contain
the JSON response capability.</p>
</div>
<div class="sect6">
<h7 id="_from_subversion_trunk">From Subversion Trunk</h7>
<div class="ulist">
<ul>
<li>
<p>Check out fileout_json from subversion:
<a href="https://scm.opendap.org/svn/trunk/fileout_json" class="bare">https://scm.opendap.org/svn/trunk/fileout_json</a></p>
</li>
<li>
<p>Compile and install it like any other BES module.</p>
</li>
<li>
<p>Check out the latest OLFS: <a href="https://scm.opendap.org/svn/trunk/olfs" class="bare">https://scm.opendap.org/svn/trunk/olfs</a></p>
</li>
<li>
<p>Compile and install as normal.</p>
</li>
<li>
<p>Start Hyrax and try it out.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_from_the_hyrax_1_9_release_branch">From the Hyrax-1.9 Release Branch</h7>
<div class="ulist">
<ul>
<li>
<p>Check out fileout_json from subversion:
<a href="https://scm.opendap.org/svn/branch/fileout_json/hyrax_1.9_release/" class="bare">https://scm.opendap.org/svn/branch/fileout_json/hyrax_1.9_release/</a></p>
</li>
<li>
<p>Compile and install it like any other BES module (be sure to use the
Hyrax-1.9 release BES)</p>
</li>
<li>
<p>Check out the latest OLFS:
<a href="https://scm.opendap.org/svn/branch/olfs/release/hyrax-1.9/" class="bare">https://scm.opendap.org/svn/branch/olfs/release/hyrax-1.9/</a></p>
</li>
<li>
<p>Compile and install as normal.</p>
</li>
<li>
<p>Start Hyrax and try it out.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_soliciting_the_json_response">Soliciting the JSON Response</h7>
<div class="paragraph">
<p>Let
datasetUrl=http://54.84.172.19:8080/opendap/data/nc/coads_climatology.nc</p>
</div>
</div>
<div class="sect6">
<h7 id="_dap4_requests">DAP4 Requests</h7>
<div class="paragraph">
<p>Using the DAP4 URLs to request both the DMR and the Data responses in a
JSON encoding.</p>
</div>
<div class="paragraph">
<p><strong>NB:</strong> <em>Currently what is returned is really a JSON encoding of the DAP
data (.dods) and metadata (.ddx) objects. When we have full DAP4 within
Hyrax these responses will return JSON version of the DAP4 DMR and Data
objects.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 w10n JSON Metadata request </dt>
<dd>
<p>datasetUrl.dmr.json</p>
</dd>
<dt class="hdlist1">DAP4 w10n JSON Data request </dt>
<dd>
<p>datasetUrl.dap.json</p>
</dd>
<dt class="hdlist1">DAP4 Instance Object Metadata request </dt>
<dd>
<p>datasetUrl.dmr.ijsn</p>
</dd>
<dt class="hdlist1">DAP4 Instance Object Data request </dt>
<dd>
<p>datasetUrl.dap.ijsn</p>
</dd>
</dl>
</div>
</div>
<div class="sect6">
<h7 id="_dap2_requests">DAP2 requests</h7>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP2 w10n JSON Data request </dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Entire Dataset </dt>
<dd>
<p>datasetUrl.json</p>
</dd>
<dt class="hdlist1">Just the variable named "COADSX" </dt>
<dd>
<p>datasetUrl.json?COADSX</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">DAP2 Instance Object JSON Data request </dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Entire Dataset </dt>
<dd>
<p>datasetUrl.ijsn</p>
</dd>
<dt class="hdlist1">Just the variable named "COADSX" </dt>
<dd>
<p>datasetUrl.ijsn?COADSX</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_examples">Examples</h6>
<div class="sect6">
<h7 id="_dataset_coads_climatology_nc">Dataset - coads_climatology.nc</h7>
<div class="paragraph">
<p>(I&#8217;m putting in the DAP2 dataset descriptions for now, the DAP4 will
follow)</p>
</div>
<div class="sect7">
<h8 id="_dds">DDS</h8>
<div class="paragraph">
<p>Here is the DDS for the grid dataset, our friend coads_climatology.nc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Float64 COADSX[COADSX = 180];
    Float64 COADSY[COADSY = 90];
    Float64 TIME[TIME = 12];
    Grid {
      Array:
        Float32 SST[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } SST;
    Grid {
      Array:
        Float32 AIRT[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } AIRT;
    Grid {
      Array:
        Float32 UWND[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } UWND;
    Grid {
      Array:
        Float32 VWND[TIME = 12][COADSY = 90][COADSX = 180];
      Maps:
        Float64 TIME[TIME = 12];
        Float64 COADSY[COADSY = 90];
        Float64 COADSX[COADSX = 180];
    } VWND;
} coads_climatology.nc;</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_das">DAS</h8>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    COADSX {
        String units "degrees_east";
        String modulo " ";
        String point_spacing "even";
    }
    COADSY {
        String units "degrees_north";
        String point_spacing "even";
    }
    TIME {
        String units "hour since 0000-01-01 00:00:00";
        String time_origin "1-JAN-0000 00:00:00";
        String modulo " ";
    }
    SST {
        Float32 missing_value -9.99999979e+33;
        Float32 _FillValue -9.99999979e+33;
        String long_name "SEA SURFACE TEMPERATURE";
        String history "From coads_climatology";
        String units "Deg C";
    }
    AIRT {
        Float32 missing_value -9.99999979e+33;
        Float32 _FillValue -9.99999979e+33;
        String long_name "AIR TEMPERATURE";
        String history "From coads_climatology";
        String units "DEG C";
    }
    UWND {
        Float32 missing_value -9.99999979e+33;
        Float32 _FillValue -9.99999979e+33;
        String long_name "ZONAL WIND";
        String history "From coads_climatology";
        String units "M/S";
    }
    VWND {
        Float32 missing_value -9.99999979e+33;
        Float32 _FillValue -9.99999979e+33;
        String long_name "MERIDIONAL WIND";
        String history "From coads_climatology";
        String units "M/S";
    }
    NC_GLOBAL {
        String history "FERRET V4.30 (debug/no GUI) 15-Aug-96";
    }
    DODS_EXTRA {
        String Unlimited_Dimension "TIME";
    }
}</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_ddx">DDX</h8>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;Dataset name="coads_climatology.nc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xml.opendap.org/ns/DAP/3.2# http://xml.opendap.org/dap/dap3.2.xsd" xmlns:grddl="http://www.w3.org/2003/g/data-view#" grddl:transformation="http://xml.opendap.org/transforms/ddxToRdfTriples.xsl" xmlns="http://xml.opendap.org/ns/DAP/3.2#" xmlns:dap="http://xml.opendap.org/ns/DAP/3.2#" dapVersion="3.2" xmlns:xml="http://www.w3.org/XML/1998/namespace" xml:base="http://54.84.172.19:8080/opendap/data/nc/coads_climatology.nc"&gt;
    &lt;Attribute name="NC_GLOBAL" type="Container"&gt;
        &lt;Attribute name="history" type="String"&gt;
            &lt;value&gt;FERRET V4.30 (debug/no GUI) 15-Aug-96&lt;/value&gt;
        &lt;/Attribute&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="DODS_EXTRA" type="Container"&gt;
        &lt;Attribute name="Unlimited_Dimension" type="String"&gt;
            &lt;value&gt;TIME&lt;/value&gt;
        &lt;/Attribute&gt;
    &lt;/Attribute&gt;
    &lt;Array name="COADSX"&gt;
        &lt;Attribute name="units" type="String"&gt;
            &lt;value&gt;degrees_east&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="modulo" type="String"&gt;
            &lt;value&gt; &lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="point_spacing" type="String"&gt;
            &lt;value&gt;even&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Float64/&gt;
        &lt;dimension name="COADSX" size="180"/&gt;
    &lt;/Array&gt;
    &lt;Array name="COADSY"&gt;
        &lt;Attribute name="units" type="String"&gt;
            &lt;value&gt;degrees_north&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="point_spacing" type="String"&gt;
            &lt;value&gt;even&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Float64/&gt;
        &lt;dimension name="COADSY" size="90"/&gt;
    &lt;/Array&gt;
    &lt;Array name="TIME"&gt;
        &lt;Attribute name="units" type="String"&gt;
            &lt;value&gt;hour since 0000-01-01 00:00:00&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="time_origin" type="String"&gt;
            &lt;value&gt;1-JAN-0000 00:00:00&lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="modulo" type="String"&gt;
            &lt;value&gt; &lt;/value&gt;
        &lt;/Attribute&gt;
        &lt;Float64/&gt;
        &lt;dimension name="TIME" size="12"/&gt;
    &lt;/Array&gt;
    &lt;Grid name="SST"&gt;
        &lt;Array name="SST"&gt;
            &lt;Attribute name="missing_value" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="_FillValue" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="long_name" type="String"&gt;
                &lt;value&gt;SEA SURFACE TEMPERATURE&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="history" type="String"&gt;
                &lt;value&gt;From coads_climatology&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;Deg C&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float32/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Array&gt;
        &lt;Map name="TIME"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;hour since 0000-01-01 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="time_origin" type="String"&gt;
                &lt;value&gt;1-JAN-0000 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSY"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_north&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSX"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_east&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Map&gt;
    &lt;/Grid&gt;
    &lt;Grid name="AIRT"&gt;
        &lt;Array name="AIRT"&gt;
            &lt;Attribute name="missing_value" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="_FillValue" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="long_name" type="String"&gt;
                &lt;value&gt;AIR TEMPERATURE&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="history" type="String"&gt;
                &lt;value&gt;From coads_climatology&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;DEG C&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float32/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Array&gt;
        &lt;Map name="TIME"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;hour since 0000-01-01 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="time_origin" type="String"&gt;
                &lt;value&gt;1-JAN-0000 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSY"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_north&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSX"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_east&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Map&gt;
    &lt;/Grid&gt;
    &lt;Grid name="UWND"&gt;
        &lt;Array name="UWND"&gt;
            &lt;Attribute name="missing_value" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="_FillValue" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="long_name" type="String"&gt;
                &lt;value&gt;ZONAL WIND&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="history" type="String"&gt;
                &lt;value&gt;From coads_climatology&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;M/S&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float32/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Array&gt;
        &lt;Map name="TIME"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;hour since 0000-01-01 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="time_origin" type="String"&gt;
                &lt;value&gt;1-JAN-0000 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSY"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_north&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSX"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_east&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Map&gt;
    &lt;/Grid&gt;
    &lt;Grid name="VWND"&gt;
        &lt;Array name="VWND"&gt;
            &lt;Attribute name="missing_value" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="_FillValue" type="Float32"&gt;
                &lt;value&gt;-9.99999979e+33&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="long_name" type="String"&gt;
                &lt;value&gt;MERIDIONAL WIND&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="history" type="String"&gt;
                &lt;value&gt;From coads_climatology&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;M/S&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float32/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Array&gt;
        &lt;Map name="TIME"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;hour since 0000-01-01 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="time_origin" type="String"&gt;
                &lt;value&gt;1-JAN-0000 00:00:00&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="TIME" size="12"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSY"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_north&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSY" size="90"/&gt;
        &lt;/Map&gt;
        &lt;Map name="COADSX"&gt;
            &lt;Attribute name="units" type="String"&gt;
                &lt;value&gt;degrees_east&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="modulo" type="String"&gt;
                &lt;value&gt; &lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Attribute name="point_spacing" type="String"&gt;
                &lt;value&gt;even&lt;/value&gt;
            &lt;/Attribute&gt;
            &lt;Float64/&gt;
            &lt;dimension name="COADSX" size="180"/&gt;
        &lt;/Map&gt;
    &lt;/Grid&gt;
    &lt;blob href="cid:"/&gt;
&lt;/Dataset&gt;</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_dmr">DMR</h8>
<div class="paragraph">
<p>Coming Soon&#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_w10n_json_abstract_model">w10n JSON (Abstract Model)</h7>
<div class="sect7">
<h8 id="_metadata_responses">Metadata Responses</h8>

</div>
<div class="sect7">
<h8 id="_single_variable_selection">Single Variable Selection</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dmr.json?dap4.ce=COADSX</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "name": "coads_climatology.nc",
  "attributes": [
    {
      "name": "NC_GLOBAL",
      "attributes": [
        {"name": "history", "value": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]}
      ]
    },
    {
      "name": "DODS_EXTRA",
      "attributes": [
        {"name": "Unlimited_Dimension", "value": ["TIME"]}
      ]
    }
  ],
  "leaves": [
    {
      "name": "COADSX",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_east"]},
        {"name": "modulo", "value": [" "]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [180]
    }
  ],
  "nodes": []
}</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_entire_dataset">Entire Dataset</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dmr.json</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "name": "coads_climatology.nc",
  "attributes": [
    {
      "name": "NC_GLOBAL",
      "attributes": [
        {"name": "history", "value": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]}
      ]
    },
    {
      "name": "DODS_EXTRA",
      "attributes": [
        {"name": "Unlimited_Dimension", "value": ["TIME"]}
      ]
    }
  ],
  "leaves": [
    {
      "name": "COADSX",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_east"]},
        {"name": "modulo", "value": [" "]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [180]
    },
    {
      "name": "COADSY",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_north"]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [90]
    },
    {
      "name": "TIME",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
        {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
        {"name": "modulo", "value": [" "]}
      ],
      "shape": [12]
    }
  ],
  "nodes": [
    {
      "name": "SST",
      "attributes": [],
      "leaves": [
        {
          "name": "SST",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["SEA SURFACE TEMPERATURE"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["Deg C"]}
          ],
          "shape": [12,90,180]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180]
        }
      ],
      "nodes": []
    }
    {
      "name": "AIRT",
      "attributes": [],
      "leaves": [
        {
          "name": "AIRT",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["AIR TEMPERATURE"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["DEG C"]}
          ],
          "shape": [12,90,180]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180]
        }
      ],
      "nodes": []
    }
    {
      "name": "UWND",
      "attributes": [],
      "leaves": [
        {
          "name": "UWND",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["ZONAL WIND"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["M/S"]}
          ],
          "shape": [12,90,180]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180]
        }
      ],
      "nodes": []
    }
    {
      "name": "VWND",
      "attributes": [],
      "leaves": [
        {
          "name": "VWND",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["MERIDIONAL WIND"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["M/S"]}
          ],
          "shape": [12,90,180]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180]
        }
      ],
      "nodes": []
    }
 
  ]
}</pre>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_data_responses">Data Responses</h7>
<div class="sect7">
<h8 id="_single_variable_selection_2">Single Variable Selection</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dap.json?dap4.ce=COADSX</strong></em></p>
</dd>
<dt class="hdlist1">DAP2 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.json?COADSX</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "name": "coads_climatology.nc",
  "attributes": [
    {
      "name": "NC_GLOBAL",
      "attributes": [
        {"name": "history", "value": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]}
      ]
    },
    {
      "name": "DODS_EXTRA",
      "attributes": [
        {"name": "Unlimited_Dimension", "value": ["TIME"]}
      ]
    }
  ],
  "leaves": [
    {
      "name": "COADSX",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_east"]},
        {"name": "modulo", "value": [" "]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [180],
      "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
    }
  ],
  "nodes": []
}</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_entire_dataset_2">Entire Dataset</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dap.json</strong></em></p>
</dd>
<dt class="hdlist1">DAP2 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.json</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "name": "coads_climatology.nc",
  "attributes": [
    {
      "name": "NC_GLOBAL",
      "attributes": [
        {"name": "history", "value": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]}
      ]
    },
    {
      "name": "DODS_EXTRA",
      "attributes": [
        {"name": "Unlimited_Dimension", "value": ["TIME"]}
      ]
    }
  ],
  "leaves": [
    {
      "name": "COADSX",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_east"]},
        {"name": "modulo", "value": [" "]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [180],
      "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
    },
    {
      "name": "COADSY",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["degrees_north"]},
        {"name": "point_spacing", "value": ["even"]}
      ],
      "shape": [90],
      "data": [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89]
    },
    {
      "name": "TIME",
      "type": "f",
      "attributes": [
        {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
        {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
        {"name": "modulo", "value": [" "]}
      ],
      "shape": [12],
      "data": [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33]
    }
  ],
  "nodes": [
    {
      "name": "SST",
      "attributes": [],
      "leaves": [
        {
          "name": "SST",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["SEA SURFACE TEMPERATURE"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["Deg C"]}
          ],
          "shape": [12,90,180],
          "data": [[[-1e+34, -1e+34, -1e+34, … (many values skipped for brevity),  -1e+34, -1e+34, -1e+34]]]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12],
          "data": [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90],
          "data": [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180],
          "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
        }
      ],
      "nodes": []
    }
    {
      "name": "AIRT",
      "attributes": [],
      "leaves": [
        {
          "name": "AIRT",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["AIR TEMPERATURE"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["DEG C"]}
          ],
          "shape": [12,90,180],
          "data": [[[-1e+34, -1e+34, -1e+34, … (many values skipped for brevity),  -1e+34, -1e+34, -1e+34]]]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12],
          "data": [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90],
          "data": [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180],
          "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
        }
      ],
      "nodes": []
    }
    {
      "name": "UWND",
      "attributes": [],
      "leaves": [
        {
          "name": "UWND",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["ZONAL WIND"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["M/S"]}
          ],
          "shape": [12,90,180],
          "data": [[[-1e+34, -1e+34, -1e+34, … (many values skipped for brevity),  -1e+34, -1e+34, -1e+34]]]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12],
          "data": [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90],
          "data": [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180],
          "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
        }
      ],
      "nodes": []
    }
    {
      "name": "VWND",
      "attributes": [],
      "leaves": [
        {
          "name": "VWND",
          "type": "f",
          "attributes": [
            {"name": "missing_value", "value": [-9.99999979e+33]},
            {"name": "_FillValue", "value": [-9.99999979e+33]},
            {"name": "long_name", "value": ["MERIDIONAL WIND"]},
            {"name": "history", "value": ["From coads_climatology"]},
            {"name": "units", "value": ["M/S"]}
          ],
          "shape": [12,90,180],
          "data": [[[-1e+34, -1e+34, -1e+34, … (many values skipped for brevity),  -1e+34, -1e+34, -1e+34]]]
        },
        {
          "name": "TIME",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["hour since 0000-01-01 00:00:00"]},
            {"name": "time_origin", "value": ["1-JAN-0000 00:00:00"]},
            {"name": "modulo", "value": [" "]}
          ],
          "shape": [12],
          "data": [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33]
        },
        {
          "name": "COADSY",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_north"]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [90],
          "data": [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89]
        },
        {
          "name": "COADSX",
          "type": "f",
          "attributes": [
            {"name": "units", "value": ["degrees_east"]},
            {"name": "modulo", "value": [" "]},
            {"name": "point_spacing", "value": ["even"]}
          ],
          "shape": [180],
          "data": [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
        }
      ],
      "nodes": []
    }
 
  ]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_instance_model_json">Instance Model JSON</h6>
<div class="sect6">
<h7 id="_metadata_responses_2">Metadata Responses</h7>
<div class="sect7">
<h8 id="_single_variable_selection_3">Single Variable Selection</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dmr.ijsn?dap4.ce=COADSX</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
 "name": "coads_climatology.nc",
 "NC_GLOBAL": {
   "history": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]
 },
 "DODS_EXTRA": {
   "Unlimited_Dimension": ["TIME"]
 },
 "COADSX":  {
   "units": ["degrees_east"],
   "modulo": [" "],
   "point_spacing": ["even"]
 }
}</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_entire_dataset_3">Entire Dataset</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dmr.ijsn</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
 "name": "coads_climatology.nc",
 "NC_GLOBAL": {
   "history": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]
 },
 "DODS_EXTRA": {
   "Unlimited_Dimension": ["TIME"]
 },
 "COADSX":  {
   "units": ["degrees_east"],
   "modulo": [" "],
   "point_spacing": ["even"]
 },
 "COADSY":  {
   "units": ["degrees_north"],
   "point_spacing": ["even"]
 },
 "TIME":  {
   "units": ["hour since 0000-01-01 00:00:00"],
   "time_origin": ["1-JAN-0000 00:00:00"],
   "modulo": [" "]
 },
 "SST": {
  "SST":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["SEA SURFACE TEMPERATURE"],
    "history": ["From coads_climatology"],
    "units": ["Deg C"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "AIRT": {
  "AIRT":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["AIR TEMPERATURE"],
    "history": ["From coads_climatology"],
    "units": ["DEG C"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "UWND": {
  "UWND":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["ZONAL WIND"],
    "history": ["From coads_climatology"],
    "units": ["M/S"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "VWND": {
  "VWND":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["MERIDIONAL WIND"],
    "history": ["From coads_climatology"],
    "units": ["M/S"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
 "name": "coads_climatology.nc",
 "NC_GLOBAL": {
   "history": ["FERRET V4.30 (debug/no GUI) 15-Aug-96"]
 },
 "DODS_EXTRA": {
   "Unlimited_Dimension": ["TIME"]
 },
 "COADSX":  {
   "units": ["degrees_east"],
   "modulo": [" "],
   "point_spacing": ["even"]
 },
 "COADSY":  {
   "units": ["degrees_north"],
   "point_spacing": ["even"]
 },
 "TIME":  {
   "units": ["hour since 0000-01-01 00:00:00"],
   "time_origin": ["1-JAN-0000 00:00:00"],
   "modulo": [" "]
 },
 "SST": {
  "SST":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["SEA SURFACE TEMPERATURE"],
    "history": ["From coads_climatology"],
    "units": ["Deg C"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "AIRT": {
  "AIRT":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["AIR TEMPERATURE"],
    "history": ["From coads_climatology"],
    "units": ["DEG C"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "UWND": {
  "UWND":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["ZONAL WIND"],
    "history": ["From coads_climatology"],
    "units": ["M/S"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 },
 "VWND": {
  "VWND":  {
    "missing_value": [-9.99999979e+33],
    "_FillValue": [-9.99999979e+33],
    "long_name": ["MERIDIONAL WIND"],
    "history": ["From coads_climatology"],
    "units": ["M/S"]
  },
  "TIME":  {
    "units": ["hour since 0000-01-01 00:00:00"],
    "time_origin": ["1-JAN-0000 00:00:00"],
    "modulo": [" "]
  },
  "COADSY":  {
    "units": ["degrees_north"],
    "point_spacing": ["even"]
  },
  "COADSX":  {
    "units": ["degrees_east"],
    "modulo": [" "],
    "point_spacing": ["even"]
  }
 }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_data_responses_2">Data Responses</h7>
<div class="sect7">
<h8 id="_single_variable_selection_4">Single Variable Selection</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL.dap<strong>.ijsn?dap4.ce=COADSX</strong></em></p>
</dd>
<dt class="hdlist1">DAP2 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.ijsn?COADSX</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
 "name": "coads_climatology.nc",
 "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
}</pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_entire_dataset_4">Entire Dataset</h8>
<div class="dlist">
<dl>
<dt class="hdlist1">DAP4 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.dap.ijsn</strong></em></p>
</dd>
<dt class="hdlist1">DAP2 Request URL </dt>
<dd>
<p><em>datasetURL<strong>.ijsn</strong></em></p>
</dd>
<dt class="hdlist1">Response </dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
 "name": "coads_climatology.nc",
 "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379],
 "COADSY":  [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89],
 "TIME":  [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33],
 "SST": {
  "SST":  [[[-1e+34, -1e+34, -1e+34, … (Many values omitted for brevity), -1e+34, -1e+34, -1e+34]]],
  "TIME":  [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33],
  "COADSY":  [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89],
  "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
 },
 "AIRT": {
  "AIRT":  [[[-1e+34, -1e+34, -1e+34, … (Many values omitted for brevity), -1e+34, -1e+34, -1e+34]]],
  "TIME":  [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33],
  "COADSY":  [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89],
  "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
 },
 "UWND": {
  "UWND":  [[[-1e+34, -1e+34, -1e+34, … (Many values omitted for brevity), -1e+34, -1e+34, -1e+34]]],
  "TIME":  [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33],
  "COADSY":  [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89],
  "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
 },
 "VWND": {
  "VWND":  [[[-1e+34, -1e+34, -1e+34, … (Many values omitted for brevity), -1e+34, -1e+34, -1e+34]]],
  "TIME":  [366, 1096.49, 1826.97, 2557.45, 3287.94, 4018.43, 4748.91, 5479.4, 6209.88, 6940.36, 7670.85, 8401.33],
  "COADSY":  [-89, -87, -85, -83, -81, -79, -77, -75, -73, -71, -69, -67, -65, -63, -61, -59, -57, -55, -53, -51, -49, -47, -45, -43, -41, -39, -37, -35, -33, -31, -29, -27, -25, -23, -21, -19, -17, -15, -13, -11, -9, -7, -5, -3, -1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89],
  "COADSX":  [21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 257, 259, 261, 263, 265, 267, 269, 271, 273, 275, 277, 279, 281, 283, 285, 287, 289, 291, 293, 295, 297, 299, 301, 303, 305, 307, 309, 311, 313, 315, 317, 319, 321, 323, 325, 327, 329, 331, 333, 335, 337, 339, 341, 343, 345, 347, 349, 351, 353, 355, 357, 359, 361, 363, 365, 367, 369, 371, 373, 375, 377, 379]
 }
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Maybe this should its own own Appendix - just like Server
functions and aggregations which are really loaded in via the module
system, get their own appendix
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gateway-module">11.C.11. The Gateway Module</h4>
<div class="sect4">
<h5 id="_introduction_10">Introduction</h5>
<div class="paragraph">
<p>The Gateway Service provides interoperability between Hyrax and other
web services. Using the Gateway module, Hyrax can be used to access and
subset data served by other web services so long as those services
return the data in a form Hyrax has been configured to serve. For
example, if a web service returns data using HDF4 files, then Hyrax,
using the gateway module, can subset and return DAP responses for those
data.</p>
</div>
</div>
<div class="sect4">
<h5 id="_special_options_supported_by_the_handler">Special Options Supported by the Handler</h5>
<div class="sect5">
<h6 id="_limiting_access_to_specific_hosts">Limiting Access to Specific Hosts</h6>
<div class="paragraph">
<p>Because this handler behaves like a web <em>client</em> there are some special
options that need to be configured to make it work. When we distribute
the client, it is limited to accessing only the local host. This
prevents misuse (where your copy of Hyrax might be used to access all
kinds of other sites). This gateway&#8217;s configuration file contains a
'whitelist' of allowed hosts. Only hosts listed on the whitelist will be
accessed by the gateway.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Gateway.Whitelist</dt>
<dd>
<p>provides a list of URL of the form <em>protocol://host.domain:port</em> that
will be passed through the gateway module. If a request is made to
access a web service not listed on the Whitelist, Hyrax returns an
error. Note that the whitelist can be more specific than just a
hostname - it could in principal limit access to a specific set of
requests to a particular web service.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Gateway.Whitelist=http://test.opendap.org/opendap
Gateway.Whitelist+=http://opendap.rpi.edu/opendap</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_recognizing_responses">Recognizing Responses</h6>
<div class="dlist">
<dl>
<dt class="hdlist1">Gateway.MimeTypes</dt>
<dd>
<p>provides a list of mappings from data handler module to returned mime
types. When the remote service returns a response, if that response
contains one of the listed MIME types (e.g., <em>application/x-hdf5</em>)
then the gateway will process it using the named handler (e.g.,
<em>h5</em>). Note that if the service does not include this information
the gateway will try other ways to figure out how to work with the
response.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These are the default types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Gateway.MimeTypes=nc:application/x-netcdf
Gateway.MimeTypes+=h4:application/x-hdf
Gateway.MimeTypes+=h5:application/x-hdf5</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_network_proxies_and_performance_optimizations">Network Proxies and Performance Optimizations</h6>
<div class="paragraph">
<p>There are four parameters that are used to configure a proxy server that
the gateway will use. Nominally this is used as a cache, so that files
do not have to be repeatedly fetched from the remote service and that&#8217;s
why we consider this a 'performance' feature. We have tested the hander
with Squid because it is widely used on both linux and OS/X and because
in addition to it&#8217;s proxy capabilities, it is often used as a cache.
This can also be used to navigate firewalls.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Gateway.ProxyProtocol</dt>
<dd>
<p>Which protocol(s) does this proxy support. Nominally this should be
<em>http</em>.</p>
</dd>
<dt class="hdlist1">Gateway.ProxyHost</dt>
<dd>
<p>On what host does the proxy server operate? Often you want to use
<em>localgost</em> for this.</p>
</dd>
<dt class="hdlist1">Gateway.ProxyPort</dt>
<dd>
<p>What port does the proxy listen on? Squid defaults to <em>3218</em>; some
documentation for web accelerators</p>
</dd>
<dt class="hdlist1">Gateway.NoProxy</dt>
<dd>
<p>Provide a regular expression that describes URLs that should <em>not</em> be
sent to the proxy. This is particularly useful for running the gateway
on the hosts that stage the service accessed via the gateway. In this
cases, a proxy/cache like squid may not process 'localhost' URLs
unless its configuration is tweaked quite a bit (and there may be no
performance advantage to having the proxy/cache store extra copies of
the files given that they are on the host already). This parameter was
added in version 1.1.0.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Gateway.ProxyProtocol=
Gateway.ProxyHost=
Gateway.ProxyPort=
Gateway.NoProxy=</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_squid">Using Squid</h5>
<div class="paragraph">
<p>Squid makes a great cache for the gateway. In our testing we have used
Squid only for services running on port 80.</p>
</div>
<div class="paragraph">
<p>Squid is a powerful tool and it is worth looking at its
<a href="http://www.squid-cache.org/">web page</a>.</p>
</div>
<div class="sect5">
<h6 id="_squid_and_dynamic_content">Squid and Dynamic Content</h6>
<div class="paragraph">
<p>Squid follows the HTTP/1.1 specification to determine what and how long
to cache items. However, you may want to force Squid to ignore some of
the information supplied by certain web services (or to different
default values when the standard information is not present). If you are
working with a web server that does not include caching control headers
in its responses but does have 'cgi-bin' or '?' in the URL, here&#8217;s how
override Squid&#8217;s default behavior (which is to never cache items
returned from a 'dynamic' source (i.e., one with 'cgi-bin' or '?' in the
URL). The value below will cause Squid to cache response from a dynamic
source for 1440 minutes unless that response includes an Expires: header
telling to cache to behave differently</p>
</div>
<div class="paragraph">
<p>In the squid configuration file, find the lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># refresh patterns (squid-recommended)
refresh_pattern ^ftp:       1440    20% 10080
refresh_pattern ^gopher:    1440    0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%  0
refresh_pattern .       0   20% 4320</pre>
</div>
</div>
<div class="paragraph">
<p>And change the third refresh_pattern to read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">refresh_pattern -i (/cgi-bin/|\?) 1440  20% 10080</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_can_i_tell_if_a_service_sends_cache_control_headers">How can I tell if a service sends Cache Control headers?</h6>
<div class="paragraph">
<p>Here are two ways to check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <a href="http://www.ircache.net/cgi-bin/cacheability.py" class="bare">http://www.ircache.net/cgi-bin/cacheability.py</a></p>
</li>
<li>
<p><em>curl -i &lt;URL&gt; | more</em> and look at the headers at the top of the
message.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_using_squid_on_osx">Using Squid on OS/X</h6>
<div class="paragraph">
<p>If you&#8217;re using OS/X to run Hyrax, the easiest Squid port is
<a href="http://web.me.com/adg/squidman/index.html">SquidMan</a>. We tested version
SquidMan 3.0 (Squid 3.1.1). Run the SquidMan application and under
<em>Preferences&#8230;&#8203; General</em> set the port to something like 3218, the cache
size to something big (16GB) and Maximum object size to 256M. Click
'Save' and you&#8217;re almost done.</p>
</div>
<div class="paragraph">
<p>Now in the <em>gateway.conf</em> file, set the proxy parameters like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Gateway.ProxyProtocol=http
Gateway.ProxyHost=localhost
Gateway.ProxyPort=3218
Gateway.NoProxy=http://localhost.*</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;assuming you&#8217;re running both Squid and Hyrax on the same host.</p>
</div>
<div class="paragraph">
<p>Restart the BES and you&#8217;re all set.</p>
</div>
<div class="paragraph">
<p>To test, make some requests using the gateway
(<a href="http://localhost/opendap/gateway" class="bare">http://localhost/opendap/gateway</a>) and click on SquidMan&#8217;s 'Access Log'
button to see the caching at work. The first access, which fetches the
data, will say <em>DIRECT/&lt;ip number&gt;</em> while cache hits will be labeled
<em>NONE/-</em>.</p>
</div>
<div class="sect6">
<h7 id="_squid_osx_and_caching_dynamic_content">Squid, OS/X and Caching Dynamic Content</h7>
<div class="paragraph">
<p>By default SquidMan does not cache dynamic content that lacks cache
control headers in the response. To hack the squid.conf file and make
the change in the <em>refresh_pattern</em> described above do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Under Preferences&#8230;&#8203; choose the 'Template' tab and scroll to the
bottom of the
text; <span class="image"><img src="./images/Edit_the_squid.conf_file.png" alt="Edit the squid.conf file"></span></p>
</li>
<li>
<p>Edit the line, replacing "0 0% 0" with "1440 20% 10080"; and</p>
</li>
<li>
<p>'Save' and then 'Stop Squid' and 'Start Squid' (note the helpful
status messages in the 'Start/Stop' window)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/Squid_1.png" alt="Squid 1"></span>
<span class="image"><img src="./images/Squid_2.png" alt="Squid 2"></span>
<span class="image"><img src="./images/Squid_3.png" alt="Squid 3"></span></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_known_problems_6">Known Problems</h5>
<div class="paragraph">
<p>For version 1.0.1 of the gateway, we know about the following problems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Squid does not cache requests to localhost, but our use of the proxy
server does not by-pass requests to localhost. Thus, using the gateway
to access data from a service running on localhost will fail when using
squid since the gateway will route the request to the proxy (i.e.,
squid) where it will generate an error.</p>
</li>
<li>
<p>Not using a caching proxy server will result in poor performance.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I think we should group all of the 'other services' that Hyrax provides
so that it&#8217;s obvious that&#8217;s what&#8217;s going on. The server provides the DAP API,
but it also provides the Gateway service, Aggregation service, WMS, and (soon)
WCS. All these services have their own web API.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gateway-service">11.C.12. Gateway Service</h4>
<div class="sect4">
<h5 id="_gateway_service_overview">Gateway Service Overview</h5>
<div class="paragraph">
<p><span class="image"><img src="./images/Gateway_service.jpg" alt="Gateway service"></span></p>
</div>
<div class="paragraph">
<p>The Gateway Service provides Hyrax with the ability to apply DAP
constraint expressions and server side functions to data available
through any network URL. This is accomplished by encoding the data
source URL into the DAP request URL supplied to the gateway_service. The
Gateway Service decodes the URL and uses the BES to to retrieve the
remote data resource and transmit the appropriate DAP response back to
the client. The system employs a white list to control what data systems
the BES will access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Rewrite this to explain that we are providing a kind of 'URL
enveloping' scheme. If we are still actually using this. jhrg 9/19/17
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Data Service Portal (DSP), such as Mirador will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide the navigation/search/discovery interface to the data source.</p>
</li>
<li>
<p>Generate the data source URLs.</p>
</li>
<li>
<p>Encode the data source URLs.</p>
</li>
<li>
<p>Build a regular DAP query as the DAP dataset ID.</p>
</li>
<li>
<p>Hand this to the client (via a link or what have you in the DSP
interface)</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_bes_gateway_module">BES Gateway Module</h6>
<div class="paragraph">
<p>The Gateway Module handles the gathering of the remote data resource and
the construction of the DAP response.</p>
</div>
<div class="paragraph">
<p>The Gateway Module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evaluates the data source URL against a white list to access
permission</p>
</li>
<li>
<p>Retrieves remote data source</p>
</li>
<li>
<p>Determines data type by:</p>
<div class="ulist">
<ul>
<li>
<p>Data type information supplied by the other parts of the server</p>
</li>
<li>
<p>HTTP Content-Disposition header</p>
</li>
<li>
<p>Applying the BES.TypeMatch string to the last term in the path
section of the data source URL.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The BES will <strong>not</strong> persist the data resources beyond the scope of each
request.</p>
</div>
</div>
<div class="sect5">
<h6 id="_olfs_gateway_service">OLFS Gateway Service</h6>
<div class="paragraph">
<p>The Gateway Service is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoding the incoming dataset URLs.</p>
</li>
<li>
<p>Building the request for the BES.</p>
</li>
<li>
<p>Returning the response from the BES to the client.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_encoding_data_source_urls">Encoding Data Source URLs</h6>
<div class="paragraph">
<p>The data source URLs need to be encoded in the DAP data request URL that
is used to access the Gateway Service.</p>
</div>
<div class="paragraph">
<p>There are many ways to encode something in this context.</p>
</div>
<div class="sect6">
<h7 id="_prototype_encoding">Prototype Encoding</h7>
<div class="paragraph">
<p>As a prototype encoding we&#8217;ll use an hex ascii encoding. In this
encoding each character in the data source URL is expressed as is
hexadecimal value using ascii characters.</p>
</div>
<div class="paragraph">
<p>Here is
<a href="http://www.opendap.org/pub/gateway_service/hexEncoder.tgz">hexEncoder.tgz</a>
(<a href="http://www.opendap.org/pub/gateway_service/hexEncoder.tgz.sig">sig</a>), a
gzipped tar file containing a java application can perform the encoding
and decoding duties from the command line. Give it a whirl - it&#8217;s a java
application in a jar file. There is a bash script (hexEncode) that
should launch it.</p>
</div>
<div class="paragraph">
<p>The source code for the EncodeDecode java class used by hexEncode is
available here:
<a href="http://scm.opendap.org/svn/trunk/olfs/src/opendap/gateway/EncodeDecode.java" class="bare">http://scm.opendap.org/svn/trunk/olfs/src/opendap/gateway/EncodeDecode.java</a></p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Encoding a simple URL</div>
<div class="content">
<div class="paragraph">
<p>stringToHex(<a href="http://www.google.com" class="bare">http://www.google.com</a>) &#8594; 687474703a2f2f7777772e676f6f676c652e636f6d</p>
</div>
<div class="paragraph">
<p>hexToString(687474703a2f2f7777772e676f6f676c652e636f6d) &#8594; <a href="http://www.google.com" class="bare">http://www.google.com</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="freeform-data-handler">Appendix D: The FreeForm Data Handler</h3>
<div class="paragraph">
<p>This section of the documentation describes the
OPeNDAP FreeForm ND Data Handler, which can
be used with the OPeNDAP data server. It is not a complete description
of the FreeForm ND software. For that, please refer to the ND manual.</p>
</div>
<div class="paragraph">
<p>This section contains much material originally written at the National
Oceanic and Atmospheric Administration&#8217;s National Environmental
Satellite, Data, and Information Service, which is part of the National
Geophysical Data Center in Boulder, Colorado.</p>
</div>
<div class="paragraph">
<p>Using FreeForm ND with OPeNDAP, a researcher can easily make his or her
data available to the wider community of OPeNDAP users without having to
convert that data into another data file format. This document presents
the FreeForm ND software, and shows how to use it with the OPeNDAP
server.</p>
</div>
<div class="sect3">
<h4 id="dintro">11.D.1. Introduction</h4>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler is an OPeNDAP data handler.
OPeNDAP FreeForm ND software can serve data from files in almost any format. The
FreeForm ND Data Access System is a flexible system for specifying
data formats to facilitate data access, management, and use. Since
DAP2 allows data to be translated over the internet and read by a
client regardless of the storage format of the data, the combination
can overcome several format restrictions.</p>
</div>
<div class="paragraph">
<p>The large variety of data formats is a primary obstacle in creation of
flexible data management and analysis software. FreeForm ND
was conceived, developed, and implemented at the National Geophysical
Data Center (NGDC) to alleviate the problems that occur when one needs
to use data sets with varying native formats or to write
format-independent applications.</p>
</div>
<div class="paragraph">
<p>DAP2 was originally conceived as a way to move large amounts of
scientific data over the internet.  As a consequence of establishing a
flexible data transmission format, DAP2 also allows substantial
independence from the storage format of the original data.  Up to now,
however, DAP2 servers have been limited to data in a few widely used
formats.  Using the OPeNDAP FreeForm ND Data Handler,
many more datasets can be made available through DAP2.</p>
</div>
<div class="sect4">
<h5 id="_the_freeform_nd_solution">The FreeForm ND Solution</h5>
<div class="paragraph">
<p>OPeNDAP FreeForm ND uses a <em>format descriptor</em> file to describe the format
of one or more data files.  This descriptor file is a simple text file
that can be created with a text editor, and it describes the structure of
your data files.</p>
</div>
<div class="paragraph">
<p>A traditional DAP2 server, illustrated <a href="#dintro-image-01">below</a>,
receives a request for data from a DAP2 client who may be at some
remote computer <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.
The data served by this server must be stored in one of the data
formats supported by the OPeNDAP server (such as netCDF, HDF, or
JGOFS), and the server uses specialized software to read this data
from disk.</p>
</div>
<div class="paragraph">
<p>When it receives a request, the server reads the requested data from
its archive, reformats the data into the DAP2 transmission format and
sends the data back to the client.</p>
</div>
<div id="dintro-image-01" class="imageblock text-center">
<div class="content">
<img src="./images/dintro_01.jpg" alt="A Traditional DAP2 Server">
</div>
</div>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler works in a similar fashion to a traditional DAP2 server, but
before the server reads the data from the archive, it first reads the
data format descriptor to determine how it should read the data.  Only
after it has absorbed the details of the data storage format does it
attempt to read the data, pack it into the transmission format and
send it on its way back to the client.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/dintro_02.jpg" alt="The OPeNDAP FreeForm ND Data Handler">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_freeform_nd_system">The FreeForm ND System</h5>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler comprises a format description mechanism, a set of programs
for manipulating data, and the server itself.  The software was built
using the FreeForm ND library and data objects.  These are documented
in The FreeForm ND User&#8217;s Guide.</p>
</div>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler includes the following programs:</p>
</div>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler distribution also includes the following OPeNDAP FreeForm ND utilities. These are quite useful to write and debug format description files.</p>
</div>
<div class="paragraph">
<p><strong>newform:</strong> This program reformats data according to the input <em>and output</em>  specifications in a format description file.</p>
</div>
<div class="paragraph">
<p><strong>chkform:</strong> After writing a format description file, you can use this program to cross-check the description against a data file.</p>
</div>
<div class="paragraph">
<p><strong>readfile:</strong> This program is useful to decode the format used by a binary file.  It allows you to try different formats on pieces of a binary file, and see what works.</p>
</div>
<div class="sect5">
<h6 id="_compiling_the_opendap_freeform_nd_data_handler">Compiling the OPeNDAP FreeForm ND Data Handler</h6>
<div class="paragraph">
<p>If the computer and operating system combination you use is not one of
the ones we own, you will have to compile the OPeNDAP FreeForm ND Data Handler from its source. Go to the OPeNDAP home page (www.opendap.org) and follow the menu item
to the downloads page. From there you will need the libdap, dap-server
and FreeForm handler software source distributions. Get each of these
and perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the distribution (e.g., <code>tar -xzf libdap-3.5.3.tar.gz</code>)</p>
</li>
<li>
<p>Change to the newly created directory (<code>cd libdap-3.5.3</code>)</p>
</li>
<li>
<p>Run the configure script (<code>./configure</code>)</p>
</li>
<li>
<p>Run make (<code>make</code>)</p>
</li>
<li>
<p>Install the software (<code>make install</code> or <code>sudo make install</code>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each source distribution contains more detailed build instructions;
see the <em>README</em>, <em>INSTALL</em> and <em>NEWS</em> files for the most
up-to-date information.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dquick">11.D.2. Quick Tour of the OPeNDAP FreeForm ND Data Handler</h4>
<div class="paragraph">
<p>This section provides you a quick introduction to the OPeNDAP
FreeForm ND Data Handler, including writing format descriptions
and serving test datasets.</p>
</div>
<div class="sect4">
<h5 id="_getting_started_serving_data">Getting Started Serving Data</h5>
<div class="paragraph">
<p>To get going with the OPeNDAP FreeForm ND Data Handler,
follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>See Hyrax for instructions about installing the OPeNDAP data server.</p>
</li>
<li>
<p>Install the OPeNDAP FreeForm ND Data Handler.</p>
</li>
<li>
<p>Examine the structure of the data file(s) you intend to serve, and
construct a OPeNDAP FreeForm ND format definition file that describes
the layout of data in the files. (Refer to the <a href="#tblfmt">Table Format</a>
for instructions about sequence data and <a href="#arrayfmt">Array Format</a>
for array data. Consult The
<a href="http://docs.opendap.org/index.php/UserGuide">OPeNDAP User Guide</a>
if you do not know the difference between the two data types.)</p>
</li>
<li>
<p>If you wish, you may include an output definition format within this file,
to allow you to test that your input description is accurate. You can use
the OPeNDAP FreeForm ND utilities, such as <em>newform</em>, to validate the
conversion. The <a href="#fmtconv">Format Conversion</a> contains a detailed description of
<em>newform</em>. This step is optional, since the OPeNDAP FreeForm ND Data Handler
ignores the output definition section of the format definition file.</p>
</li>
<li>
<p>Although the OPeNDAP FreeForm ND Data Handler can generate default DDS and
DAS files, you may want to write these files yourself, to override the
default data descriptions, or to add attribute data. The default
descriptions are based on the format of the data the the OPeNDAP FreeForm ND
Data Handler receives from the OPeNDAP FreeForm ND engine.</p>
</li>
<li>
<p>Place the data files, and a corresponding format file for each data file,
in a place where <a href="#hyrax-overview">Hyrax</a> can find them.
See the <a href="#Hyrax_Configuration">Hyrax Configuration Instructions</a>
for information about where Hyrax looks for its files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your data is now available to anyone who knows about your server.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_2">Examples</h5>
<div class="paragraph">
<p>You can easily create FreeForm ND format description files that describe
the formats of input and output data and headers. The OPeNDAP reeForm ND
Data Handler and other OPeNDAP FreeForm ND-based programs then use these
files to correctly access and manipulate data in various formats. An
example format description file is shown and described below.</p>
</div>
<div class="paragraph">
<p>For complete information about writing format descriptions, see the
<a href="#tblfmt">Table Format</a> and <a href="#arrayfmt">Array Format</a> docs.</p>
</div>
<div class="sect5">
<h6 id="_sequence_data">Sequence Data</h6>
<div class="paragraph">
<p>Here is a data file, containing a sequence of four data types. (This data
file and several of the other examples in this chapter are available.)</p>
</div>
<div class="paragraph">
<p>Here is the data file, called <em>ffsimple.dat</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Latitude and Longitude: -63.223548 54.118314  -176.161101 149.408117
-47.303545 -176.161101 11.7125 34.4634
-25.928001   -0.777265 20.7288 35.8953
-28.286662   35.591879 23.6377 35.3314
12.588231  149.408117 28.6583 34.5260
-63.223548   55.319598  0.4503 33.8830
54.118314 -136.940570 10.4085 32.0661
-38.818812   91.411330 13.9978 35.0173
-34.577065   30.172129 20.9096 35.4705
27.331551 -155.233735 23.0917 35.2694
11.624981 -113.660611 27.5036 33.7004</pre>
</div>
</div>
<div class="paragraph">
<p>The file consists of a single header line, followed by a sequence of
records, each of which contains a latitude, longitude, temperature, and
salinity.</p>
</div>
<div class="paragraph">
<p>Here is a format file you can use to read ffsimple.dat. It is called
<em>ffsimple.fmt</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_file_header "Latitude/Longitude Limits"
minmax_title 1 24 char 0
latitude_min 25 36 double 6
latitude_max 37 46 double 6
longitude_min 47 59 double 6
longitude_max 60 70 double 6

ASCII_data "lat/lon"
latitude 1 10 double 6
longitude 12 22 double 6
temp 24 30 double 4
salt 32 38 double 4

ASCII_output_data "output"
latitude 1 10 double 3
longitude_deg 11 15 short 0
longitude_min 16 19 short 0
longitude_sec 20 23 short 0
salt 31 40 double 2
temp 41 50 double 2</pre>
</div>
</div>
<div class="paragraph">
<p>The format file consists of three sections. The first shows OPeNDAP FreeForm
ND how to parse the file header. The second section describes the contents
of the data file. The third part describes how to write the data to another
file. This part is not important for the OPeNDAP FreeForm ND Data Handler
but is useful for debugging the input descriptions.</p>
</div>
<div class="paragraph">
<p>Download the <em>ffsimple</em> files described above and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; newform ffsimple.dat</pre>
</div>
</div>
<div class="paragraph">
<p>You should see results like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Welcome to Newform release 4.2.3 -- an NGDC FreeForm ND application

(ffsimple.fmt) ASCII_input_file_header  "Latitude/Longitude Limits"
File ffsimple.dat contains 1 header record (71 bytes)
Each record contains 6 fields and is 71 characters long.

(ffsimple.fmt) ASCII_input_data "lat/lon"
File ffsimple.dat contains 10 data records (390 bytes)
Each record contains 5 fields and is 39 characters long.

(ffsimple.fmt) ASCII_output_data        "output"
Program memory contains 10 data records (510 bytes)
Each record contains 7 fields and is 51 characters long.


-47.304 -176   9  40            34.46     11.71
-25.928    0 -46  38            35.90     20.73
-28.287   35  35  31            35.33     23.64
12.588  149  24  29            34.53     28.66
-63.224   55  19  11            33.88      0.45
54.118 -136  56  26            32.07     10.41
-38.819   91  24  41            35.02     14.00
-34.577   30  10  20            35.47     20.91
27.332 -155  14   1            35.27     23.09
11.625 -113  39  38            33.70     27.50
100\</pre>
</div>
</div>
<div class="paragraph">
<p>Now take both the <em>ffsimple</em> files and put them into a directory in your web
server&#8217;s document root directory. (Refer to the The
<a href="http://docs.opendap.org/index.php/UserGuide">OPeNDAP User Guide</a>
for some tips on figuring out where that is.)</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example on a computer on which the web server document root is <em>/export/home/http/htdocs</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; mkdir /export/home/http/htdocs/data
&gt; cp ffsimple.* /export/home/http/htdocs/data</pre>
</div>
</div>
<div class="paragraph">
<p>Now, using a common web browser, enter the following URL
(substitute your machine name and CGI directory for the
ones in the example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://test.opendap.org/opendap/nph-dods/data/ff/ffsimple.dat.asc</pre>
</div>
</div>
<div class="paragraph">
<p>You should get something like the following in your web browser&#8217;s window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">latitude, longitude, temp, salt
-47.3035, -176.161, 11.7125, 34.4634
-25.928, -0.777265, 20.7288, 35.8953
-28.2867, 35.5919, 23.6377, 35.3314
12.5882, 149.408, 28.6583, 34.526
-63.2235, 55.3196, 0.4503, 33.883
54.1183, -136.941, 10.4085, 32.0661
-38.8188, 91.4113, 13.9978, 35.0173
-34.5771, 30.1721, 20.9096, 35.4705
27.3316, -155.234, 23.0917, 35.2694
11.625, -113.661, 27.5036, 33.7004</pre>
</div>
</div>
<div class="paragraph">
<p>Try this URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://test.opendap.org/opendap/nph-dods/data/ffsimple.dat.dds</pre>
</div>
</div>
<div class="paragraph">
<p>This will show a description of the dataset structure (See
<a href="http://docs.opendap.org/index.php/UserGuide">OPeNDAP User Guide</a>
for a detailed description of the DAP2 "Dataset Description Structure,"
or DDS.):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> Dataset {
    Sequence {
        Float64 latitude;
        Float64 longitude;
        Float64 temp;
        Float64 salt;
    } lat/lon;
} ffsimple;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_array_data">Array Data</h6>
<div class="paragraph">
<p>If your data more naturally comes in arrays, you can still
use the OPeNDAP FreeForm ND Data Handler to serve your data.
The OPeNDAP FreeForm ND format for sequence data is somewhat
simpler than the format for array data, so you may find it
easier to begin with the example in the previous section.</p>
</div>
<div class="sect6">
<h7 id="_one_dimensional_arrays">One-dimensional Arrays</h7>
<div class="paragraph">
<p>Here is a data file, called <em>ffarr1.dat</em>, containing
four ten-element vectors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> 123456789012345678901234567
 1.00  50.00 0.1000  1.1000
 2.00  61.00 0.3162  0.0953
 3.00  72.00 0.5623 -2.3506
 4.00  83.00 0.7499  0.8547
 5.00  94.00 0.8660 -0.1570
 6.00 105.00 0.9306 -1.8513
 7.00 116.00 0.9647  0.6159
 8.00 127.00 0.9822 -0.4847
 9.00 138.00 0.9910 -0.7243
10.00 149.00 0.9955 -0.3226</pre>
</div>
</div>
<div class="paragraph">
<p>Here is a format file to read this data (<em>ffarr1.fmt</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_input_data "simple array format"
index 1 5 ARRAY["line" 1 to 10 sb 23] OF float 1
data1 6 12 ARRAY["line" 1 to 10 sb 21] OF float 1
data2 13 19 ARRAY["line" 1 to 10 sb 21] OF float 1
data3 20 27 ARRAY["line" 1 to 10 sb 20] OF float 1

ASCII_output_data "simple array output"
index 1 7 ARRAY["line" 1 to 10] OF float 0
/data1 6 12 ARRAY["line" 1 to 10 sb 21] OF float 1
/data2 13 19 ARRAY["line" 1 to 10 sb 21] OF float 4
/data3 20 27 ARRAY["line" 1 to 10 sb 20] OF float 4</pre>
</div>
</div>
<div class="paragraph">
<p>The output section is not essential for the OPeNDAP
FreeForm ND Data Handler but is included so you can check
out the data with the newform command.</p>
</div>
<div class="paragraph">
<p>Download the files from the OPeNDAP web site, and try typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; newform ffarr1.dat</pre>
</div>
</div>
<div class="paragraph">
<p>You should see the index array printed out. Uncomment different
lines in the output section of the example file to see different
data vectors.</p>
</div>
<div class="paragraph">
<p>Now look a little closer at the input section of the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">index 1 5 ARRAY["line" 1 to 10 sb 23] OF float 1</pre>
</div>
</div>
<div class="paragraph">
<p>This line says that the array in question&#8201;&#8212;&#8201;called "index"&#8201;&#8212;&#8201;starts
in column one of the first line, and each element takes up five bytes.
The first element starts in column one and goes into column five. The
array has one dimension, "line," and is composed of floating point data.
The remaining elements of this array are found by skipping the next 23
bytes (the newline counts as a character), reading the following five
bytes, skipping the next 23 bytes, and so on.</p>
</div>
<div class="paragraph">
<p>Of course, the 23 bytes skipped in between the index array elements also
contain data from other arrays. The second array, data1, starts in column
6 of line one, and has 21 bytes between values. The third array starts in
column 13 of the first line, and the fourth starts in column 20.</p>
</div>
<div class="paragraph">
<p>Move the ffarr1.* files into your data directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; cp ffarr1.* /export/home/http/htdocs/data</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can look at this data the same way you looked at the sequence data.
Request the DDS for the dataset with a URL like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://test.opendap.org/opendap/nph-dods/data/ffarr1.dat.dds</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the dataset is a collection of one-dimensional
vectors. You can see the individual vectors with a URL like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://test.opendap.org/opendap/nph-dods/data/ffarr1.dat.asc?index</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_multi_dimensional_arrays">Multi-dimensional Arrays</h7>
<div class="paragraph">
<p>Here&#8217;s another example, with a two-dimensional array. (ffarr2.dat):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">          1         2         3         4
1234567890123456789012345678901234567890
  1.00  2.00  3.00  4.00  5.00  6.00
  7.00  8.00  9.00 10.00 11.00 12.00
 13.00 14.00 15.00 16.00 17.00 18.00
 19.00 20.00 21.00 22.00 23.00 24.00
 25.00 26.00 27.00 28.00 29.00 30.00</pre>
</div>
</div>
<div class="paragraph">
<p>There are no spaces between the data columns within an array row,
but in order to skip reading the newline character, we have to skip
one character at the end of each row. Here is a format file to read
this data (<em>ffarr2.fmt</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_input_data "one"
data 1 6 ARRAY["y" 1 to 5 sb 1]["x" 1 to 6] OF float 1

ASCII_output_data "two"
data 1 4 ARRAY["x" 1 to 6 sb 2]["y" 1 to 5] OF float 1</pre>
</div>
</div>
<div class="paragraph">
<p>Again, the output section is only for using with the newform tool.
Put these data files into your htdocs directory, and look at the
DDS as you did with the previous example.</p>
</div>
</div>
<div class="sect6">
<h7 id="_a_little_more_complicated">A Little More Complicated</h7>
<div class="paragraph">
<p>You can use the OPeNDAP FreeForm ND Data Handler to serve data with
multi-dimensional arrays and one-dimensional vectors interspersed
among one another. Here&#8217;s a file containing this kind of data
(ffarr3.dat):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1         2         3         4
1234567890123456789012345678901234567890123
XXXX  1.00  2.00  3.00  4.00  5.00  6.00YY
XXXX  7.00  8.00  9.00 10.00 11.00 12.00YY
XXXX 13.00 14.00 15.00 16.00 17.00 18.00YY
XXXX 19.00 20.00 21.00 22.00 23.00 24.00YY
XXXX 25.00 26.00 27.00 28.00 29.00 30.00YY</pre>
</div>
</div>
<div class="paragraph">
<p>In order to read this file successfully, we define three vectors
to read the "XXXX", the "YY", and the newline. Here is a format
file that does this (<em>ffarr3.fmt</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">dBASE_input_data "one"
headers 1 4 ARRAY["line" 1 to 5 sb 39] OF text 0
data 5 10 ARRAY["y" 1 to 5 sb 7]["x" 1 to 6] OF float 1
trailers 41 42 ARRAY["line" 1 to 5 sb 41] OF text 0
newline 43 43 ARRAY["line" 1 to 5 sb 42] OF text 0

ASCII_output_data "two"
data 1 4 ARRAY["x" 1 to 6 sb 2]["y" 1 to 5] OF float 0
/headers 1 6 ARRAY["line" 1 to 5] OF text 0
/trailers 1 4 ARRAY["line" 1 to 5] OF text 0
/newline 1 4 ARRAY["line" 1 to 5] OF text 0</pre>
</div>
</div>
<div class="paragraph">
<p>The following chapters offer more detailed information
about how exactly to create a format description file.</p>
</div>
</div>
<div class="sect6">
<h7 id="_non_interleaved_multi_dimensional_arrays">Non-interleaved Multi-dimensional Arrays</h7>
<div class="paragraph">
<p>So far the array examples have shown how to read interleaved arrays
(either vectors or higher dimensional arrays). Reading array data
where one array follows another is pretty straightforward.
Use <em>the same</em> syntax as for the interleaved array case, but set the
start and stop points to be the same and to be the offset from the
start of the data file. Here is a format file for a real dataset
that contains a number of arrays of binary data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BINARY_input_data "AMSR-E_Ocean_Product"
time_a 1 1 array["lat" 1 to 720]["lon" 1 to 1440] OF uint8 0
sst_a 1036801 1036801 array["lat" 1 to 720]["lon" 1 to 1440] OF uint8 0
wind_a 2073601 2073601 array["lat" 1 to 720]["lon" 1 to 1440] OF uint8 0</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the array <em>time_a</em> uses start and stop values of <em>1</em> and
then the array sst_a uses start and stop values of <em>1 036 801</em>
which is exactly the size of the preceding array. Note that in this
dataset, each array is of an unsigned 8-bit integer. Here&#8217;s another
example with different size and type arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BINARY_input_data "test_data"
time_a 1 1 array["lat" 1 to 10]["lon" 1 to 10] OF uint8 0
sst_a 101 108 array["lat" 1 to 10]["lon" 1 to 20] OF float64 0
wind_a 301 302 array["lat" 1 to 10]["lon" 1 to 5] OF uint16 0</pre>
</div>
</div>
<div class="paragraph">
<p>The first array starts at offset 1; the second array starts at
offset 100 (10 * 10); and the third array starts at 300 (100 + (10 * 20).
Note that FreeForm offsets are given in terms of <em>elements</em>, not bytes.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tblfmt">11.D.3. Format Descriptions for Tabular Data</h4>
<div class="paragraph">
<p>Format descriptions define the formats of input and output data and
headers. FreeForm ND provides an easy-to-use mechanism for describing
data. FreeForm ND programs and FreeForm ND-based applications that you
develop use these format descriptions to correctly access data. Any
data file used by FreeForm ND programs must be described in a format
description file.</p>
</div>
<div class="paragraph">
<p>This page explains how to write format descriptions for data
arranged in tabular format---rows and columns---only. For data in
non-tabular formats, see <a href="#arrayfmt">Array Format</a>.</p>
</div>
<div class="sect4">
<h5 id="_freeform_nd_variable_types">FreeForm ND Variable Types</h5>
<div class="paragraph">
<p>The data sets you produce and use may contain a variety of variable
types. The characteristics of the types that FreeForm ND supports are
summarized in the table below, which is followed by a
description of each type.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>OPeNDAP FreeForm ND Data Types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Minimum Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Maximum Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Size in Bytes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precision</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">**</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uchar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32,767</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32,767</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ushort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65,535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2,147,483,647</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,147,483,647</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4,294,967,295</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;math&gt;10^{-37}&lt;/math&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;math&gt;10^{38}&lt;/math&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6***</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;math&gt;10^{-307}&lt;/math&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;math&gt;10^{308}&lt;/math&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15***</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">**</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">record length</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">convert</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">**</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">*Expressed as the number of significant digits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">**User-specified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">***Can vary depending on environment</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sizes in table 3.1 are machine-dependent.
Those given are for most Unix workstations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>char</strong>: The <em>char</em> variable type is used for character strings. Variables of this type, including numerals, are interpreted as characters, not as numbers.</p>
</div>
<div class="paragraph">
<p><strong>uchar:</strong> The <em>uchar</em> (unsigned character) variable type can be used for integers between 0 and 255 (28- 1). Variables that can be represented by the <em>uchar</em> type (for example: month, day, hour, minute) occur in many data sets. An advantage of using the <em>uchar</em> type in binary formats is that only one byte is used for each variable. Variables of this type are interpreted as numbers, not characters.</p>
</div>
<div class="paragraph">
<p><strong>short:</strong> A <em>short</em> variable can hold integers between -32,767 and 32,767 (&lt;math2^{15}- 1&lt;/math). This type can be used for signed integers with less than 5 digits, or for real numbers with a total of 4 or fewer digits on both sides of the decimal point (-99 to 99 with a precision of 2, -999 to 999 with a precision of 1, and so on).</p>
</div>
<div class="paragraph">
<p><strong>ushort:</strong> A <em>ushort</em> (unsigned short) variable can hold integers between 0 and 65,535 (&lt;math2^{16} - 1&lt;/math).</p>
</div>
<div class="paragraph">
<p><strong>long:</strong> A <em>long</em> variable can hold integers between -2,147,483,647 and +2,147,483,647 (&lt;math2^{31} - 1&lt;/math). This variable type is commonly used to represent floating point data as integers, which may be more portable. It can be used for numbers with 9 or fewer digits with up to 9 digits of precision, for example, latitude or longitude (-180.000000 to 180.000000).</p>
</div>
<div class="paragraph">
<p><strong>ulong:</strong> The <em>ulong</em> (unsigned long) variable type can be used for integers between 0 and 4,294,967,295 (&lt;math2^{32} - 1&lt;/math).</p>
</div>
<div class="paragraph">
<p><strong>float, double:</strong> Numbers that include explicit decimal points are either <em>float</em> or <em>double</em> depending on the desired number of digits. A <em>float</em> has a maximum of 6 significant digits, a <em>double</em> has 15 maximum. The extra digits of a <em>double</em> are useful, for example, for precisely specifying time of day within a month as decimal days. One second of time is approximately 0.00001 day. The number specifying day (maximum = 31) can occupy up to 2 digits. A <em>float</em> can therefore only specify decimal days to a whole second (31.00001 occupies seven digits). A <em>double</em> can, however, be used to track decimal parts of a second (for example, 31.000001).</p>
</div>
</div>
<div class="sect4">
<h5 id="_freeform_nd_file_types">FreeForm ND File Types</h5>
<div class="paragraph">
<p>FreeForm ND supports binary, ASCII, and dBASE file types. Binary data
are stored in a fixed amount of space with a fixed range of values.
This is a very efficient way to store data, but the files are
machine-readable rather than human-readable. Binary numbers can be
integers or floating point numbers.</p>
</div>
<div class="paragraph">
<p>Numbers and character strings are stored as text strings in ASCII. The
amount of space used to store a string is variable, with each
character occupying one byte.</p>
</div>
<div class="paragraph">
<p>The dBASE file type, used by the dBASE product, is ASCII text without
end-of-line markers.</p>
</div>
</div>
<div class="sect4">
<h5 id="_format_description_files">Format Description Files</h5>
<div class="paragraph">
<p>Format description files accompany data files. A format description
file can contain descriptions for one or more formats. You include
descriptions for header, input, and output formats as appropriate.
Format descriptions for more than one file may be included in a single
format description file.</p>
</div>
<div class="paragraph">
<p>An example format description file is shown next. The sections that
follow describe each element of a format description file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This format description file is for
/ data files latlon.bin and latlon.dat.

binary_data Default binary format
latitude 1 4 long 6
longitude 5 8 long 6

ASCII_data Default ASCII format
latitude 1 10 double 6
longitude 12 22 double 6</pre>
</div>
</div>
<div class="paragraph">
<p>Lines 1 and 2 are comment lines.  Lines 4 and 8 give the format type and title. Lines 5, 6,
9, and 10 contain variable descriptions.  Blank lines signify the end of a format
description</p>
</div>
<div class="paragraph">
<p>You can include blank lines between format descriptions and comments
in a format description file as necessary.  Comment lines begin with a
slash (/). FreeForm ND ignores comments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_format_descriptions">Format Descriptions</h5>
<div class="paragraph">
<p>A format description file comprises one or more format descriptions. A
format description consists of a line specifying the format type and
title followed by one or more variable descriptions, as in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">binary_data Default binary format
latitude 1 4 long 6
longitude 5 8 long 6</pre>
</div>
</div>
<div class="sect5">
<h6 id="_format_type_and_title">Format Type and Title</h6>
<div class="paragraph">
<p>A line specifying the format type and title begins a format
description. A <em>format descriptor</em>, for example, <em>binary_data</em>, is
used to indicate format type to FreeForm ND. The <em>format title</em>, for
example, "Default binary format", briefly describes the format. It
must be surrounded by quotes and follow the format descriptor on the
same line. The maximum number of characters for the format title is 80
including the quotes.</p>
</div>
<div class="sect6">
<h7 id="_format_descriptors">Format Descriptors</h7>
<div class="paragraph">
<p>Format descriptors indicate (in the order given) file type, read/write
type, and file section. Possible values for each descriptor component
are shown in the following table.</p>
</div>
<div class="paragraph">
<p>Format Descriptor Components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>File Type</p>
<div class="ulist">
<ul>
<li>
<p>ASCII</p>
</li>
<li>
<p>Binary</p>
</li>
<li>
<p>dBASE</p>
</li>
</ul>
</div>
</li>
<li>
<p>Read/Write Type (Optional)</p>
<div class="ulist">
<ul>
<li>
<p>input</p>
</li>
<li>
<p>output</p>
</li>
</ul>
</div>
</li>
<li>
<p>File Section</p>
<div class="ulist">
<ul>
<li>
<p>data</p>
</li>
<li>
<p>file_header</p>
</li>
<li>
<p>record_header</p>
</li>
<li>
<p>file_header_seperate*</p>
</li>
<li>
<p>record_header_separate*</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>*The qualifier <em>separate</em> indicates there is a header file separate from the data file.</p>
</div>
<div class="paragraph">
<p>The components of a format descriptor are separated by underscores
(<em>). For example, _ASCII_output_data</em> indicates that the format
description is for ASCII data in an output file. The order of
descriptors in a format description should reflect the order of format
types in the file. For instance, the descriptor
<em>ASCII_file_header</em> would be listed in the format description
file before <em>ASCII_data</em>. The format descriptors you can use in
FreeForm ND are listed in the next table, where <em>XXX</em> stands for
<em>ASCII</em>, <em>binary</em>, or <em>dBASE</em>.  (Example: <em>XXX_data</em>
= <em>ASCII_data</em>, <em>binary_data</em>, or <em>dBASE_data</em>.)</p>
</div>
<div class="paragraph">
<p>Format Descriptors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data</strong></p>
<div class="ulist">
<ul>
<li>
<p>XXX_data</p>
</li>
<li>
<p>XXX_input_data</p>
</li>
<li>
<p>XXX_output_data</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Header</strong></p>
<div class="ulist">
<ul>
<li>
<p>XXX_file_header</p>
</li>
<li>
<p>XXX_file_header_separate</p>
</li>
<li>
<p>XXX_record_header</p>
</li>
<li>
<p>XXX_record_header_separate</p>
</li>
<li>
<p>XXX_input_file_header</p>
</li>
<li>
<p>XXX_input_file_header_separate</p>
</li>
<li>
<p>XXX_input_record_header</p>
</li>
<li>
<p>XXX_input_record_header_separate</p>
</li>
<li>
<p>XXX_output_file_header</p>
</li>
<li>
<p>XXX_output_file_header_separate</p>
</li>
<li>
<p>XXX_output_record_header</p>
</li>
<li>
<p>XXX_output_record_header_separate</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Special</strong></p>
<div class="ulist">
<ul>
<li>
<p>Return (lets FreeForm ND skip over end-of-line characters in the data.)</p>
</li>
<li>
<p>EOL (a constant indicating an end-of-line character should be inserted in a multi-line record.)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about header formats, see <a href="#hdrfmts">Header Formats</a>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_variable_descriptions">Variable Descriptions</h6>
<div class="paragraph">
<p>A variable description defines the name, start and end column
position, type, and precision for each variable. The fields in a
variable description are separated by white space. Two variable
descriptions are shown below with the fields indicated. Each field is
then described.</p>
</div>
<div class="paragraph">
<p>Here are two example variable descriptions.  Each one consists of a
name, a start position, and end position, a type, and a precision.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">latitude    1  10  double  6
longitude  12  22  double  6</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Name:</strong>
The variable name is case-sensitive, up to 63 characters long with
no blanks. The variable names in the example are latitude and
longitude. If the same variable is included in more than one format
description within a format description file, its name must be the
same in each format description.</p>
</div>
<div class="paragraph">
<p><strong>Start Position:</strong>
The column position where the first character (ASCII) or byte
(binary) of a variable value is placed. The first position is 1, not
0. In the example, the variable latitude is defined to start at
position 1 and longitude at 12.</p>
</div>
<div class="paragraph">
<p><strong>End Position:</strong>
The column position where the last character (ASCII) or byte
(binary) of a variable value is placed. In the example, the variable
latitude is defined to end at position 10 and longitude at 22.</p>
</div>
<div class="paragraph">
<p><strong>Type:</strong>
The variable type can be a standard type such as char, float,
double, or a special FreeForm ND type. The type for both variables
in the example is double. See above for
descriptions of supported types.</p>
</div>
<div class="paragraph">
<p><strong>Precision:</strong>
Precision defines the number of digits to the right of the decimal
point. For float or double variables, precision only controls the
number of digits printed or displayed to the right of the decimal
point in an ASCII representation. The precision for both variables
in the example is 6.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="arrayfmt">11.D.4. Format Descriptions for Array Data</h4>
<div class="paragraph">
<p>If the tabular format discussed in <a href="#tblfmt">Table Format</a> doesn&#8217;t
describe your data well, FreeForm ND&#8217;s array notation may prove
useful. Describing a data file&#8217;s organization as a set of as
n-dimensional arrays allows for much more flexibility in writing
format definitions. It also enables subsetting, pixel-manipulation,
and reorienting arrays of arbitrary dimension and character.</p>
</div>
<div class="sect4">
<h5 id="_array_descriptor_syntax">Array Descriptor Syntax</h5>
<div class="paragraph">
<p>FreeForm ND allows you to describe the same fundamental FreeForm ND
data types in array notation. The arrays can have any number of
dimensions, any number of elements in each dimension, and either an
increasing or a decreasing sequencing in each dimension. Furthermore,
elements in any dimension may be separated from each other
(demultiplexed) and may even be placed in separate files. However,
every element of an array must be of the same type.</p>
</div>
<div class="paragraph">
<p>Array descriptors are a string of n dimension descriptions for arrays
of n dimensions.  FreeForm ND accepts descriptions with the most
significant dimension first (i.e. row-major order for 2 dimensions,
plane-major order in 3 dimensions).</p>
</div>
<div class="paragraph">
<p>Individual dimension descriptions are enclosed in brackets. Each
dimension description can contain various keywords and values which
specify how the dimension is set up. Some of the specifications are
optional; if you do not specify them, they default to a specific
value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must not mix array and tabular formats within the input and
output sections of the format definition file. Only one type of
notation can be used within each section of the format description
file, although the sections may use different forms. For example, a
file&#8217;s input format could use array definitions, but the output
format might be entirely tabular.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The dimension description variables include:</p>
</div>
<div class="paragraph">
<p><strong>dimension name (REQUIRED):</strong>
A name for the dimension. This can be any ASCII string enclosed in
double-quotes ("). The name for each dimension must be unique
throughout the array descriptor.
This example specifies that a dimension named "latitude" exists</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[latitude 0 to 180]`</pre>
</div>
</div>
<div class="paragraph">
<p><strong>starting and ending indices (REQUIRED):</strong>
A starting and ending index specifying a range for the dimension.
The starting and ending indices are specified as integers separated
by the word "to" following the dimension name. As long as both
numbers are integral, there are no other restrictions on their
values.
This example specifies that the dimension "temperature" has
indices ranging from -50 to +50:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[temperature -50 to 50]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>granularity (optional):</strong>
A specification for the density of elements in the indices. The
number provided after the "by" keyword specifies how many index
positions are to be skipped to find the next element.
This example specifies that index values 0, 50, 100, 150 and 200 are
the only valid index values for the dimension "height":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[height 0 to 200 by 50]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>grouping (optional):</strong>
A specification for splitting an array across "partitions" (files
or buffers in memory). The number provided after the "gb" or
"groupedby" keyword specifies how many elements of the dimension
are in each partition. If no value is specified, the default is 0
(no partitioning). Each partition must have the same number of
elements. Every more-significant dimension description (those to the
left) must also have a grouping specified- "dangling" grouping
specifications are not allowed. If a dimension is not partitioned,
but is required to have a grouping specification because a
less-significant dimension is partitioned, a grouping of M can be
specified, where:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">M = [end_index -  start_index] + 1</pre>
</div>
</div>
<div class="paragraph">
<p>This example specifies that the dimension "latitude" is partitioned
into 9 chunks of 10 "bands" of latitude each:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[latitude 1 to 90 gb 10]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>separation (optional):</strong>
A specification for "unused space" in the array. The number
provided after the "sb" or "separation" keyword specifies how
many bytes of data following each element in the dimension should
not be considered part of the array. An "element in the dimension"
is considered to be everything which occurs in one index of that
dimension. separation takes on a slightly different meaning if the
dimension also has a specified grouping. In dimensions with a
specified grouping, the separation occurs at the end of each
partition, not after every element.
This example specifies a 2-dimensional array with 4 bytes between
the elements in the "columns" and an additional 2 bytes at the end
of every row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[lat -90 to 90 sb 2][lon -180 to 179 sb 4]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_handling_newlines">Handling Newlines</h5>
<div class="paragraph">
<p>The convention of expecting a newline to follow each record of ASCII
data becomes troublesome when dealing with array data, especially when
expressed using format description notation that is intended for
tabular data. It is the FreeForm ND convention that there is an
implicit newline after the last variable of an ASCII format.</p>
</div>
<div class="paragraph">
<p>For example, these two format descriptions are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_data broken time --- BIP
year 1 2 uint8 0
month 3 4 uint8 0
day 5 6 uint8 0
hour 7 8 uint8 0
minute 9 10 uint8 0
second 11 14 uint16 2

dBASE_data broken time --- BIP
year 1 2 uint8 0
month 3 4 uint8 0
day 5 6 uint8 0
hour 7 8 uint8 0
minute 9 10 uint8 0
second 11 14 uint16 2
EOL 15 16 constant 0</pre>
</div>
</div>
<div class="paragraph">
<p>However, the EOL variable shown here assumes that newlines are two
bytes long, which is true only on a PC. FreeForm ND adjusts to this by
assuming that ASCII data always has native newlines, and it updates
the starting and ending position of EOL variables and subsequent
variables accordingly.</p>
</div>
<div class="paragraph">
<p>The EOL variable is typically used to define a record layout that
spans multiple lines. However, the EOL variable in combination with
the dBASE format type can completely replace the ASCII format type.We
recommend using the dBASE format type when describing ASCII arrays, to
ensure that separation, if specified, takes into account the length of
any newlines.
In this output format a newline separates each band of data, but it
would be just as easy to omit the newlines entirely.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">dBASE_input_data broken time --- BIP
year 1 2 array[x 1 to 10 sb 14] of uint8 0
month 3 4 array[x 1 to 10 sb 14] of uint8 0
day 5 6 array[x 1 to 10 sb 14] of uint8 0
hour 7 8 array[x 1 to 10 sb 14] of uint8 0
minute 9 10 array[x 1 to 10 sb 14] of uint8 0
second 11 14 array[x 1 to 10 sb 12] of uint16 2
EOL 15 16 array[x 1 to 10 sb 14] of constant 0

dBASE_output_data broken time - BSQ
year 1 2 array[x 1 to 10] of uint8 0
EOL 21 22 constant 0
month 23 24 array[x 1 to 10] of uint8 0
EOL 43 44 constant 0
day 45 46 array[x 1 to 10] of uint8 0
EOL 65 66 constant 0
hour 67 68 array[x 1 to 10] of uint8 0
EOL 87 89 constant 0
minute 90 91 array[x 1 to 10] of uint8 0
EOL 110 111 constant 0
second 112 115 array[x 1 to 10] of uint16 2
EOL 132 133 constant 0</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The separation size now takes into account the two-character PC newline. To use this format description with a native ASCII file on UNIX platforms, it would be necessary to change the separation sizes of 12 and 14 to 11 and 13, respectively. &lt;/blockquote&gt;
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_examples_3">Examples</h5>
<div class="paragraph">
<p>The following examples should be helpful in understanding the array
notation.</p>
</div>
<div class="sect5">
<h6 id="_tabular_versus_array_descriptions">Tabular versus Array Descriptions</h6>
<div class="paragraph">
<p>Array notation can simply replace the tabular format description, as in these examples.</p>
</div>
<div class="paragraph">
<p>A single element can be described in tabular format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">year 1 2 uint8 0</pre>
</div>
</div>
<div class="paragraph">
<p>or as an array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">year 1 2 array[x 1 to 10] of uint8 0</pre>
</div>
</div>
<div class="paragraph">
<p>An image file can be described in tabular format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">binary_input_data grid data
data 1 1 uint8 0</pre>
</div>
</div>
<div class="paragraph">
<p>or as an array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">binary_input_data grid data
data 1 1 array[rows 1 to 180] [cols 1 to 360] of uint8 0</pre>
</div>
</div>
<div class="paragraph">
<p>Multiplexed data can be described in tabular format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_data broken time --- tabular
year 1 2 uint8 0
month 3 4 uint8 0
day 5 6 uint8 0
hour 7 8 uint8 0
minute 9 10 uint8 0
second 11 14 uint16 2</pre>
</div>
</div>
<div class="paragraph">
<p>or as an array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_data broken time -- BIP
year 1 2 array[x 1 to 10 sb 12] of uint8 0
month 3 4 array[x 1 to 10 sb 12] of uint8 0
day 5 6 array[x 1 to 10 sb 12] of uint8 0
hour 7 8 array[x 1 to 10 sb 12] of uint8 0
minute 9 10 array[x 1 to 10 sb 12] of uint8 0
second 11 14 array[x 1 to 10 sb 10] of uint16 2</pre>
</div>
</div>
<div class="paragraph">
<p>These two format descriptions communicate much the same information,
but the array example also indicates that the data file is blocked
into ten data values for each variable.</p>
</div>
<div class="paragraph">
<p>In this example, the data is not multiplexed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_data broken time -- BSQ
year 1 2 array[x 1 to 10] of uint8 0
month 21 22 array[x 1 to 10] of uint8 0
day 41 42 array[x 1 to 10] of uint8 0
hour 61 62 array[x 1 to 10] of uint8 0
minute 81 82 array[x 1 to 10] of uint8 0
second 101 104 array[x 1 to 10] of uint16 2</pre>
</div>
</div>
<div class="paragraph">
<p>The starting position indicates the file offset of the first element
of each array, the same as with the alternative definition given for
starting position in tabular data format descriptions.</p>
</div>
</div>
<div class="sect5">
<h6 id="_array_manipulation">Array Manipulation</h6>
<div class="paragraph">
<p>Consider a 6x6 array of data with an "XXXX" header and a "YY"
trailer on each line.  Each data element is a space, a row ("y")
index, a comma, and a column ("x") index, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">XXXX 0,0 0,1 0,2 0,3 0,4 0,5YY
XXXX 1,0 1,1 1,2 1,3 1,4 1,5YY
XXXX 2,0 2,1 2,2 2,3 2,4 2,5YY
XXXX 3,0 3,1 3,2 3,3 3,4 3,5YY
XXXX 4,0 4,1 4,2 4,3 4,4 4,5YY
XXXX 5,0 5,1 5,2 5,3 5,4 5,5YY</pre>
</div>
</div>
<div class="paragraph">
<p>The goal is to produce a data file that looks like the data below. To
do that, we need to strip the headers and trailers, and transpose rows
and columns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">0,0 1,0 2,0 3,0 4,0 5,0
0,1 1,1 2,1 3,1 4,1 5,1
0,2 1,2 2,2 3,2 4,2 5,2
0,3 1,3 2,3 3,3 4,3 5,3
0,4 1,4 2,4 3,4 4,4 5,4
0,5 1,5 2,5 3,5 4,5 5,5</pre>
</div>
</div>
<div class="paragraph">
<p>The key to writing the input format description is understanding that
the input data file is composed of four interleaved arrays:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The "XXXX" headers</p>
</li>
<li>
<p>The data</p>
</li>
<li>
<p>The "YY" trailers</p>
</li>
<li>
<p>The newlines</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The array of headers is a one-dimensional array composed of six
elements (one for each line) with each element being four characters
wide and separated from the next element by 28 bytes (24 + 2 + 2 ---
24 bytes for a row of data plus 2 bytes for the trailer plus two bytes
for the newline).</p>
</div>
<div class="paragraph">
<p>The array of data is a two-dimensional array of six elements in each
dimension with each element being four characters wide, each row is
separated from the next by eight bytes (columns are adjacent and so
have zero separation), and the first element begins in the fifth byte
of the file (counting from one).</p>
</div>
<div class="paragraph">
<p>The array of trailers is a one-dimensional array composed of six
elements with each element being two characters wide, each element is
separated from the next by 30 bytes, and the first element begins in
the 29th byte of the file.</p>
</div>
<div class="paragraph">
<p>The array of newlines is a one-dimensional array composed of six
elements with each element being two characters wide (on a PC), each
element is separated from the next by 30 bytes, and the first element
begins in the 31st byte of the file.</p>
</div>
<div class="paragraph">
<p>The FreeForm ND input format description needed is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">dBASE_input_data one
headers 1 4 ARRAY[line 1 to 6 separation 28] OF text 0
data 5 8 ARRAY[y 1 to 6 separation 8][x 1 to 6] OF text 0
trailers 29 30 ARRAY[line 1 to 6 separation 30] OF text 0
PCnewline 31 32 ARRAY[line 1 to 6 separation 30] OF text 0</pre>
</div>
</div>
<div class="paragraph">
<p>The output data is composed of two interleaved arrays:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The data</p>
</li>
<li>
<p>The newlines</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The array of data now has a separation of two bytes between each row,
the first element begins in the first byte of the file, and the order
of the dimensions has been switched.</p>
</div>
<div class="paragraph">
<p>The array of newlines now has a separation of 24 bytes and the first
element begins in the 25th byte of the file. Each array can be
operated on independently.  In the case of the data array we simply
transposed rows and columns, but we could do other reorientations as
well, such as resequencing elements within either or both dimensions.</p>
</div>
<div class="paragraph">
<p>The FreeForm ND output format description needed is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">dBASE_output_data two
data 1 4 ARRAY[x 1 to 6 separation 2][y 1 to 6] OF text 0
PCnewline 25 26 ARRAY[line 1 to 6 separation 24] OF text 0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sampling_and_data_manipulation">Sampling and Data Manipulation</h6>
<div class="paragraph">
<p>With a wider range of descriptive possibilities, FreeForm can more
easily be used for sampling and subsetting data, as in these examples.</p>
</div>
<div class="paragraph">
<p>The following array descriptor pair subsets a two-dimensional array,
retrieving one quarter (the north-west quarter of the earth).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [latitude -90 to 90] [longitude -179 to 180]
OUTPUT: [latitude 0 to 90] [longitude -179 to 0]</pre>
</div>
</div>
<div class="paragraph">
<p>The following array descriptor pair flips a two-dimensional array
row-wise (vertically).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [row 0 to 100] [column 13 to 42]
OUTPUT: [row 100 to 0] [column 13 to 42]</pre>
</div>
</div>
<div class="paragraph">
<p>The following array descriptor pair rotates a two-dimensional array 90
degrees (exchanging rows and columns).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [row 0 to 10] [column 0 to 42]
OUTPUT: [column 0 to 42] [row 0 to 10]</pre>
</div>
</div>
<div class="paragraph">
<p>The following array descriptor pair outputs every other plane from a
three-dimensional array (essentially cutting the depth resolution in
half).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [plane 1 to 18] [row 0 to 10] [column 0 to 42]
OUTPUT: [plane 1 to 18 by 2] [row 0 to 10] [column 0 to 42]</pre>
</div>
</div>
<div class="paragraph">
<p>The following array descriptor pair replicates every plane from a
three-dimensional array three times (essentially tripling the depth).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [plane 1 to 54 by 3] [row 0 to 10] [column 0 to 42]
OUTPUT: [plane 1 to 54] [row 0 to 10] [column 0 to 42]</pre>
</div>
</div>
<div class="paragraph">
<p>This array descriptor pair outputs the middle 1/27 of a three
dimensional array with depth and width exchanged and height halved and
flipped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INPUT: [plane 1 to 27] [row 1 to 27] [column 1 to 27]
OUTPUT: [column 10 to 18] [row 18 to 10 by 2] [plane 10 to 18]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hdrfmts">11.D.5. Header Formats</h4>
<div class="paragraph">
<p>Headers are one of the most commonly encountered forms of
metadata-data about data. Applications need the information contained
in headers for reading the data that the headers describe. To access
these data, applications must be able to read the headers. Just as
there are many data formats, there are numerous header formats. You
can include header format descriptions, which have exactly the same
form as data format descriptions, in format description files.</p>
</div>
<div class="sect4">
<h5 id="_header_treatment_in_freeform_nd">Header Treatment in FreeForm ND</h5>
<div class="paragraph">
<p>FreeForm ND is not 100 percent backwards compatible with FreeForm in
the area of header treatment.</p>
</div>
<div class="paragraph">
<p>Headers have traditionally been handled differently from data in
FreeForm ND. If a header format was not specified as either input or
output, it was taken as both input and output. <em>newform</em> did
little in processing headers, and FreeForm ND relied on extraneous
utilities to work with headers.</p>
</div>
<div class="sect5">
<h6 id="_new_behavior">New Behavior</h6>
<div class="paragraph">
<p>In FreeForm ND, header formats are treated the same as data formats.
This means that header formats must be identified as either input or
output, explicitly or implicitly. If done explicitly, then either the
input or the output descriptor will form the format type (e.g.,
<em>ASCII_input_header</em>). If done implicitly, then the same
ambiguity resolution rules that apply to data formats will be applied
to header formats. This means that ASCII header formats will be taken
as input for data files with a <em>.dat</em> extension, dBASE header
formats will be taken as input for data files with a <em>.dab</em>
extension, and binary header formats will be taken as input for all
other data files.</p>
</div>
<div class="paragraph">
<p>If an embedded header and the data have different file types, then
either the header format or data format (preferably both) must be
explicitly identified as input or output (for example, an ASCII header
embedded in a binary data file). Obviously, ambiguous formats with
different file types cannot both be resolved as input formats.</p>
</div>
<div class="paragraph">
<p>The same header format is no longer used as both an input and an
output header format.</p>
</div>
<div class="paragraph">
<p>In FreeForm ND, <em>newform</em> honors output header formats that are
separate (e.g., <em>ASCII_output_header_separate</em>). The header is
written to a separate file which, unless otherwise specified, is named
after the output data file with a <em>.hdr</em> extension. This requires
that you name the output file using the <em>-o</em> option flag; redirected
output cannot be used with separate output headers. The output header
file name and path can be specified using the same keywords that tell
FreeForm ND how to find an input separate header file (i.e.,
<em>header_file_ext</em>, <em>header_file_name</em>, and
<em>header_file_path</em>).</p>
</div>
<div class="paragraph">
<p>When defining keywords to specify how an output header file is to be
named, you must use a new type of equivalence section,
<em>input_eqv</em>, which must appear in the format file along with
<em>output_eqv</em>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_header_types">Header Types</h5>
<div class="paragraph">
<p>FreeForm ND recognizes two types of headers. File headers describe all
the data in a file whereas record headers describe the data in a
single record or data block. FreeForm ND can read headers included in
the data file or stored in a separate file. Header formats, like data
formats, are described in format description files.</p>
</div>
<div class="sect5">
<h6 id="_file_headers">File Headers</h6>
<div class="paragraph">
<p>A file header included in a data file is at the beginning of the file.
Only one file header can be associated with a data file.
Alternatively, a file header can be stored in a file separate from the
data file.</p>
</div>
<div class="paragraph">
<p>In the following example, a file header is used to store the minimum
and maximum for each variable and the data are converted from ASCII to
binary. There are two variables, latitude and longitude. The file
header format and data formats are described in the format description
file <em>llmaxmin.fmt</em>.</p>
</div>
<div class="listingblock">
<div class="title">llmaxmin.fmt</div>
<div class="content">
<pre class="nowrap">ASCII_file_header Latitude/Longitude Limits
minmax_title 1 24 char 0
latitude_min 25 36 double 6
latitude_max 37 46 double 6
longitude_min 47 59 double 6
longitude_max 60 70 double 6

ASCII_data lat/lon
latitude 1 10 double 6
longitude 12 22 double 6

binary_data lat/lon
latitude 1 4 long 6
longitude 5 8 long 6</pre>
</div>
</div>
<div class="paragraph">
<p>The example ASCII data file <em>llmaxmin.dat</em> contains a file header
and data as described in <em>llmaxmin.fmt</em>.</p>
</div>
<div class="listingblock">
<div class="title">llmaxmin.dat</div>
<div class="content">
<pre class="nowrap">1         2         3         4         5         6         7
1234567890123456789012345678901234567890123456789012345678901234567890

Latitude and Longitude:   -83.223548 54.118314  -176.161101 149.408117
-47.303545 -176.161101
-25.928001    0.777265
-28.286662   35.591879

12.588231  149.408117
-83.223548   55.319598

54.118314 -136.940570

38.818812   91.411330
-34.577065   30.172129

27.331551 -155.233735

11.624981 -113.660611</pre>
</div>
</div>
<div class="paragraph">
<p>This use of a file header would be appropriate if you were interested
in creating maps from large data files. By including maximums and
minimums in a header, the scale of the axes can be determined without
reading the entire file.</p>
</div>
<div class="paragraph">
<p>FreeForm ND naming conventions have been followed in this example, so
to convert the ASCII data in the example to binary format, use the
following simple command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform llmaxmin.dat -o llmaxmin.bin</pre>
</div>
</div>
<div class="paragraph">
<p>The file header in the example will be written into the binary file as
ASCII text because the header descriptor in <em>llmaxmin.fmt</em>
(<em>ASCII_file_header</em>) does not specify read/write type, so the
format is used for both the input and output header.</p>
</div>
</div>
<div class="sect5">
<h6 id="_record_headers">Record Headers</h6>
<div class="paragraph">
<p>Record headers occur once for every block of data in a file. They are
interspersed with the data, a configuration sometimes called a format
sandwich. Record headers can also be stored together in a separate
file.</p>
</div>
<div class="paragraph">
<p>The following format description file specifies a record header and
ASCII and binary data formats for aeromagnetic trackline data.</p>
</div>
<div class="listingblock">
<div class="title"><em>aeromag.fmt</em></div>
<div class="content">
<pre class="nowrap">ASCII_record_header Aeromagnetic Record Header Format
flight_line_number 1 5 long 0
count 6 13 long 0
fiducial_number_corresponding_to_first_logical_record 14 22 long 0
date_MMDDYY_or_julian_day 23 30 long 0
flight_number 31 38 long 0
utm_easting_of_first_record 39 48 float 0
utm_northing_of_first_record 49 58 float 0
utm_easting_of_last_record 59 68 float 0
utm_northing_of_last_record 69 78 float 0
blank_padding 79 104 char 0

ASCII_data Aeromagnetic ASCII Data Format
flight_line_number 1 5 long 0
fiducial_number 6 15 long 0
utm_easting_meters 16 25 float 0
utm_northing_meters 26 35 float 0
mag_total_field_intensity_nT 36 45 long 0
mag_residual_field_nT 46 55 long 0
alt_radar_meters 56 65 long 0
alt_barometric_meters 66 75 long 0
blank 76 80 char 0
latitude 81 92 float 6
longitude 93 104 float 6

binary_data Aeromagnetic Binary Data Format
flight_line_number 1 4 long 0
fiducial_number 5 8 long 0
utm_easting_meters 9 12 long 0
utm_northing_meters 13 16 long 0
mag_total_field_intensity_nT 17 20 long 0
mag_residual_field_nT 21 24 long 0
alt_radar_meters 25 28 long 0
alt_barometric_meters 29 32 long 0
blank 33 37 char 0
latitude 38 41 long 6
longitude 42 45 long 6</pre>
</div>
</div>
<div class="paragraph">
<p>The example ASCII file <em>aeromag.dat</em> contains two record headers
followed by a number of data records. The header and data formats are
described in <em>aeromag.fmt</em>. The variable count (second variable
defined in the header format description) is used to indicate how many
data records occur after each header.</p>
</div>
<div class="listingblock">
<div class="title">aeromag.dat</div>
<div class="content">
<pre class="nowrap">1         2         3         4         5         6         7         8         9         10
123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345

420       5     5272     178       2   413669.  6669740.   333345.  6751355.

420      5272   413669.  6669740.   2715963   2715449      1088      1348        60.157307 -154.555191

420      5273   413635.  6669773.   2715977   2715464      1088      1350        60.157593 -154.555817

420      5274   413601.  6669807.   2716024   2715511      1088      1353        60.157894 -154.556442

420      5275   413567.  6669841.   2716116   2715603      1079      1355        60.158188 -154.557068

420      5276   413533.  6669875.   2716263   2715750      1079      1358        60.158489 -154.557693

411      10     8366     178       2   332640.  6749449.   412501.  6668591.

411      8366   332640.  6749449.   2736555   2736538       963      1827        60.846806 -156.080185

411      8367   332674.  6749415.   2736539   2736522       932      1827        60.846516 -156.079529

411      8368   332708.  6749381.   2736527   2736510       917      1829        60.846222 -156.078873

411      8369   332742.  6749347.   2736516   2736499       922      1832        60.845936 -156.078217

411      8370   332776.  6749313.   2736508   2736491       946      1839        60.845642 -156.077560

411      8371   332810.  6749279.   2736505   2736488       961      1846        60.845348 -156.076904

411      8372   332844.  6749245.   2736493   2736476       982      1846        60.845062 -156.076248

411      8373   332878.  6749211.   2736481   2736463      1015      1846        60.844769 -156.075607

411      8374   332912.  6749177.   2736470   2736452      1029      1846        60.844479 -156.074951

411      8375   332946.  6749143.   2736457   2736439      1041      1846        60.844189 -156.074295</pre>
</div>
</div>
<div class="paragraph">
<p>This file contains two record headers. The first occurs on the first
line of the file and has a count of 5, so it is followed by 5 data
records. The second record header follows the first 5 data records. It
has a count of 10 and is followed by 10 data records.</p>
</div>
<div class="paragraph">
<p>The FreeForm ND default naming conventions have been used here so you
could use the following abbreviated command to reformat
<em>aeromag.dat</em> to a binary file named <em>aeromag.bin</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform aeromag.dat -o aeromag.bin</pre>
</div>
</div>
<div class="paragraph">
<p>The ASCII record headers are written into the binary file as ASCII
text.</p>
</div>
</div>
<div class="sect5">
<h6 id="_separate_header_files">Separate Header Files</h6>
<div class="paragraph">
<p>You may need to describe a data set with external headers. An external or separate header file can contain only headers-one file header or multiple record headers.</p>
</div>
<div class="sect6">
<h7 id="_separate_file_header">Separate File Header</h7>
<div class="paragraph">
<p>Suppose you want the file header used to store the minimum and maximum
values for latitude and longitude (from the llmaxmin example) in a
separate file so that the data file is homogenous, thus easier for
applications to read. Instead of one ASCII file (<em>llmaxmin.dat</em>),
you will have an ASCII header file, say it is named <em>llmxmn.hdr</em>,
and an ASCII data file-call it <em>llmxmn.dat</em>.</p>
</div>
<div class="listingblock">
<div class="title">llmxmn.hdr</div>
<div class="content">
<pre class="nowrap">Latitude and Longitude:   -83.223548 54.118314  -176.161101 149.408117</pre>
</div>
</div>
<div class="listingblock">
<div class="title">llmxmn.dat</div>
<div class="content">
<pre class="nowrap">-47.303545 -176.161101
-25.928001    0.777265
-28.286662   35.591879

12.588231  149.408117
-83.223548   55.319598

54.118314 -136.940570

38.818812   91.411330
-34.577065   30.172129

27.331551 -155.233735

11.624981 -113.660611</pre>
</div>
</div>
<div class="paragraph">
<p>You will need to make one change to <em>llmaxmin.fmt</em>, adding the
qualifier separate to the header descriptor, so that FreeForm ND will
look for the header in a separate file. The first line of
<em>llmaxmin.fmt</em> becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_file_header_separate Latitude/Longitude Limits</pre>
</div>
</div>
<div class="paragraph">
<p>Save <em>llmaxmin.fmt</em> as <em>llmxmn.fmt</em> after you make the change.</p>
</div>
<div class="paragraph">
<p>To convert the data in <em>llmxmn.dat</em> to binary format in
<em>llmxmn.bin</em>, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform llmxmn.dat -o llmxmn.bin</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you run <em>newform</em>, it will write the separate header to <em>llmxmn.bin</em> along with the data in <em>llmxmn.dat</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_separate_record_headers">Separate Record Headers</h7>
<div class="paragraph">
<p>Record headers in separate files can act as indexes into data files if
the headers specify the positions of the data in the data file. For
example, if you have a file containing data from 25 observation
stations, you could effectively index the file by including a station
ID and the starting position of the data for that station in each
record header. Then you could use the index to quickly locate the data
for a particular station.</p>
</div>
<div class="paragraph">
<p>Returning to the <em>aeromag</em> example, suppose you want to place the
two record headers in a separate file. Again, the only change you need
to make to the format description file (<em>aeromag.fmt</em>) is to add
the qualifier separate to the header descriptor. The first line would
then be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_record_header_separate Aeromagnetic Record Header Format</pre>
</div>
</div>
<div class="paragraph">
<p>The separate header file would contain the following two lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">420       5     5272     178       2   413669.  6669740.   333345.  6751355.
411      10     8366     178       2   332640.  6749449.   412501.  6668591.</pre>
</div>
</div>
<div class="paragraph">
<p>The data file would look like the current <em>aeromag.dat</em> with the
first and seventh lines removed.</p>
</div>
<div class="paragraph">
<p>Assuming the data file is named <em>aeromag.dat</em>, the default name
and location of the header file would be <em>aeromag.hdr</em> in the same
directory as the data file. Otherwise, the separate header file name
and location need to be defined in an equivalence table. (For
information about equivalence tables, see the GeoVu Tools Reference
Guide.)</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_dbasefile_format">The dBASEfile Format</h6>
<div class="paragraph">
<p>Headers and data records in dBASE format are represented in ASCII but
are not separated by end-of-line characters. They can be difficult to
read or to use in applications that expect newlines to separate
records. By using <em>newform</em>, dBASE data can be reformatted to
include end-of-line characters.</p>
</div>
<div class="paragraph">
<p>In this example, you will reformat the dBASE data file
<em>oceantmp.dab</em> (see below) into the ASCII data file
<em>oceantmp.dat</em>. The input file <em>oceantmp.dab</em> contains a
record header at the beginning of each line. The header is followed by
data on the same line. When you convert the file to ASCII, the header
will be on one line followed by the data on the number of lines
specified by the variable count. The format description file
<em>oceantmp.fmt</em> is used for this reformatting.</p>
</div>
<div class="listingblock">
<div class="title">oceantmp.fmt</div>
<div class="content">
<pre class="nowrap">dbase_record_header NODC-01 record header format
WMO_quad 1 1 char 0
latitude_deg_abs 2 3 uchar 0
latitude_min 4 5 uchar 0
longitude_deg_abs 6 8 uchar 0
longitude_min 9 10 uchar 0
date_yymmdd 11 16 long 0
hours 17 19 uchar 1
country_code 20 21 char 0
vessel 22 23 char 0
count 24 26 short 0
data_type_code 27 27 char 0
cruise 28 32 long 0
station 33 36 short 0

dbase_data IBT input format
depth_m 1 4 short 0
temperature 5 8 short 2

RETURN NEW LINE INDICATOR

ASCII_data ASCII output format
depth_m 1 5 short 0
temperature 27 31 float 2</pre>
</div>
</div>
<div class="paragraph">
<p>This format description file contains a header format description, a
description for dBASE input data, the special RETURN descriptor, and a
description for ASCII output data. The variable <em>count</em> (fourth
from the bottom in the header format description) indicates the number
of data records that follow each header. The descriptor RETURN lets
<em>newform</em> skip over the end-of-line marker at the end of each data
block in the input file <em>oceantmp.dab</em> as it is meaningless to
<em>newform</em> here. Because the end-of-line marker appears at the end
of the data records in each input data block, RETURN is placed after
the input data format description in the format description file.</p>
</div>
<div class="listingblock">
<div class="title">oceantmp.dab</div>
<div class="content">
<pre class="nowrap">1         2         3         4         5         6         7
1234567890123456789012345678901234567890123456789012345678901234567890
11000171108603131109998  4686021000000002767001027670020276700302767
110011751986072005690AM  4686091000000002928001028780020287200302872
11111176458102121909998  4681011000000002728009126890241110005000728
112281795780051918090PI  268101100000000268900402711</pre>
</div>
</div>
<div class="paragraph">
<p>Each dBASE header in <em>oceantmp.dab</em> is located from position 1 to
36. It is followed by four data records of 8 bytes each. Each record
comprises a depth and temperature reading. The variable count in the
header (positions 24-26) indicates that there are 4 data records each
in the first 3 lines and 2 on the last line. This will all be more
obvious after conversion.</p>
</div>
<div class="paragraph">
<p>To reformat <em>oceantmp.dab</em> to ASCII, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform oceantmp.dab -o oceantmp.dat</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting file <em>oceantmp.dat</em> is much easier to read. It is
readily apparent that there are 4 data records after the first three
headers and 2 after the last.</p>
</div>
<div class="listingblock">
<div class="title">oceantmp.dat</div>
<div class="content">
<pre class="nowrap">1         2         3         4
1234567890123456789012345678901234567890
11000171108603131109998  46860210000

0                     27.67

10                     27.67

20                     27.67

30                     27.67
110011751986072005690AM  46860910000

0                     29.28

10                     28.78

20                     28.72

30                     28.72
11111176458102121909998  46810110000

0                     27.28

91                     26.89

241                     11.00

500                     07.28
112281795780051918090PI  26810110000

0                     26.89

40                     27.11</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ff-server">11.D.6. The OPeNDAP FreeForm ND Data Handler</h4>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler is a OPeNDAP server add-on that uses OPeNDAP FreeForm ND to convert and serve data
in formats that are not directly supported by existing <a href="#hyrax-overview">Hyrax</a> data handlers.  Bringing
OPeNDAP FreeForm ND 's data conversion capacity into the OPeNDAP world widens data
access for DAP2 clients, since any format that can be described in
OPeNDAP FreeForm ND can now be served by the OPeNDAP data server.</p>
</div>
<div class="paragraph">
<p>Like all DAP2 servers, the OPeNDAP FreeForm ND Data Handler responds to client requests for data
by returning either data values or information about the data.  It
differs from other DAP2 servers because it invokes OPeNDAP FreeForm ND to read the
data from disk before serving it to the client.</p>
</div>
<div class="paragraph">
<p>The following sequence of steps illustrates how the OPeNDAP FreeForm ND Data Handler works:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A DAP2 client sends a request for data to a OPeNDAP FreeForm ND Data Handler .  The request must include the name of the file that contains the data, and may include a constraint expression to sample the data.</p>
</li>
<li>
<p>The OPeNDAP FreeForm ND Data Handler looks in its path for two files: a data file with the name sent by the client, and a format definition file to use with the data file.  The format definition file contains a description of the data format, constructed according to the OPeNDAP FreeForm ND syntax.</p>
</li>
<li>
<p>The server uses both files in invoking the OPeNDAP FreeForm ND engine.  The OPeNDAP FreeForm ND engine reads the data file and the format file, using the instructions in the latter to convert the former into data which is then passed back to the OPeNDAP FreeForm ND Data Handler .</p>
</li>
<li>
<p>On receiving the converted data, the OPeNDAP FreeForm ND Data Handler converts the data into the DAP2 transmission format.  The conversion may involve some adjustment of data types; these are listed below.  The server also applies any constraint expressions the client sent along with the URL.</p>
</li>
<li>
<p>The server then constructs DDS and DAS files based on the format of the converted data.  If the server has access to DDS and DAS files that describe the data, it applies those definition before sending them back to the client.</p>
</li>
<li>
<p>Finally, the server sends the DDS, DAS, and converted data back to the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For information about how to write a OPeNDAP FreeForm ND data description, refer to
the <a href="#tblfmt">Table Format</a> for sequence data and
<a href="#arrayfmt">Array Format</a> for array data.</p>
</div>
<div class="paragraph">
<p>For an introduction to DAP2 and to the OPeNDAP project, please refer
to The Opendap User Guide.</p>
</div>
<div class="sect4">
<h5 id="_differences_between_opendap_freeform_nd_and_the_opendap_freeform_nd_data_handler">Differences between OPeNDAP FreeForm ND and the OPeNDAP FreeForm ND Data Handler</h5>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler is based on the same libraries used to make the OPeNDAP FreeForm ND utilities.  However, there are some important differences in the
resulting software:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The OPeNDAP FreeForm ND Data Handler is a OPeNDAP FreeForm ND application that converts data <em>on receiving a client request for that data</em>, and not before.  Data served by the OPeNDAP FreeForm ND Data Handler remains in its original format.</p>
</li>
<li>
<p>The OPeNDAP FreeForm ND Data Handler does not produce an output file containing the converted data, but serves it directly over the network to the DAP2 client.  Therefore, the OPeNDAP FreeForm ND Data Handler ignores the output section of the format definition file.</p>
</li>
<li>
<p>To sample a data file, you do not write format definitions that cause the OPeNDAP FreeForm ND engine to sample the data file.  Instead, you add a DAP2 "constraint expression" to the URL that the client sends to the OPeNDAP FreeForm ND Data Handler .</p>
</li>
<li>
<p>The OPeNDAP FreeForm ND Data Handler performs data conversion on the fly.  Conversion only takes place when the client sends a URL requesting data from the OPeNDAP FreeForm ND Data Handler .</p>
</li>
<li>
<p>Unlike OPeNDAP FreeForm ND , there is no static file created by the conversion.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(If you wish to create or work with such a file, use the OPeNDAP FreeForm ND
utilities, such as <em>newform</em>.)</p>
</div>
</div>
<div class="sect4">
<h5 id="_data_type_conversions">Data Type Conversions</h5>
<div class="paragraph">
<p>The OPeNDAP FreeForm ND Data Handler performs data conversions, based on the data it receives
from the OPeNDAP FreeForm ND engine.  Note that OPeNDAP does not recommend the use of
<em>int64</em> and <em>uint64</em> in the format definition file.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>DAP2 Data Type Conversions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8, unit8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32, int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32, uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64, enote</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float64</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_conversion_examples">Conversion Examples</h6>
<div class="paragraph">
<p>The examples show how the OPeNDAP FreeForm ND Data Handler treats data
received from the OPeNDAP FreeForm ND engine.  Please see the OPeNDAP
FreeForm ND Data Handler distribution for more test data and format
definition files, and the <a href="#tblfmt">Table Format</a> for
more information on writing format definitions.</p>
</div>
<div class="sect6">
<h7 id="_arrays">Arrays</h7>
<div class="paragraph">
<p>If you define a variable as an array in the OPeNDAP FreeForm ND format definition
file, the OPeNDAP FreeForm ND Data Handler produces an array of variables with matching types.</p>
</div>
<div class="paragraph">
<p>For exmple, this entry in the format definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">binary_input_data array
fvar1 1 4 ARRAY[records 1 to 101] of int32 0</pre>
</div>
</div>
<div class="paragraph">
<p>in converted by the OPeNDAP FreeForm ND Data Handler to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Int32 fvar1[records = 101]</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_collections_of_variables">Collections of Variables</h7>
<div class="paragraph">
<p>If you define several variables in the format definition file, the
OPeNDAP FreeForm ND Data Handler produces a Sequence of variables with matching types.</p>
</div>
<div class="paragraph">
<p>For example, this entry in the format definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_input_data ASCII_data
fvar1   1 10  int32 2
svar1  13 18  int16 0
usvar1 21 26 uint16 1
lvar1  29 39  int32 0
ulvar1 42 52 uint32 4</pre>
</div>
</div>
<div class="paragraph">
<p>is converted by the OPeNDAP FreeForm ND Data Handler to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Sequence {
Int32 fvar1;
Int32 svar1;

...
} ASCII_data;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_multiple_arrays">Multiple Arrays</h7>
<div class="paragraph">
<p>If you define a collection of arrays in the format definition file, as
you would expect, the OPeNDAP FreeForm ND Data Handler produces a dataset containing multiple
arrays.</p>
</div>
<div class="paragraph">
<p>For example, this entry in the format definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">binary_input_data arrays
fvar1 1 4 ARRAY[records 1 to 101] of int32 0
fvar2 1 4 ARRAY[records 1 to 101] of int32 0</pre>
</div>
</div>
<div class="paragraph">
<p>is converted by the OPeNDAP FreeForm ND Data Handler to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
Int32 fvar1[records=101]
Int32 fvar2[records=101]
};</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fileserv">11.D.7. File Servers</h4>
<div class="paragraph">
<p>The DODS and OPEnDAP projects have used the OPeNDAP FreeForm ND
Data Handler to present a catalog of data files to the world as a
single dataset. In many ways this was a very successful system,
providing catalogs for multi-granule
datasets that could be searched by date and time. However, the OPeNDAP
project has decided (winter 2006) to adopt the THREDDS xml-based
catalog system developed at Unidata, Inc. The remainder of this
chapter describes the 'file servers' that can be built using the
FreeForm data handler. Even though we feel it&#8217;s best to adopt the
THREDDS catalogs, there are good reasons to keep existing catalog
servers running and to build new catalogs as a stop-gap measure to
support existing client software.</p>
</div>
<div class="paragraph">
<p>Normally, in the OPeNDAP
argot, a "dataset" is contained in a single file on a disk. However,
this paradigm is often broken by large datasets that may contain many
thousands or tens of thousands of data files. The OPeNDAP file server is
a way to make these dicrete datasets appear to be a single large
dataset.</p>
</div>
<div class="paragraph">
<p>The OPeNDAP file server is an OPeNDAP server that returns a URL or set of
URLs in response to a query containing selection variables.  For
example, a dataset organized by date and geographic location might
provide a file server that allowed you to query the dataset with a
range of dates and longitudes.  This fileserver would return a list of
one or more URLs corresponding to files within that dataset that fell
within the given range.</p>
</div>
<div class="sect4">
<h5 id="_the_problem">The Problem</h5>
<div class="paragraph">
<p>Consider the following (imaginary) list of files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1997360.nc  1998001.nc  1998007.nc  1998013.nc ...
1997361.nc  1998002.nc  1998008.nc  1998014.nc
1997362.nc  1998003.nc  1998009.nc  1998015.nc
1997363.nc  1998004.nc  1998010.nc  1998016.nc
1997364.nc  1998005.nc  1998011.nc  1998017.nc
1997365.nc  1998006.nc  1998012.nc  1998018.nc</pre>
</div>
</div>
<div class="paragraph">
<p>These appear to be a set of netCDF files, arranged by
date. (A serial date, with a year and the day of the year,
expressed in an ordinal number from 1 to 365 or 366.)</p>
</div>
<div class="paragraph">
<p>If you want data from the first week of January, 1998, it is fairly
clear which files to request.  However, the OPeNDAP server provides
no way to request data from more than one file, so your request would
have to be split into 7 different requests, from <em>1998001.nc</em> to
<em>1998007.nc</em>.  This could be represented as a set of seven DODS
URLs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://opendap/dap/data/1998001.nc
http://opendap/dap/data/1998002.nc
http://opendap/dap/data/1998003.nc
http://opendap/dap/data/1998004.nc
http://opendap/dap/data/1998005.nc
http://opendap/dap/data/1998006.nc
http://opendap/dap/data/1998007.nc</pre>
</div>
</div>
<div class="paragraph">
<p>But what if you then uncover another similar dataset whose data you
want to compare to the first?  Or what if you want to expand the
inquiry to cover the entire year?  Keeping track of this many URLs
will quickly become burdensome.</p>
</div>
<div class="paragraph">
<p>What&#8217;s more, another similar dataset could be arranged in two
different directories, <em>1997</em> and <em>1998</em>, each with files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">001.nc
002.nc
003.nc
...</pre>
</div>
</div>
<div class="paragraph">
<p>and so on.  Now you have to keep track of two large sets of URLs, in
two different forms.  But you could also imagine files called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">0011998.nc
0021998.nc
0031998.nc</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">00198.nc
00298.nc
00398.nc</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1Jan98.nc
2Jan98.nc
3Jan98.nc</pre>
</div>
</div>
<div class="paragraph">
<p>That is, the number of possible sensible arrangements may not, in
fact, be infinite, but it may seem that way to a scientist who is
simply trying to find data.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_opendap_file_server_solution">The OPeNDAP File Server Solution</h5>
<div class="paragraph">
<p>To create a system that allows data providers to assert a degree of
uniformity over wildly variable dataset organizations, OPeNDAP
provides for the installation of an OPeNDAP \new{file server}. The
file server is a server that provides access to a special dataset,
containing associations between the names of files within a dataset
and some "selectable" data values.</p>
</div>
<div class="sect5">
<h6 id="_selectable_data">Selectable Data</h6>
<div class="paragraph">
<p>The concept of \new{selectable data} requires some explanation.  This
is used to indicate the data variables you might ordinarily use to
narrow your search for data in the first pass at a dataset.</p>
</div>
<div class="paragraph">
<p>For geophysical data, the selectable data is often the time and
location of the data, since typical searches for data often begin by
specifying a part of the globe that bears examining, or a date of some
event.  For other types of data, other data variables will seem more
appropriate.  Model data, for example, which has no real location or
time, might be arranged by the parameters that varied between runs.</p>
</div>
<div class="paragraph">
<p>A comprehensive definition of selectable data has so far eluded the
OPeNDAP group, but there are some guidelines, albeit fairly vague ones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The selectable data is generally <em>not</em>  recorded within each data file.
However, the selectable data may often include a <em>range</em>  summarizing
some of the data within each file.</p>
</li>
<li>
<p>The selectable data should help a user decide whether a particular
data file in a dataset is useful.  A temperature range might not be
as useful as a time range, since data searches more often start with
time.  (Both would presumably be still more useful,but there is a
trade-off between the utility of the file server and the time spent
maintaining it.)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_what_it_looks_like">What It Looks Like</h6>
<div class="paragraph">
<p>Consider again the set of data files shown in (<em>fs,problem</em>).
We could associate each one of these files with a date, and this would
provide the rudiments of a file server if we then serve that data with
an OPeNDAP server such as the OPeNDAP FreeForm ND Data Handler .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1997/360 http://opendap/dap/data/1997360.nc
1997/361 http://opendap/dap/data/1997361.nc
1997/362 http://opendap/dap/data/1997362.nc
1997/363 http://opendap/dap/data/1997363.nc
1997/364 http://opendap/dap/data/1997364.nc
1997/365 http://opendap/dap/data/1997365.nc
1998/001 http://opendap/dap/data/1998001.nc
1998/002 http://opendap/dap/data/1998002.nc
1998/003 http://opendap/dap/data/1998003.nc
1998/004 http://opendap/dap/data/1998004.nc
1998/005 http://opendap/dap/data/1998005.nc
1998/006 http://opendap/dap/data/1998006.nc
1998/007 http://opendap/dap/data/1998007.nc
1998/008 http://opendap/dap/data/1998008.nc
1998/009 http://opendap/dap/data/1998009.nc
1998/010 http://opendap/dap/data/1998010.nc</pre>
</div>
</div>
<div class="paragraph">
<p>This list represents a set of DAP URLs, each identified by a date,
given as a year and a serial day.  The files appear to be netCDF
format files, served by an OPeNDAP netCDF server, but that is not
important for this discussion.</p>
</div>
<div class="paragraph">
<p>To use the OPeNDAP FreeForm ND Data Handler for your file server, you could use a format
description file with an input section like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_input_data File Server Example Input
year 1 4 short 0
serial_day 6 8 short 0
DODS_Url 10 46 char 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="convs">11.D.8. FreeForm ND Conventions</h4>
<div class="paragraph">
<p>File name conventions have been defined for FreeForm ND. If you follow
these conventions, FreeForm ND can locate format files through a
default search sequence. Using the file name conventions also lets you
reduce the number of arguments on the command line. In addition to
standard file names, FreeForm ND programs recognize various standard
command line arguments.</p>
</div>
<div class="sect4">
<h5 id="_file_name_conventions">File Name Conventions</h5>
<div class="paragraph">
<p>Naming conventions have been established for files accessed by
FreeForm ND. Although you are not required to follow these
conventions, using them lets you enter abbreviated commands when you
are using FreeForm ND-based programs. FreeForm ND can then
automatically execute several operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determination of input and output formats when they are not explicitly identified in the relevant format descriptions in format files</p>
</li>
<li>
<p>Location of format files when they are not specified on the command line</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_file_name_extensions">File Name Extensions</h5>
<div class="paragraph">
<p>The expected extensions for data files are as follows:</p>
</div>
<div class="paragraph">
<p><strong>.dat:</strong> For ASCII, e.g., <em>latlon.dat</em></p>
</div>
<div class="paragraph">
<p><strong>.dab:</strong> For dBASE, e.g., <em>latlon.dab</em></p>
</div>
<div class="paragraph">
<p><strong>.bin:</strong> binary or anything that is not <em>.dat</em> or <em>.dab</em>, e.g., <em>latlon.bin</em></p>
</div>
<div class="paragraph">
<p>The expected extension for format description files is <em>.fmt</em>, e.g.,
<em>latlon.fmt</em>. You should not use mixed case extensions for format
description files if you want to take advantage of FreeForm ND&#8217;s
default search capabilities. If you explicitly specify the names of
format description files on the command line, you can use mixed case
extensions.</p>
</div>
<div class="paragraph">
<p>Previous versions of FreeForm ND used variable description files
(formerly called format specification files) each of which contained
variable descriptions for one file. Expected extensions for these
files were <em>.afm</em> (ASCII), <em>.bfm</em> (binary), and <em>.dfm</em> (dBASE). Variable descriptions for one or more files can now be
incorporated into a single format description file. It is
recommended that you convert and combine (as appropriate) existing
variable description files into format description files.</p>
</div>
</div>
<div class="sect4">
<h5 id="_file_name_relationships">File Name Relationships</h5>
<div class="paragraph">
<p>FreeForm ND-based programs expect certain relationships between data
file and format description file names as outlined below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data file is named datafile.ext where datafile is the file name of your choosing and ext is the extension. Example: <em>latlon.dat</em></p>
</li>
<li>
<p>The corresponding format description file should be named datafile.fmt. Example: <em>latlon.fmt</em></p>
</li>
<li>
<p>If one format description file is used for multiple data files, all with the same extension, the format description file should be named ext.fmt. Example: <em>ll.fmt</em> is the format description file for <em>lldat1.ll</em>, <em>lldat2.ll</em>, and <em>lldat3.ll</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again, although not required, it is to your advantage to use these
conventions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_determining_input_and_output_formats">Determining Input and Output Formats</h5>
<div class="paragraph">
<p>You can optionally include the read/write type ("<em>input</em>" or
"<em>output</em>") in format descriptors, e.g.,
<em>ASCII_input_data</em>. You may not want to specify the read/write
type in some circumstances. For example, you may need to translate
from native ASCII to binary, then back to ASCII. ASCII is the input
format in the first translation and the output format in the second
translation, vice versa for binary. You would need to edit the format
description file before executing the second translation if you
included read/write type in the format descriptors.</p>
</div>
<div class="paragraph">
<p>If you use the -ft option, you do not need to edit the format
description file. See below.
If you do not specify read/write type, FreeForm ND can nevertheless
determine which format in a format description file is input and which
is output as long as you have adhered to FreeForm ND filenaming
conventions.</p>
</div>
<div class="paragraph">
<p>If the input format is not specified, and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the input data filename extension is <em>.bin</em>, assume binary input.</p>
</li>
<li>
<p>the input data filename extension is <em>.dab</em>, assume dBASE input.</p>
</li>
<li>
<p>the input data filename extension is <em>.dat</em>, assume ASCII input.</p>
</li>
<li>
<p>the input data filename extension is anything else, assume binary input.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the output format is not specified, and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the input format is dBASE, the output is ASCII or binary, whichever is found first.</p>
</li>
<li>
<p>the input format is ASCII, the output is binary or dBASE, whichever is found first.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The appropriate format descriptions must be in the format
description file(s) used by FreeForm ND for a translation. If, for
example, FreeForm ND determines the input format is binary and the
output format is ASCII, there must be a format description for each
type. The checkvar program needs only an input format.</p>
</div>
</div>
<div class="sect4">
<h5 id="_locating_format_files">Locating Format Files</h5>
<div class="paragraph">
<p>FreeForm ND programs use the following search sequence to find a
format file (format or variable description file) for the data file
datafile.ext when the format file name is not explicitly specified on
the command line. In summary, FreeForm ND searches the directory
specified by the GeoVu keyword <em>format_dir</em> (defined in a equivalence
table or in the environment), the current or working directory, and
the data file&#8217;s home directory. The rules are applied in the order
given below until a format file is found or all rules have been
exhausted. If the relevant format file does not follow FreeForm ND
conventions for name or location, it should be explicitly specified on
the command line.</p>
</div>
<div class="paragraph">
<p>GeoVu is a FreeForm ND-based application for data access and
visualization. FreeForm ND applications other than GeoVu use GeoVu</p>
</div>
<div class="paragraph">
<p>keywords.
For information about equivalence tables, see the GeoVu Tools
Reference Guide, available from the NGDC.</p>
</div>
<div class="sect5">
<h6 id="_search_sequence">Search Sequence</h6>
<div class="ulist">
<ul>
<li>
<p>Search the directory given by the GeoVu keyword <em>format_dir</em> for a format description file named datafile.fmt.</p>
</li>
<li>
<p>Search the directory given by the GeoVu keyword <em>format_dir</em> for variable description files named <em>datafile.afm</em>, <em>datafile.bfm</em>, and <em>datafile.dfm</em>. Step 2 is included to accommodate variable description files that were created using previous versions of FreeForm ND. It is recommended that you convert existing variable description files to format description files.</p>
</li>
<li>
<p>Search the directory given by the GeoVu keyword <em>format_dir</em> for a format description file named ext.fmt. If the GeoVu keyword <em>format_dir</em> is not found, FreeForm ND continues the search for a format file as follows.</p>
</li>
<li>
<p>Search the current (default) directory for a format description file named datafile.fmt.</p>
</li>
<li>
<p>Search the current directory for variable description files named <em>datafile.afm</em>, <em>datafile.bfm</em>, and <em>datafile.dfm</em>. Use the criteria in step 2 for determining input and output format files.</p>
</li>
<li>
<p>Search the current directory for a format description file named <em>ext.fmt</em>. If the data file&#8217;s home directory is not the same as the current directory, FreeForm ND continues the search for a format file with steps 7-9. The data file&#8217;s home directory is given by the directory path component of the data file name. If the data file name has no directory path component, the home directory search is not done.</p>
</li>
<li>
<p>Search the data file&#8217;s home directory for a format description file named <em>datafile.fmt</em>.</p>
</li>
<li>
<p>Search the data file&#8217;s home directory for variable description files named <em>datafile.afm</em>, <em>datafile.bfm</em>, and <em>datafile.dfm</em>. Use the criteria in step 2 for determining input and output format files.</p>
</li>
<li>
<p>Search the data file&#8217;s home directory for a format description file named <em>ext.fmt</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_case_sensitivity">Case Sensitivity</h6>
<div class="paragraph">
<p>FreeForm ND adheres to the following rules for case sensitivity (in
applicable operating systems) when it searches for a format file for
the data file datafile.ext.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FreeForm ND preserves the case of datafile, for example, the default format file for the data file <em>LATLON.BIN</em> is <em>LATLON.fmt</em> (or <em>LATLON.bfm</em>).</p>
</li>
<li>
<p>FreeForm ND searches for a format file with a lower case extension. That is, the format file must have its extension in lower case no matter what the case of datafile. For example, the default format file for the data file <em>LatLon.dat</em> is <em>LatLon.fmt</em> (or <em>LatLon.afm</em>), and <em>TIMEDATE.fmt</em> (or <em>TIMEDATE.bfm</em>) is the default format file for <em>TIMEDATE.bin</em>.</p>
</li>
<li>
<p>In searching for a format description file of type <em>ext.fmt</em>, FreeForm ND preserves the case of ext. For example, for data files named <em>lldat1.LL</em>, <em>lldat2.LL</em>, and <em>latlon3.LL</em>, the default format description file is <em>LL.fmt</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_command_line_arguments">Command Line Arguments</h5>
<div class="paragraph">
<p>FreeForm ND programs can take various command line arguments. The most
widely used or standard arguments are discussed in this section. They
are used for several different purposes: identifying input and output
files, identifying format files and titles, changing run-time
operation parameters, and defining data filters.</p>
</div>
<div class="paragraph">
<p>The only required argument for any FreeForm ND program is the name of
the input file or file to be processed. All other arguments are
optional and can be in any order following the input file name. The
command line of a FreeForm ND program with the standard arguments has
the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">application_name input_file [-f format_file]

[-if input_format_file] [-of output_format_file] [-ft "title"] [-ift "title"] [-oft "title"] [-b local_buffer_size] [-c count] [-v var_file] [-q query_file] [-o output_file]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To see a summary of command line usage for a FreeForm ND
program, enter the program&#8217;s name on the command line without any
arguments.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_specifying_input_and_output_files">Specifying Input and Output Files</h6>
<div class="paragraph">
<p><strong>input_file:</strong>
Name of the file to be processed. Following FreeForm ND naming
conventions, the standard extensions for data files are <em>.dat</em> for ASCII format, <em>.bin</em> for binary, and <em>.dab</em> for dBASE.</p>
</div>
<div class="paragraph">
<p><strong>-o output_file:</strong>
Option flag followed by the name of the output file. The standard extensions are the same as for input files.</p>
</div>
</div>
<div class="sect5">
<h6 id="_specifying_format_description_source">Specifying Format Description Source</h6>
<div class="paragraph">
<p>FreeForm ND offers a number of command line options for specifying the
source of the format descriptions that a program must find in order to
process data. The proper option or combination of options to use
depends on how you have constructed your format files.</p>
</div>
<div class="paragraph">
<p><strong>-f format_file:</strong>
Option flag followed by the name of the format description file
describing both input and output data.</p>
</div>
<div class="paragraph">
<p><strong>-if input_format_file:</strong>
Option flag followed by the name of the format description file describing the input data. Also use this option for an input variable description file written using earlier versions of FreeForm ND.</p>
</div>
<div class="paragraph">
<p><strong>-of output_format_file:</strong>
Option flag followed by the name of the format description file describing the output data. Also use this option for an output variable description file written using earlier versions of FreeForm ND.</p>
</div>
<div class="paragraph">
<p><strong>-ft title:</strong>
Option flag followed by the title (enclosed in quotes) of the format to be used for both input and output data, in which case there is no reformatting. The title follows format type on the first line of a format description in a format description file.</p>
</div>
<div class="paragraph">
<p><strong>-ift title:</strong>
Option flag followed by the title (enclosed in quotes) of the desired input format.</p>
</div>
<div class="paragraph">
<p><strong>-oft title:</strong>
Option flag followed by the title (enclosed in quotes) of the desired output format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Previous versions of FreeForm ND used variable description files
(<em>.afm</em>, <em>.bfm</em>, <em>.dfm</em>). It is recommended that you
convert and combine (as appropriate) existing variable description
files into format description files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The various options available for specifying the source of a format
description offer you a great deal of flexibility-in naming files,
setting up format description files, and on the command line. In using
these options, you need to consider the content of your format
description files and how FreeForm ND will interpret the arguments on
the command line.</p>
</div>
</div>
<div class="sect5">
<h6 id="_changing_run_time_parameters">Changing Run-time Parameters</h6>
<div class="paragraph">
<p>FreeForm ND includes three arguments that let you change run-time
parameters according to your needs. One argument lets you specify
local buffer size, another indicates the number of records to process,
and the third indicates which variables to process.</p>
</div>
<div class="paragraph">
<p><strong>-b local_buffer_size:</strong>
Option flag followed by the size of the memory buffer used to
process the data and format files. Default buffer size is 32,768. You many want to decrease the buffer size if you are running with low memory. Keep in mind that too small a buffer may result in unexpected behavior.</p>
</div>
<div class="paragraph">
<p><strong>-c count:</strong>
Option flag followed by a number that specifies how many data
records at the head or tail of the file to process. If &lt;mathcount  0&lt;/math, <em>count</em> records at the beginning of the file are processed. If &lt;mathcount &lt; 0&lt;/math, <em>count</em> records at the tail or end of the file are processed.</p>
</div>
<div class="paragraph">
<p><strong>-v var_file:</strong>
Option flag followed by the name of a variable file. The file
contains names of the variables in the input data file to be processed by the FreeForm ND program. Variable names in var_file can be separated by one or more spaces or each name can be on a separate line.</p>
</div>
</div>
<div class="sect5">
<h6 id="_defining_filters">Defining Filters</h6>
<div class="paragraph">
<p>The query option lets you define data filters via a query file so you
can precisely specify which data to process. The FreeForm ND program
will process only those records meeting the query criteria.</p>
</div>
<div class="paragraph">
<p><strong>-q query_file:</strong>
Option flag followed by the name of the file containing query
criteria.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fmtconv">11.D.9. Format Conversion</h4>
<div class="paragraph">
<p>The FreeForm ND utility program newform lets you convert data from one
format to another. This allows you to pass data to applications in the
format they require. You may also want to create binary archives for
efficient data storage and access. With newform, conversion of ASCII
data to binary format is straightforward. If you wish to read the data
in a binary file, you can convert it to ASCII with newform, or use the
interactive program readfile. You can also convert data from one ASCII
format to another ASCII format with newform.</p>
</div>
<div class="sect4">
<h5 id="_newform"><em>newform</em></h5>
<div class="paragraph">
<p>The FreeForm ND-based program <em>newform</em> is a general tool for changing the format ofa data file. The only required command line argument, if you use FreeForm ND naming conventions, is the name of the input data file.
The reformatted data is written to standard output (the screen) unless
you specify an output file. If you reformat to binary, you will
generally want to store the output in a file.</p>
</div>
<div class="paragraph">
<p>You must create a format description file (or files) with format
descriptions for the data files involved in a conversion before you
can use <em>newform</em> to perform the conversion. The standard
extension for format description files is <em>.fmt</em>. If you do not
explicitly specify the format description file on the command line,
which is unnecessary if you use FreeForm ND naming conventions,
<em>newform</em> follows the FreeForm ND search sequence to find a format
file.</p>
</div>
<div class="paragraph">
<p>For details about FreeForm ND naming conventions and the search
sequence, see <a href="#convs">Conventions</a>.</p>
</div>
<div class="paragraph">
<p>The <em>newform</em> command has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">_newform_ _input_file_ [-f format_file] [-if-if input_format_file] [-of output_format_file]

[-ft "title"] [-ift "title"] [-oft "title"] [-b local_buffer_size] [-c count] [-v var_file] [-q query_file] [-o output_file]</pre>
</div>
</div>
<div class="paragraph">
<p>For descriptions of the arguments, see <a href="#convs">Conventions</a>.</p>
</div>
<div class="paragraph">
<p>If you want to convert an ASCII file to a binary file, and you follow
the FreeForm ND naming conventions, the command is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform datafile.dat -o datafile.bin</pre>
</div>
</div>
<div class="paragraph">
<p>where datafile is the file name of your choosing.</p>
</div>
<div class="paragraph">
<p>If data files and format files are not in the current directory or in
the same directory, you can specify the appropriate path name.  For
example, if the input data file is not in the current directory, you
can enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform /path/datafile.dat -o datafile.bin</pre>
</div>
</div>
<div class="paragraph">
<p>To read the data in the resulting binary file, you can reformat back
to ASCII using the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform datafile.bin -o datafile.ext</pre>
</div>
</div>
<div class="paragraph">
<p>or you can use the <em>readfile</em> program, described in
&lt;strong class="selflink"&gt;Format Conversion&lt;/strong&gt;.</p>
</div>
</div>
<div class="sect4">
<h5 id="_chkform"><em>chkform</em></h5>
<div class="paragraph">
<p>Though <em>newform</em> is useful for checking data formats, it is
limited by requiring a format file to specify an output format.  Since
some OPeNDAP FreeForm ND applications (such as the OPeNDAP FreeForm handler) do not
require an output format, this is extra work for the dataset
administrator.  For these occasions, OPeNDAP FreeForm ND provides a simpler
format-checking program, called <em>chkform</em>.</p>
</div>
<div class="paragraph">
<p>The <em>chkform</em> program attempts to read an ASCII file, using the
specified input format.  If the format allows the file to be read</p>
</div>
<div class="paragraph">
<p>properly, <em>chkform</em> says so.  However, if the input format
contains errors, or does not accurately reflect the contents of the
given data file, <em>chkform</em> delivers an error message, and attempts
to provide a rudimentary diagnosis of the problem.</p>
</div>
<div class="paragraph">
<p>You must create a format description file (or files) with format
descriptions for the data files involved before you can use
<em>chkform</em> to chack the format.  As with <em>newform</em>, the
standard extension for format description files is <em>.fmt</em>. If you
do not explicitly specify the format description file on the command
line (unnecessary if you use FreeForm ND naming conventions)
<em>chkform</em> follows the FreeForm ND search sequence to find a format
file.</p>
</div>
<div class="paragraph">
<p>For details about FreeForm ND naming conventions and the search
sequence, see <a href="#convs">Conventions</a>.</p>
</div>
<div class="paragraph">
<p>The <em>chkform</em> command has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">chkform input_file [-if input_format_file] [-ift title] [-b local_buffer_size]
[-c count] [-q query_file] [-ol log_file] [-el error_log_file] [-ep]</pre>
</div>
</div>
<div class="paragraph">
<p>Most of the arguments are described in
<a href="#convs">Conventions</a>.  The following are specific to
<em>chkform</em>:</p>
</div>
<div class="paragraph">
<p><strong>-ol log_file:</strong>
Puts a log of processing information into the specified <em>log_file</em>.</p>
</div>
<div class="paragraph">
<p><strong>-el error_log_file:</strong>
Creates an error log file that contains whatever error messages are issued by <em>chkform</em>.</p>
</div>
<div class="paragraph">
<p><strong>-ep:</strong>
In normal operation, <em>chkform</em> asks you to manually acknowledge each important error by typing something on the keyboard.  If you use this option, <em>chkform</em> will not stop to prompt, but will continue processing until either the file is procesed, or there is an error preventing more processing.</p>
</div>
<div class="paragraph">
<p>As in the above examples, if you have an ASCII data file called
<em>datafile.dat</em>, supposedly described in a format file called
<em>datafile.fmt</em>, you can use <em>chkform</em> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">chkform datafile.dat</pre>
</div>
</div>
<div class="paragraph">
<p>If processing is successful, you will see something like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Welcome to Chkform release 4.2.3 -- an NGDC FreeForm ND application

(llmaxmin.fmt) ASCII_input_file_header  Latitude/Longitude Limits
File llmaxmin.dat contains 1 header record (71 bytes)
Each record contains 6 fields and is 71 characters long.

(llmaxmin.fmt) ASCII_input_data lat/lon
File llmaxmin.dat contains 10 data records (230 bytes)
Each record contains 3 fields and is 23 characters long.

100

No errors found (11 lines checked)</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_readfile"><em>readfile</em></h5>
<div class="paragraph">
<p>FreeForm ND includes <em>readfile</em>, a simple interactive binary file
reader. The program has one required command line argument, the name
of the file to be read. You do not have to write format descriptions
to use <em>readfile</em>.</p>
</div>
<div class="paragraph">
<p>The <em>readfile</em> command has the following form:</p>
</div>
<div class="paragraph">
<p><em>readfile</em> <em>binary_data_file</em></p>
</div>
<div class="paragraph">
<p>When the program starts, it shows the available options, shown in
table 9.3. At the <em>readfile</em> prompt, type
these option codes to view binary encoded values. (Pressing return
repeats the last option.)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>The <em>readfile</em> program options</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char --- 1 byte character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short --- 2 byte signed integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long --- 4 byte signed integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float --- 4 byte single-precision floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double --- 8 byte double-precision floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uchar --- 1 byte unsigned integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ushort --- 2 byte unsigned integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong --- 4 byte unsigned integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toggle between "big-endian" and your machine&#8217;s native byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show present file position and length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display this help screen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The options let you interactively read your way through the specified
binary file. The first position in the file is 0. You must type the
character(s) indicating variable type (e.g., us for unsigned short) to
view each value, so you need to know the data types of variables in
the file and the order in which they occur. If successive variables
are of the same type, you can press Return to view each value after
the first of that type.</p>
</div>
<div class="paragraph">
<p>You can toggle the byte-order switch on and off by typing b. The
byte-order option is used to read a binary data file that requires
byte swapping. This is the case when you need cross-platform access to
a file that is not byte-swapped, for example, if you are on a Unix
machine reading data from a CD-ROM formatted for a PC. When the switch
is on, type s or l to swap short or long integers
respectively, or type f or d to swap floats or doubles.
The <em>readfile</em> program does not byte swap the file itself (the
file is unchanged) but byte swaps the data values internally for
display purposes only.</p>
</div>
<div class="paragraph">
<p>To go to another position in the file, type p. You are prompted
to enter the new file position in bytes. If, for example, each value
in the file is 4 bytes long and you type 16, you will be positioned at
the first byte of the fifth value. If you split fields (by not
repositioning at the beginning of a field), the results will probably
be garbage. Type P to find out your current position in the file
and total file length in bytes. Type q to exit from
<em>readfile</em>.</p>
</div>
<div class="paragraph">
<p>You can also use an input command file rather than entering commands
directly. In that case, the <em>readfile</em> command has the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">readfile binary_data_file &amp;lt; input_command_file</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_binary_archive">Creating a Binary Archive</h5>
<div class="paragraph">
<p>By storing data files in binary, you save disk space and make access
by applications more efficient. An ASCII data file can take two to
five times the disk space of a comparable binary data file. Not only
is there less information in each byte, but extra bytes are needed for
decimal points, delimiters, and end-of-line markers.</p>
</div>
<div class="paragraph">
<p>It is very easy to create a binary archive using <em>newform</em> as the
following examples show. The input data for these examples are in the
ASCII file <em>latlon.dat</em> (shown below). They consist of 20 random
latitude and longitude values. The size of the file on a Unix system
is 460 bytes.</p>
</div>
<div class="paragraph">
<p>Here is the <em>latlon.dat</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-47.303545 -176.161101
-0.928001    0.777265
-28.286662   35.591879
12.588231  149.408117
-83.223548   55.319598
54.118314 -136.940570
38.818812   91.411330
-34.577065   30.172129
27.331551 -155.233735
11.624981 -113.660611
77.652742  -79.177679
77.883119  -77.505502
-65.864879  -55.441896
-63.211962  134.124014
35.130219 -153.543091
29.918847  144.804390
-69.273601   38.875778
-63.002874   36.356024
35.086084  -21.643402
-12.966961   62.152266</pre>
</div>
</div>
<div class="sect5">
<h6 id="_simple_ascii_to_binary_conversion">Simple ASCII to Binary Conversion</h6>
<div class="paragraph">
<p>In this example, you will use <em>newform</em> to convert the ASCII data
file <em>latlon.dat</em> into the binary file <em>latlon.bin</em>. The input
and output data formats are described in <em>latlon.fmt</em>.</p>
</div>
<div class="paragraph">
<p>Here is the <em>latlon.fmt</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This is the format description file for data files latlon.bin
/ and latlon.dat. Each record in both files contains two fields,
/ latitude and longitude.

binary_data binary format
latitude 1 8 double 6
longitude 9 16 double 6

ASCII_data ASCII format
latitude 1 10 double 6
longitude 12 22 double 6</pre>
</div>
</div>
<div class="paragraph">
<p>The binary and ASCII variables both have the same names. The binary
variable latitude occupies positions 1 to 8 and longitude occupies
positions 9-16. The corresponding ASCII variables occupy positions
1-10 and 12-22. Both the binary and ASCII variables are stored as
doubles and have a precision of 6.</p>
</div>
</div>
<div class="sect5">
<h6 id="_converting_to_binary">Converting to Binary</h6>
<div class="paragraph">
<p>To convert from an ASCII representation of the numbers in
<em>latlon.dat</em> to a binary representation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change to the directory that contains the FreeForm ND example files.</p>
</li>
<li>
<p>Enter the following command:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.dat -o latlon.bin</pre>
</div>
</div>
<div class="paragraph">
<p>Because FreeForm ND filenaming conventions have been used,
<em>newform</em> will locate and use <em>latlon.fmt</em> for the
translation. The <em>newform</em> program creates a new data file
(effectively a binary archive) called <em>latlon.bin</em>. The size of
the archive file is 2/3 the size of <em>latlon.dat</em>. Additionally,
the data do not have to be converted to machine-readable
representation by applications.</p>
</div>
<div class="paragraph">
<p>There are two methods for checking the data in <em>latlon.bin</em> to
make sure they converted correctly. You can reformat back to ASCII and
view the resulting file, or use <em>readfile</em> to read
<em>latlon.bin</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_reconverting_to_native_format">Reconverting to Native Format</h6>
<div class="paragraph">
<p>Use the following <em>newform</em> command to reformat the binary data in
<em>latlon.bin</em> to its native ASCII format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.bin -o latlon.rf</pre>
</div>
</div>
<div class="paragraph">
<p>The ASCII file <em>latlon.rf</em> matches (but does not overwrite) the
original input file <em>latlon.dat</em>. You can confirm this by using a
file comparison utility. The <em>diff</em> command is generally available on
Unix platforms.</p>
</div>
<div class="paragraph">
<p>To use <em>diff</em> to compare the <em>latlon</em> ASCII files, enter the
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">diff latlon.dat latlon.rf</pre>
</div>
</div>
<div class="paragraph">
<p>The output should be something along these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Files are effectively identical.</pre>
</div>
</div>
<div class="paragraph">
<p>Several implementations of the <em>diff</em> utility don&#8217;t print anything
if the two input files are identical.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>diff</em> utility may detect a difference in other similar
cases because FreeForm ND adds a leading zero in front of a decimal
and interprets a blank as a zero if the field is described as a
number. (A blank described as a character is interpreted as a
blank.)
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_conversion_to_a_more_portable_binary">Conversion to a More Portable Binary</h6>
<div class="paragraph">
<p>In this example, you will use <em>newform</em> to reformat the latitude
and longitude values in the ASCII data file <em>latlon.dat</em> into
binary longs in the binary file <em>latlon2.bin</em>. The input and
output data formats are described in <em>latlon2.fmt</em>.</p>
</div>
<div class="paragraph">
<p>This is what&#8217;s in <em>latlon2.fmt</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This is the format description file for data files latlon.dat
/ and latlon2.bin. Each record in both files contains two fields,
/ latitude and longitude.

ASCII_data ASCII format
latitude 1 10 double 6
longitude 12 22 double 6

binary_data binary format
latitude 1 4 long 6
longitude 5 8 long 6</pre>
</div>
</div>
<div class="paragraph">
<p>The ASCII and binary variables both have the same names. The ASCII
variable latitude occupies positions 1-10 and longitude occupies
positions 12-22. The ASCII variables are defined to be of type double.
The binary variables occupy four bytes each (positions 1-4 and 5-8)
and are of type long. The precision for all is 6.</p>
</div>
</div>
<div class="sect5">
<h6 id="_converting_to_binary_long">Converting to Binary Long</h6>
<div class="paragraph">
<p>In the previous example, both the ASCII and binary variables were
defined to be doubles. Binary longs, which are 4-byte integers, may be
more portable across different platforms than binary doubles or
floats.</p>
</div>
<div class="paragraph">
<p>To convert the ASCII data in <em>latlon.dat</em> to binary longs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change to the directory that contains the FreeForm ND example files.</p>
</li>
<li>
<p>Enter the following command:<br>
<code>newform latlon.dat -f latlon2.fmt -o latlon2.bin</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It creates the binary archive file <em>latlon2.bin</em> with the 20
latitude and longitude values in <em>latlon.dat</em> stored as binary
longs.</p>
</div>
<div class="paragraph">
<p>This example duplicates one in <a href="#dquick">the Quickstart Guide</a>. If you completed that
example, an error message will indicate that <em>latlon2.bin</em> exists.
You can rename, move, or delete the existing file.</p>
</div>
<div class="paragraph">
<p>The size of the archive file <em>latlon2.bin</em> is about 1/3 the size
of <em>latlon.dat</em>. Also, the data do not have to be converted to
machine representation by applications. The main tradeoff in achieving
savings in space and access time is that although binary longs are
more portable than binary doubles or floats, any binary representation
is less portable than ASCII.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
There may be a loss of precision when input data of
type double is converted to long.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_1_4_6_reading_the_binary_file">1.4.6 Reading the Binary File</h6>
<div class="paragraph">
<p>Once again, you can use <em>readfile</em> to check the data in the binary
archive you created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the following command:<br>
<code>readfile latlon2.bin</code></p>
</li>
<li>
<p>The data are stored as longs, so enter l to view each value (or press Return to view each value after the first).</p>
</li>
<li>
<p>Enter q to quit <em>readfile</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If desired, you can enter the commands to <em>readfile</em> from an input command file rather than directly from the command line. The example command file <em>latlon.in</em> is shown next.</p>
</div>
<div class="listingblock">
<div class="title">latlon.in</div>
<div class="content">
<pre class="nowrap">llllllp0 llPq</pre>
</div>
</div>
<div class="paragraph">
<p>The 6 l&#8217;s (l for <em>long</em>) cause the first 6 values in the file to be
displayed. The sequence p0 causes a return to the top (position 0) of
the file. A position number (0) must be followed by a blank space. The
2 l&#8217;s display the first two values again. The P displays the
current file position and length, and q closes <em>readfile</em>.</p>
</div>
<div class="paragraph">
<p>If you enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">readfile latlon2.bin &amp;lt; latlon.in</pre>
</div>
</div>
<div class="paragraph">
<p>you should see the following output on the screen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">long:  -47303545
long: -176161101
long:    -928001
long:     777265
long:  -28286662
long:   35591879
New File Position = 0
long:  -47303545
long: -176161101
File Position: 8       File Length: 160</pre>
</div>
</div>
<div class="paragraph">
<p>The floating point numbers have been multiplied by 106, the precision
of the long variables in <em>latlon2.fmt</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_including_a_query">Including a Query</h6>
<div class="paragraph">
<p>You can use the query option (<em>-q</em> <em>query_file</em>) to specify
exactly which records in the data file <em>newform</em> should process.
The query file contains query criteria. Query syntax is summarized in
Appendix C.</p>
</div>
<div class="paragraph">
<p>In this example, you will specify a query so that <em>newform</em> will
reformat only those value pairs in <em>latlon.dat</em> where latitude is
positive and longitude is negative into the binary file
<em>llposneg.bin</em>. The input and output data formats are described in
<em>latlon2.fmt</em>.</p>
</div>
<div class="paragraph">
<p>The query criteria are specified in the following file, called
<em>llposneg.qry</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[latitude]  0 &amp;amp; [longitude] &amp;lt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>To convert the desired data in <em>latlon.dat</em> to binary and then
view the results:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following command:<br>
<code>newform latlon.dat -f latlon2.fmt -q llposneg.qry -o llposneg.bin</code><br>
The <em>llposneg.bin</em> file now contains the positive/negative latitude/longitude pairs in binary form.</p>
</li>
<li>
<p>To view the data, first convert the data in <em>llposneg.bin</em> back to ASCII format:  newform llposneg.bin -f latlon2.fmt -o llposneg.dat</p>
</li>
<li>
<p>Enter the appropriate command to display the data in <em>llposneg.dat</em>, e.g. <em>more</em>: The following output appears on the screen:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">54.118314 -136.940570
27.331551 -155.233735
11.624981 -113.660611
77.652742  -79.177679
77.883119  -77.505502
35.130219 -153.543091
35.086084  -21.643402</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As demonstrated in the examples above, you can check the data in
a binary file either by using <em>readfile</em> or by converting the
data back to ASCII using <em>newform</em> and then viewing it.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_names_and_context">File Names and Context</h5>
<div class="paragraph">
<p>In the preceding examples, the read/write type (input or output) was
not included in the format descriptors (<em>ASCII_data</em> and
<em>binary_data</em>). FreeForm ND naming conventions were used, so
<em>newform</em> can determine from the context which format should be
used for input and which for output. Consider the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.dat -o latlon.bin</pre>
</div>
</div>
<div class="paragraph">
<p>The input file extension is <em>.dat</em> and the output file extension
is <em>.bin</em>. These extensions provide context indicating that ASCII
should be used as the input format and binary should be used as the
output format. The format description file that <em>newform</em> will
look for is the file with the same name as the input file and the
extension <em>.fmt</em>, i.e., <em>latlon.fmt</em>.</p>
</div>
<div class="paragraph">
<p>If you use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.bin</pre>
</div>
</div>
<div class="paragraph">
<p>to translate the binary archive <em>latlon.bin</em> back to ASCII,
<em>newform</em> identifies the input format as binary and uses the ASCII
format for output. The ASCII data is written to the screen because an
output file was not specified.</p>
</div>
<div class="paragraph">
<p>For information about FreeForm ND file name conventions, see
<a href="#convs">Conventions</a>.</p>
</div>
<div class="sect5">
<h6 id="_nonstandard_data_file_names">"Nonstandard" Data File Names</h6>
<div class="paragraph">
<p>If you are working with data files that do not use FreeForm ND naming
conventions, you need to more explicitly define the context. For
example, the files <em>lldat1.ll</em>, <em>lldat2.ll</em>, <em>lldat3.ll</em>,
<em>lldat4.ll</em>, and <em>lldat5.ll</em> all have latitude and longitude values in the ASCII format given in the format description file <em>lldat.fmt</em>. If you wanted to archive these files in binary format, you could not use a command of the form used in the previous
examples, i.e., <em>newform</em> <em>datafile.dat</em> -o <em>datafile.bin</em>
with <em>datafile.fmt</em> as the default format description file.</p>
</div>
<div class="paragraph">
<p>First, the ASCII data files do not have the extension <em>.dat</em>,
which identifies them as ASCII files. Second, you would need five
separate format description files, all with the same content:
<em>lldat1.fmt</em>, <em>lldat2.fmt</em>, <em>lldat3.fmt</em>,
<em>lldat4.fmt</em>, and <em>lldat5.fmt</em>. Creating the format
description file <em>ll.fmt</em> solves both problems.</p>
</div>
<div class="paragraph">
<p>Here is the <em>ll.fmt</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This is the format description file that describes latlon
/ data in files with the extension .ll

ASCII_input_data ASCII format for .ll latlon data
latitude 1 10 double 6
longitude 12 22 double 6

binary_output_data binary format for .ll latlon data
latitude 1 4 long 6
longitude 5 8 long 6</pre>
</div>
</div>
<div class="paragraph">
<p>The name used for the format description file, <em>ll.fmt</em>, follows the FreeForm ND convention that one format description file can be
utilized for multiple data files, all with the same extension, if the
format description file is named <em>ext.fmt</em>. Also, the read/write type (input or output) is made explicit by including it in the format
descriptors <em>ASCII_input_data</em> and <em>binary_output_data</em>. This provides the context needed for FreeForm ND programs to determine which format to use for input and which for output.</p>
</div>
<div class="paragraph">
<p>Use the following commands to produce binary versions of the ASCII
input files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform lldat1.ll -o llbin1.ll
newform lldat2.ll -o llbin2.ll
newform lldat3.ll -o llbin3.ll
newform lldat4.ll -o llbin4.ll
newform lldat5.ll -o llbin5.ll</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to convert back to ASCII, you can switch the words input
and output in the format description file <em>ll.fmt</em>. You could then use the following commands to convert back to native ASCII format with output written to the screen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform llbin1.ll
newform llbin2.ll
newform llbin3.ll
newform llbin4.ll
newform llbin5.ll</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to convert back to ASCII without switching the
read/write types input and output in <em>ll.fmt</em>. You can specify input and output formats by title instead. In this case, you want to
use the output format in <em>ll.fmt</em> as the input format and the input format in <em>ll.fmt</em> as the output format. Use the following command to convert <em>llbin1.ll</em> back to ASCII:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform llbin1 -ift binary format for .ll latlon data

-oft ASCII format for .ll latlon data</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <em>newform</em> reports back the read/write type actually used. Since <em>ASCII_input_data</em> was used as the output format, <em>newform</em> reports it as <em>ASCII_output_data</em>.</p>
</div>
<div class="paragraph">
<p>Now assume that you want to convert the ASCII data file <em>llvals.asc</em> (not included in the example file set) to the binary
file <em>latlon3.bin</em>, and the input and output data formats are described in <em>latlon.fmt</em>. The data file names do not provide the context allowing <em>newform</em> to find <em>latlon.fmt</em> by default, so you must include all file names on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform llvals.asc -f latlon.fmt -o latlon3.bin</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_nonstandard_format_description_file_names">"Nonstandard" Format Description File Names</h6>
<div class="paragraph">
<p>If you are using a format description file that does not follow
FreeForm ND file naming conventions, you must include its name on the
command line. Assume that you want to convert the ASCII data file
<em>latlon.dat</em> to the binary file <em>latlon.bin</em>, and the input
and output data formats are both described in <em>llvals.frm</em> (not included in the example file set). The data file names follow FreeForm
ND conventions, but the name of the format description file does not,
so it will not be located through the default search sequence. Use the
following command to convert to binary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.dat -f llvals.frm -o latlon.bin</pre>
</div>
</div>
<div class="paragraph">
<p>Suppose now that the input format is described in <em>latlon.fmt</em> and
the output format in <em>llvals.frm</em>. You do not need to explicitly specify the input format description file because it will be located
by default, but you must specify the output format description file
name. In this case, the command would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.dat -of llvals.frm -o latlon.bin</pre>
</div>
</div>
<div class="paragraph">
<p>You can always unambiguously specify the names of format description
files and data files, whether or not their names follow FreeForm ND
conventions. Assume you want to look only at longitude values in
<em>latlon.bin</em> and that you want them defined as integers (longs) which are right-justified at column 30. You will reformat the
specified binary data in <em>latlon.bin</em> into ASCII data in
<em>longonly.dat</em> and then view it. The input format is found in <em>latlon.fmt</em>, the output format in <em>longonly.fmt</em>.</p>
</div>
<div class="listingblock">
<div class="title">longonly.fmt</div>
<div class="content">
<pre class="nowrap">/ This is the format description file for viewing longitude as an
/ integer value right-justified at column 30.

ASCII_data ASCII output format, right-justified at 30
longitude 20 30 long 6</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, you have decided to look at the first 5 longitude values. Use the following command to unambiguously designate all files involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform latlon.bin -if latlon.fmt -of longonly.fmt -c 5
-o longonly.dat</pre>
</div>
</div>
<div class="paragraph">
<p>When you view <em>longonly.dat</em>, you should see the following 5 values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1         2         3         4
1234567890123456789012345678901234567890

-176161101
777265
35591879
149408117
55319598</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_changing_ascii_formats">Changing ASCII Formats</h5>
<div class="paragraph">
<p>You may encounter situations where a specific ASCII format is
required, and your data cannot be used in its native ASCII format.
With <em>newform</em>, you can easily reformat one ASCII format to
another. In this example, you will reformat California earthquake data
from one ASCII format to three other ASCII formats commonly used for
such data.The file <em>calif.tap</em> contains data about earthquakes in
California with magnitudes  5.0 since 1980. The data were initially
distributed by NGDC on tape, hence the <em>.tap</em> extension. The data
format is described in <em>eqtape.fmt</em>:</p>
</div>
<div class="paragraph">
<p>Here is the <em>eqtape.fmt</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This is the format description file for the NGDC .tap format,
/ which is used for data distributed on floppy disks or tapes.

ASCII_data .tap format
source_code 1 3 char 0
century 4 6 short 0
year 7 8 short 0
month 9 10 short 0
day 11 12 short 0
hour 13 14 short 0
minute 15 16 short 0
second 17 19 short 1
latitude_abs 20 24 long 3
latitude_ns 25 25 char 0
longitude_abs 26 31 long 3
longitude_ew 32 32 char 0
depth 33 35 short 0
magnitude_mb 36 38 short 2
MB 39 40 constant 0
isoseismal 41 43 char 0
intensity 44 44 char 0

/ The NGDC record check format includes
/ six flags in characters 45 to 50. These
/ can be treated as one variable to allow
/ multiple flags to be set in a single pass,
/ or each can be set by itself.

ngdc_flags 45 50 char 0
diastrophic 45 45 char 0
tsunami 46 46 char 0
seiche 47 47 char 0
volcanism 48 48 char 0
non_tectonic 49 49 char 0
infrasonic 50 50 char 0

fe_region 51 53 short 0
magnitude_ms 54 55 short 1
MS 56 57 char 0
z_h 58 58 char 0
cultural 59 59 char 0
other 60 60 char 0
magnitude_other 61 63 short 2
other_authority 64 66 char 0
ide 67 67 char 0
depth_control 68 68 char 0
number_stations_qual 69 71 char 0
time_authority 72 72 char 0
magnitude_local 73 75 short 2
local_scale 76 77 char 0
local_authority 78 80 char 0</pre>
</div>
</div>
<div class="paragraph">
<p>Three other formats used for California earthquake data are
hypoellipse, hypoinverse, and hypo71. Subsets of these formats are
described in the format description file <em>hypo.fmt</em>. The format
descriptions include the parameters required by the AcroSpin program
that is distributed as part of the IASPEI Software Library (Volume 2).
AcroSpin shows 3D views of earthquake point data.</p>
</div>
<div class="paragraph">
<p>Here is the <em>hypo.fmt</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/ This format description file describes subsets of the
/ hypoellipse, hypoinverse, and hypo71 formats.

ASCII_data hypoellipse format

year 1 2 uchar 0
month 3 4 uchar 0
day 5 6 uchar 0
hour 7 8 uchar 0
minute 9 10 uchar 0
second 11 14 ushort 2
latitude_deg_abs 15 16 uchar 0
latitude_ns 17 17 char 0
latitude_min 18 21 ushort 2
longitude_deg_abs 22 24 uchar 0
longitude_ew 25 25 char 0
longitude_min 26 29 ushort 2
depth 30 34 short 2
magnitude_local 35 36 uchar 1

ASCII_data hypoinverse format
year 1 2 uchar 0
month 3 4 uchar 0
day 5 6 uchar 0
hour 7 8 uchar 0
minute 9 10 uchar 0
second 11 14 ushort 2
latitude_deg_abs 15 16 uchar 0
latitude_ns 17 17 char 0
latitude_min 18 21 ushort 2
longitude_deg_abs 22 24 uchar 0
longitude_ew 25 25 char 0
longitude_min 26 29 ushort 2
depth 30 34 short 2
magnitude_local 35 36 uchar 1
number_of_times 37 39 short 0
maximum_azimuthal_gap 40 42 short 0
nearest_station 43 45 short 1
rms_travel_time_residual 46 49 short 2

ASCII_data hypo71 format
year 1 2 uchar 0
month 3 4 uchar 0
day 5 6 uchar 0
hour 8 9 uchar 0
minute 10 11 uchar 0
second 12 17 float 2
latitude_deg_abs 18 20 uchar 0
latitude_ns 21 21 char 0
latitude_min 22 26 float 2
longitude_deg_abs 27 30 uchar 0
longitude_ew 31 31 char 0
longitude_min 32 36 float 2
depth 37 43 float 2
magnitude_local 44 50 float 2
number_of_times 51 53 short 0
maximum_azimuthal_gap 54 57 float 0
nearest_station 58 62 short 1
rms_travel_time_residual 63 67 float 2
error_horizontal 68 72 float 1
error_vertical 73 77 float 1
s_waves_used 79 79 char 0</pre>
</div>
</div>
<div class="paragraph">
<p>The parameters from the California earthquake data in the NGDC format
needed for use with the AcroSpin program can be extracted and
converted using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">newform calif.tap -if eqtape.fmt -of hypo.fmt

-oft hypoellipse format -o calif.he
newform calif.tap -if eqtape.fmt -of hypo.fmt

-oft hypoinverse format -o calif.hi
newform calif.tap -if eqtape.fmt -of hypo.fmt

-oft hypo71 format -o calif.h71</pre>
</div>
</div>
<div class="paragraph">
<p>If you develop an application that accesses seismicity data in a
particular ASCII format, you need only to write an appropriate format
description file in order to convert NGDC data into the format used by
the application. This lets you make use of the data that NGDC provides
in a format that works for you.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_checking">11.D.10. Data Checking</h4>
<div class="paragraph">
<p>The FreeForm ND-based utility program <em>checkvar</em> creates variable
summary files, lists of maximum and minimum values, and summaries of
processing activity. You can use this information to check data
quality and to examine the distribution of the data.</p>
</div>
<div class="sect4">
<h5 id="_generating_the_summaries">Generating the Summaries</h5>
<div class="paragraph">
<p>A variable summary file (or list file), which contains histogram
information showing the variable&#8217;s distribution in the data file, is
created for each variable (or designated variables) in the specified
data file. You can optionally specify an output file in which a
summary of processing activity is saved.</p>
</div>
<div class="paragraph">
<p>Variable summaries (list files) can be helpful for performing quality
control checks of data. For example, you could run <em>checkvar</em> on
an ASCII file, convert the file to binary, and then run <em>checkvar</em>
on the binary file. The output from <em>checkvar</em> should be the same
for both the ASCII and binary files. You can also use variable
summaries to look at the data distribution in a data set before
extracting data.</p>
</div>
<div class="paragraph">
<p>The <em>checkvar</em> command has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    checkvar input_file [-f format_file] [-if input_format_file] [-of output_format_file]

    [-ft title] [-ift title] [-oft title] [-b local_buffer_size] [-c count] [-v var_file] [-q query_file]  [-p precision] [-m maxbins] [-md missing_data_flag] [-mm] [-o processing_summary]</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>checkvar</em> program needs to find only an input format
description. Output format descriptions will be ignored. If conversion
variables are included in input or output formats, no conversion is
performed when you run <em>checkvar</em>, since it ignores output
formats.</p>
</div>
<div class="paragraph">
<p>For descriptions of the standard arguments (first eleven arguments
above), see <a href="#convs">Conventions</a>.</p>
</div>
<div class="paragraph">
<p><strong>-p precision:</strong>
Option flag followed by the number of decimal places. The number
represents the power of 10 that data is multiplied by prior to
binning. A value of 0 bins on one&#8217;s, 1 on tenth&#8217;s, and so on. This
option allows an adjustment of the resolution of the <em>checkvar</em>
output. The default is 0; maximum is 5.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use the <em>-p</em> option on the command line, the precision set in
the relevant format file is overridden. The precision in the format file
serves as the default.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>-m maxbins:</strong>
Option flag followed by the approximate maximum number of bins
desired in <em>checkvar</em> output. The <em>checkvar</em> program keeps track of the number of bins filled as the data is processed. The
smaller the number of bins, the faster <em>checkvar</em> runs. By
keeping the number of bins small, you can check the gross aspects of
data distribution rather than the details. The number of bins is adjusted dynamically as <em>checkvar</em> runs depending on the distribution of data in the input file. If the number of filled bins becomes  1.5 * maxbins, the width of the bins is doubled to keep the total number near the desired maximum. The default is 100 bins; minimum is 6. Must be &lt; 10,000.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The precision (-p) and maxbins (-m) options have no effect on
character variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>-md missing_data_flag:</strong>
Option flag followed by a flag value that <em>checkvar</em> should
ignore across all variables in creating histogram data. Missing data flags are used in a data file to indicate missing or meaningless data. If you want <em>checkvar</em> to ignore more than one value, use the query (<em>-q</em>) option in conjunction with the variable file (<em>-v</em>) option.</p>
</div>
<div class="paragraph">
<p><strong>-mm:</strong>
Option flag indicating that only the maximum and minimum values of variables are calculated and displayed in the processing summary. Variable summary files are not created.</p>
</div>
<div class="paragraph">
<p><strong>-o <em>processing_summary</em>:</strong>
Option flag followed by the name of the file in which summary information displayed during processing is stored.</p>
</div>
<div class="sect5">
<h6 id="_example">Example</h6>
<div class="paragraph">
<p>You will use <em>checkvar</em> with a precision of 3 to create a
processing summary file and summary files for the two variables
latitude and longitude in the file <em>latlon.dat</em>.</p>
</div>
<div class="paragraph">
<p>Here is <em>latlon.dat</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-47.303545 -176.161101
-0.928001    0.777265
-28.286662   35.591879
12.588231  149.408117
-83.223548   55.319598
54.118314 -136.940570
38.818812   91.411330
-34.577065   30.172129
27.331551 -155.233735
11.624981 -113.660611
77.652742  -79.177679
77.883119  -77.505502
-65.864879  -55.441896
-63.211962  134.124014
35.130219 -153.543091
29.918847  144.804390
-69.273601   38.875778
-63.002874   36.356024
35.086084  -21.643402
-12.966961   62.152266</pre>
</div>
</div>
<div class="paragraph">
<p>To create the summary files, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">checkvar latlon.dat -p 3 -o latlon.sum</pre>
</div>
</div>
<div class="paragraph">
<p>A summary of processing information and the maximum and minimum for
each variable are displayed on the screen. The following three files
are created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>latlon.sum</em> recaps processing activity, maximums and minimums</p>
</li>
<li>
<p><em>latitude.lst</em> shows distribution of the latitude values in <em>latlon.dat</em></p>
</li>
<li>
<p><em>longitude.lst</em> shows distribution of the longitude values in <em>latlon.dat</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interpreting_the_summaries">Interpreting the Summaries</h5>
<div class="paragraph">
<p>The processing and variable summary files output by <em>checkvar</em>
from the example in the previous section are shown and discussed
below.</p>
</div>
<div class="sect5">
<h6 id="_processing_summary">Processing Summary</h6>
<div class="paragraph">
<p>If you specify an output file on the command line, it stores the
information that is displayed on the screen during processing. The
file <em>latlon.sum</em> was specified as the output file in the example
above.</p>
</div>
<div class="paragraph">
<p>Here is <em>latlon.sum</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Input file: latlon.dat
Requested precision = 3, Approximate number of sorting bins = 100

Input data format       (latlon.fmt)
ASCII_input_data       ASCII format
The format contains 2 variables; length is 24.

Output data format       (latlon.fmt)
binary_output_data       binary format
The format contains 2 variables; length is 16.

Histogram data precision: 3, Number of sorting bins: 20
latitude: 20 values read
minimum: -83.223548 found at record  5
maximum:  77.883119 found at record 12
Summary file: latitude.lst

Histogram data precision: 3, Number of sorting bins: 20
longitude: 20 values read
minimum: -176.161101 found at record 1
maximum:  149.408117 found at record 4
Summary file: longitude.lst.</pre>
</div>
</div>
<div class="paragraph">
<p>The processing summary file <em>latlon.sum</em> first shows the name of
the input data file (<em>latlon.dat</em>). If you specified precision and
a maximum number of bins on the command line, those values are given
as Requested precision, in this case 3, and Approximate number of
sorting bins, in this case the default value of 100. If precision is
not specified, No requested precision is shown.</p>
</div>
<div class="paragraph">
<p>A summary of each format shows the type of format (in this case, Input
data format and Output data format) and the name of the format file
containing the format descriptions (<em>latlon.fmt</em>), whether
specified on the command line or located through the default search
sequence. In this case, it was located by
default. Since <em>checkvar</em> only needs an input format description,
it ignores output format descriptions. Next, you see the format
descriptor as resolved by FreeForm ND (e.g., <em>ASCII_input_data</em>)
and the format title (e.g., "ASCII format"). Then the number of
variables in a record and total record length are given; for ASCII,
record length includes the end-of-line character (1 byte for Unix).</p>
</div>
<div class="paragraph">
<p>A section for each variable processed by <em>checkvar</em> indicates the
histogram precision and actual number of sorting bins. Under some
circumstances, the precision of values in the histogram file may be
different than the precision you specified on the command line. The
default value for precision, if none is specified on the command line,
is the precision specified in the relevant format description file or
5, whichever is smaller. The second line shows the name of the
variable (latitude, longitude) and the number of values in the data
file for the variable (20 for both latitude and longitude).</p>
</div>
<div class="paragraph">
<p>The minimum and maximum values for the variable are shown next
(-83.223548 is the minimum and 77.883119 is the maximum value for
latitude). The maximum and minimum values are given here with a
precision of 6, which is the precision specified in the format
description file. The locations of the maximum and minimum values in
the input file are indicated. (-83.223548 is the fifth latitude value
in <em>latlon.dat</em> and 77.883119 is the twelfth). Finally, the name
of the histogram data (or variable summary) file generated for each
variable is given (<em>latitude.lst</em> and <em>longitude.lst</em>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_variable_summaries">Variable Summaries</h6>
<div class="paragraph">
<p>The name of each variable summary file (list file) output by
<em>checkvar</em> is of the form <em>variable.lst</em> for numeric variables and <em>variable.cst</em> for character variables. The data in *<em>.lst</em>, and *<em>.cst</em> files can be loaded into histogram plot programs for graphical representation. (You must be familiar enough
with your program of choice to manipulate the data as necessary in order to achieve the desired result.) In Unix, there is no need to abbreviate the base file name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use the -v option, the order of variables in var_file has
no effect on the numbering of base file names of the variable summary files.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Example Variable Summary Files</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>latitude.lst</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>longitude.lst</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-83.224 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-176.162 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-69.274 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-155.234 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-65.865 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-153.544 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-63.212 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-136.941 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-63.003 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-113.661 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-47.304 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-79.178 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-34.578 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-77.506 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-28.287 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-55.442 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-12.967 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-21.644 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.929 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.777 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11.624 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30.172 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.588 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.591 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27.331 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36.356 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">29.918 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">38.875 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.086 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">55.319 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.130 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">62.152 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">38.818 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">91.411 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">54.118 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">134.124 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">77.652 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">144.804 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">77.883 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">149.408</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The variable summary files consist of two columns. The first indicates
boundary values for data bins and the second gives the number of data
points in each bin. Because a precision of 3 was specified in the
example, each boundary value has three decimal places. The boundary
values are determined dynamically by <em>checkvar</em> and often do not
correspond to data values in the input file, even if the
<em>checkvar</em> and data file precisions are the same.</p>
</div>
<div class="paragraph">
<p>The first data bin in <em>latitude.lst</em> contains data points in the
range -83.224 (inclusive) to -69.274 (exclusive); neither boundary
number exists in <em>latlon.dat</em>. The first bin has one data point,
-83.223548. The fourth data bin contains latitude values from -63.212
(inclusive) to -63.003 (exclusive), again with neither boundary value
occurring in the data file. The data point in the fourth bin is
-63.211962.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hdf_utilities">11.D.11. HDF Utilities</h4>
<div class="paragraph">
<p>FreeForm ND includes three utilities for use with HDF (hierarchical
data format) files: <em>makehdf</em>, <em>splitdat</em>, and <em>pntshow</em>.
These programs were built using both the FreeForm library and the HDF
library, which was developed at the National Center for Supercomputer
Applications (NCSA).</p>
</div>
<div class="paragraph">
<p>The <em>makehdf</em> program converts binary and ASCII data files to HDF
files and converts multiplexed band interleaved by pixel image files
into a series of single parameter files. The <em>splitdat</em> program is
used to separate and reformat data files containing headers and data
into separate header and data files, or to translate them into HDF
files. The <em>pntshow</em> program extracts point data from HDF files
into binary or ASCII format.</p>
</div>
<div class="paragraph">
<p>It is assumed in this chapter that you have a working familiarity with
HDF terminology and conventions. See the HDF user documentation for
detailed information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not try the examples in this chapter. The example file set is
incomplete.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_makehdf"><em>makehdf</em></h5>
<div class="paragraph">
<p>Using <em>makehdf</em> you can convert data files with formats described
in a FreeForm format file into HDF files. You should follow FreeForm
naming conventions for the data and format files. For details about
FreeForm conventions, see the <a href="#convs">Conventions documentation</a>.</p>
</div>
<div class="paragraph">
<p>A dBASE input file must be converted to ASCII or binary using
<em>newform</em> before you can run <em>makehdf</em> on it.
The HDF file resulting from a conversion consists either of a group of
scientific datasets (SDS&#8217;s), one for each variable in the input data
file, or of a <em>vgroup</em> containing all the variables as one
<em>vdata</em>. If you are working with grid data, you will want SDS&#8217;s
(the default) in the output HDF file. A vdata (<em>-vd</em> option) is the
appropriate choice for point data.</p>
</div>
<div class="paragraph">
<p>The <em>makehdf</em> command has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    makehdf input_file [-r rows] [-c columns] [-v var_file] [-d HDF_description_file]

    [-xl x_label -yl y_label] [-xu x_units -yu y_units] [-xf x_format -yf y_format] [-id file_id] [-vd [vdata_file]] [-dmx [-sep]] [-df] [-md missing_data_file] [-dof HDF_file]</pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>input_file</em>:</strong>
Name of the input data file. Following FreeForm naming conventions,
the standard extensions for data files are <em>.dat</em> for ASCII
format and <em>.bin</em> for binary.</p>
</div>
<div class="paragraph">
<p><strong>-r rows:</strong>
Option flag followed by the number of rows in each resulting
scientific dataset. The number of rows must be specified through
this option on the command line, or in an equivalence table, or in a
header (<em>.hdr</em>) file defined according to FreeForm standards.</p>
</div>
<div class="paragraph">
<p><strong>-c columns:</strong>
Option flag followed by the number of columns in each resulting
scientific dataset. The number of columns must be specified through
this option on the command line, or in an equivalence table, or in a
header (<em>.hdr</em>) file defined according to FreeForm standards.
For information about equivalence tables, see the GeoVu Tools
Reference Guide.</p>
</div>
<div class="paragraph">
<p><strong>-v var_file:</strong>
Option flag followed by the name of the variable file. The file
contains names of the variables in the input data file to be
processed by <em>makehdf</em>. Variable names in \var{var_file} can be
separated by one or more spaces or each name can be on a separate
line.</p>
</div>
<div class="paragraph">
<p><strong>-d HDF_description_file:</strong>
Option flag followed by the name of the file containing a
description of the input file. The description will be stored as a
file annotation in the resulting HDF file.</p>
</div>
<div class="paragraph">
<p><strong>-xl x_label -yl y_label:</strong>
Option flags followed by strings (labels) describing the x and y
axes; labels must be in quotes (<em>" "</em>) if more than one word.</p>
</div>
<div class="paragraph">
<p><strong>-xu x_units -yu y_units:</strong>
Option flags followed by strings indicating the measurement units
for the x and y axes; strings must be in quotes (<em>" "</em>) if more than
one word.</p>
</div>
<div class="paragraph">
<p><strong>- xf x_format -yf y_format:</strong>
Option flags followed by strings indicating the formats to be used
in displaying scale for the x and y dimensions; strings must be in
quotes (<em>" "</em>) if more than one word.</p>
</div>
<div class="paragraph">
<p><strong>- id file_id:</strong>
Option flag followed by a string that will be stored as the ID of
the resulting HDF file.</p>
</div>
<div class="paragraph">
<p><strong>- vd [vdata_file]:</strong>
Option flag indicating that the output HDF file should contain a
vdata. The optional file name specifies the name of the output HDF
file; the default is <em>input_file.HDF</em>.</p>
</div>
<div class="paragraph">
<p><strong>- dmx [-sep]:</strong>
The option flag <em>-dmx</em> indicates that input data should be
demultiplexed from band interleaved by pixel to band sequential form
in <em>input_file.dmx</em>. If <em>-dmx</em> is followed by <em>-sep</em>,
the input data are demultiplexed into separate variable files called
<em>data_file.1</em> \ldots <em>data_file.n</em></p>
</div>
<div class="paragraph">
<p><strong>- df:</strong></p>
</div>
<div class="paragraph">
<p>To use this option, the input file (<em>data_file.ext</em>) must be a
binary demultiplexed (band sequential) file.  For each input
variable in the applicable FreeForm format description file, there
is a corresponding demultiplexed section in the output HDF file.</p>
</div>
<div class="paragraph">
<p><strong>- md missing_data_file:</strong>
Option flag followed by the name of the file defining missing data
(data you want to exclude). Use this option only along with the
vdata (-vd) option. Each line in the missing data file has the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">variable_name lower_limit upper_limit</pre>
</div>
</div>
<div class="paragraph">
<p>The precision of the upper and lower limits matches the precision of
the input data.</p>
</div>
<div class="paragraph">
<p><strong>- dof HDF_file:</strong></p>
</div>
<div class="paragraph">
<p>Option flag followed by the name of the output HDF file. If you do
not use the <em>-dof</em> option, the default output file name is
<em>input_file.HDF</em>.</p>
</div>
<div class="sect5">
<h6 id="_1_1_1_example">1.1.1 Example</h6>
<div class="paragraph">
<p>You will use <em>makehdf</em> to store <em>latlon.dat</em> as an HDF file.
The HDF file will consist of two SDS&#8217;s, one each for the two variables
latitude and longitude. Each SDS will have four rows and five columns.</p>
</div>
<div class="paragraph">
<p>To convert <em>latlon.dat</em> to an HDF file, enter the following
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">makehdf latlon.dat -r 4 -c 5</pre>
</div>
</div>
<div class="paragraph">
<p>As <em>makehdf</em> translates <em>latlon.dat</em> into HDF, processing
information is displayed on the screen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1   Caches (1150 bytes) Processed: 800 bytes written to latlon.dmx
Writing latlon.HDF and calculating maxima and minima ...

Variable latitude:
Minimum: -86.432712  Maximum 89.170904
Variable longitude:
Minimum: -176.161101  Maximum 165.066193</pre>
</div>
</div>
<div class="paragraph">
<p>The output from <em>makehdf</em> is an HDF file named <em>latlon.HDF</em>
(by default). It contains the minimum and maximum values for the two
variables as well as the two SDS&#8217;s.</p>
</div>
<div class="paragraph">
<p>A temporary file named <em>latlon.dmx</em> was also created. It contains
the data from latlon.dat in demultiplexed form . The data was
converted from its original multiplexed form to enable <em>makehdf</em>
to write sections of data to SDS&#8217;s.</p>
</div>
<div class="paragraph">
<p>If you start with a demultiplexed file such as <em>latlon.dmx</em>, the
translation process is much quicker, particularly for large data
files. As an illustration, try this. Rename <em>latlon.dmx</em> to
<em>latlon.bin</em> (renaming is necessary for <em>makehdf</em> to find the
format description file <em>latlon.fmt</em> by default). Enter the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">makehdf latlon.bin -df -r 4 -c 5</pre>
</div>
</div>
<div class="paragraph">
<p>The output file again is <em>latlon.HDF</em>, but notice that no
demultiplexing was done.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_splitdat"><em>splitdat</em></h5>
<div class="paragraph">
<p>The <em>splitdat</em> program translates files with headers and data into
separate header and data files or into HDF files. If the translation
is to separate header and data files, the header file can include
indexing information.</p>
</div>
<div class="paragraph">
<p>The combination of header and data records in a file is often used for
point data sets that include a number of observations made at one or
more stations or locations in space. The header records contain
information about the stations or locations of the measurements. The
data records hold the observational data. A station record usually
indicates how many data records follow it. The structure of such a
file is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Header for Station 1
Observation 1 for Station 1
Observation 2 for Station 1

.

.
Observation N for Station 1

Header for Station 2
Observation 1 for Station 2
Observation 2 for Station 2

.

.

.
Observation N for Station 2

Header for Station 3

.

.

.</pre>
</div>
</div>
<div class="paragraph">
<p>Many applications have difficulty reading this sort of heterogeneous
data file. One solution is to split the data into two homogeneous
files, one containing the headers, the other containing the data. With
<em>splitdat</em>, you can easily create the separate data and header
files. To use <em>splitdat</em> for this purpose, the input and output
formats for the record headers and the data must be described in a
FreeForm format description file. To use <em>splitdat</em> for
translating files to HDF, the input format must be described in a
FreeForm format description file. You should follow FreeForm naming
conventions for the data and format files. For details about FreeForm
conventions, see the <a href="#convs">Conventions documentation</a>.</p>
</div>
<div class="paragraph">
<p>The <em>splitdat</em> command has the following form:</p>
</div>
<div class="paragraph">
<p>\proto{<em>splitdat</em> \var{input_file} [\var{output_data_file}  \var{output_header_file}]}</p>
</div>
<div class="paragraph">
<p><strong>\var{input_file} :</strong>
Name of the file to be processed. Following FreeForm naming
conventions, the standard extensions for data files are <em>.dat</em>
for ASCII format and <em>.bin</em> for binary.</p>
</div>
<div class="paragraph">
<p><strong>\var{output_data_file} :</strong>
Name of the output file into which data are transferred with the
format specified in the applicable FreeForm format description file.
The standard extensions are the same as for input files. If an
output file name is not specified, the default is standard output.</p>
</div>
<div class="paragraph">
<p><strong>\var{output_header_file} :</strong>
Name of the output file into which headers from the input file are
transferred with the format specified in the applicable FreeForm
format description file. If an output header file name is not
specified, the default is standard output.</p>
</div>
<div class="sect5">
<h6 id="_index_creation">Index Creation</h6>
<div class="paragraph">
<p>You can use the two variables begin and extent (described below) in
the format description for the output record headers to indicate the
location and size of the data block associated with each record
header. If you then use <em>splitdat</em>, the header file that results
can be used as an index to the data file.</p>
</div>
<div class="paragraph">
<p><strong><em>begin</em>:</strong>
Indicates the offset to the beginning of the data associated with a
particular header. If the data is being translated to HDF, the units
are records; if not, the units are bytes.</p>
</div>
<div class="paragraph">
<p><strong><em>extent</em>:</strong>
Indicates the number of records (HDF) or bytes (non-HDF) associated
with each header record.</p>
</div>
<div class="sect6">
<h7 id="_example_2">Example</h7>
<div class="paragraph">
<p>You will use <em>splitdat</em> to extract the headers and data from a
rawinsonde (a device for gathering meteorological data) ASCII data
file named <em>hara.dat</em> (HARA = Historic Arctic Rawinsonde Archive)
and create two output files-<em>23338.dat</em> containing the ASCII data
and <em>23338hdr.dat</em> containing the ASCII headers. The format
description file <em>hara.fmt</em> should contain the necessary format
descriptions.</p>
</div>
<div class="paragraph">
<p>Here is <em>hara.fmt</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_input_record_header ASCII Location Record input format
WMO_station_ID_number 1 5 char 0
latitude 6 10 long 2
longitude_east 11 15 long 2
year 17 18 uchar 0
month 19 20 uchar 0
day 21 22 uchar 0
hour 23 24 uchar 0
flag_processing_1 28 28 char 0
flag_processing_2 29 29 char 0
flag_processing_3 30 30 char 0
station_type 31 31 char 0
sea_level_elev 32 36 long 0
instrument_type 37 38 uchar 0
number_of_observations 40 42 ushort 0
identification_code 44 44 char 0

ASCII_input_data Historical Arctic Rawinsonde Archive input format
atmospheric_pressure 1 5 long 1
geopotential_height 7 11 long 0
temperature_deg 13 16 short 0
dewpoint_depression 18 20 short 0
wind_direction 22 24 short 0
wind_speed_m/s 26 28 short 0
flag_qg 30 30 char 0
flag_qg1 31 31 char 0
flag_qt 33 33 char 0
flag_qt1 34 34 char 0
flag_qd 36 36 char 0
flag_qd1 37 37 char 0
flag_qw 39 39 char 0
flag_qw1 40 40 char 0
flag_qp 42 42 char 0
flag_levck 43 43 char 0

ASCII_output_record_header ASCII Location Record output format

.

.

.

ASCII_output_data Historical Arctic Rawinsonde Archive output format

.

.

.</pre>
</div>
</div>
<div class="paragraph">
<p>To "split" <em>hara.dat</em>, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">splitdat hara.dat 23338.dat  23338hdr.dat</pre>
</div>
</div>
<div class="paragraph">
<p>The data values from <em>hara.dat</em> are stored in <em>23338.dat</em> and
the headers in <em>23338hdr.dat</em>.</p>
</div>
<div class="paragraph">
<p>Because the variables begin and extent were used in the header output
format in <em>hara.fmt</em> to indicate data offset and number of
records, <em>23338hdr.dat</em> has two columns of data showing offset and
extent. Thus, it can serve as an index into <em>23338.dat</em>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_hdf_translation">HDF Translation</h6>
<div class="paragraph">
<p>If output files are not specified on the <em>splitdat</em> command line,
a file named <em>input_file.HDF</em> is created. It is hierarchically
named and organized as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">vgroup

input_file_name

/      \

/        \

vdata1       vdata2
PointIndex      input_file_name</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>vdata1</em> contains the record headers</p>
</li>
<li>
<p><em>vdata2</em> contains the data</p>
</li>
<li>
<p>If writing to a Vset (represented by a vgroup), both output
formats are converted to binary, if not binary already.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_example_3">Example</h7>
<div class="paragraph">
<p>To create the file <em>hara.HDF</em> from <em>hara.dat</em>, enter the
following abbreviated command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">splitdat hara.dat</pre>
</div>
</div>
<div class="paragraph">
<p>The output formats in <em>hara.fmt</em> are automatically converted to
binary, and subsequently the ASCII data in <em>hara.dat</em> are also
converted to binary for HDF storage.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pntshow"><em>pntshow</em></h5>
<div class="paragraph">
<p>The <em>pntshow</em> program is a versatile tool for extracting point
data  from HDF files containing scientific datasets and Vsets. The
extraction can be done into any binary or ASCII format described in a
FreeForm format description file. Before using <em>pntshow</em> on an HDF
file, you should pack the file using the NCSA-developed HDF utility
hdfpack.</p>
</div>
<div class="paragraph">
<p>You can use <em>pntshow</em> to extract headers and data from an HDF file
into separate files or to extract just the data. It&#8217;s a good idea to
define GeoVu keywords in an equivalence table to facilitate access to
HDF objects. For information about equivalence tables, see the GeoVu
Tools Reference Guide. The input and output formats must be described
in a FreeForm format description file. You should follow FreeForm
naming conventions for the data and format files. For details about
FreeForm conventions, see the <a href="#convs">Conventions documentation</a>.</p>
</div>
<div class="paragraph">
<p>If a format description file is not specified on the command line, the
output format is taken by default from the FreeForm output format
annotation stored in the HDF file. If there is no annotation, a
default ASCII output format is used.</p>
</div>
<div class="paragraph">
<p>An equivalence table takes precedence over
everything. (vdata=1963, SDS=702)
If you have not specified an HDF object in an equivalence table,
<em>pntshow</em> uses the following sequence to determine the appropriate
source for output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Output the first vdata with class name Data.</p>
</li>
<li>
<p>Output the largest vdata.</p>
</li>
<li>
<p>Output the first SDS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no vdatas exist in the file, but an SDS is found, it is extracted
and a default ASCII output format is used.</p>
</div>
<div class="sect5">
<h6 id="_extracting_headers_and_data">Extracting Headers and Data</h6>
<div class="paragraph">
<p>The <em>pntshow</em> command takes the following form when you want to
extract headers and data from HDF files into separate files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    pntshow input_HDF_file [-h [output_header_file]] [-hof output_header_format_file]

    [-hof output_header_format_file] [-d [output_data_file]] [-dof output_data_format_file]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>\var{input_HDF_file}:</strong>
Name of the input HDF file, which has been packed using
<em>hdfpack</em>.</p>
</div>
<div class="paragraph">
<p><strong>\hdfh:</strong>
Option flag followed optionally by the name of the file designated
to contain the record headers currently stored in a vdata with a
class name of Index. If an output header file name is not specified,
the default is standard output.</p>
</div>
<div class="paragraph">
<p><strong>\hdfhof:</strong>
Option flag followed by the name of the FreeForm format file that
describes the format for the headers extracted to standard output or
output_header_file.</p>
</div>
<div class="paragraph">
<p><strong>\hdfd:</strong>
Option flag followed optionally by the name of the file designated
to contain the data currently stored in a vdata with a class name of
Data. If an output file name is not specified, the default is
standard output.</p>
</div>
<div class="paragraph">
<p><strong>\hdfdof:</strong>
Option flag followed by the name of the FreeForm format file that
describes the format for data extracted to standard output or
\var{output_data_file}.</p>
</div>
<div class="sect6">
<h7 id="_example_4">Example</h7>
<div class="paragraph">
<p>You will extract data and headers from <em>hara.HDF</em> (created by
<em>splitdat</em> in a previous example). This file contains two vdatas:
one has the class name Data and the other has the class name Index.
Because this file is extremely small, no appending links were created
in the file, so there is no need to pack the file before using
<em>pntshow</em>, though you can if you wish.</p>
</div>
<div class="paragraph">
<p>To extract data and headers from <em>hara.HDF</em>, enter the following
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">pntshow hara.HDF -d haradata.dat -h harahdrs.dat</pre>
</div>
</div>
<div class="paragraph">
<p>The data from the vdata designated as Data in <em>hara.HDF</em> are now
stored in <em>haradata.dat</em>. The data are in their original format
because the original output format was stored by <em>splitdat</em> in the
HDF file. The header data from the vdata designated as Index in
<em>hara.HDF</em> are now stored in <em>harahdrs.dat</em>. In addition to
the original header data, the variables begin and extent have also
been extracted to <em>harahdrs.dat</em>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_extracting_data_only">Extracting Data Only</h6>
<div class="paragraph">
<p>The <em>pntshow</em> command takes the following form when you want to
extract just the data from an HDF file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    pntshow input_HDF_file [-of default_output_format_file]

    [ output_file]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>\var{input_HDF_file}:</strong>
Name of the input HDF file, which has been packed using <em>hdfpack</em>.</p>
</div>
<div class="paragraph">
<p><strong>\hdfof:</strong>
Option flag followed by the name of the FreeForm format file that
describes the format for data extracted to standard output or
\var{output_file.}</p>
</div>
<div class="paragraph">
<p><strong>\var{output_file}:</strong>
Name of the output file into which data is transferred. If an output
file name is not specified, the default is standard output.</p>
</div>
<div class="sect6">
<h7 id="_examples_4">Examples</h7>
<div class="paragraph">
<p>You can use <em>pntshow</em> to extract designated variables from an HDF
file. In this example, you will extract temperature and pressure
values from <em>hara.HDF</em> to an ASCII format. First, the following
format description file must exist.</p>
</div>
<div class="paragraph">
<p>Here is <em>haradata.fmt</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ASCII_output_data ASCII format for pressure, temp
atmospheric_pressure 1 10 long 1
temperature_deg 15 25 float 1</pre>
</div>
</div>
<div class="paragraph">
<p>To create a file named <em>temppres.dat</em> containing only the
temperature and pressure variables, enter either of the following
commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">pntshow hara.HDF -of haradata.fmt  temppres.dat</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">pntshow hara.HDF -d temppres.dat -dof haradata.fmt</pre>
</div>
</div>
<div class="paragraph">
<p>If you use the first command, <em>pntshow</em> searches <em>hara.HDF</em>
for a vdata named Data. Since <em>hara.HDF</em> contains only one vdata
named <em>Data</em>, this vdata is extracted by default with the format
specified in <em>haradata.fmt</em>.</p>
</div>
<div class="paragraph">
<p>The results are the same if you use the second command. Now, try
running <em>pntshow</em> on the previously created file <em>latlon.HDF</em>,
which contains two SDS&#8217;s. Use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">pntshow latlon.HDF  latlon.SDS</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>latlon.SDS</em> file now contains the latitude and longitude
values extracted from <em>latlon.HDF</em>. They have the default ASCII
output format. You could have used the -of option to specify an output
format included in a FreeForm format description file.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_handling">11.D.12. Error Handling</h4>
<div class="paragraph">
<p>The FreeForm ND error handling system captures errors, such as improper usage, code problems, and system errors, and places them in an error queue. For each error captured, error type and a short message are placed in the message queue. If a fatal error occurs, the program stops executing and displays all error messages in the queue.</p>
</div>
<div class="sect4">
<h5 id="_error_messages">Error Messages</h5>
<div class="paragraph">
<p>The following is a list of some possible error messages with suggestions for corrections.</p>
</div>
<div class="paragraph">
<p><strong>Problem opening, reading, or writing to file:</strong>
Check that all file names and paths are correct.</p>
</div>
<div class="paragraph">
<p><strong>Problem making format</strong>
Make sure there is a format file describing the data file formats. Check that input and output format descriptions in the format file accurately describe the data.</p>
</div>
<div class="paragraph">
<p><strong>Problem making header format:</strong>
If a header exists in the data file, it must be described in a format file. Check that the header description accurately describes the header in your data file.</p>
</div>
<div class="paragraph">
<p><strong>Problem getting value</strong></p>
</div>
<div class="paragraph">
<p><strong>Problem processing variable list:</strong>
The data formats may not be described correctly or there may be some inconsistencies in the data. Check also for unprintable characters at the end of the data file.</p>
</div>
<div class="paragraph">
<p><strong>File length / Record length mismatch</strong></p>
</div>
<div class="paragraph">
<p><strong>Record Length or CR Problem:</strong>
This usually happens because the input format description is not correct. Make sure the format description&#8217;s last position is the last character before the end-of-line character. If you have a header, make sure it is described correctly. The header&#8217;s length must include all characters up until the last end-of-line-character before the data begins.</p>
</div>
<div class="paragraph">
<p><strong>Binary Overflow:</strong>
 Try using a larger output variable type such as a long instead of a short. Be sure you have given enough space for the values to be written. See Chapter  for more information.</p>
</div>
<div class="paragraph">
<p><strong>Variable not found:</strong>
 The variable names in your output format must match the variable names in the input format unless you are using conversion variables.</p>
</div>
<div class="paragraph">
<p><strong>Data Overflow:</strong>
Data overflow does not usually cause a fatal error and FreeForm ND functions try to anticipate them. If overflow occurs for a particular value, <strong>*</strong>'s are written to that value&#8217;s location. If you find these in your output, check your variable positions and precision. Increase field width or use a "larger" data type. Be sure the output format specifies space for the output variable. For instance, FreeForm ND adds a leading zero in front of decimal points. If the original data did not have a leading zero, the output will have one more digit than the input.</p>
</div>
<div class="paragraph">
<p><strong>Insufficient memory allocation:</strong>
The application has run out of memory. Try using the -b (local buffer size) option, or modify autoexec.bat and config.sys and comment out devices, TSR&#8217;s, etc.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serving_data_with_timestamps_in_the_file_names">11.D.13. Serving Data with Timestamps in the File Names</h4>
<div class="paragraph">
<p>This handler can read data stored in files that incorporate data strings
in their names. This feature was added to support serving data produced
and hosted by Remote Sensing Systems (RSS) and while the run-time
parameters bear the name of that organization, they can be used for any
data that fit the naming conventions they have developed. The naming
convention is as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The convention</dt>
<dd>
<p>+ '_' + &lt;date_string&gt; + &lt;version&gt; + [_d3d]</p>
</dd>
<dt class="hdlist1">Daily data</dt>
<dd>
<p>When &lt;date_string&gt; includes YYYYMMDDVV, the file contains <em>daily</em>
data.</p>
</dd>
<dt class="hdlist1">Averaged data</dt>
<dd>
<p>When &lt;date_string&gt; only includes YYYYMMVV (no <em>DD</em>), or includes
(<em>DD</em>) and optional <em>_d3d</em> then the file contains <em>averaged</em> data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For <em>daily</em> data the format file should be named <em>&lt;data
source&gt;_daily.fmt</em> while averaged data should be named <em>&lt;data
source&gt;_averaged.fmt</em>.</p>
</div>
<div class="paragraph">
<p>To use this feature, set the run-time parameter <em>FF.RSSFormatSupport</em> to
<em>yes</em> or <em>true</em>. If you store the format files (and optional ancillary
DAS files) in a directory other than the data, use the parameter
<em>FF.RSSFormatFiles</em> to name that other directory. Like all handler
run-time configuration parameters, these can go in either the <em>bes.conf</em>
or <em>ff.conf</em> file. Here&#8217;s an example sniplet from ff.conf showing how
these are used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#
# Data Handler Specific key/value parameters
#
FF.RSSFormatSupport = yes
FF.RSSFormatFiles = /usr/local/RSS</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aggregation">Appendix E: Aggregation</h3>
<div class="paragraph">
<p>Often it is desirable to treat a collection of data files as if they were
a single dataset. Hyrax provides two different ways to do this: it enables
data providers to define <em>aggregations</em> of files so those appear as a single
dataset and it provides a way for users to send the server a list of files
along with processing operations and receive a single amalgamated response.</p>
</div>
<div class="paragraph">
<p>In the first half of this appendix, we discuss aggregations defined by
data providers. These aggregations use a simple mark-up language
called NCML, first defined by Unidata as a way to work with NetCDF
files. Both Hyrax and the THREDDS Data Server use NCML as a tool to
describe how data files can be combined to aggregated data sets. In
the second part of this appendix, we discuss user-specified
aggregations. These aggregations currently use a new interface to the
Hyrax server.</p>
</div>
<div class="sect3">
<h4 id="NcML_Module">11.E.1. The NcML Module</h4>
<div class="sect4">
<h5 id="_introduction_11">Introduction</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the past Hyrax was distributed as a collection of separate
binary packages which data providers would choose to install to build up
a server with certain features. As the number of modules grew, this
became more and more complex and time consuming. As of Hyrax 1.12 we
started distributing the server in three discreet packages - the DAP
library, the BES daemon and all of the most important handlers
(including the NcML handler described here) and the Hyrax web services
front end. In some places in this documentation you may read about
'installing the handler' or other similar text, and can safely ignore
that. If you have a modern version of the server it includes this
handler.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_features_2">Features</h5>
<div class="paragraph">
<p>This version currently implements a subset of NcML 2.2 functionality,
along with some OPeNDAP extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Metadata Manipulation</p>
<div class="ulist">
<ul>
<li>
<p>Addition, Removal, and Modification of attributes to other datasets
(NetCDF, HDF4, HDF5, etc.) served by the same Hyrax 1.6 server</p>
</li>
<li>
<p>Extends NcML 2.2 to allow for common nested "attribute containers"</p>
</li>
<li>
<p>Attributes can be DAP2 types as well as the NcML types</p>
</li>
<li>
<p>Attributes can be of the special "OtherXML" type for injecting
arbitrary XML into a DDX response</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Manipulation</p>
<div class="ulist">
<ul>
<li>
<p>Addition of new data variables (scalars or arrays of basic types as
well as structures)</p>
</li>
<li>
<p>Variables may be removed from the wrapped dataset</p>
</li>
<li>
<p>Allows the creation of "pure virtual" datasets which do not wrap
another dataset</p>
</li>
</ul>
</div>
</li>
<li>
<p>Aggregations: JoinNew, JoinExisting, and Union:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#join_new_aggregation"><em>JoinNew</em> Aggregation</a></p>
<div class="ulist">
<ul>
<li>
<p>Allows multiple datasets to be "joined" by creating a new outer
dimension for the aggregated variable</p>
</li>
<li>
<p>Aggregation member datasets can be listed explicitly with explicit
coordinates for the new dimension for each member</p>
</li>
<li>
<p>Scan: Aggregations can be specified "automatically" by scanning a
directory for files matching certain criteria, such as a suffix or
regular expression.</p>
</li>
<li>
<p>Metadata may be added to the new coordinate variable for the new
dimension</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#join_existing_aggregation"><em>JoinExisting</em> Aggregation</a></p>
<div class="ulist">
<ul>
<li>
<p>The <em>ncoords</em> element can be left out of the <em>joinexisting</em>
granules. However, this may be a slow operation, depending on the number
of granules in the aggregation.</p>
</li>
<li>
<p>Scan may also be used with <em>ncoords</em> attribute for uniform sized
granules</p>
</li>
<li>
<p>Only allows join dimension to be aggregated from granules and not
overridden in NcML</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#union_aggregation"><em>Union</em> Aggregation</a></p>
<div class="ulist">
<ul>
<li>
<p>Merges all member datasets into one by taking the first named
instance of variables and metadata from the members</p>
</li>
<li>
<p>Useful for combining two or more datasets with different variables
into a single set</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_parameters_7">Configuration Parameters</h5>
<div class="sect5">
<h6 id="_tempdirectory">TempDirectory</h6>
<div class="paragraph">
<p>Where should the NCML handler store temporary data on the server&#8217;s file
system.</p>
</div>
<div class="paragraph">
<p>Default value is '/tmp'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NCML.TempDirectory=/tmp</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_globalattributescontainername">GlobalAttributesContainerName</h6>
<div class="paragraph">
<p>In DAP2 all global attributes must be held in containers. However, the
default behavior for the handler is set for DAP4, where this requirement
is relaxed so that any kind of attribute can be a global attribute.
However, to support older clients that only understand DAP2, the handler
will bundle top-level non-container attributes into a container. Use
this option to set the name of that container. By default, the container
is named <em>NC_GLOBAL</em> (because lots of clients look for that name), but
it can be anything you choose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NCML.GlobalAttributesContainerName=NC_GLOBAL</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_installation">Testing Installation</h5>
<div class="paragraph">
<p>Test data is provided to see if the installation was successful. The
file sample_virtual_dataset.ncml is a dataset purely created in NcML and
doesn&#8217;t contain an underlying dataset. You may also view
fnoc1_improved.ncml to test adding attributes to an existing netCDF
dataset (fnoc1.nc), but this requires the netCDF data handler to be
installed first! Several other examples installed also use the HDF4 and
HDF5 handlers.</p>
</div>
</div>
<div class="sect4">
<h5 id="_functionality">Functionality</h5>
<div class="paragraph">
<p>This version of the NcML Module implements a subset of NcML 2.2
functionality.</p>
</div>
<div class="paragraph">
<p>Our module can currently&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refer only to files being served locally (not remotely)</p>
</li>
<li>
<p>Add, modify, and remove attribute metadata to a dataset</p>
</li>
<li>
<p>Create a purely virtual dataset using just NcML and no underlying
dataset</p>
</li>
<li>
<p>Create new scalar variables of any simple NcML type or simple DAP type</p>
</li>
<li>
<p>Create new Structure variables (which can contain new child variables)</p>
</li>
<li>
<p>Create new N-dimensional arrays of simple types (NcML or DAP)</p>
</li>
<li>
<p>Remove existing variables from a wrapped dataset</p>
</li>
<li>
<p>Rename existing variables in a wrapped dataset</p>
</li>
<li>
<p>Name dimensions as a mnemonic for specifying Array shapes</p>
</li>
<li>
<p>Perform union aggregations on multiple datasets, virtual or wrapped or
both</p>
</li>
<li>
<p>Perform joinNew aggregations to merge a variable across multiple
datasets by creating a new outer dimension</p>
</li>
<li>
<p>Specify aggregation member datasets by scanning directories for files
matching certain criteria</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We describe each supported NcML element in detail below.</p>
</div>
<div class="sect5">
<h6 id="_netcdf_element">&lt;netcdf&gt; Element</h6>
<div class="paragraph">
<p>The &lt;netcdf&gt; element is used to define a dataset, either a wrapped
dataset that is to be modified, a pure virtual dataset, or a member
dataset of an aggregation. The &lt;netcdf&gt; element is assumed to be the
topmost node, or as a child of an aggregation element.</p>
</div>
<div class="sect6">
<h7 id="_local_vs_remote_datasets">Local vs. Remote Datasets</h7>
<div class="paragraph">
<p>The location attribute (<em>netcdf@location</em>) can be used to reference either
local or remote files. If the value of <em>netcdf@location</em> <strong>does not</strong> begin
with the string <code>http</code> then the value is interpreted as a path to dataset
relative to the BES data root directory. However, if the value of the
<em>netcdf@location</em> attributte begins with <code>http</code> then the value is treated
as a URL and the Gateway System is used to access the remote data. As a
result any URL used in an <em>netcdf@location</em> attribute value must match one
of the Gateway.Whitelist expressions in the <code>bes.conf</code> stack.</p>
</div>
<div class="paragraph">
<p>If the value of <em>netcdf@location</em> is the empty string (or unspecified, as
empty is the default), the dataset is a pure virtual dataset, fully specified
within the NcML file itself. Attributes and variables may be fully
described and accessed with constraints just as normal datasets in this
manner. The installed sample datafile "sample_virtual_dataset.ncml" is
an example test case for this functionality.</p>
</div>
</div>
<div class="sect6">
<h7 id="_unsupported_attributes">Unsupported Attributes</h7>
<div class="paragraph">
<p>The current version does not support the following attributes of
&lt;netcdf&gt;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enhance</p>
</li>
<li>
<p>addRecords</p>
</li>
<li>
<p>fmrcDefinition (will be supported when FMRC aggregation is added)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_readmetadata_element">&lt;readMetadata&gt; Element</h6>
<div class="paragraph">
<p>The &lt;readMetadata/&gt; element is the default, so is effectively not
needed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_explicit_element">&lt;explicit&gt; element</h6>
<div class="paragraph">
<p>The &lt;explicit/&gt; element simply clears all attribute tables in the
referred to netcdf@location before applying the rest of the NcML
transformations to the metadata.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dimension_element">&lt;dimension&gt; Element</h6>
<div class="paragraph">
<p>The &lt;dimension&gt; element has limited functionality in this release since
the DAP2 doesn&#8217;t support dimensions as more than mnemonics at this time.
The limitations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We only parse the <em>dimension@name</em> and <em>dimension@length</em> attributes.</p>
</li>
<li>
<p>Dimensions can only be specified as a direct child of a &lt;netcdf&gt;
element prior to any reference to them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf&gt;
  &lt;dimension name="station" length="2"/&gt;
  &lt;dimension name="samples" length="5"/&gt;
  &lt;!-- Some variable elements refer to the dimensions here --&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The dimension element sets up a mapping from the <em>name</em> to the unsigned
integer <em>length</em> and can be used in a <em>variable@shape</em> to specify a
length for an array dimension (see the section on &lt;variable&gt; below). The
dimension map is cleared when &lt;/netcdf&gt; is encountered (though this
doesn&#8217;t matter currently since we allow only one right now, but it will
matter for aggregation, potentially). We also do not support &lt;group&gt;,
which is the only other legal place in NcML 2.2 for a dimension element.</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the name and length are not both specified.</p>
</li>
<li>
<p>If the dimension name already exists in the current scope</p>
</li>
<li>
<p>If the length is not an unsigned integer</p>
</li>
<li>
<p>If any of the other attributes specified in NcML 2.2 are used. We do
not handle them, so we consider them errors now.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_variable_element">&lt;variable&gt; Element</h6>
<div class="paragraph">
<p>The &lt;variable&gt; element is used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide lexical scope for a contained &lt;attribute&gt; or &lt;variable&gt;
element</p>
</li>
<li>
<p>Rename existing variables</p>
</li>
<li>
<p>Add new scalar variables of simple types</p>
</li>
<li>
<p>Add new Structure variables</p>
</li>
<li>
<p>Add new N-dimensional Array&#8217;s of simple types</p>
</li>
<li>
<p>Specify the coordinate variable for the new dimension in a joinNew
aggregation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We describe each in turn in more detail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When working with an existing variable (array or otherwise) it is
not required that the variable type be specified in it' NcML
declaration. All that is needed is the correct name (in lexical scope).
When specifying the type for an existing variable care must be taken to
ensure that the type specified in the NcML document matches the type of
the existing variable. In particular, variables that are arrays must be
called array, and not the type of the template primitive.
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="_specifying_lexical_scope_with_variable_type">Specifying Lexical Scope with &lt;variable type=""&gt;</h7>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;variable name="u"&gt;
    &lt;attribute name="Metadata" type="string"&gt;This is metadata!&lt;/attribute&gt;
  &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This code assumes that a variable named "u" exists (of any type since we
do not specify) and provides the lexical scope for the attribute
"Metadata" which will be added or modified within the attribute table
for the variable "u" (it&#8217;s qualified name would be "u.Metadata").</p>
</div>
</div>
<div class="sect6">
<h7 id="_nested_dap_structure_and_grid_scopes">Nested DAP Structure and Grid Scopes</h7>
<div class="paragraph">
<p>Scoping variable elements may be nested if the containing variable is a
Structure (this includes the special case of Grid)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;variable name="DATA_GRANULE" type="Structure"&gt;
    &lt;variable name="PlanetaryGrid" type="Structure"&gt;
      &lt;variable name="percipitate"&gt;
    &lt;attribute name="units" type="String" value="inches"/&gt;
      &lt;/variable&gt;
    &lt;/variable&gt;
  &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This adds a "unit" attribute to the variable "percipitate" within the
nested Structure&#8217;s ("DATA_GRANULE.PlanetaryGrid.percipitate" as fully
qualified name). Note that we <strong>must</strong> refer to the type explicitly as a
"Structure" so the parser knows to traverse the tree.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The variable might be of type Grid, but the type "Structure" must
be used in the NcML to traverse it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_adding_multiple_attributes_to_the_same_variable">Adding Multiple Attributes to the Same Variable</h7>
<div class="paragraph">
<p>Once the variable&#8217;s scope is set by the opening &lt;variable&gt; element, more
than one attribute can be specified within it. This will make the NcML
more readable and also will make the parsing more efficient since the
variable will only need to be looked up once.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="Foo"&gt;
   &lt;attribute name="Attr_1" type="string" value="Hello"/&gt;
   &lt;attribute name="Attr_2" type="string" value="World!"/&gt;
&lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;should be preferred over&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="Foo"&gt;
   &lt;attribute name="Attr_1" type="string" value="Hello"/&gt;
&lt;/variable&gt;

&lt;variable name="Foo"&gt;
   &lt;attribute name="Attr_2" type="string" value="World!"/&gt;
&lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;although they produce the same result. Any number of attributes can be
specified before the variable is closed.</p>
</div>
</div>
<div class="sect6">
<h7 id="_renaming_existing_variables">Renaming Existing Variables</h7>
<div class="paragraph">
<p>The attribute <em>variable@orgName</em> is used to rename an existing variable.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="NewName" orgName="OldName"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will rename an existing variable at the current scope named "OldName" to
"NewName". After this point in the NcML file (such as in constraints
specified for the DAP request), the variable is known by "NewName".</p>
</div>
<div class="paragraph">
<p>Note that the type is not required here --- the variable is assumed to
exist and its existing type is used. It is not possible to change the
type of an existing variable at this time!</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a variable with <em>variable@orgName</em> doesn&#8217;t exist in the current
scope</p>
</li>
<li>
<p>If the new name <em>variable@name</em> is already taken in the current scope</p>
</li>
<li>
<p>If a new variable is created but does not have exactly one values
element</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_adding_a_new_scalar_variable">Adding a New Scalar Variable</h7>
<div class="paragraph">
<p>The &lt;variable&gt; element can be used to create a new scalar variable of a
simple type (i.e. an atomic NcML type such as "int" or "float", or any
DAP atomic type, such as "UInt32" or "URL") by specifying an empty
<em>variable@shape</em> (which is the default), a simple type for
<em>variable@type</em>, and a contained &lt;values&gt; element with the one value
of correct type.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="TheAnswerToLifeTheUniverseAndEverything" type="double"&gt;
    &lt;attribute name="SolvedBy" type="String" value="Deep Thought"/&gt;
    &lt;values&gt;42.000&lt;/values&gt;
  &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will create a new variable named
"TheAnswerToLifeTheUniverseAndEverything" at the current scope. It has
no shape so will be a scalar of type "double" and will have the value
42.0.</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is a parse error to not specify a &lt;values&gt; element with exactly one
proper value of the variable type.</p>
</li>
<li>
<p>It is a parse error to specify a malformed or out of bounds value for
the data type</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_adding_a_new_structure_variable">Adding a New Structure Variable</h7>
<div class="paragraph">
<p>A new Structure variable can be specified at the global scope or within
another Structure. It is illegal for an array to have type structure, so
the shape must be empty.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="MyNewStructure" type="Structure"&gt;
    &lt;attribute name="MetaData" type="String" value="This is metadata!"/&gt;
    &lt;variable name="ContainedScalar1" type="String"&gt;&lt;values&gt;I live in a new structure!&lt;/values&gt;&lt;/variable&gt;
    &lt;variable name="ContainedInt1" type="int"&gt;&lt;values&gt;42&lt;/values&gt;&lt;/variable&gt;
  &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;specifies a new structure called "MyNewStructure" which contains two
scalar variable fields "ContainedScalar1" and "ContainedInt1".</p>
</div>
<div class="paragraph">
<p>Nested structures are allowed as well.</p>
</div>
<div class="paragraph">
<p><strong>Parse Error</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If another variable or attribute exists at the current scope with the
new name.</p>
</li>
<li>
<p>If a &lt;values&gt; element is specified as a direct child of a new
Structure --- structures cannot contain values, only attributes and
other variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_adding_a_new_n_dimensional_array">Adding a New N-dimensional Array</h7>
<div class="paragraph">
<p>An N-dimensional array of a simple type may be created virtually as well
by specifying a non-empty <em>variable@shape</em>. The shape contains the
array dimensions in left-to-right order of slowest varying dimension
first. For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;variable name="FloatArray" type="float" shape="2 5"&gt;
      &lt;!-- values specified in row major order (leftmost dimension in shape varies slowest)
    Any whitespace is a valid separator by default, so we can use newlines to pretty print 2D matrices.
    --&gt;
      &lt;values&gt;
    0.1 0.2 0.3 0.4 0.5
    1.1 1.1 1.3 1.4 1.5
      &lt;/values&gt;
    &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will specify a 2x5 dimension array of float values called "FloatArray".
The &lt;values&gt; element must contain 2x5=10 values in row major order
(slowest varying dimension first). Since whitespace is the default
separator, we use a newline to show the dimension boundary for the
values, which is easy to see for a 2D matrix such as this.</p>
</div>
<div class="paragraph">
<p>A dimension name may also be used to refer mnemonically to a length. The
DAP response will use this mnemonic in its output, but it is not
currently used for shared dimensions, only as a mnemonic. See the
section on the &lt;dimension&gt; element for more information. For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf&gt;
 &lt;dimension name="station" length="2"/&gt;
 &lt;dimension name="sample" length="5"/&gt;
 &lt;variable name="FloatArray" type="float" shape="station sample"&gt;
      &lt;values&gt;
    0.1 0.2 0.3 0.4 0.5
    1.1 1.1 1.3 1.4 1.5
      &lt;/values&gt;
    &lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will produce the same 2x5 array, but will incorporate the dimension
mnemonics into the response. For example, here&#8217;s the DDS response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
     Float32 FloatArray[station = 2][samples = 5];
} sample_virtual_dataset.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the &lt;values&gt; element respects the <em>values@separator</em> attribute
if whitespace isn&#8217;t correct. This is very useful for arrays of strings
with whitespace, for example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="StringArray" type="string" shape="3"&gt;
  &lt;values separator="*"&gt;String 1*String 2*String 3&lt;/values&gt;
&lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;creates a length 3 array of string StringArray = \{"String 1", "String
2", "String 3"}.</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is an error to specify the incorrect number of values</p>
</li>
<li>
<p>It is an error if any value is malformed or out of range for the data
type.</p>
</li>
<li>
<p>It is an error to specify a named dimension which does not exist in
the current &lt;netcdf&gt; scope.</p>
</li>
<li>
<p>It is an error to specify an Array whose flattened size (product of
dimensions) is &gt; 2^31-1.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_specifying_the_new_coordinate_variable_for_a_joinnew_aggregation">Specifying the New Coordinate Variable for a joinNew Aggregation</h7>
<div class="paragraph">
<p>In the special case of a joinNew aggregation, the new coordinate
variable may be specified with the &lt;variable&gt; element. The new
coordinate variable is <em>defined</em> to have the same name as the new
dimension. This allows for several things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explicit specification of the variable type and coordinates for the
new dimension</p>
</li>
<li>
<p>Specification of the metadata for the new coordinate variable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first case, the author can specify explicitly the type of the new
coordinate variable and the actual values for each dataset. In this
case, the variable <em>must</em> be specified <em>after</em> the aggregation element
in the file so the new dimension&#8217;s size (number of member datasets) may
be known and error checking performed. Metadata can also be added to the
variable here.</p>
</div>
<div class="paragraph">
<p>In the second case, the author may just specify the variable name, which
allows one to specify the metadata for a coordinate variable that is
automatically generated by the aggregation itself. This is the only
allowable case for a variable element to <em>not</em> contain a values element!
Coordinate variables are generated automatically in two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The author has specified an explicit list of member datasets, with or
without explicit coordVal attributes.</p>
</li>
<li>
<p>The author has used a &lt;scan&gt; element to specify the member datasets
via a directory scan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, the &lt;variable&gt; element may come before or after the
&lt;aggregation&gt;.</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If an explicit variable is declared for the new coordinate variable:</p>
<div class="ulist">
<ul>
<li>
<p>And it contains explicit values, the number of values must be equal
to the number of member datasets in the aggregation.</p>
</li>
<li>
<p>It must be specifed <em>after</em> the &lt;aggregation&gt; element</p>
</li>
</ul>
</div>
</li>
<li>
<p>If a numeric coordVal is used to specify the first member dataset&#8217;s
coordinate, then <em>all</em> datasets must contain a numerical coordinate.</p>
</li>
<li>
<p>An error is thrown if the specified aggregation variable (variableAgg)
is not found in <em>all</em> member datasets.</p>
</li>
<li>
<p>An error is thrown if the specified aggregation variable is not of the
same type in <em>all</em> member datasets. Coercion is <em>not</em> performed!</p>
</li>
<li>
<p>An error is thrown if the specified aggregation variables in all
member datasets do not have the same shape</p>
</li>
<li>
<p>An error is thrown if an explicit coordinate variable is specified
with a shape that is <em>not</em> the same as the new dimension name (and the
variable name itself).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_values_element">&lt;values&gt; Element</h6>
<div class="paragraph">
<p>The &lt;values&gt; element can only be used in the context of a <strong>new</strong> variable
of scalar or array type. We cannot change the values for existing
variables in this version of the handler. The characters content of a
&lt;values&gt; element is considered to be a separated list of value tokens
valid for the type of the variable of the parent element. The number of
specified tokens in the content <em>must</em> equal the product of the
dimensions of the enclosing <em>variable@shape</em>, or be one value for a
scalar. It is an error to <em>not</em> specify a &lt;values&gt; element for a
declared new variable as well.</p>
</div>
<div class="sect6">
<h7 id="_changing_the_separator_tokens">Changing the Separator Tokens</h7>
<div class="paragraph">
<p>The author may specify values@separator to change the default value
token separator from the default whitespace. This is very useful for
specifying arrays of strings with whitespace in them, or if data in CSV
form is being pasted in.</p>
</div>
</div>
<div class="sect6">
<h7 id="_autogeneration_of_uniform_arrays">Autogeneration of Uniform Arrays</h7>
<div class="paragraph">
<p>We also can parse <em>values@start</em> and <em>values@increment</em> INSTEAD OF
tokens in the content. This will "autogenerate" a uniform array of
values of the given product of dimensions length for the containing
variable. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;variable name="Evens" type="int" shape="100"&gt;
  &lt;values start="0" increment="2"/&gt;
&lt;/variable&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>will specify an array of the first 100 even numbers (including 0).</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the incorrect number of tokens are specified for the containing
variable&#8217;s shape</p>
</li>
<li>
<p>If any value token cannot be parsed as a valid value for the
containing variable&#8217;s type</p>
</li>
<li>
<p>If content is specified in addition to start and increment</p>
</li>
<li>
<p>If only one of start or increment is specified</p>
</li>
<li>
<p>If the values element is placed anywhere except within a NEW variable.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_attribute_element">&lt;attribute&gt; Element</h6>
<div class="paragraph">
<p>As an overview, whenever the parser encounters an &lt;attribute&gt; with a
non-existing name (at the current scope), it creates a new one, whether
a container or atomic attribute (see below). If the attribute exists,
its value and/or type is modified to those specified in the &lt;attribute&gt;
element. If an attribute structure (container) exists, it is used to
define a nested lexical scope for child attributes.</p>
</div>
<div class="paragraph">
<p>Attributes may be scalar (one value) or one dimensional arrays. Arrays
are specified by using whitespace (default) to separate the different
values. The attribute@separator may also be set in order to specify a
different separator, such as CSV format or to specify a non-whitespace
separator so strings with whitespace are not tokenized. We will give
examples of creating array attributes below.</p>
</div>
<div class="sect6">
<h7 id="_adding_new_attributes_or_modifying_an_existing_attribute">Adding New Attributes or Modifying an Existing Attribute</h7>
<div class="paragraph">
<p>If a specified attribute with the attribute@name does not exist at the
current lexical scope, a new one is created with the given type and
value. For example, assume "new_metadata" doesn&#8217;t exist at the current
parse scope. Then&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="new_metadata" type="string" value="This is a new entry!"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will create the attribute at that scope. Note that value can be
specified in the content of the element as well. This is identical to
the above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="new_metadata" type="string"&gt;This is a new entry!&lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If the attribute@name already exists at the scope, it is modified to
contain the specified type and value.</p>
</div>
</div>
<div class="sect6">
<h7 id="_arrays_2">Arrays</h7>
<div class="paragraph">
<p>As in NcML, for numerical types an array can be specified by separating
the tokens by whitespace (default) or be specifying the token separator
with attribute@separator. For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="myArray" type="int"&gt;1 2 3&lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="myArray" type="int" separator=","&gt;1,2,3&lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;both specify the same array of three integers named "myArray".</p>
</div>
<div class="paragraph">
<p>TODO Add more information on splitting with a separator!</p>
</div>
</div>
<div class="sect6">
<h7 id="_structures_containers">Structures (Containers)</h7>
<div class="paragraph">
<p>We use attribute@type="Structure" to define a new (or existing)
attribute container. So if we wanted to add a new attribute structure,
we&#8217;d use something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;attribute name="MySamples" type="Structure"&gt;
    &lt;attribute name="Location" type="string" value="Station 1"/&gt;
    &lt;attribute name="Samples" type="int"&gt;1 4 6&lt;/attribute&gt;
  &lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming "MySamples" doesn&#8217;t already exist, an attribute container will
be created at the current scope and the "Location" and "Samples"
attributes will be added to it.</p>
</div>
<div class="paragraph">
<p>Note that we can create nested attribute structures to arbitrary depth
this way as well.</p>
</div>
<div class="paragraph">
<p>If the attribute container with the given name already exists at the
current scope, then the attribute@type="Structure" form is used to
define the lexical scope for the container. In other words, child
&lt;attribute&gt; elements will be processed within the scope of the
container. For example, in the above example, if "MySamples" already
exists, then the "Location" and "Samples" will be processed within the
existing container (they may or may not already exist as well).</p>
</div>
</div>
<div class="sect6">
<h7 id="_renaming_an_existing_attribute_or_attribute_container">Renaming an Existing Attribute or Attribute Container</h7>
<div class="paragraph">
<p>We also support the attribute@orgName attribute for renaming attributes.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="NewName" orgName="OldName" type="string"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>will rename an existing attribute "OldName" to "NewName" while leaving
its value alone. If attribute@value is also specified, then the
attribute is renamed <em>and</em> has its value modified.</p>
</div>
<div class="paragraph">
<p>This works for renaming attribute containers as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;attribute name="MyNewContainer" orgName="MyOldContainer" type="Structure"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will rename an existing "MyOldContainer" to "MyNewContainer". Note that
any children of this container will remain in it.</p>
</div>
</div>
<div class="sect6">
<h7 id="_dap_otherxml_extension">DAP <em>OtherXML</em> Extension</h7>
<div class="paragraph">
<p>The module now allows specification of attributes of the new DAP type
"OtherXML". This allows the NCML file author to inject arbitrary
well-formed XML into an attribute for clients that want XML metadata
rather than just string or url. Internally, the attribute is still a
string (and in a DAP DAS response will be quoted inside one string).
However, since it is XML, the NCMLParser still parses it and checks it
for well-formedness (but NOT against schemas). This extension allows the
NCMLParser to parse the arbitrary XML within the given attribute without
causing errors, since it can be any XML.</p>
</div>
<div class="paragraph">
<p>The injected XML is most useful in the DDX response, where it shows up
directly in the response as XML. XSLT and other clients can then parse
it.</p>
</div>
</div>
<div class="sect6">
<h7 id="_errors">Errors</h7>
<div class="ulist">
<ul>
<li>
<p>The XML <strong>must</strong> be in the content of the &lt;attribute type="OtherXML"&gt;
element. It is a parser error for <em>attribute@value</em> to be set if
<em>attribute@type</em> is "OtherXML".</p>
</li>
<li>
<p>The XML must also be well-formed since it is parsed. A parse error
will be thrown if the OtherXML is malformed.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_example_5">Example</h7>
<div class="paragraph">
<p>Here&#8217;s an example of the use of this special case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" location="/coverage/200803061600_HFRadar_USEGC_6km_rtv_SIO.nc"&gt;

    &lt;attribute name="someName" type="OtherXML"&gt;
        &lt;Domain xmlns="http://www.opengis.net/wcs/1.1"
                xmlns:ows="http://www.opengis.net/ows/1.1"
                xmlns:gml="http://www.opengis.net/gml/3.2"
                &gt;
            &lt;SpatialDomain&gt;
                &lt;ows:BoundingBox crs="urn:ogc:def:crs:EPSG::4326"&gt;
                    &lt;ows:LowerCorner&gt;-97.8839 21.736&lt;/ows:LowerCorner&gt;
                    &lt;ows:UpperCorner&gt;-57.2312 46.4944&lt;/ows:UpperCorner&gt;
                &lt;/ows:BoundingBox&gt;
            &lt;/SpatialDomain&gt;
            &lt;TemporalDomain&gt;
                &lt;gml:timePosition&gt;2008-03-27T16:00:00.000Z&lt;/gml:timePosition&gt;
            &lt;/TemporalDomain&gt;
        &lt;/Domain&gt;
        &lt;SupportedCRS xmlns="http://www.opengis.net/wcs/1.1"&gt;urn:ogc:def:crs:EPSG::4326&lt;/SupportedCRS&gt;
        &lt;SupportedFormat xmlns="http://www.opengis.net/wcs/1.1"&gt;netcdf-cf1.0&lt;/SupportedFormat&gt;
        &lt;SupportedFormat xmlns="http://www.opengis.net/wcs/1.1"&gt;dap2.0&lt;/SupportedFormat&gt;
    &lt;/attribute&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>TODO: Put the DDX response for the above in here!</p>
</div>
</div>
<div class="sect6">
<h7 id="_namespace_closure">Namespace Closure</h7>
<div class="paragraph">
<p>Furthermore, the parser will make the chunk of OtherXML "namespace
closed". This means any namespaces specified in parent NCML elements of
the OtherXML tree will be "brought down" and added to the <em>root</em>
OtherXML elements so that the subtree may be pulled out and added to the
DDX and still have its namespaces. The algorithm doesn&#8217;t just bring used
prefixes, but brings <em>all</em> of the lexically scoped closest namespaces in
all ancestors. In other words, it adds unique namespaces (as determined
by prefix) in order from the root of the OtherXML tree as it traverses
to the root of the NCML document.</p>
</div>
<div class="paragraph">
<p>Namespace closure is a syntactic sugar that simplifies the author&#8217;s task
since they can specify the namespaces just once at the top of the NCML
file and expect that when the subtree of XML is added to the DDX that
these namespaces will come along with that subtree of XML. Otherwise
they have to explicitly add the namespaces to each attributes.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong> Add an example!</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_remove_element">&lt;remove&gt; Element</h6>
<div class="paragraph">
<p>The &lt;remove&gt; element can remove attributes and variables. For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;attribute name="NC_GLOBAL" type="Structure"&gt;
    &lt;remove name="base_time" type="attribute"/&gt;
  &lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will remove the attribute named "base_time" in the attribute structure
named "NC_GLOBAL".</p>
</div>
<div class="paragraph">
<p>Note that this works for attribute containers as well. We could
recursively remove the <em>entire</em> attribute container (i.e. it and all its
children) with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> &lt;remove name="NC_GLOBAL" type="attribute"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It also can be used to remove variables from existing datasets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;remove name="SomeExistingVariable" type="variable"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This also recurses on variables of type Structure --- the entire
structure including all of its children are removed from the dataset&#8217;s
response.</p>
</div>
<div class="paragraph">
<p><strong>Parse Errors</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is a parse error if the given attribute or variable doesn&#8217;t exist
in the current scope</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_aggregation_element">&lt;aggregation&gt; Element</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The syntax used by Hyrax is slightly different from the
THREDDS Data Server (TDS). In particular, we do not process the
&lt;aggregation&gt; element prior to other elements in the dataset, so in some
cases the relative ordering of the &lt;aggregation&gt; and references to
variables within the aggregation matters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Aggregation involves combining multiple datasets (&lt;netcdf&gt;) into a
virtual "single" dataset in various ways. For a tutorial on aggregation
in NcML 2.2, the reader is referred to the Unidata page:
<a href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html" class="bare">http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html</a></p>
</div>
<div class="paragraph">
<p>NcML 2.2 supports multiple types of aggregation: union, joinNew,
joinExisting, and fmrc (forecast model run collection).</p>
</div>
<div class="paragraph">
<p>The current version of the NcML module supports two of these
aggregations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Union <a href="#union_aggregation">NCML_Module_Aggregation_Union</a></p>
</li>
<li>
<p>JoinNew <a href="#join_new_aggregation">NCML_Module_Aggregation_JoinNew</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>union</em> aggregation specifies that the first instance of a variable or
attribute (by name) that is found in the ordered list of datasets will
be the one in the output aggregation. This is useful for combining two
dataset files, each which may contain a single variable, into a
composite dataset with both variables.</p>
</div>
<div class="paragraph">
<p>A <em>JoinNew</em> aggregation joins a variable which exists in multiple datasets
(usually samples of a datum over time) into a new variable containing
the data from <em>all</em> member datasets by creating a new outer dimension.
The <em>i</em>th component in the new outer dimension is the variable&#8217;s data
from the <em>i</em>th member dataset. It also adds a new coordinate variable
of whose name is the new dimension&#8217;s name and whose shape (length) is
the new dimension as well. This new coordinate variable may be
explicitly given by the author or may be autogenerated in one of several
ways.</p>
</div>
</div>
<div class="sect5">
<h6 id="_scan_element">&lt;scan&gt; Element</h6>
<div class="paragraph">
<p>The scan element can be used within an aggregation context to allow a
directory to be searched in various ways in order to specify the members
of an aggregation. This allows a static NcML file to refer to an
aggregation which may change over time, such as where a new data file is
generated each day.</p>
</div>
<div class="paragraph">
<p><a href="#join_new_aggregation"><strong>We describe usage of the &lt;scan&gt; element
in detail in the joinNew aggregation tutorial here</strong></a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_errors_2">Errors</h5>
<div class="paragraph">
<p>There are three types of error messages that may be returned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internal Error</p>
</li>
<li>
<p>Resource Not Found Error</p>
</li>
<li>
<p>Parse Error</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_internal_errors">Internal Errors</h6>
<div class="paragraph">
<p><strong>Internal errors</strong> should be reported to <a href="mailto:support@opendap.org">support@opendap.org</a> as they are
likely bugs.</p>
</div>
</div>
<div class="sect5">
<h6 id="_resource_not_found_errors">Resource Not Found Errors</h6>
<div class="paragraph">
<p>If the netcdf@location specifies a non-existent local dataset (one that
is not being served by the same Hyrax server), it will specify the
resource was not found. This may also be returned if a handler for the
specified dataset is not currently loaded in the BES. Users should test
that the dataset to be wrapped already exists and can be viewed on the
running server before writing NcML to add metadata. It&#8217;s also an error
to refer to remote datasets (at this time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_parse_errors">Parse Errors</h6>
<div class="paragraph">
<p><strong>Parse errors</strong> are user errors in the NcML file. These could be
malformed XML, malformed NcML, unimplemented features of NcML, or could
be errors in referring to the wrapped dataset.</p>
</div>
<div class="paragraph">
<p>The error message should specify the error condition as well as the
"current scope" as a fully qualified DAP name within the loaded dataset.
This should be enough information to correct the parse error as new NcML
files are created.</p>
</div>
<div class="paragraph">
<p>The parser will generate parse errors in various situations where it
expects to find certain structure in the underlying dataset. Some
examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A variable of the given name was not found at the current scope</p>
</li>
<li>
<p>attribute@orgName was specified, but the attribute cannot be found at
current scope.</p>
</li>
<li>
<p>attribute@orgName was specified, but the new name is already used at
current scope.</p>
</li>
<li>
<p>remove specified a non-existing attribute name</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_additionschanges_to_ncml_2_2">Additions/Changes to NcML 2.2</h5>
<div class="paragraph">
<p>This section will keep track of changes to the NcML 2.2 schema.
Eventually these will be rolled into a new schema.</p>
</div>
<div class="sect5">
<h6 id="_attribute_structures_containers">Attribute Structures (Containers)</h6>
<div class="paragraph">
<p>This module also adds functionality beyond the current NcML 2.2 schema
--- it can handle nested &lt;attribute&gt; elements in order to make attribute
structures. This is done by using the &lt;attribute type="Structure"&gt; form,
for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;attribute name="MySamples" type="Structure"&gt;
    &lt;attribute name="Location" type="string" value="Station 1"/&gt;
    &lt;attribute name="Samples" type="int"&gt;1 4 6&lt;/attribute&gt;
  &lt;/attribute&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>"MyContainer" describes an attribute structure with two attribute
fields, a string "Location" and an array of int&#8217;s called "Samples". Note
that an attribute structure of this form can only contain other
&lt;attribute&gt; elements and NOT a value.</p>
</div>
<div class="paragraph">
<p>If the container does not already exist, it will be created at the scope
it is declared, which could be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global (top of dataset)</p>
</li>
<li>
<p>Within a variable&#8217;s attribute table</p>
</li>
<li>
<p>Within another attribute container</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an attribute container of the given name already exists at the
lexical scope, it is traversed in order to define the scope for the
nested (children) attributes it contains.</p>
</div>
</div>
<div class="sect5">
<h6 id="_unspecified_variable_type_matching_for_lexical_scope">Unspecified Variable Type Matching for Lexical Scope</h6>
<div class="paragraph">
<p>We also allow the type attribute of a variable element (variable@type)
to be the empty string (or unspecified) when using existing variables to
define the lexical scope of an &lt;attribute&gt; transformation. In the
schema, variable@type is (normally) required.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dap_2_types">DAP 2 Types</h6>
<div class="paragraph">
<p>Additionally, we allow DAP2 atomic types (such as UInt32, URL) in
addition to the NcML types. The NcML types are mapped onto the closest
DAP2 type internally.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dap_otherxml_attribute_type">DAP OtherXML Attribute Type</h6>
<div class="paragraph">
<p>We also allow attributes to be of the new DAP type "OtherXML" for
injecting arbitrary XML into an attribute as content rather than trying
to form a string. This allows the parser to check well-formedness.</p>
</div>
</div>
<div class="sect5">
<h6 id="_forward_declaration_of_dimensions">Forward Declaration of Dimensions</h6>
<div class="paragraph">
<p>Since we use a SAX parser for efficiency, we require the &lt;dimension&gt;
elements to come <em>before</em> their use in a <em>variable@shape</em>. One way to
change the schema to allow this is to force the dimension elements to be
specified in a sequence after explicit and metadata choice and before
all other elements.</p>
</div>
</div>
<div class="sect5">
<h6 id="_aggregation_element_location_and_processing_order_differences">Aggregation Element Location and Processing Order Differences</h6>
<div class="paragraph">
<p>NcML specifies that if a dataset (&lt;netcdf&gt; element) specifies an
aggregation element, the aggregation element is always processed first,
regardless of its ordering within the &lt;netcdf&gt; element. Our parser,
since it is SAX and not DOM, modifies this behavior in that order
matters in some cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Metadata (&lt;attribute&gt;) elements specified <em>prior</em> to an aggregation
"shadow" the aggregation versions. This is be useful for "overriding" an
attribute or variable in a union aggregation, where the first found will
take precedence.</p>
</li>
<li>
<p>JoinNew: If the new coordinate variable&#8217;s data is to be set explicitly
by specifying the new dimension&#8217;s shape (either with explicit data or
the autogenerated data using values@start and values@increment
attributes), the &lt;variable&gt; <em>must</em> come after the aggregation since the
size of the dimension is unknown until the aggregation element is
processed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_backward_compatibility_issues">Backward Compatibility Issues</h5>
<div class="paragraph">
<p>Due to the way shared dimensions were implemented in the NetCDF, HDF4,
and HDF5 handlers, the DAS responses did not follow the DAP2
specification. The NcML module, on the other hand, generates DAP2
compliant DAS for these datasets, which means that wrapping some
datasets in NcML will generate a DAS with a different structure. This is
important for the NcML author since it changes the names of attributes
and variables. In order for the module to find the correct scope for
adding metadata, for example, the DAP2 DAS must be used.</p>
</div>
<div class="paragraph">
<p>In general, what this means is that an empty "passthrough" NcML file
should be the starting point for authoring an NcML file. This file would
just specify a dataset and nothing else:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf location="/data/ncml/myNetcdf.nc"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The author would then request the DAS response for the NCML file and use
that as the starting point for modifications to the original dataset.</p>
</div>
<div class="paragraph">
<p>More explicit examples are given below.</p>
</div>
<div class="sect5">
<h6 id="_netcdf">NetCDF</h6>
<div class="paragraph">
<p>The NetCDF handler represents some NC datasets as a DAP 2 Grid, but the
returned DAS is not consistent with the DAP 2 spec for the attribute
hierarchy for such a Grid. The map vector attributes are placed as
siblings of the grid attributes rather than within the grid lexical
scope. For example, here&#8217;s the NetCDF Handler DDS for a given file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Int16 cldc[time = 456][lat = 21][lon = 360];
      Maps:
        Float64 time[time = 456];
        Float32 lat[lat = 21];
        Float32 lon[lon = 360];
    } cldc;
} cldc.mean.nc;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;showing the Grid. Here&#8217;s the DAS the NetCDF handler generates&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    lat {
        String long_name "Latitude";
        String units "degrees_north";
        Float32 actual_range 10.00000000, -10.00000000;
    }
    lon {
        String long_name "Longitude";
        String units "degrees_east";
        Float32 actual_range 0.5000000000, 359.5000000;
    }
    time {
        String units "days since 1-1-1 00:00:0.0";
        String long_name "Time";
        String delta_t "0000-01-00 00:00:00";
        String avg_period "0000-01-00 00:00:00";
        Float64 actual_range 715511.00000000000, 729360.00000000000;
    }
    cldc {
        Float32 valid_range 0.000000000, 8.000000000;
        Float32 actual_range 0.000000000, 8.000000000;
        String units "okta";
        Int16 precision 1;
        Int16 missing_value 32766;
        Int16 _FillValue 32766;
        String long_name "Cloudiness Monthly Mean at Surface";
        String dataset "COADS 1-degree Equatorial Enhanced\\012AI";
        String var_desc "Cloudiness\\012C";
        String level_desc "Surface\\0120";
        String statistic "Mean\\012M";
        String parent_stat "Individual Obs\\012I";
        Float32 add_offset 3276.500000;
        Float32 scale_factor 0.1000000015;
    }
    NC_GLOBAL {
        String title "COADS 1-degree Equatorial Enhanced";
        String history "";
        String Conventions "COARDS";
    }
    DODS_EXTRA {
        String Unlimited_Dimension "time";
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note the map vector attributes are in the "dataset" scope.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the DAS that the NcML Module produces from the correctly formed
DDX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    NC_GLOBAL {
        String title "COADS 1-degree Equatorial Enhanced";
        String history "";
        String Conventions "COARDS";
    }
    DODS_EXTRA {
        String Unlimited_Dimension "time";
    }
    cldc {
        Float32 valid_range 0.000000000, 8.000000000;
        Float32 actual_range 0.000000000, 8.000000000;
        String units "okta";
        Int16 precision 1;
        Int16 missing_value 32766;
        Int16 _FillValue 32766;
        String long_name "Cloudiness Monthly Mean at Surface";
        String dataset "COADS 1-degree Equatorial Enhanced\\012AI";
        String var_desc "Cloudiness\\012C";
        String level_desc "Surface\\0120";
        String statistic "Mean\\012M";
        String parent_stat "Individual Obs\\012I";
        Float32 add_offset 3276.500000;
        Float32 scale_factor 0.1000000015;
        cldc {
        }
        time {
            String units "days since 1-1-1 00:00:0.0";
            String long_name "Time";
            String delta_t "0000-01-00 00:00:00";
            String avg_period "0000-01-00 00:00:00";
            Float64 actual_range 715511.00000000000, 729360.00000000000;
        }
        lat {
            String long_name "Latitude";
            String units "degrees_north";
            Float32 actual_range 10.00000000, -10.00000000;
        }
        lon {
            String long_name "Longitude";
            String units "degrees_east";
            Float32 actual_range 0.5000000000, 359.5000000;
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here the Grid Structure "cldc" and its contained data array (of the same
name "cldc") and map vectors have their own attribute containers as DAP
2 specifies.</p>
</div>
<div class="paragraph">
<p>What this means for the author of an NcML file adding metadata to a
NetCDF dataset that returns a Grid is that they should generate a
"passthrough" file and get the DAS and then specify modifications based
on that structure.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example passthrough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf location="data/ncml/agg/cldc.mean.nc" title="This file results in a Grid"&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to add an attribute to the map vector "lat" in the above,
we&#8217;d need the following NcML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf location="data/ncml/agg/cldc.mean.nc" title="This file results in a Grid"&gt;
  &lt;!-- Traverse into the Grid as a Structure --&gt;
  &lt;variable name="cldc" type="Structure"&gt;
    &lt;!-- Traverse into the "lat" map vector (Array) --&gt;
    &lt;variable name="lat"&gt;
      &lt;attribute name="Description" type="string"&gt;I am a new attribute in the Grid map vector named lat!&lt;/attribute&gt;
    &lt;/variable&gt;
    &lt;variable name="lon"&gt;
      &lt;attribute name="Description" type="string"&gt;I am a new attribute in the Grid map vector named lon!&lt;/attribute&gt;
    &lt;/variable&gt;
  &lt;/variable&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This clearly shows that the structure of the Grid must be used in the
NcML: the attribute being added is technically "cldc.lat.Description" in
a fully qualified name. The parser would return an error if it was
attempted as "lat.Description" as the NetCDF DAS for the original file
would have led one to believe.</p>
</div>
</div>
<div class="sect5">
<h6 id="_hdf4hdf5">HDF4/HDF5</h6>
<div class="paragraph">
<p>Similarly to the NetCDF case, the Hyrax HDF4 Module produces DAS
responses that do not respect the DAP2 specification. If an NcML file is
used to "wrap" an HDF4 dataset, the correct DAP2 DAS response will be
generated, however.</p>
</div>
<div class="paragraph">
<p>This is important for those writing NcML for HDF4 data since the lexical
scope for attributes relies on the correct DAS form --- to handle this,
the user should start with a "passthrough" NcML file (see the above
NetCDF example) and use the DAS from that as the starting point for
knowing the structure the NcML handler expects to see in the NcML file.
Alternatively, the DDX has the proper attribute structure as well (the
DAS is generated from it).</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_known_bugs">Known Bugs</h5>
<div class="paragraph">
<p>There are no known bugs currently.</p>
</div>
</div>
<div class="sect4">
<h5 id="_planned_enhancements">Planned Enhancements</h5>
<div class="paragraph">
<p>Planned enhancements for future versions of the module include&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New NcML Aggregations</p>
<div class="ulist">
<ul>
<li>
<p>Forecast Model Run Collection (FMRC)</p>
<div class="ulist">
<ul>
<li>
<p>Special case of JoinNew for forecast data with two time variables</p>
</li>
<li>
<p>See:
<a href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/FmrcAggregation.html" class="bare">http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/FmrcAggregation.html</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join_new_aggregation">11.E.2. JoinNew Aggregation</h4>
<div class="sect4">
<h5 id="_introduction_12">Introduction</h5>
<div class="paragraph">
<p>A <em>joinNew</em> aggregation joins existing datasets along a new outer Array
dimension. Essentially, it adds a new index to the existing variable
which points into the values in each member dataset. One useful example
of this aggregation is for joining multiple samples of data from
different times into one virtual dataset containing all the times. We
will first provide a basic introduction to the joinNew aggregation, then
demonstrate examples for the various ways to specify the members
datasets of an aggregation, the values for the new dimension&#8217;s
coordinate variable (map vector), and ways to specify metadata for this
aggregation.</p>
</div>
<div class="paragraph">
<p>The reader is also directed to a basic tutorial of this NcML aggregation
which may be found at
<a href="http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/ncml/Aggregation.html#joinNew" class="bare">http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/ncml/Aggregation.html#joinNew</a></p>
</div>
<div class="paragraph">
<p>A <em>joinNew</em> aggregation combines a variable with data across <em>n</em>
datasets by creating a new <em>outer dimension</em> and placing the data from
aggregation member <em>i</em> into the element <em>i</em> of the new outer dimension
of size <em>n</em>. By "outer dimension" we mean a slowest varying dimension
in a row major order flattening of the data (an example later will
clarify this). For example, the array <strong>A</strong>[<em>day</em>][<em>sample</em>] would
have the <em>day</em> dimension as the outer dimension. The data samples all
must have the same data syntax; specifically the DDS of the variables
must all match. For example, if the <em>aggregation variable</em> has name
<strong>sample</strong> and is a 10x10 Array of float32, then all the member datasets
in the aggregation must include a variable named <strong>sample</strong> which are all
also 10x10 Arrays of float32. If there were 100 datasets specified in
the aggregation, the resulting DDS would contain a variable named
<strong>sample</strong> that was now of data shape 100x10x10.</p>
</div>
<div class="paragraph">
<p>In addition, a new <em>coordinate variable</em> specifying data values for the
new dimension will be created at the same scope as (a sibling of) the
specified aggregation variable. For example, if the new dimension is
called "filename" and the new dimension&#8217;s values are unspecified (the
default), then an Array of type String will be created with one element
for each member dataset --- the filename of the dataset. Additionally,
if the aggregation variable was represented as a DAP Grid, this new
dimension coordinate variable will <em>also</em> be added as a new Map vector
inside the Grid to maintain the Grid specification.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to specify the member datasets of a joinNew
aggregation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Explicit</strong>: Specifying a separate &lt;netcdf&gt; element for each dataset</p>
</li>
<li>
<p><strong>Scan</strong>: scan a directory tree for files matching a conjunction of
certain criteria:</p>
<div class="ulist">
<ul>
<li>
<p>Specific suffix</p>
</li>
<li>
<p>Older than a specific duration</p>
</li>
<li>
<p>Matching a specific regular expression</p>
</li>
<li>
<p>Either in a specific directory or recursively searching
subdirectories</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, there are multiple ways to specify the new coordinate
variable&#8217;s (the new outer dimension&#8217;s associated data variable) data
values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Default</strong>: An Array of type String containing the filenames of the
member datasets</p>
</li>
<li>
<p><strong>Explicit Value Array</strong>: Explicit list of values of a specific data
type, exactly one per dataset</p>
</li>
<li>
<p><strong>Dynamic Array</strong>: a numeric Array variable specified using start and
increment values&#8201;&#8212;&#8201;one value is generated automatically per dataset</p>
</li>
<li>
<p><strong>Timestamp from Filename</strong>: An Array of String with values of ISO
8601 Timestamps extracted from scanned dataset filenames using a
specified Java SimpleDataFormat string. (Only works with &lt;scan&gt;
element!)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_a_simple_self_contained_example">A Simple Self-Contained Example</h5>
<div class="paragraph">
<p>First, we start with a simple purely virtual (no external datasets)
example to give you a basic idea of this aggregation. This
example will join two one-dimensional Arrays of int&#8217;s of length 5. The
variable they describe will be called <strong>V</strong>. In this example, we assume
we are joining samples of some variable <strong>V</strong> where each dataset is
samples from 5 stations on a single day. We want to join the datasets so
the new outer dimension is the day, resulting in a 2x5 array of int
values for <strong>V</strong>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s our NcML, with comments to describe what we are doing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!-- A simple pure virtual joinNew aggregation of type Array&lt;int&gt;[5][2]  --&gt;

&lt;netcdf title="Sample joinNew Aggregation on Pure NCML Datasets"&gt;

  &lt;!-- joinNew forming new outer dimension "day" --&gt;
  &lt;aggregation type="joinNew" dimName="day"&gt;

    &lt;!-- For variables with this name in child datasets --&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;!-- Datasets are one-dimensional Array&lt;int&gt; with cardinality 5. --&gt;
    &lt;netcdf title="Sample Slice 1"&gt;
      &lt;!-- Must forward declare the dimension size --&gt;
      &lt;dimension name="station" length="5"/&gt;
      &lt;variable name="V" type="int" shape="station"&gt;
    &lt;values&gt;1 3 5 7 9&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;!-- Second slice must match shape! --&gt;
    &lt;netcdf title="Sample Slice 2"&gt;
      &lt;dimension name="station" length="5"/&gt;
      &lt;variable name="V" type="int" shape="station"&gt;
    &lt;values&gt;2 4 6 8 10&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

&lt;!-- This is what the expected output aggregation will look like.
       We can use the named dimensions for the shape here since the aggregation
       comes first and the dimensions will be added to the parent dataset by now --&gt;
  &lt;variable name="V_expected" type="int" shape="day station"&gt;
    &lt;!-- Row major values.  Since we create a new outer dimension, the slices are concatenated
        since the outer dimension varies the slowest in row major order.  This gives a 2x5 Array.
     We use the newline to show the dimension separation for the reader's benefit --&gt;
    &lt;values&gt;
      1 3 5 7 9
      2 4 6 8 10
    &lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we specify the name of the aggregation variable <strong>V</strong> inside the
aggregation using a &lt;variableAgg&gt; element --- this allows to to specify
multiple variables in the datasets to join. The new dimension, however,
is specified by the attribute <em>dimName</em> of &lt;aggregation&gt;. We do NOT need
to specify a &lt;dimension&gt; element for the new dimension (in fact, it
would be an error to do so). Its size is calculated based on the number
of datasets in the aggregation.</p>
</div>
<div class="paragraph">
<p>Running this file through the module produces the following DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Int32 V[day = 2][station = 5];
    Int32 V_expected[day = 2][station = 5];
    String day[day = 2];
} joinNew_virtual.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the new dimension caused a <em>coordinate variable</em> to be
created with the same name and shape as the new dimension. This array
will contain the default values for the new outer dimension&#8217;s map as we
shall see if we ask for the ASCII version of the DODS (data) response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">The data:
Int32 V[day = 2][station = 5] = {{1, 3, 5, 7, 9},{2, 4, 6, 8, 10}};
Int32 V_expected[day = 2][station = 5] = {{1, 3, 5, 7, 9},{2, 4, 6, 8, 10}};
String day[day = 2] = {"Virtual_Dataset_0", "Virtual_Dataset_1"};</pre>
</div>
</div>
<div class="paragraph">
<p>We see that the resulting aggregation data matches what we expected to
create, specified by our <strong>V_expected</strong> variable. Also, notice that the
values for the coordinate variable are "Virtual_Dataset_i", where i is
the number of the dataset. Since the datasets did not have the
<em>location</em> attribute set (which would have been used if it was), the
module generates unique names for the virtual datasets in the output.</p>
</div>
<div class="paragraph">
<p>We could also have specified the value for the dataset using the
<em>netcdf@coordValue</em> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;netcdf title="Sample joinNew Aggregation on Pure NCML Datasets"&gt;

    &lt;aggregation type="joinNew" dimName="day"&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;netcdf title="Sample Slice 1" coordValue="100"&gt;
      &lt;dimension name="station" length="5"/&gt;
      &lt;variable name="V" type="int" shape="station"&gt;
    &lt;values&gt;1 3 5 7 9&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title="Sample Slice 2" coordValue="107"&gt;
      &lt;dimension name="station" length="5"/&gt;
      &lt;variable name="V" type="int" shape="station"&gt;
    &lt;values&gt;2 4 6 8 10&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This results in the ASCII DODS of&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">The data:
Int32 V[day = 2][station = 5] = {{1, 3, 5, 7, 9},{2, 4, 6, 8, 10}};
Float64 day[day = 2] = {100, 107};</pre>
</div>
</div>
<div class="paragraph">
<p>Since the coordValue&#8217;s could be parsed numerically, the coordinate
variable is of type double (Float64). If they could not be parsed
numerically, then the variable would be of type String.</p>
</div>
<div class="paragraph">
<p>Now that the reader has an idea of the basics of the joinNew
aggregation, we will create examples for the many different use cases
the NcML aggregation author may wish to create.</p>
</div>
</div>
<div class="sect4">
<h5 id="_a_simple_example_using_explicit_dataset_files">A Simple Example Using Explicit Dataset Files</h5>
<div class="paragraph">
<p>Using virtual datasets is not that common. More commonly, the
aggregation author wants to specify files for the aggregation. As an
introductory example of this, we&#8217;ll create a simple aggregation
explicitly listing the files and giving string coordValue&#8217;s. Note that
this is a contrived example: we are using the same dataset file for each
member, but changing the coordValue&#8217;s. Also notice that we have
specified that <em>both</em> the <strong>u</strong> and <strong>v</strong> variables be aggregated using the
same new dimension name <em>source</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Aggregation with explicit string coordValue."&gt;

  &lt;aggregation type="joinNew" dimName="source"&gt;
    &lt;variableAgg name="u"/&gt;
    &lt;variableAgg name="v"/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title="Dataset 1" location="data/ncml/fnoc1.nc" coordValue="Station_1"/&gt;
    &lt;netcdf title="Dataset 2" location="data/ncml/fnoc1.nc" coordValue="Station_2"/&gt;
    &lt;netcdf title="Dataset 3" location="data/ncml/fnoc1.nc" coordValue="Station_3"/&gt;

  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which produces the DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    String source[source = 3];
} joinNew_string_coordVal.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>Since there&#8217;s so much data we only show the new coordinate variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">String source[source = 3] = {"Station_1", "Station_2", "Station_3"};</pre>
</div>
</div>
<div class="paragraph">
<p>Also notice that other coordinate variables (lat, lon, time) already
existed in the datasets along with the <strong>u</strong> and <strong>v</strong> arrays. Any variable
that is not aggregated over (specified as an aggregationVar) is
explicitly <em>union</em> aggregated (please see
<a href="#union_aggregation">NCML_Module_Aggregation_Union</a>
into the resulting dataset --- the first instance of every variable
found in the order the datasets are listed is used.</p>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve seen simple cases, let&#8217;s look at more complex examples.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_of_explicit_dataset_listings">Examples of Explicit Dataset Listings</h5>
<div class="paragraph">
<p>In this section we will give several examples of joinNew aggregation
with a static, explicit list of member datasets. In particular, we will
go over examples of&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default values for the new coordinate variable</p>
</li>
<li>
<p>Explicitly setting values of any type on the new coordinate variable</p>
</li>
<li>
<p>Autogenerating uniform numeric values for the new coordinate variable</p>
</li>
<li>
<p>Explicitly setting String or double values using the
<em>netcdf@coordValue</em> attribute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are several ways to specify values for the new coordinate variable
of the new outer dimension. If String or double values are sufficient,
the author may set the value for each listed dataset using the
<em>netcdf@coordValue</em> attribute for each dataset. If another type is
required for the new coordinate variable, then the author has a choice
of specifying the entire new coordinate variable explicitly (which must
match dimensionality of the aggregated dimension) or using the
start/increment autogeneration &lt;values&gt; element for numeric, evenly
spaced samples.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="#join_new_tutorial">Join Explicit Dataset Tutorial</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_addingmodifying_metadata_on_aggregations">Adding/Modifying Metadata on Aggregations</h5>
<div class="paragraph">
<p>It is possible to add or modify metadata on existing or new variables in
an aggregation. The syntax for these varies somewhat, so we give
examples of the different cases. We will also give examples of providing metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding/modifying metadata to the new coordinate variable</p>
</li>
<li>
<p>Adding/modifying metadata to the aggregation variable itself</p>
</li>
<li>
<p>Adding/modifying metadata to existing maps in an aggregated Grid</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#metdata_tutorial">Metadata on Aggregations Tutorial</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_aggregations_using_directory_scanning">Dynamic Aggregations Using Directory Scanning</h5>
<div class="paragraph">
<p>A powerful way to create dynamic aggregations (rather than by listing
datasets explicitly) is by specifying a data directory where aggregation
member datasets are stored and some criteria for which files are to be
added to the aggregation. These criteria will be combined in a
conjunction (an AND operator) to handle various types of searches. The
way to specify datasets in an aggregation is by using the &lt;scan&gt; element
inside the &lt;aggregation&gt; element.</p>
</div>
<div class="paragraph">
<p>A key benefit of using the &lt;scan&gt; element is that the NcML file need not
change as new datasets are added to the aggregation, say by an automated
process which simply writes new data files into a specific directory. By
properly specifying the NcML aggregation with a scan, the same NcML will
refer to a dynamically changing aggregation, staying up to date with
current data, without the need for modifications to the NcML file
itself. If the filenames have a timestamp encoded in them, the use of
the dateFormatMark allows for automatic creation of the new coordinate
variable data values as well, as shown below.</p>
</div>
<div class="paragraph">
<p>The scan element may be used to search a directory to find files that
match the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Suffix</strong> : the aggregated files end in a specific suffix, indicating
the file type</p>
</li>
<li>
<p><strong>Subdirectories</strong>: any subdirectories of the given location are to be
searched and all regular files tested against the criteria</p>
</li>
<li>
<p><strong>Older Than</strong>: the aggregated files must have been modified longer
than some duration ago (to exclude files that may be currently being
written)</p>
</li>
<li>
<p><strong>Reg Exp</strong>: the aggregated file pathnames must match a specific
regular expression</p>
</li>
<li>
<p><strong>Date Format Mark</strong>: this highly useful criterion, useful in
conjunction with others, allows the specification of a pattern in the
filename which encodes a timestamp. The timestamp is extracted from the
filenames using the pattern and is used to create
<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> date elements for the
new dimension&#8217;s coordinate variable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will give examples of each of these criteria in use in our tutorial.
Again, if more than one is specified, then ALL must match for the file
to be included in the aggregation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join_existing_aggregation">11.E.3. JoinExisting Aggregation</h4>
<div class="sect4">
<h5 id="_introduction_13">Introduction</h5>
<div class="paragraph">
<p>A <em>joinExisting</em> aggregation joins multiple granule datasets by
concatenating the specified outer dimensional data from the granules
into the output. This results in matrices of the same number of
dimensions, but with larger outer dimension cardinality. The outer
dimension sizes of the granules may vary across granule, but any inner
dimensions for multi-dimensional data still are required to match.</p>
</div>
<div class="paragraph">
<p>The reader is also directed to a basic tutorial of this NcML aggregation
which may be found at
<a href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html#joinExisting" class="bare">http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html#joinExisting</a>.
Note that version 1.1.0 of the module does not support all features of
joinExisting.</p>
</div>
</div>
<div class="sect4">
<h5 id="_content_summary">Content Summary</h5>
<div class="paragraph">
<p>This section describes the behavior of the initial implementation of
joinExisting for version 1.2.x of the NcML Module, bundled with Hyrax
1.8. It is a limited feature set described below. Please see the
Limitations section for more information.</p>
</div>
<div class="paragraph">
<p>In version 1.2.x, a joinExisting aggregation may be specified in three
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using explicit lists of <strong>netcdf</strong> elements with the the <em>ncoords</em>
attribute correctly specified for all of them.</p>
</li>
<li>
<p>Leaving off the <em>ncoords</em> attribute for all of the <em>netcdf</em> elements.</p>
</li>
<li>
<p>Using a <strong>scan</strong> element with <em>ncoords</em> specified and all matching
granule datasets having this dimension size</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Our example below will clarify this.</p>
</div>
<div class="paragraph">
<p>Future versions of the module will implement more of the joinExisting
feature set.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_5">Examples</h5>
<div class="paragraph">
<p>Here we give an example that illustrates the functionality offered by
the current version of the aggregation. This example may also be found
on&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><a href="http://test.opendap.org:8090/opendap/ioos/mday_joinExist.ncml" class="bare">http://test.opendap.org:8090/opendap/ioos/mday_joinExist.ncml</a></p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;with the data granules located in</p>
</div>
<div class="paragraph">
<p><a href="http://test.opendap.org:8090/opendap/coverage/mday/" class="bare">http://test.opendap.org:8090/opendap/coverage/mday/</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_granules">Granules</h5>
<div class="paragraph">
<p>Assume we have some number of granule datasets with a DDS the same as
the following (modulo the dataset name):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Float32 PHssta[time = 1][altitude = 1][lat = 4096][lon = 8192];
      Maps:
        Float64 time[time = 1];
        Float64 altitude[altitude = 1];
        Float64 lat[lat = 4096];
        Float64 lon[lon = 8192];
    } PHssta;
} PH2006001_2006031_ssta.nc;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_listing_of_granules">Explicit Listing of Granules</h5>
<div class="paragraph">
<p>We see that here <em>time</em> is the outer dimension, which is the only
dimension we may join along (it is an error to specify an inner). Given
some number of granules with this same shape, consider the following
explicit joinExisting aggregation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
&lt;netcdf title="joinExisting test on netcdf Grid granules"&gt;
 
  &lt;aggregation type="joinExisting" dimName="time" &gt;
    &lt;!-- Note explicit use of ncoords specifying size of "time" --&gt;
    &lt;netcdf location="/coverage/mday/PH2006001_2006031_ssta.nc" ncoords="1"/&gt;
    &lt;netcdf location="/coverage/mday/PH2006032_2006059_ssta.nc" ncoords="1"/&gt;
    &lt;netcdf location="/coverage/mday/PH2006060_2006090_ssta.nc" ncoords="1"/&gt;
  &lt;/aggregation&gt;
 
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the same aggregation using the <em>scan</em> element instead of
explicitly listing each file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
&lt;netcdf title="joinExisting test on netcdf Grid granules using scan"&gt;
 
  &lt;aggregation type="joinExisting" dimName="time" &gt;
    &lt;scan location="/coverage/mday/" suffix=".nc"/&gt;
  &lt;/aggregation&gt;
 
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>First, note that the <em>ncoords</em> attribute should be specified on the
individual granules for this version of the module. In many cases the
handler will be more efficient if the <em>ncoords</em> attribute is used. Note
that we also specify the <em>dimName</em>. Any data array whose outer
dimension is called this will be subject to aggregation in the output.</p>
</div>
<div class="paragraph">
<p>Serving this from Hyrax will result in the following DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Float32 PHssta[time = 3][altitude = 1][lat = 4096][lon = 8192];
      Maps:
        Float64 time[time = 3];
        Float64 altitude[altitude = 1];
        Float64 lat[lat = 4096];
        Float64 lon[lon = 8192];
    } PHssta;
    Float64 time[time = 3];
} mday_joinExist.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>We see that the time dimension is now of size 3 to match that we joined
three granule datasets together.</p>
</div>
<div class="paragraph">
<p>Also notice that the map vector for the joined dimension, time, has been
duplicated as a sibling of the dataset. This is done automatically by
the aggregation and it is copied into the actual map of the Grid. This
copy is to facilitate datasets which have multiple Grid&#8217;s that are to be
joined --- the top-level map vector is used as the canonical template
map which is then copied into the maps for all the aggregated Grids. In
the case of the joined data being of type Array, this vector would
already exist as the coordinate variable for the data matrix. Since this
is the source map for all aggregated Grid&#8217;s, any attribute (metadata)
changes should be made explicitly on this top-level coordinate variable
so that the metadata is shared among all the aggregated Grid map
vectors.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_scan_element">Using the Scan Element</h5>
<div class="paragraph">
<p>The collection of member datasets in a joinExisiting aggregation can be
specified using the NcML <em>scan</em> element as described in the
<a href="#dynamic_aggregation_tutorial">dynamic aggregation tutorial</a>.</p>
</div>
<div class="sect5">
<h6 id="_ncml_dimension_cache">NcML Dimension Cache</h6>
<div class="paragraph">
<p>If the scan element is used without the <em>ncoords</em> extension (see below),
then the first time a joinExisiting aggregation is accessed (say by
requesting it&#8217;s DDS) the <strong>BES process will open every file</strong> in the
aggregation and cache its dimension information in the NcML dimension
cache. By default the cache files are written into <code>/tmp</code> and the total
size of the cache is limited to a maximum size of 2GB. These settings
can be changed by modifying the <code>ncml.conf file</code>, typically located in
<code>/etc/bes/modules/ncml.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#-----------------------------------------------------------------------#
# NcML Aggregation Dimension Cache Parameters                           #
#-----------------------------------------------------------------------#
 
# Directory into which the cache files will be stored.
NCML.DimensionCache.directory=/tmp
 
# Filename prefix to be used for the cache files
NCML.DimensionCache.prefix=ncml_dimension_cache
 
# This is the size of the cache in megabytes; e.g., 2,000 is a 2GB cache
NCML.DimensionCache.size=2000
 
# Maximum number of dimension allowed in any particular dataset.
# If not set in this configuration the value defaults to 100.
# NCML.DimensionCache.maxDimensions=100</pre>
</div>
</div>
<div class="paragraph">
<p>The cache files are small compared to the source dataset files,
typically less than 1kb for a dataset with a few named dimensions.
However, the cache files are numerous, one for each file used in a
joinExisiting aggregation. If you have large joinExisiting aggregations,
it is important to be sure that the <strong>NCML.DimensionCache.directory</strong> has
space to contain the cache and that the <strong>NCML.DimensionCache.size</strong> to an
appropriately large value.</p>
</div>
<div class="paragraph">
<p>Because the first access of the aggregation triggers the population of
the NcML dimension cache for that aggregation the time for this first
access can be significant. It may be that typical HTTP clients will
timeout before that requests completes. If a client timeout occurs
dimension cache may not get fully populated, however subsequent requests
will cause the cache population to pick up where it was left off.</p>
</div>
<div class="paragraph">
<p>With only a modicum of effort one could write a shell program that
utilizes the BES standalone functionality to pre-populate the dimension
caches for large joinExisiting aggregations.</p>
</div>
</div>
<div class="sect5">
<h6 id="_ncoords_extension">ncoords Extension</h6>
<div class="paragraph">
<p>If all of the granules are of uniform dimensional size, we may also use
the syntactic sugar provided by a Hyrax-specific extension to NcML&#8201;&#8212;&#8201;adding the <em>ncoords</em> attribute to a <strong>scan</strong> element. The behavior of this
extension is to set the <em>ncoords</em> for each granule matching the scan to
be this value, as if the datasets were each listed explicitly with this
value of the attribute. Here&#8217;s an example of using the syntactic sugar
that results in the same exact aggregation as the previous explicit one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- joinExisting test on netcdf granules using scan@ncoords extension--&gt;
&lt;netcdf title="joinExisting test on netcdf Grid granules using scan@ncoords"
    &gt;

  &lt;attribute name="Description" type="string"
         value=" joinExisting test on netcdf Grid granules using scan@ncoords"/&gt;

  &lt;aggregation type="joinExisting"
           dimName="time" &gt;

    &lt;!-- Filenames have lexicographic and chronological ordering match --&gt;
    &lt;scan location="/coverage/mday"
      subdirs="false"
      suffix=".nc"
      ncoords="1"
      /&gt;

  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which we see results in the same DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Float32 PHssta[time = 3][altitude = 1][lat = 4096][lon = 8192];
      Maps:
        Float64 time[time = 3];
        Float64 altitude[altitude = 1];
        Float64 lat[lat = 4096];
        Float64 lon[lon = 8192];
    } PHssta;
    Float64 time[time = 3];
} mday_joinExist.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of this is that the server does not have to inspect all of
the member granules to determine their dimensional size, which allows
server to manufacture responses much more quickly.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_limitations_2">Limitations</h5>
<div class="paragraph">
<p>The current version implements only basic functionality. If there is
extended functionality that is needed for your use, please send
&lt;<a href="mailto:support@opendap.org">mailto:support@opendap.org</a>&gt; to let us know!</p>
</div>
<div class="sect5">
<h6 id="_join_dimension_sizes_should_be_explicitly_declared">Join Dimension Sizes Should Be Explicitly Declared</h6>
<div class="paragraph">
<p>As we have seen, the most important limitation to the JoinExisting
aggregation support is that the <em>ncoords</em> attribute should be specified
for efficiency reasons. Future versions will continue to relax this
requirement. The problem is that the size of the output join dimension
is dependent on checking the DDS of <em>every</em> granule in the aggregation,
which is computationally expensive for large aggregations.</p>
</div>
</div>
<div class="sect5">
<h6 id="_source_of_data_for_aggregated_coordinate_variable_on_join_dimension">Source of Data for Aggregated Coordinate Variable on Join Dimension</h6>
<div class="paragraph">
<p>This version does not allow the join dimension&#8217;s data to be declared
explicitly in the NcML as the NcML tutorial page describes. This version
automatically aggregates <strong>all</strong> variables with the outer dimension
matching the <em>dimName</em>. This includes the coordinate variable (map
vector in the case of Grid&#8217;s) for the join dimension. These data cannot
be overridden from those pulled from the files. Currently the TDS lists
about 5 ways this data can be specified in addition to pulling them from
the granules --- we only can pull them from granules now, which seems
the most common use.</p>
</div>
</div>
<div class="sect5">
<h6 id="_source_of_join_dimension_metadata">Source of Join Dimension Metadata</h6>
<div class="paragraph">
<p>The metadata for the coordinate variable is pulled from the <em>first</em>
granule dataset. Modification of coordinate variable metadata is not
fully supported yet.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="union_aggregation">11.E.4. Union Aggregation</h4>
<div class="sect4">
<h5 id="_introduction_14">Introduction</h5>
<div class="paragraph">
<p>The current trunk version of the module supports the union aggregation
element of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf&gt;
  &lt;aggregation type="union"&gt;
      &lt;!-- some &lt;netcdf&gt; nodes --&gt;
  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_functionality_2">Functionality</h5>
<div class="paragraph">
<p>The union aggregation specifies the attributes and variables (and
perhaps dimensions) for the dataset it is contained within (i.e. it&#8217;s
parent &lt;netcdf&gt; node, which must be be virtual, in other words, have no location
specifed). To do this it&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Processes each child netcdf element recursively, creating the final
transformed dataset</p>
</li>
<li>
<p>Scans the processed child datasets in order of specification and:</p>
<div class="ulist">
<ul>
<li>
<p>Adds to the parent dataset any attribute, variable, or dimension that
doesn&#8217;t already exist in the parent dataset</p>
</li>
<li>
<p>Skips any attribute or variable that already exists in the parent
dataset</p>
</li>
<li>
<p>Skips any dimension already in the parent dataset, unless the lengths
do not match, in which case it throws a parse error.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the module processes each child dataset entirely as if it were
a top level element, obeying all the normal processing for a dataset,
but collecting the result into that netcdf node. This means that any
child netcdf of an aggregation may refer to a location, have
transformations applied to it, have metadata removed, or may even
contain its own nested aggregation!</p>
</div>
<div class="paragraph">
<p>Which items will show up in the output? We need to discuss this in a
little more detail, in particular since we have deviated slightly from
the Unidata implementation.</p>
</div>
<div class="sect5">
<h6 id="_order_of_element_processing">Order of Element Processing</h6>
<div class="paragraph">
<p>The NCML Module processes the nodes in a &lt;netcdf&gt; element in the order
encountered. This means that the parent dataset of an aggregation may
place attributes and variables into the union prior to an aggregation
taking place, meaning that those items matching the name in the
aggregation itself will be skipped. It also implies that any changes to
existing metadata within a member of the aggregation by using an
attribute element, for example, must come AFTER the actual aggregation
element, or else a parse error will be thrown.</p>
</div>
</div>
<div class="sect5">
<h6 id="_shadowing_an_aggregation_member">Shadowing an Aggregation Member</h6>
<div class="paragraph">
<p>For example, the following examples show how to "shadow" a variable
contained in an aggregation by specifying it in the parent dataset prior
to the aggregation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf&gt;

  &lt;variable name="Foo" type="string"&gt;
    &lt;values&gt;I come before the aggregation, so will appear in the output!&lt;/values&gt;
  &lt;/variable&gt;

  &lt;aggregation type="union"&gt;

    &lt;netcdf&gt;
      &lt;variable name="Foo" type="string"&gt;
    &lt;values&gt;I will be skipped since there's a Foo in the dataset prior to the aggregation.&lt;/values&gt;
      &lt;/variable&gt;
   &lt;/netcdf&gt;

    &lt;netcdf&gt;
      &lt;variable name="Bar" type="string"&gt;
    &lt;values&gt;I do not exist prior, so will be in the output!&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The values make it clear what the output will be. The variable "Foo" in
the first child will be skipped since the parent dataset already
specified it, but the variable "Bar" in the second child dataset will
show up in the output since it doesn&#8217;t already exist in either the
parent or the previous child. Note that this would also work on an
attribute or dimension.</p>
</div>
</div>
<div class="sect5">
<h6 id="_modifying_the_winner_of_the_union_aggregation">Modifying the "Winner" of the Union Aggregation</h6>
<div class="paragraph">
<p>The following example shows how to modify the "winning" variable in a
union aggregation by specifying the attribute change AFTER the
aggregation element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf&gt;
  &lt;aggregation type="union"&gt;

    &lt;netcdf&gt;
      &lt;variable name="Foo" type="string"&gt;
    &lt;attribute name="Description" type="string" value="Winning Foo before we modify, should NOT be in output!"/&gt;
    &lt;values&gt;I am the winning Foo!&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf&gt;
      &lt;variable name="Foo" type="string"&gt;
    &lt;attribute name="Description" type="string" value="I will be the losing Foo and should NOT be in output!"/&gt;
    &lt;values&gt;I am the losing Foo!&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- Now we modify the "winner" of the previous union --&gt;
  &lt;variable name="Foo"&gt;
    &lt;attribute name="Description" type="string" value="I am Foo.Description and have modified the winning Foo and deserve to be in the output!"/&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the output dataset will have the variable Foo with a value
of "I am the winning Foo!", but its metadata will have been modified by
the transformation after the aggregation, so its attribute "Description"
will have the value "I am Foo.Description and have modified the winning
Foo and deserve to be in the output!".</p>
</div>
<div class="paragraph">
<p>If this entire netcdf element were contained within another aggregation,
then other transformations might be applied after the fact as well,
again in the order encountered for clarity.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dimensions">Dimensions</h5>
<div class="paragraph">
<p>Since the DAP2 does not specify dimensions as explicit data items, a
union of dimensions is only done <em>if the child netcdf elements
explicitly declare dimensions</em>. In practice, this is mostly of little
utility since the only time dimensions are specified is to create
virtual array variables (Note: we do not load dimensions from wrapped
sets, so effectively they <strong>do not exist</strong> in them, even if the wrapped
dataset was an NcML file!)</p>
</div>
<div class="paragraph">
<p>If a dimension does exist explicitly in a child dataset and a second
with the same name is encountered in another child dataset, the
cardinalities are checked and a parse error is thrown if they do not
exist. This is a simple check that can be done to ensure the resulting
arrays are of the correct size. Note that even if an array had a named
dimension within a wrapped set, we <strong>do not check</strong> that these match at
this time.</p>
</div>
<div class="paragraph">
<p>Here is an example of a valid use of dimension in the current module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2"&gt;

  &lt;!-- Test that a correct union with dimensions in the virtual datasets will work if the dimensions match as they need to --&gt;
  &lt;attribute name="title" type="string" value="Testing union with dimensions"/&gt;

  &lt;aggregation type="union"&gt;

    &lt;netcdf&gt;
      &lt;attribute name="Description" type="string" value="The first dataset"/&gt;
      &lt;dimension name="lat" length="5"/&gt;

      &lt;!-- A variable that uses the dimension, this one will be used --&gt;
      &lt;variable name="Grues" type="int" shape="lat"&gt;
    &lt;attribute name="Description" type="string"&gt;I should be in the output!&lt;/attribute&gt;
    &lt;values&gt;1 3 5 3 1&lt;/values&gt;
      &lt;/variable&gt;

    &lt;/netcdf&gt;

    &lt;netcdf&gt;
      &lt;attribute name="Description" type="string" value="The second dataset"/&gt;

      &lt;!-- This dimension will be skipped, but the length matches the previous as required --&gt;
      &lt;dimension name="lat" length="5"/&gt;

      &lt;!-- This dimension is new so will be used... --&gt;
      &lt;dimension name="station" length="3"/&gt;

      &lt;!-- A variable that uses it, this one will NOT be used --&gt;
      &lt;variable name="Grues" type="int" shape="lat"&gt;
    &lt;attribute name="Description" type="string"&gt;!!!! I should NOT be in the output! !!!!&lt;/attribute&gt;
    &lt;values&gt;-3 -5 -7 -3 -1&lt;/values&gt;
      &lt;/variable&gt;

      &lt;!-- This variable uses both and will show up in output correctly --&gt;
      &lt;variable name="Zorks" type="int" shape="station lat"&gt;
    &lt;attribute name="Description" type="string"&gt;I should be in the output!&lt;/attribute&gt;
    &lt;values&gt;
      1  2   3   4   5
      2  4   6   8  10
      4  8  12 16 20
    &lt;/values&gt;
      &lt;/variable&gt;

   &lt;/netcdf&gt;

  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example that will produce a dimension mismatch parse error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2"&gt;

  &lt;!-- Test that a union with dimensions in the virtual datasets will ERROR if the child set dimensions DO NOT match as they need to --&gt;
  &lt;attribute name="title" type="string" value="Testing union with dimensions"/&gt;

  &lt;aggregation type="union"&gt;

    &lt;netcdf&gt;
      &lt;dimension name="lat" length="5"/&gt;
      &lt;!-- A variable that uses the dimension, this one will be used --&gt;
      &lt;variable name="Grues" type="int" shape="lat"&gt;
    &lt;attribute name="Description" type="string"&gt;I should be in the output!&lt;/attribute&gt;
    &lt;values&gt;1 3 5 3 1&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf&gt;
      &lt;!-- This dimension WOULD be skipped, but does not match the representative and will cause an error on union! --&gt;
      &lt;dimension name="lat" length="6"/&gt;
     &lt;!-- This dimension is new so will be used... --&gt;
      &lt;dimension name="station" length="3"/&gt;
      &lt;!-- A variable that uses it, this one will NOT be used --&gt;
      &lt;variable name="Grues" type="int" shape="lat"&gt;
    &lt;attribute name="Description" type="string"&gt;!!!! I should NOT be in the output! !!!!&lt;/attribute&gt;
    &lt;values&gt;-3 -5 -7 -3 -3 -1&lt;/values&gt;
      &lt;/variable&gt;

      &lt;!-- This variable uses both and will show up in output correctly --&gt;
      &lt;variable name="Zorks" type="int" shape="station lat"&gt;
    &lt;attribute name="Description" type="string"&gt;I should be in the output!&lt;/attribute&gt;
    &lt;values&gt;
      1  2   3   4   5  6
      2  4   6   8  10  12
      4  8  12 16 20  24
    &lt;/values&gt;
      &lt;/variable&gt;

   &lt;/netcdf&gt;

  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the failure is that the second dataset had an extra "lat"
sample added to it, but the prior dataset did not. Again, these
dimension checks only occur now in a <strong>pure virtual dataset</strong> like we see
here. Using netcdf@location will effectively "hide" all the dimensions
within it at this point.</p>
</div>
<div class="sect5">
<h6 id="_thoughts_about_future_directions_for_dimension">Thoughts About Future Directions for Dimension</h6>
<div class="paragraph">
<p>For a future implementation, we may want to consider a DAP2 Grid Map
vector as a dimension and do cardinality checks on them if we have
multiple grids in a union each of which specify the same names for their
map vectors. One argument is that this should be done if an explicit
dimension element with the map vector name is specified in the parent
dataset and is explicitly specified as "isShared". Although DAP2 does not
have shared dimensions, this would be a basic first step in the error
checking that will have to be done for shared dimensions.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notes_about_changes_from_ncml_2_2_implementation">Notes About Changes from NcML 2.2 Implementation</h5>
<div class="paragraph">
<p>In the Aggregation tutorial, it is mentioned that in a given &lt;netcdf&gt;
node, the &lt;aggregation&gt; element is process prior to any other nodes,
which reflects an explicitly DOM implementation of the NcML parser.
Since we are using a SAX parser for efficiency, we cannot follow this
prescription. Instead, we process the elements in the order encountered.
We argue that this approach, while more efficient, also allows for more
explicit control over which attributes and variables show up in the
dataset which is the parent node of the aggregation. The examples above
show this extra power gained by allowing elements to be added to the
resultant dataset prior to or after the aggregation has been processed.
In particular, it will let us shadow potential members of the
aggregation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join_new_tutorial">11.E.5. JoinNew Explicit Dataset Tutorial</h4>
<div class="sect4">
<h5 id="_default_values_for_the_new_coordinate_variable_on_a_grid">Default Values for the New Coordinate Variable (on a Grid)</h5>
<div class="paragraph">
<p>The default for the new coordinate variable is to be of type String with
the location of the dataset as the value. For example, the following
NcML file&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Simple test of joinNew Grid aggregation"&gt;

  &lt;aggregation type="joinNew" dimName="filename"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;
  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;specifies an aggregation on a Grid variable <strong>dsp_band_1</strong> sampled in four
HDF4 datasets listed explicitly.</p>
</div>
<div class="paragraph">
<p>First, the data structure (DDS) is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[filename = 4][lat = 1024][lon = 1024];
      Maps:
        String filename[filename = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    String filename[filename = 4];
} joinNew_grid.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>We see the aggregated variable <strong>dsp_band_1</strong> has the new outer dimension
<em>filename</em>. A coordinate variable <em>filename[filename]' was created as
a sibling of the aggregated variable (the top level Grid we specified)
and was also copied into the aggregated Grid as a new map vector.</em></p>
</div>
<div class="paragraph">
<p>The ASCII data response for just the new coordinate variable
<em>filename[filename]</em> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">String filename[filename = 4] = {"data/ncml/agg/grids/f97182070958.hdf",
"data/ncml/agg/grids/f97182183448.hdf",
"data/ncml/agg/grids/f97183065853.hdf",
"data/ncml/agg/grids/f97183182355.hdf"};</pre>
</div>
</div>
<div class="paragraph">
<p>We see that the absolute location we specified for the dataset as a
String is the value for each element of the new coordinate variable.</p>
</div>
<div class="paragraph">
<p>The newly added map <strong>dsp_band_1.filename</strong> contains a copy of this data.</p>
</div>
<div class="sect5">
<h6 id="_explicitly_specifying_the_new_coordinate_variable">Explicitly Specifying the New Coordinate Variable</h6>
<div class="paragraph">
<p>If the author wishes to have the new coordinate variable be of a
specific data type with non-uniform values, then they must specify the
new coordinate variable explicitly.</p>
</div>
<div class="sect6">
<h7 id="_array_virtual_dataset">Array Virtual Dataset</h7>
<div class="paragraph">
<p>Here&#8217;s an example using a contrived pure virtual dataset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="JoinNew on Array with Explicit Map"&gt;

  &lt;!-- joinNew and form new outer dimension "day" --&gt;
  &lt;aggregation type="joinNew" dimName="day"&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;netcdf title="Slice 1"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
    &lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title="Slice 2"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
    &lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- This is recognized as the definition of the new coordinate variable,
       since it has the form day[day] where day is the dimName for the aggregation.
       It MUST be specified after the aggregation, so that the dimension size of day
      has been calculated.
  --&gt;
  &lt;variable name="day" type="int" shape="day"&gt;
    &lt;!-- Note: metadata may be added here as normal! --&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;1 30&lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Int32 V[day = 2][sensors = 3];
    Int32 day[day = 2];
} joinNew_with_explicit_map.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and the ASCII data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Int32 V[day = 2][sensors = 3] = {{1, 2, 3},{4, 5, 6}};
Int32 day[day = 2] = {1, 30};</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the values we have explicitly given are used here as well as
the specified NcML type, <em>int</em> which is mapped to a DAP Int32.</p>
</div>
<div class="paragraph">
<p>If metadata is desired on the new coordinate variable, it may be added
just as in a normal new variable declaration. We&#8217;ll give more examples
of this later.</p>
</div>
</div>
<div class="sect6">
<h7 id="_grid_with_explicit_map">Grid with Explicit Map</h7>
<div class="paragraph">
<p>Let&#8217;s give one more example using a Grid to demonstrate the recognition
of the coordinate variable as it is added to the Grid as the map vector
for the new dimension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation with explicit map"&gt;

  &lt;aggregation type="joinNew" dimName="sample_time"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;
  &lt;/aggregation&gt;

  &lt;!-- Note: values are contrived --&gt;
  &lt;variable name="sample_time" shape="sample_time" type="float"&gt;
    &lt;!-- Metadata here will also show up in the Grid map --&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;100 200 400 1000&lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This produces the DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[sample_time = 4][lat = 1024][lon = 1024];
      Maps:
        Float32 sample_time[sample_time = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    Float32 sample_time[sample_time = 4];
} joinNew_grid_explicit_map.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>You can see the explicit coordinate variable <strong>sample_time</strong> was found as
the sibling of the aggregated Grid as was added as the new map vector
for the Grid.</p>
</div>
<div class="paragraph">
<p>The values for the projected coordinate variables are as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Float32 sample_time[sample_time = 4] = {100, 200, 400, 1000};</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_errors_3">Errors</h6>
<div class="paragraph">
<p>It is a Parse Error to&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Give a different number of values for the explicit coordinate variable
than their are specified datasets.</p>
</li>
<li>
<p>Specify the new coordinate variable prior to the &lt;aggregation&gt; element
since the dimension size is not yet known.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_autogenerated_uniform_numeric_values">Autogenerated Uniform Numeric Values</h5>
<div class="paragraph">
<p>If the number of datasets might vary (for example, if a &lt;scan&gt; element,
described later, is used), but the values are uniform, the
start/increment version of the &lt;values&gt; element may be used to generate
the values for the new coordinate variable. For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="JoinNew on Array with Explicit Autogenerated Map"&gt;

  &lt;aggregation type="joinNew" dimName="day"&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;netcdf title="Slice 1"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
    &lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title="Slice 2"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
    &lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- Explicit coordinate variable definition --&gt;
  &lt;variable name="day" type="int" shape="day"&gt;
    &lt;attribute name="units" type="string" value="days since 2000-01-01 00:00"/&gt;
    &lt;!-- We sample once a week... --&gt;
    &lt;values start="1" increment="7"/&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The DDS is the same as before and the coordinate variable is generated
as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Int32 sample_time[sample_time = 4] = {1, 8, 15, 22};</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this form is useful for uniform sampled datasets (or if only a
numeric index is desired) where the variable need not be changed as
datasets are added. It is especially useful for a &lt;scan&gt; element that
refers to a dynamic number of files that can be described with a
uniformly varying index.</p>
</div>
</div>
<div class="sect4">
<h5 id="_explicitly_using_coordvalue_attribute_of_netcdf">Explicitly Using coordValue Attribute of &lt;netcdf&gt;</h5>
<div class="paragraph">
<p>The <em>netcdf@coordValue</em> may be used to specify the value for the given
dataset right where the dataset is declared. This attribute will cause a
coordinate variable to be automatically generated with the given values
for each dataset filled in. The new coordinate variable will be of type
<strong>double</strong> if the coordValue&#8217;s can all be parsed as a number, otherwise
they will be of type <strong>String</strong>.</p>
</div>
<div class="sect5">
<h6 id="_string_coordvalue_example">String coordValue Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Aggregation with explicit string coordValue"&gt;

  &lt;aggregation type="joinNew" dimName="source"&gt;
    &lt;variableAgg name="u"/&gt;
    &lt;variableAgg name="v"/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title="Dataset 1" location="data/ncml/fnoc1.nc" coordValue="Station_1"/&gt;
    &lt;netcdf title="Dataset 2" location="data/ncml/fnoc1.nc" coordValue="Station_2"/&gt;
    &lt;netcdf title="Dataset 3" location="data/ncml/fnoc1.nc" coordValue="Station_3"/&gt;
  &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    String source[source = 3];
} joinNew_string_coordVal.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and ASCII data response of the projected coordinate variable is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">String source[source = 3] = {"Station_1", "Station_2", "Station_3"};</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;as we specified.</p>
</div>
</div>
<div class="sect5">
<h6 id="_numeric_double_use_of_coordvalue">Numeric (double) Use of coordValue</h6>
<div class="paragraph">
<p>If the first <em>coordValue</em> can be successfully parsed as a double numeric
type, then a coordinate variable of type double (Float64) is created and
all remaining <em>coordValue</em> specifications <strong>must</strong> be parsable as a double
or a Parse Error is thrown.</p>
</div>
<div class="paragraph">
<p>Using the same example but with numbers instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Aggregation with numeric coordValue"&gt;

  &lt;aggregation type="joinNew" dimName="source"&gt;
    &lt;variableAgg name="u"/&gt;
    &lt;variableAgg name="v"/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title="Dataset 1" location="data/ncml/fnoc1.nc" coordValue="1.2"/&gt;
    &lt;netcdf title="Dataset 2" location="data/ncml/fnoc1.nc" coordValue="3.4"/&gt;
    &lt;netcdf title="Dataset 3" location="data/ncml/fnoc1.nc" coordValue="5.6"/&gt;

  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This time we see that a Float64 array is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    Float64 source[source = 3];
} joinNew_numeric_coordValue.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>The values we specified are in the coordinate variable ASCII data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Float64 source[source = 3] = {1.2, 3.4, 5.6};</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="metdata_tutorial">11.E.6. Metadata on Aggregations Tutorial</h4>
<div class="sect4">
<h5 id="_metadata_specification_on_the_new_coordinate_variable">Metadata Specification on the New Coordinate Variable</h5>
<div class="paragraph">
<p>We can add metadata to the new coordinate variable in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding it to the &lt;variable&gt; element directly in the case where the new
coordinate variable and values is defined explicitly</p>
</li>
<li>
<p>Adding the metadata to an <em>automatically created</em> coordinate variable
by leaving the &lt;values&gt; element out</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first case we have already seen, but we will show it again
explicitly. The second case is a little different and we&#8217;ll cover it
separately.</p>
</div>
<div class="sect5">
<h6 id="_adding_metadata_to_the_explicit_new_coordinate_variable">Adding Metadata to the Explicit New Coordinate Variable</h6>
<div class="paragraph">
<p>We have already seen examples of explicitly defining the new coordinate
variable and giving its values. In these cases, the metadata is added to
the new coordinate variable exactly like any other variable. Let&#8217;s see
the example again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation with explicit map"&gt;

  &lt;aggregation type="joinNew" dimName="sample_time"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;
  &lt;/aggregation&gt;

  &lt;variable name="sample_time" shape="sample_time" type="float"&gt;
    &lt;!-- Metadata here will also show up in the Grid map --&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;100 200 400 1000&lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>We see that the <strong>units</strong> attribute for the new coordinate variable has
been specified. This subset of the DAS (we don&#8217;t show the extensive
global metadata) shows this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        sample_time {
 ---&gt;           String units "Days since 01/01/2010";
        }
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
    sample_time {
---&gt;        String units "Days since 01/01/2010";
    }</pre>
</div>
</div>
<div class="paragraph">
<p>We show the new metadata with the "--&#8594;" marker. Note that the metadata
for the coordinate variable is also copied into the new map vector of
the aggregated Grid.</p>
</div>
<div class="paragraph">
<p>Metadata can be specified in this way for <em>any</em> case where the new
coordinate variable is listed explicitly.</p>
</div>
</div>
<div class="sect5">
<h6 id="_adding_metadata_to_an_autogenerated_coordinate_variable">Adding Metadata to An Autogenerated Coordinate Variable</h6>
<div class="paragraph">
<p>If we expect the coordinate variable to be automatically added, we can
also specify its metadata by referring to the variable without setting
its values. This is useful in the case of using <em>netcdf@coordValue</em> and
we will also see it is very useful when using a &lt;scan&gt; element for
dynamic aggregations.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a trivial example using the default case of the filename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Test of adding metadata to the new map vector in a joinNew Grid aggregation"&gt;

  &lt;aggregation type="joinNew" dimName="filename"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
  &lt;/aggregation&gt;

  &lt;!--
       Add metadata to the created new outer dimension variable after
       the aggregation is defined by using a placeholder variable
       whose values will be defined automatically by the aggregation.
  --&gt;
  &lt;variable type="string" name="filename"&gt;
    &lt;attribute name="units" type="string"&gt;Filename of the dataset&lt;/attribute&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note here that we just neglected to add a &lt;values&gt; element since we want
the values to be generated automatically by the aggregation. Note also
that this is <em>almost</em> the same way we&#8217;d modify an existing variable&#8217;s
metadata. The only difference is we need to "declare" the type of the
variable here since technically the variable specified here is a
placeholder for the generated coordinate variable. So after the
aggregation is specified, we are simply modifying the created variable&#8217;s
metadata, in this case the newly generated map vector.</p>
</div>
<div class="paragraph">
<p>Here is the DAS portion with just the aggregated Grid and the new
coordinate variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        filename {
            String units "Filename of the dataset";
        }
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
    filename {
        String units "Filename of the dataset";
    }</pre>
</div>
</div>
<div class="paragraph">
<p>Here also the map vector gets a copy of the coordinate variable&#8217;s
metadata.</p>
</div>
<div class="paragraph">
<p>We can also use this syntax in the case that <em>netcdf@coordValue</em> was
used to autogenerate the coordinate variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation with coordValue and metadata"&gt;

  &lt;aggregation type="joinNew" dimName="sample_time"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" coordValue="1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf" coordValue="10"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf" coordValue="15"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf" coordValue="25"/&gt;
  &lt;/aggregation&gt;

  &lt;!-- Note: values are contrived --&gt;
  &lt;variable name="sample_time" shape="sample_time" type="double"&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here we see the metadata added to the new coordinate variable and
associated map vector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
   dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        sample_time {
 ---&gt;           String units "Days since 01/01/2010";
        }
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
    sample_time {
---&gt;        String units "Days since 01/01/2010";
    }
}</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_parse_errors_2">Parse Errors</h6>
<div class="paragraph">
<p>Since the processing of the aggregation takes a few steps, care must be
taken in specifying the coordinate variable in the cases of
autogenerated variables.</p>
</div>
<div class="paragraph">
<p>In particular, it is a Parse Error&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify the shape of the autogenerated coordinate variable if
&lt;values&gt; are not set</p>
</li>
<li>
<p>To leave out the type or to use a type that does not match the
autogenerated type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second can be somewhat tricky to remember since for existing
variables it can be safely left out and the variable will be "found".
Since aggregations get processed fulled when the &lt;netcdf&gt; element
containing them is closed, the specified coordinate variables in these
cases are <em>placeholders</em> for the automatically generated variables, so
they must match the name and type, but not specify a shape since the
shape (size of the new aggregation dimension) is not known until this
occurs.</p>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_specification_on_the_aggregation_variable_itself">Metadata Specification on the Aggregation Variable Itself</h6>
<div class="paragraph">
<p>It is also possible to add or modify the attributes on the aggregation
variable itself. If it is a Grid, metadata can be modified on the
contained array or maps as well. Note that the aggregated variable
begins with the metadata <em>from the first dataset specified in the
aggregation</em> just like in a union aggregation.</p>
</div>
<div class="paragraph">
<p>We will use a Grid as our primary example since other datatypes are
similar and simpler and this case will cover those as well.</p>
</div>
<div class="sect6">
<h7 id="_an_aggregated_grid_example">An Aggregated Grid example</h7>
<div class="paragraph">
<p>Let&#8217;s start from this example aggregation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf&gt;
  &lt;aggregation type="joinNew" dimName="filename"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;
  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the DAS for this unmodifed aggregated Grid (with the global
dataset metadata removed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
   dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        filename {
        }
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
    filename {
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We will now add attributes to all the existing parts of the Grid:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Grid Structure itself</p>
</li>
<li>
<p>The Array of data within the Grid</p>
</li>
<li>
<p>Both existing map vectors (<strong>lat</strong> and <strong>lon</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have already seen how to add data to the new coordinate variable as
well.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the NcML we will use. Note we have added units data to the
subparts of the Grid, and also added some metadata to the grid itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Showing how to add metadata to all parts of an aggregated grid"&gt;

  &lt;aggregation type="joinNew" dimName="filename"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;
  &lt;/aggregation&gt;

  &lt;variable name="dsp_band_1" type="Structure"&gt; &lt;!-- Enter the Grid level scope --&gt;

1)  &lt;attribute name="Info" type="String"&gt;This is metadata on the Grid itself.&lt;/attribute&gt;

    &lt;variable name="dsp_band_1"&gt; &lt;!-- Enter the scope of the Array dsp_band_1 --&gt;
2)    &lt;attribute name="units" type="String"&gt;Temp (packed)&lt;/attribute&gt; &lt;!-- Units of the array --&gt;
    &lt;/variable&gt; &lt;!-- dsp_band_1.dsp_band_1 --&gt;

    &lt;variable name="lat"&gt; &lt;!-- dsp_band_1.lat map --&gt;
3)    &lt;attribute name="units" type="String"&gt;degrees_north&lt;/attribute&gt;
    &lt;/variable&gt;

    &lt;variable name="lon"&gt; &lt;!-- dsp_band_1.lon map --&gt;
4)    &lt;attribute name="units" type="String"&gt;degrees_east&lt;/attribute&gt;
    &lt;/variable&gt; &lt;!-- dsp_band_1.lon map --&gt;
  &lt;/variable&gt; &lt;!-- dsp_band_1 Grid --&gt;

  &lt;!-- Note well: this is a new coordinate variable so requires the correct type.
  Also note that it falls outside of the actual grid since we must specify it
  as a sibling coordinate variable it will be made into a Grid when the netcdf is closed.
  --&gt;
  &lt;variable name="filename" type="String"&gt;
5)  &lt;attribute name="Info" type="String"&gt;Filename with timestamp&lt;/attribute&gt;
  &lt;/variable&gt; &lt;!-- filename --&gt;

&lt;/netcdf</pre>
</div>
</div>
<div class="paragraph">
<p>Here we show metadata being injected in several ways, denoted by the 1)&#8201;&#8212;&#8201;5) notations.</p>
</div>
<div class="paragraph">
<p>1) We are inside the scope of the top-level Grid variable, so this
metadata will show up in the attribute table inside the Grid Structure.</p>
</div>
<div class="paragraph">
<p>2) This is the actual data Array of the Grid, <strong>dsp_band_1.dsp_band_1</strong>.
We specify the units are a packed temperature.
3) Here we are in the
scope of a map variable, <strong>dsp_band_1.lat</strong>. We add the units
specification to this map.</p>
</div>
<div class="paragraph">
<p>4) Likewise, we add units to the <strong>lon</strong> map
vector.</p>
</div>
<div class="paragraph">
<p>5) Finally, we must close the actual grid and specify the
metadata for the <em>NEW</em> coordinate variable as a sibling of the Grid
since this will be used as the canonical prototype to be added to all
Grid&#8217;s which are to be aggregated on the new dimension. Note in this
case (unlike previous cases) the type of the new coordinate variable is
required since we are specifying a "placeholder" variable for the new
map until the Grid is actually processed once its containing &lt;netcdf&gt; is
closed (i.e. all data is available to it).</p>
</div>
<div class="paragraph">
<p>The resulting DAS (with global dataset metadata removed for clarity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attribute {
... global data clipped ...
  dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
1)   String Info "This is metadata on the Grid itself.";
        filename {
5)       String Info "Filename with timestamp";
        }
        dsp_band_1 {
2)        String units "Temp (packed)";
        }
        lat {
            String name "lat";
            String long_name "latitude";
3)        String units "degrees_north";
        }
        lon {
            String name "lon";
            String long_name "longitude";
4)        String units "degrees_east";
        }
    }
    filename {
5)    String Info "Filename with timestamp";
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We have annotated the DAS with numbers representing which lines in the
NcML above correspond to the injected metadata.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dynamic_aggregation_tutorial">11.E.7. Dynamic Aggregation Tutorial</h4>
<div class="sect4">
<h5 id="_introduction_15">Introduction</h5>
<div class="paragraph">
<p>Dynamic aggregation is achieved through the use of the <em>scan</em> element.</p>
</div>
<div class="paragraph">
<p>The NcML-2.2 <em>scan</em> element schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;xsd:element name="scan" minOccurs="0" maxOccurs="unbounded"&gt;
  &lt;xsd:complexType&gt;
    &lt;xsd:attribute name="location" type="xsd:string" use="required"/&gt;
    &lt;xsd:attribute name="regExp" type="xsd:string" /&gt;
    &lt;xsd:attribute name="suffix" type="xsd:string" /&gt;
    &lt;xsd:attribute name="subdirs" type="xsd:boolean" default="true"/&gt;
    &lt;xsd:attribute name="olderThan" type="xsd:string" /&gt;
    &lt;xsd:attribute name="dateFormatMark" type="xsd:string" /&gt;
    &lt;xsd:attribute name="enhance" type="xsd:string"/&gt;
  &lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This document discusses the use and significance of <em>scan</em> in creating
dynamically aggregated datasets.</p>
</div>
</div>
<div class="sect4">
<h5 id="_location_location_location">Location (Location Location&#8230;&#8203;)</h5>
<div class="paragraph">
<p>The most important attribute of the scan element is the <em>scan@location</em>
element that specifies the top-level search directory for the scan,
relative to the BES data root directory specified in the BES
configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<em>ALL</em> locations are interpreted relative to the BES root
directory and <strong>NOT</strong> relative to the location of the NcML file itself!
This means that all data to be aggregated <strong>must</strong> be in a subdirectory of
the BES root data directory and that these directories <em>must</em> be
specified fully, not relative to the NcML file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if the BES root data dir is "/usr/local/share/hyrax", let
${BES_DATA_ROOT} refer to this location. If the NcML aggregation file
is in "${BES_DATA_ROOT}/data/ncml/myAgg.ncml" and the aggregation
member datasets are in "${BES_DATA_ROOT}/data/hdf4/myAggDatasets", then
the location in the NcML file for the aggregation data directory would
be&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;scan location="data/hdf4/myAggDatasets" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which specifies the data directory relative to the BES data root as
required.</p>
</div>
<div class="paragraph">
<p>Again, for security reasons, the data is always searched under the
BES data root. Trying to specify an absolute filesystem path, such as&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;scan location="/usr/local/share/data" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will <em>NOT</em> work. This directory will also be assumed to be a
subdirectory of the ${BES_DATA_ROOT}, regardless of the preceding "/"
character.</p>
</div>
<div class="sect5">
<h6 id="_suffix_criterion">Suffix Criterion</h6>
<div class="paragraph">
<p>The simplest criterion is to match only files of a certain datatype in a
given directory. This is useful for filtering out text files and other
files that may exist in the directory but which do not form part of the
aggregation data.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Example of joinNew Grid aggregation using the scan element."&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan location="data/ncml/agg/grids" suffix=".hdf" /&gt;
 &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that the specified location "data/ncml/agg/grids" contains no
subdirectories, this NcML will return all files in that directory that
end in ".hdf" in alphanumerical order. In the case of our installed
example data, there are four HDF4 files in that directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">data/ncml/agg/grids/f97182070958.hdf
data/ncml/agg/grids/f97182183448.hdf
data/ncml/agg/grids/f97183065853.hdf
data/ncml/agg/grids/f97183182355.hdf</pre>
</div>
</div>
<div class="paragraph">
<p>These will be included in alphanumerical order, so the scan element will
in effect be equivalent to the following list of &lt;netcdf&gt; elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>By default, scan will search subdirectories, which is why we mentioned
"grids has no subdirectories". We discuss this in the next section.</p>
</div>
</div>
<div class="sect5">
<h6 id="_subdirectory_searching_the_default">Subdirectory Searching (The Default!)</h6>
<div class="paragraph">
<p>If the author specifies the <em>scan@subdirs</em> attribute to the value "true"
(which is the default!), then the criteria will be applied recursively
to any subdirectories of the <em>scan@location</em> base scan directory as well
as to any regular files in the base directory.</p>
</div>
<div class="paragraph">
<p>For example, continuing our previous example, but giving a higher level
location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation using the scan element."&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan location="data/ncml/agg/" suffix=".hdf" subdirs="true"/&gt;
 &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that only the "grids" subdir of "/data/ncml/agg" contains HDF4
files with that extension, the same aggregation as prior will be
created, in other words, an aggregation isomorphic to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;
&lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>scan@subdirs</em> attribute is much for useful for turning off the
default recursion. For example, if recursion is <strong>NOT</strong> desired, but only
files with the given suffix in the given directory are required, the
following will do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation using the scan element."&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan location="data/ncml/agg/grids" suffix=".hdf" subdirs="false"/&gt;
 &lt;/aggregation&gt;
&lt;/pre&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_olderthan_criterion">OlderThan Criterion</h6>
<div class="paragraph">
<p>The <em>scan@olderThan</em> attribute can be used to filter out files that are
"too new". This feature is useful for excluding partial files currently
being written by a daemon process, for example.</p>
</div>
<div class="paragraph">
<p>The value of the attribute is a duration specified by a number followed
by a basic time unit. The time units recognized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>seconds</strong>: \{ s, sec, secs, second, seconds }</p>
</li>
<li>
<p><strong>minutes</strong>: \{ m, min, mins, minute, minutes }</p>
</li>
<li>
<p><strong>hours</strong>: \{ h, hour, hours }</p>
</li>
<li>
<p><strong>days</strong>: \{ day, days }</p>
</li>
<li>
<p><strong>months</strong>: \{ month, months }</p>
</li>
<li>
<p><strong>years</strong>: \{ year, years }</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strings inside \{ } are all recognized as referring to the given
time unit.</p>
</div>
<div class="paragraph">
<p>For example, if we are following our previous example, but we suspect a
new HDF file may be written at any time and usually takes 5 minutes to
do so, we might use the following NcML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation using the scan element."&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan location="data/ncml/agg/grids" suffix=".hdf" subdirs="false" olderThan="10 mins" /&gt;
 &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the file will always be written withing 10 minutes, this files
does what we wish. Only files whose modification date is older than the
given duration from the current system time are included.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> that the modification date of the file, not the creation date, is
used for the test.</p>
</div>
</div>
<div class="sect5">
<h6 id="_regular_expression_criterion">Regular Expression Criterion</h6>
<div class="paragraph">
<p>The <em>scan@regExp</em> attribute may be used for more complicated filename
matching tests where data for multiple variables, for example, may live
in the same directory by whose filenames can be used to distinguish
which are desired in the aggregation. Additionally, since the pathname
including the location is used for the test, a regular expression test
may be used in conjunction with a recursive directory search to find
files in subdirectories where the directory name itself is specified in
the regular expression, not just the filename. We&#8217;ll give examples of
both of these cases.</p>
</div>
<div class="paragraph">
<p>We also reiterate that this test is used <em>in conjunction</em> with any other
tests --- the author may also include a suffix and an olderThan test if
they wish. All criteria must match for the file to be included in the
aggregation.</p>
</div>
<div class="paragraph">
<p>We recognize the POSIX regular expression syntax. For more information
on regular expressions and the POSIX syntax, please see:
<a href="http://en.wikipedia.org/wiki/Regular_expression" class="bare">http://en.wikipedia.org/wiki/Regular_expression</a>.</p>
</div>
<div class="paragraph">
<p>Consider the following, basic examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Finding all subdirectories with a given name</p>
</li>
<li>
<p>Matching a filename starting with a certain substring</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_matching_a_subdirectory_name">Matching a Subdirectory Name</h7>
<div class="paragraph">
<p>Here&#8217;s an example where we use a subdirectory search to find ".hdf"
files in all subdirectories named "grids":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Example of joinNew Grid aggregation using the scan element with a regexp"&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan
      location="data/"
      subdirs="true"
      regExp="^.*/grids/.+\.hdf$"
      /&gt;
 &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The regular expression here is "^.*/grids/.+\/hdf". Let&#8217;s pull it apart
quickly (this is not intended to be a regular expression tutorial):</p>
</div>
<div class="paragraph">
<p>The "^" matching the beginning of the string, so starts at the beginning
of the location pathname. (without this we can match substrings in the
middle of strings, etc)</p>
</div>
<div class="paragraph">
<p>We then match ".*" meaning 0 or more of any character.</p>
</div>
<div class="paragraph">
<p>We then match the "/grids/" string explicitly, meaning we want all
pathnames that contain "/grids/" as a subdirectory.</p>
</div>
<div class="paragraph">
<p>We then match ".+" meaning 1 or more of any character.</p>
</div>
<div class="paragraph">
<p>We then match "\." meaning a literal "." character (the backslash
"escapes" it).</p>
</div>
<div class="paragraph">
<p>We then match the suffix "hdf".</p>
</div>
<div class="paragraph">
<p>Finally, we match "$" meaning the end of the string.</p>
</div>
<div class="paragraph">
<p>So ultimately, this regular expression finds all filenames ending in
".hdf" that exist in some subdirectory named "grids" of the top-level
location.</p>
</div>
<div class="paragraph">
<p>In following with our previous example, if there was only the one
"grids" subdirectory in the ${BES_DATA_ROOT} with our four familiar
files, we&#8217;d get the same aggregation as before.</p>
</div>
</div>
<div class="sect6">
<h7 id="_matching_a_partial_filename">Matching a Partial Filename</h7>
<div class="paragraph">
<p>Let&#8217;s say we have a given directory full of data files whose filename
prefix specifies which variable they refer to. For example, let&#8217;s say
our "grids" directory has files that start with "grad" as well as the
files that start with "f" we have seen in our examples. We still want
just the files starting with "f" to filter out the others. Here&#8217;s an
example for that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Example of joinNew Grid aggregation using the scan element with a regexp"&gt;

 &lt;aggregation type="joinNew" dimName="filename"&gt;
   &lt;variableAgg name="dsp_band_1"/&gt;
   &lt;scan
      location="data/"
      subdirs="true"
      regExp="^.*/grids/f.+\.hdf$"
      /&gt;
 &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here we match all pathnames ending in "grids" and files that start with
the letter "f" and end with ".hdf" as we desire.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_date_format_mark_and_timestamp_extraction">Date Format Mark and Timestamp Extraction</h6>
<div class="paragraph">
<p>This section shows how to use the <em>scan@dateFormatMark</em> attribute along
with other search criteria in order to extract and sort datasets by a
timestamp encoded in the filename. All that is required is that the
timestamp be parseable by a pattern recognized by the Java language
"SimpleDateFormat" class, which has also been implemented in C++ in the
<a href="http://site.icu-project.org/">International Components for Unicode</a>
library which we use.</p>
</div>
<div class="paragraph">
<p>We base this example from the Unidata site
<a href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html">Aggregation
Tutorial</a>. Here we have a directory with four files whose filenames
contain a timestamp describable by a SimpleDataFormat (SDF) pattern. We
will also use a regular expression criterion and suffix criterion in
addition to the dateFormatMark since we have other files in the same
directory and only wish to match those starting with the characters "CG"
that have suffix ".nc".</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the list of files (relative to the BES data root dir):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">data/ncml/agg/dated/CG2006158_120000h_usfc.nc
data/ncml/agg/dated/CG2006158_130000h_usfc.nc
data/ncml/agg/dated/CG2006158_140000h_usfc.nc
data/ncml/agg/dated/CG2006158_150000h_usfc.nc</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the NcML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Test of joinNew aggregation using the scan element and dateFormatMark"&gt;

 &lt;aggregation type="joinNew" dimName="fileTime"&gt;
   &lt;variableAgg name="CGusfc"/&gt;
   &lt;scan
       location="data/ncml/agg/dated"
       suffix=".nc"
       subdirs="false"
       regExp="^.*/CG[^/]*"
       dateFormatMark="CG#yyyyDDD_HHmmss"
   /&gt;
 &lt;/aggregation&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>So here we joinNew on the new outer dimension <em>fileTime</em>. The new
coordinate variable <strong>fileTime</strong>[<em>fileTime</em>] for this dimension will
be an Array of type String that will contain the parsed
<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> timestamps we will
extract from the matching filenames.</p>
</div>
<div class="paragraph">
<p>We have specified that we want only Netcdf files (suffix ".nc") which
match the regular expression "<sup>.<strong>/CG[</sup>/]</strong>". This means match the start
of the string, then any number of characters that end with a "/" (the
path portion of the filename), then the letters "CG", then some number
of characters that do <em>not</em> include the "/" character (which is what
"[^/]*" means). Essentially, we want files whose basename (path
stripped) start with "CG" and end with ".nc". We also do not want to
recurse, but only look in the location directory "/data/ncml/agg/dated"
for the files.</p>
</div>
<div class="paragraph">
<p>Finally, we specify the <em>scan@dateFormatMark</em> pattern to describe how to
parse the filename into an ISO 8601 date. The <em>dateFormatMark</em> is
processed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Skip the <em>number</em> of characters prior to the "#" mark in the pattern
while scanning the base filename (no path)</p>
</li>
<li>
<p>Interpret the next characters of the file basename using the given
SimpleDateFormat string</p>
</li>
<li>
<p>Ignore any characters after the SDF portion of the filename (such as
the suffix)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>First, note that we <strong>do not match</strong> the characters in the dateFormatMark
--- they are simply counted and skipped. So rather than "CG#" specifying
the prefix before the SDF, we could have also used "XX#". This is why we
must also use a regular expression to filter out files with other
prefixes that we do not want in the aggregation. Note that the "#" is
just a marker for the start of the SDF pattern and doesn&#8217;t count as an
actual character in the matching process.</p>
</div>
<div class="paragraph">
<p>Second, we specify the dateFormatMark (DFM) as the following SDF
pattern: "yyyyDDD_HHmmss". This means that we use the four digit year,
then the day of the year (a three digit number), then an underscore
("_") separator, then the 24 hour time as 6 digits. Let&#8217;s take the
basename of the first file as an example:</p>
</div>
<div class="paragraph">
<p>"CG2006158_120000h_usfc.nc"</p>
</div>
<div class="paragraph">
<p>We skip two characters due to the "CG#" in the DFM. Then we want to
match the "yyyy" pattern for the year with: "2006".</p>
</div>
<div class="paragraph">
<p>We then match the day of the year as "DDD" which is "158", the 158th day
of the year for 2006.</p>
</div>
<div class="paragraph">
<p>We then match the underscore character "_" which is only a separator.</p>
</div>
<div class="paragraph">
<p>Next, we match the 24 hour time "HHmmss" as 12:00:00 hours:mins:secs
(i.e. noon).</p>
</div>
<div class="paragraph">
<p>Finally, any characters after the DFM are ignored, here "h_usfc.nc".</p>
</div>
<div class="paragraph">
<p>We see that the four dataset files are on the same day, but sampled each
hour from noon to 3 pm.</p>
</div>
<div class="paragraph">
<p>These parsed timestamps are then converted to an ISO 8601 date string
which is used as the value for the coordinate variable element
corresponding to that aggregation member. The first file would thus have
the time value "2006-06-07T12:00:00Z", which is 7 June 2006 at noon in
the GMT timezone.</p>
</div>
<div class="paragraph">
<p>The matched files are then <strong>sorted using the ISO 8601 timestamp as the
sort key</strong> and added to the aggregation in this order. Since ISO 8601 is
designed such that lexicographic order is isomorphic to chronological
order, this orders the datasets monotonically in time from past to
future. This is different from the &lt;scan&gt; behavior <em>without</em> a
dateFormatMark specified, where files are ordered lexicographically
(alphanumerically by full pathname) --- this order may or may not match
chronological order.</p>
</div>
<div class="paragraph">
<p>If we project out the ASCII dods response for the new coordinate
variable, we see all of the parsed timestamps and that they are in
chronological order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">String fileTime[fileTime = 4] = {"2006-06-07T12:00:00Z",
"2006-06-07T13:00:00Z",
 "2006-06-07T14:00:00Z",
"2006-06-07T15:00:00Z"};</pre>
</div>
</div>
<div class="paragraph">
<p>We also check the resulting DDS to see that it is added as a map vector
to the Grid as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        Float32 CGusfc[fileTime = 4][time = 1][altitude = 1][lat = 29][lon = 26]
;
      Maps:
        String fileTime[fileTime = 4];
        Float64 time[time = 1];
        Float32 altitude[altitude = 1];
        Float32 lat[lat = 29];
        Float32 lon[lon = 26];
    } CGusfc;
    String fileTime[fileTime = 4];
} joinNew_scan_dfm.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we look at the DAS with global metadata removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
  CGusfc {
        Float32 _FillValue -1.000000033e+32;
        Float32 missing_value -1.000000033e+32;
        Int32 numberOfObservations 303;
        Float32 actual_range -0.2876400054, 0.2763200104;
        fileTime {
---&gt;            String _CoordinateAxisType "Time";
        }
        CGusfc {
        }
        time {
            String long_name "End Time";
            String standard_name "time";
            String units "seconds since 1970-01-01T00:00:00Z";
            Float64 actual_range 1149681600.0000000, 1149681600.0000000;
        }
        altitude {
            String long_name "Altitude";
            String standard_name "altitude";
            String units "m";
            Float32 actual_range 0.000000000, 0.000000000;
        }
        lat {
            String long_name "Latitude";
            String standard_name "latitude";
            String units "degrees_north";
            String point_spacing "even";
            Float32 actual_range 37.26869965, 38.02470016;
            String coordsys "geographic";
        }
        lon {
            String long_name "Longitude";
            String standard_name "longitude";
            String units "degrees_east";
            String point_spacing "even";
            Float32 actual_range 236.5800018, 237.4799957;
            String coordsys "geographic";
        }
    }
    fileTime {
---&gt;     String _CoordinateAxisType "Time";
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We see that the aggregation has also automatically added the
"_CoordinateAxisType" attribute and set it to "Time" (denoted by the
"-&#8594;") as defined by the NcML 2.2 specification. The author may add
other metadata to the new coordinate variable as discussed previously.</p>
</div>
</div>
<div class="sect5">
<h6 id="_order_of_inclusion">Order of Inclusion</h6>
<div class="paragraph">
<p>In cases where a dateFormatMark is <em>not</em> specified, the member datasets
are added to the aggregation in alphabetical order <em>on the full
pathname</em>. This is important in the case of subdirectories since the
path of the subdirectory is taken into account in the sort.</p>
</div>
<div class="paragraph">
<p>In cases where a dateFormatMark <em>is</em> specified, the extracted ISO 8601
timestamp is used as the sorting criterion, with older files being added
before newer files.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="grid_metadata_utorial">11.E.8. Grid Metadata Tutorial</h4>
<div class="sect4">
<h5 id="_an_example_of_adding_metadata_to_a_grid">An Example of Adding Metadata to a Grid</h5>
<div class="paragraph">
<p>We will go through a basic example of adding metadata to all the
possible scopes in a Grid variable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The top-level Grid Structure itself</p>
</li>
<li>
<p>The data Array in the Grid</p>
</li>
<li>
<p>Each Map vector in the Grid</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will also modify the global dataset attribute container to elucidate
the difference between an attribute Structure and a variable Structure.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a "pass-through" NcML file which wraps a Netcdf dataset
that Hyrax represents as a Grid. This will let us see the exact
structure of the data we will want to modify (which may be slightly
different than the wrapped dataset due to legacy issues with how shared
dimensions are represented, etc):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;
&lt;!-- This space intentionally left blank! --&gt;
&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This gives the DDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[lat = 1024][lon = 1024];
      Maps:
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
} grid_attributes_2.ncml;</pre>
</div>
</div>
<div class="paragraph">
<p>and the (extensive) DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    HDF_GLOBAL {
        UInt16 dsp_SubImageId 0;
        String dsp_SubImageName "N/A";
        Int32 dsp_ModificationDate 20040416;
        Int32 dsp_ModificationTime 160521;
        Int32 dsp_SubImageFlag 64;
        String dsp_SubImageTitle "Ingested by SCRIPP";
        Int32 dsp_StartDate 19970701;
        Float32 dsp_StartTime 70958.5;
        Int32 dsp_SizeX 1024;
        Int32 dsp_SizeY 1024;
        Int32 dsp_OffsetX 0;
        Int32 dsp_RecordLength 2048;
        Byte dsp_DataOrganization 64;
        Byte dsp_NumberOfBands 1;
        String dsp_ing_tiros_ourid "NO14****C\\217\\345P?\\253\\205\\037";
        UInt16 dsp_ing_tiros_numscn 44305;
        UInt16 dsp_ing_tiros_idsat 2560;
        UInt16 dsp_ing_tiros_iddata 768;
        UInt16 dsp_ing_tiros_year 24832;
        UInt16 dsp_ing_tiros_daysmp 46592;
        Int32 dsp_ing_tiros_milsec 1235716353;
        Int32 dsp_ing_tiros_slope 1075636998, 551287046, -426777345, -1339034123, 5871604;
        Int32 dsp_ing_tiros_intcpt 514263295, 1892553983, -371365632, 9497638, -2140793044;
        UInt16 dsp_ing_tiros_tabadr 256, 512, 768;
        UInt16 dsp_ing_tiros_cnlins 256;
        UInt16 dsp_ing_tiros_cncols 256;
        UInt16 dsp_ing_tiros_czncs 8;
        UInt16 dsp_ing_tiros_line 256;
        UInt16 dsp_ing_tiros_icol 0;
        String dsp_ing_tiros_date0 "23-MAY-10 13:54:29\\030";
        String dsp_ing_tiros_time0 "13:54:29\\030";
        UInt16 dsp_ing_tiros_label 14112, 12576, 14137;
        UInt16 dsp_ing_tiros_nxtblk 1280;
        UInt16 dsp_ing_tiros_datblk 1280;
        UInt16 dsp_ing_tiros_itape 256;
        UInt16 dsp_ing_tiros_cbias 0;
        UInt16 dsp_ing_tiros_ccoeff 0;
        Int32 dsp_ing_tiros_pastim 1235716353;
        UInt16 dsp_ing_tiros_passcn 3840;
        UInt16 dsp_ing_tiros_lostct 0;
        UInt16 dsp_ing_tiros_lost 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
        UInt16 dsp_ing_tiros_ndrll 1280;
        UInt16 dsp_ing_tiros_ndrrec 3840, 5376, 6912, 8448, 9984, 0, 0, 0, 0, 0;
        UInt16 dsp_ing_tiros_ndrlat 46110, 44318, 42526, 40478, 38686, 0, 0, 0, 0, 0;
        UInt16 dsp_ing_tiros_ndrlon 49891, 48611, 47075, 45539, 44259, 0, 0, 0, 0, 0;
        UInt16 dsp_ing_tiros_chncnt 1280;
        UInt16 dsp_ing_tiros_chndsq 8, 8, 8, 8, 8;
        UInt16 dsp_ing_tiros_czncs2 4;
        UInt16 dsp_ing_tiros_wrdsiz 512;
        UInt16 dsp_ing_tiros_nchbas 256;
        UInt16 dsp_ing_tiros_nchlst 1280;
        Float32 dsp_ing_tiros_rpmclc 0;
        UInt16 dsp_ing_tiros_numpix 8;
        UInt16 dsp_ing_tiros_scnden 256;
        UInt16 dsp_ing_tiros_eltden 256;
        UInt16 dsp_ing_tiros_orbtno 23858;
        Int32 dsp_ing_tiros_slope2 1075636998, 551287046, -426777345, -1339034123, 5871604;
        Int32 dsp_ing_tiros_intcp2 514263295, 1892553983, -371365632, 9497638, -2140793044;
        Float32 dsp_ing_tiros_prtemp 3.0811e+10;
        Float32 dsp_ing_tiros_timerr 5.6611e-20;
        UInt16 dsp_ing_tiros_timstn 8279;
        String dsp_nav_xsatid "NO14\\005\\002";
        Byte dsp_nav_xsatty 5;
        Byte dsp_nav_xproty 2;
        Byte dsp_nav_xmapsl 0;
        Byte dsp_nav_xtmpch 4;
        Float32 dsp_nav_ximgdy 97182;
        Float32 dsp_nav_ximgtm 70954.4;
        Float32 dsp_nav_xorbit 12893;
        Float32 dsp_nav_ximgcv 71.1722, 0, 4.88181, 0, -112.11, 0, -27.9583, 0;
        Float32 dsp_nav_earth_linoff 0;
        Float32 dsp_nav_earth_pixoff 0;
        Float32 dsp_nav_earth_scnstr 1;
        Float32 dsp_nav_earth_scnstp 1024;
        Float32 dsp_nav_earth_pixstr 1;
        Float32 dsp_nav_earth_pixstp 1024;
        Float32 dsp_nav_earth_latorg 0;
        Float32 dsp_nav_earth_lonorg 0;
        Float32 dsp_nav_earth_orgrot 0;
        Float32 dsp_nav_earth_lattop 0;
        Float32 dsp_nav_earth_latbot 0;
        Float32 dsp_nav_earth_latcen 38;
        Float32 dsp_nav_earth_loncen -70;
        Float32 dsp_nav_earth_height 66.3444;
        Float32 dsp_nav_earth_width 84.2205;
        Float32 dsp_nav_earth_level 1;
        Float32 dsp_nav_earth_xspace 5.99902;
        Float32 dsp_nav_earth_yspace 5.99902;
        String dsp_nav_earth_rev " 0.1";
        Float32 dsp_nav_earth_dflag 0;
        Float32 dsp_nav_earth_toplat 71.1722;
        Float32 dsp_nav_earth_botlat 4.88181;
        Float32 dsp_nav_earth_leflon -112.11;
        Float32 dsp_nav_earth_ritlon -27.9583;
        Float32 dsp_nav_earth_numpix 1024;
        Float32 dsp_nav_earth_numras 1024;
        Float32 dsp_nav_earth_magxx 6;
        Float32 dsp_nav_earth_magyy 6;
        Int32 dsp_hgt_llnval 18;
        Int32 dsp_hgt_lltime 25744350;
        Float32 dsp_hgt_llvect 869.428, 1.14767, 868.659, 1.09635, 867.84, 1.04502, 866.979, 0.9937, 866.084, 0.942374, 865.165, 0.891045, 864.231, 0.839715, 863.292, 0.788383, 862.356, 0.737049, 861.434, 0.685714, 860.536, 0.634378, 859.67, 0.58304, 858.847, 0.531702, 858.075, 0.480362, 857.363, 0.429022, 856.718, 0.377682, 856.148, 0.326341, 855.66, 0.275, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
        String history "\\001PATHNLC May 23 22:40:54 2000 PATHNLC t,3,269.16,0.125,0.,0.01,271.16,308.16,,,,1,,,2,,,3,,,,,,4,,,,,,,2.,,35.,0.1,5,,,,,,,2.,,35.,0.15,55.,80.,0.005,20,,,-2,6.,t,,,,,,,,,,16,,3.5 allb=0 nlsst=1 in=/pathfdr5//97182070958.N14@INGEST@ in1=/pathfdr10/mask/oi.9727.mean out=/pathfdr4/nlc/f97182070958.FMG@0\\012\\004PATHNLC  NLSST Temp calculation date: April 10, 1996\\012\\001OISST Jan 12 17:53:43 1998 OISST  /usr3/gacsst/maketc/oi/dinp/oi.comp.bias.1997,/usr3/gacsst/maketc/oi/dout/oi.97,-3.,0.15,oi.dates.97,0\\012\\004OISST 26 97 06 22 97 06 28  7        472\\012\\001STATS Jan 12 18:27:34 1998 STATS minpix=1 maxpix=255 in=/usr3/gacsst/maketc/oi/dout//oi.9726 \\011  audit=t, callim=f, cal=f, cloud=f \\011  outm=/usr3/gacsst/etc/oi/oi.9727.mean\\012\\001OISST Jan 12 17:53:43 1998 OISST  /usr3/gacsst/maketc/oi/dinp/oi.comp.bias.1997,/usr3/gacsst/maketc/oi/dout/oi.97,-3.,0.15,oi.dates.97,0\\012\\004OISST 27 97 06 29 97 07 05  7        472\\012\\002STATS /usr3/gacsst/maketc/oi/dout//oi.9727\\012\\001OISST Jan 12 17:53:43 1998 OISST  /usr3/gacsst/maketc/oi/dinp/oi.comp.bias.1997,/usr3/gacsst/maketc/oi/dout/oi.97,-3.,0.15,oi.dates.97,0\\012\\004OISST 27 97 06 29 97 07 05  7        472\\012\\002STATS /usr3/gacsst/maketc/oi/dout//oi.9727\\012\\001OISST Jan 12 17:53:43 1998 OISST  /usr3/gacsst/maketc/oi/dinp/oi.comp.bias.1997,/usr3/gacsst/maketc/oi/dout/oi.97,-3.,0.15,oi.dates.97,0\\012\\004OISST 28 97 07 06 97 07 12  7        472\\012\\002STATS /usr3/gacsst/maketc/oi/dout//oi.9728\\012\\002PATHNLC /pathfdr10/mask/oi.9727.mean\\012\\004PATHNLC  45d coeffs used (1) =    0.759   0.947   0.110   1.460   0.000\\012\\004PATHNLC  45d coeffs used (2) =    1.320   0.952   0.071   0.882   0.000\\012\\004PATHNLC  45d coeffs used (3) =    0.000   0.000   0.000   0.000   0.000\\012\\004PATHNLC  GETOZONE I     0.0900    0.0000\\012\\001REMAP Jun  4 07:59:42 2000 REMAP in=/coral/miami/remaps/sst_8r/file_uZ.FMG out=/coral/miami/remaps/sst_8r/f97182070958.nwa16\\012\\004REMAP Output image pixel, line size =    6144,    6144\\012\\004REMAP Grid spacing (X,Y) = (        6.00,        6.00), Projection Code=     1\\012\\004REMAP center lon,lat,dlon,dlat =       -70.00       38.00        0.01        0.01\\012\\001merge_sb Apr 16 16:05:09 2004 merge_sb in=(file=/NOPP/carlw/atlantic/remaps/nwa16/f97182070958.nwa16, filecheck=/RAID2/sbaker/atlantic/bslines97/f97182070958.nwa16) val=0 valcheck=0 tag=0 out=(file1=/RAID2/sbaker/nwa1024d/NDC/dsp_data/f97182070958.tmp_m2)\\012\\001merge_sb Apr 16 16:05:18 2004 merge_sb in=(file=/RAID2/sbaker/nwa1024d/NDC/dsp_data/f97182070958.tmp_m2, filecheck=/RAID/sbaker/DECLOUD/landmask16.img) val=1 valcheck=2 tag=0 out=(file1=/RAID2/sbaker/nwa6144d/NDC/dsp_data/f97182070958.nwa16)\\012\\001CONVRT Apr 16 16:05:21 2004 CONVRT 1024,1024,0,0,6,6,0,0,f,f,t,16,,SUB,1 in=/RAID2/sbaker/nwa6144d/NDC/dsp_data/f97182070958.nwa16   out=/RAID2/sbaker/nwa1024d/NDC/dsp_data/f97182070958.nwa16\\012\\012@\\000\\000\\000";
    }
    dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say we want to add the following attributes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add an attribute to the HDF_GLOBAL attribute container called
"ncml_location" since the file is wrapped by our NcML and the original
location being wrapped might not be obvious.</p>
</li>
<li>
<p>Add the same attribute to the <strong>dsp_band_1</strong> Grid itself so it&#8217;s
easier to see and in case of projections</p>
</li>
<li>
<p>Add "units" to the Array member variable <strong>dsp_band_1</strong> of the Grid
that matches the containing Grid&#8217;s "units" attribute with value "Temp"</p>
</li>
<li>
<p>Add "units" to the <strong>lat</strong> map vector as a String with value
"degrees_north"</p>
</li>
<li>
<p>Add "units" to the <strong>lon</strong> map vector as a String with value
"degrees_east"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>First, let&#8217;s add the "ncml_location" into the HDF_GLOBAL attribute
container. To do this, we need to specify the "scope" of the HDF_GLOBAL
attribute container (called a Structure in NcML):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;

  &lt;!-- Traverse into the HDF_GLOBAL attribute Structure (container) --&gt;
  &lt;attribute name="HDF_GLOBAL" type="Structure"&gt;
    &lt;!-- Specify the new attribute in that scope --&gt;
1)  &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
  &lt;/attribute&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following (clipped for clarity) DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    HDF_GLOBAL {
        UInt16 dsp_SubImageId 0;
        ... *** CLIPPED FOR CLARITY ***  ...
1)    String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
    }
    dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We can see at the 1) where the new attribute has been added to
HDF_GLOBAL as desired.</p>
</div>
<div class="paragraph">
<p>Next, we want to add the same attribute to the top-level <strong>dsp_band_1</strong>
Grid variable. Here&#8217;s the NcML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;

  &lt;!-- Traverse into the HDF_GLOBAL attribute Structure (container) --&gt;
 &lt;attribute name="HDF_GLOBAL" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/attribute&gt;

 &lt;!-- Traverse into the dsp_band_1 variable Structure (actually a Grid) --&gt;
 &lt;variable name="dsp_band_1" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
2) &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which gives the (clipped again) DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    HDF_GLOBAL {
       ... *** CLIPPED FOR CLARITY *** ...
        String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
    }
    dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
2)    String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
        dsp_band_1 {
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We have denoted the injected metadata with a 2).</p>
</div>
<div class="paragraph">
<p>As a learning exercise, let&#8217;s say we made a mistake and tried to use
&lt;attribute&gt; to specify the <strong>dsp_band_1</strong> attribute table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;

  &lt;!-- Traverse into the HDF_GLOBAL attribute Structure (container) --&gt;
 &lt;attribute name="HDF_GLOBAL" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/attribute&gt;

 &lt;!-- THIS IS AN ERROR! --&gt;
 &lt;attribute name="dsp_band_1" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/attribute&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Then we get a Parse Error&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;response xmlns="http://xml.opendap.org/ns/bes/1.0#" reqID="some_unique_value"&gt;
  &lt;getDAS&gt;
      &lt;BESError&gt;&lt;Type&gt;3&lt;/Type&gt;
           &lt;Message&gt;NCMLModule ParseError: at line 11: Cannot create a new attribute container with name=dsp_band_1 at current scope since a variable with that name already exists.  Scope=&lt;/Message&gt;
           &lt;Administrator&gt;admin.email.address@your.domain.name&lt;/Administrator&gt;&lt;Location&gt;&lt;File&gt;AttributeElement.cc&lt;/File&gt;&lt;Line&gt;277&lt;/Line&gt;&lt;/Location&gt;
      &lt;/BESError&gt;
   &lt;/getDAS&gt;
&lt;/response&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which basically tells us the problem: we tried to specify an attribute
with the same name as the Grid, but <strong>dsp_band_1</strong> is a variable already
with that name. It is illegal for an attribute and variable at the same
scope to have the same name.</p>
</div>
<div class="paragraph">
<p>Next, we want to add the "units" attribute that is on the Grid itself to
the actual data Array inside the Grid (say we know we will be projecting
it out with a constraint and don&#8217;t want to lose this metadata). The NcML
now becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;

  &lt;!-- Traverse into the HDF_GLOBAL attribute Structure (container) --&gt;
 &lt;attribute name="HDF_GLOBAL" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/attribute&gt;

 &lt;!-- Traverse into the dsp_band_1 variable Structure (actually a Grid) --&gt;
 &lt;variable name="dsp_band_1" type="Structure"&gt;

   &lt;!-- Specify the new attribute in the Grid's attribute table --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;

   &lt;!-- While remaining in the Grid, traverse into the Array dsp_band_1: --&gt;
   &lt;variable name="dsp_band_1"&gt;
     &lt;!-- And add the attribute there.  Fully qualified name of this scope is "dsp_band_1.dsp_band_1" --&gt;
3)   &lt;attribute name="units" type="String" value="Temp"/&gt;
   &lt;/variable&gt; &lt;!-- Exit the Array variable scope, back to the Grid level --&gt;

 &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Our modified DAS is now&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    HDF_GLOBAL {
       ... *** CLIPPED FOR CLARITY *** ...
        String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
    }
    dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
        String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
        dsp_band_1 {
3)        String units "Temp";
        }
        lat {
            String name "lat";
            String long_name "latitude";
        }
        lon {
            String name "lon";
            String long_name "longitude";
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;where the 3) denotes the newly injected metadata on
<strong>dsp_band_1.dsp_band_1</strong>.</p>
</div>
<div class="paragraph">
<p>Next, we will add the units to both of the map vectors in the next
version of our NcML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf" title="This file results in a Grid"&gt;

  &lt;!-- Traverse into the HDF_GLOBAL attribute Structure (container) --&gt;
 &lt;attribute name="HDF_GLOBAL" type="Structure"&gt;
   &lt;!-- Specify the new attribute in that scope --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;
 &lt;/attribute&gt;

 &lt;!-- Traverse into the dsp_band_1 variable Structure (actually a Grid) --&gt;
 &lt;variable name="dsp_band_1" type="Structure"&gt;

   &lt;!-- Specify the new attribute in the Grid's attribute table --&gt;
   &lt;attribute name="ncml_location" type="String" value="data/ncml/agg/grids/f97182070958.hdf"/&gt;

   &lt;!-- While remaining in the Grid, traverse into the Array dsp_band_1: --&gt;
   &lt;variable name="dsp_band_1"&gt;
     &lt;!-- And add the attribute there.  Fully qualified name of this scope is "dsp_band_1.dsp_band_1" --&gt;
     &lt;attribute name="units" type="String" value="Temp"/&gt;
   &lt;/variable&gt; &lt;!-- Exit the Array variable scope, back to the Grid level --&gt;

   &lt;!-- Traverse into the lat map vector variable --&gt;
   &lt;variable name="lat"&gt;
     &lt;!-- Add the units --&gt;
4)   &lt;attribute name="units" type="String" value="degrees_north"/&gt;
   &lt;/variable&gt;

   &lt;!-- Traverse into the lon map vector variable --&gt;
   &lt;variable name="lon"&gt;
     &lt;!-- Add the units --&gt;
5)   &lt;attribute name="units" type="String" value="degrees_east"/&gt;
   &lt;/variable&gt;

 &lt;/variable&gt;

&lt;/netcdf&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;where we denote the changed with 4) and 5). Here&#8217;s the resulting DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Attributes {
    HDF_GLOBAL {
        ... *** CLIPPED FOR CLARITY *** ...
1)      String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
    }
    dsp_band_1 {
        Byte dsp_PixelType 1;
        Byte dsp_PixelSize 2;
        UInt16 dsp_Flag 0;
        UInt16 dsp_nBits 16;
        Int32 dsp_LineSize 0;
        String dsp_cal_name "Temperature";
        String units "Temp";
        UInt16 dsp_cal_eqnNumber 2;
        UInt16 dsp_cal_CoeffsLength 8;
        Float32 dsp_cal_coeffs 0.125, -4;
        Float32 scale_factor 0.125;
        Float32 add_off -4;
2)       String ncml_location "data/ncml/agg/grids/f97182070958.hdf";
        dsp_band_1 {
3)          String units "Temp";
        }
        lat {
            String name "lat";
            String long_name "latitude";
4)          String units "degrees_north";
        }
        lon {
            String name "lon";
            String long_name "longitude";
5)          String units "degrees_east";
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;where we have marked all the new metadata we have injected, including
the new attributes on the map vectors.</p>
</div>
<div class="paragraph">
<p>Although we added metadata to the Grid, it is possible to also use the
other forms of &lt;attribute&gt; in order to modify existing attributes or
remove unwanted or incorrect attributes.</p>
</div>
<div class="paragraph">
<p>The only place where this syntax varies slightly is in adding metadata
to an aggregated Grid. Please see the tutorial section on aggregating
grids for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user_specified_aggregation">Appendix F: User-Specified Aggregation</h3>
<div class="sect3">
<h4 id="_introduction_16">11.F.1. Introduction</h4>
<div class="paragraph">
<p>In response to requests from NASA, and with their support, we have added
two new kinds of aggregation to Hyrax. Both of these aggregation
operations provide a way for client software to specify the granules
that will be used to build the aggregate result. While our existing
aggregation interface, based on NcML, works well for NASA&#8217;s level 3 data
products, it is all but useless for level 2 <em>swath data</em>. These
aggregation functions are specifically designed to work with satellite
swath data without being limited to just swath data and are explicitly
intended for use with search interfaces that have knowledge of the
individual files that make up typical satellite data sets (often called
a <em>dataset inventory</em>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This service provides value-based subsetting for satellite
<em>swath data</em>. It&#8217;s applicable to lots of other kinds of data, but
works best with data that meet certain requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Providing search results that include explicit references to hundreds or
thousands of discrete files has been the only option for many search
interfaces up to this point. This is especially when the datasets holds
satellite swath data because swath data are not easily aggregated. For
this interface to Hyrax&#8217;s aggregation software, we provide two kinds of
responses: Data in multiple files that are bundled together using an zip
archive and data in tabular form. For clients that request the aggregate
result in a zip file, given a request for values from N files, there
will be N entries in the resulting zip archive. Some of these entries
may simply indicate that no data matching the spatial or other
constraints were found. While the source data files can be in any format
that the Hyrax server can read, the response will be either netCDF3,
netCDF4 or ASCII. The netCDF3/4 files returned will conform to CF 1.6 to
the extent possible (the underlying data files may lack information CF
1.6 requires). For clients that request data in tabular form, the data
from N files will be returned in one ASCII CSV response. These values
can be easily assimilated by database systems, Excel and other tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="_intended_audience">11.F.2. Intended Audience</h4>
<div class="paragraph">
<p>This service was originally intended for software developers working
data search tools who need to be able to return results that encompass
hundreds or thousands of granules. It works best from a programmatic
interface, but it&#8217;s certainly open to end users, see the examples using
curl for one way to access the service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_the_aggregation_services">11.F.3. Accessing the Aggregation Services</h4>
<div class="paragraph">
<p>This 'service' is accessed using HTTP&#8217;s GET or POST methods. In this
documentation I will describe how to use POST to send information, but
the same key-value parameters can be sent using the GET method, albeit
within the character limits of a URL (which vary depending on
implementation).</p>
</div>
<div class="paragraph">
<p>The service is accessed using the following set of key-value parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">operation</dt>
<dd>
<p>Use <em>operation</em> to select from various kinds of responses. The form of
the response also determines how the aggregation is built. The current
values for this parameter are: <em>version</em> which returns information
about the service&#8217;s version; <em>file</em> returns a collection of files;
<em>netcdf3</em>, <em>netcdf4</em>, <em>ascii</em> all translate the underlying granule
format to netcdf3, etc., and return that collection of translated
files; <em>csv</em> returns data from many granules as a single table of
data, using Comma Separated Values (csv) format. More information
about this is given below.</p>
</dd>
<dt class="hdlist1">file</dt>
<dd>
<p>The URL path component to a granule served by Hyrax. This parameter
will appear once for each file in the aggregation.</p>
</dd>
<dt class="hdlist1">var</dt>
<dd>
<p>A comma-separated list of variables to include in the files returned
when using <em>operation</em> equal to <em>netcdf3</em>, <em>netcdf4</em>, <em>ascii</em>,
or <em>csv</em></p>
</dd>
<dt class="hdlist1">bbox</dt>
<dd>
<p>Limit the values returned to those that fall within a bounding box for
a given variable. Like <em>var</em>, this applies only to <em>netcdf3</em>,
<em>netcdf4</em>, <em>ascii</em>, or <em>csv</em></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_how_to_use_these_parameters">How to Use These Parameters</h5>
<div class="paragraph">
<p>The <em>operation</em> and <em>file</em> parameters are the key to the service. By
listing multiple files, you can explicitly control which files are
accessed and the order of that access. The <em>operation</em> parameter
provides a way to choose between a zipped response with many files
either in their native format (<em>file</em>) or in one of three well known
representations (<em>netcdf3</em>, netcdf4 <em>or</em> ascii<em>).</em></p>
</div>
<div class="paragraph">
<p>While a complete request can make use of only the <em>operation</em> and <em>file</em>
parameters, adding the variable and value subsetting can provide a much
more manageable response. The <em>var</em> and <em>bbox</em> parameters can appear
either once or <em>N</em> times where <em>N</em> is the number of time the <em>file</em>
parameter appears. In the first case, the values of the single instances
of <em>var</em> and/or <em>bbox</em> are applied to every file/granule listed in the
request. In the second case the value of <em>var1</em> is used with <em>file1</em>,
<em>var2</em> with <em>file2</em>, and so on up to <em>varN</em> and <em>fileN</em>. The same is
true of the <em>bbox</em> parameter. Furthermore, these parameters act
independently, so a request can use one value for <em>var</em> and <em>N</em> values
for <em>bbox</em> or vice versa.</p>
</div>
</div>
<div class="sect4">
<h5 id="_response_formats">Response Formats</h5>
<div class="paragraph">
<p>This service will either return a collection of files bundled in a <em>zip
archive</em> or it will return a since CSV/text file. When <em>operation</em> is
<em>file</em>, <em>netcdf3</em>, <em>netcdf4</em> or <em>ascii</em>, the service will take
each of the files as they are retrieve or built and put them in a zip
archive that it streams back to the client. The ZIP64(tm) format
extensions are used to overcome the size limitations of the original ZIP
format.</p>
</div>
<div class="paragraph">
<p>For the <em>csv</em> operation, the response is a single CSV/text file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_about_var">More About <em>var</em></h5>
<div class="paragraph">
<p>The <em>var</em> parameter is a comma-separated list of variables in the files
listed in the request. Each of the variables must be named just as it is
in the DAP dataset. If you&#8217;re getting errors from the service that 'No
such variable exists in the dataset &#8230;&#8203;', use a web browser or <em>curl</em> to
look at one of the granules and see what the exact name is. For many
NASA dataset, these names can be quite long and have several components,
separated by dots. One way to test the name is to build a URL to the
file and use the <em>getdap</em> (part of the libdap software package) tool
like this</p>
</div>
<div class="paragraph">
<p><em>getdap -d &lt;url&gt; -c</em></p>
</div>
<div class="paragraph">
<p>If this returns an error, look at the DDS or DMR from the dataset and
figure out the correct name. Do that using</p>
</div>
<div class="paragraph">
<p><em>getdap -d &lt;url&gt;</em> or</p>
</div>
<div class="paragraph">
<p><em>getdap4 -d &lt;url&gt;</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_more_about_bbox">More About <em>bbox</em></h5>
<div class="paragraph">
<p>The <em>bbox</em> parameter is probably the most powerful of the parameters in
terms of its ability to select specific data values. It has two
different modes, one when used with the zip-formatted responses (i.e.,
<em>operation</em> is <em>netcdf3</em>, <em>netcdf4</em> or <em>ascii</em>) and another when its
used with <em>operation</em> equal to <em>csv</em>. However, ther are somethings
that are common to both uses of the parameter. In either case, <em>bbox</em> is
used to select a range of values for a particular variable or a set of
variables. The format for a <em>bbox</em> request has the following form</p>
</div>
<div class="paragraph">
<p><em>[</em> &lt;lower value&gt; <em>,</em> &lt;variable name&gt; <em>,</em> &lt;upper value&gt; <em>]</em></p>
</div>
<div class="paragraph">
<p>for each variable in the subset request. If more than one variable is
included, use a series of <em>range requests</em> surrounded by double quotes.
An example <em>box</em> request looks like</p>
</div>
<div class="paragraph">
<p>&amp;bbox="[49,Latitude,50][167,Longitude,170]"</p>
</div>
<div class="paragraph">
<p>which translates to <em>"for the variable Latitude, return only values
between 49 and 50 (inclusive) and for the variable Longitude return only
values between 167 and 170"</em>. Note that the example here uses two
variables named <em>Latitude</em> and <em>Longitude</em>, but any variables in the
dataset could be used.</p>
</div>
<div class="paragraph">
<p>The <em>bbox</em> operation is special, however, because the range limitation
applies not only to the variable listed, but to any other variables in
the request that share dimensions with those variables. Thus, for a
dataset that contains <em>Latitude</em>, <em>longitude</em> and <em>Optical_Depth</em>
where all have the shared dimensions <em>x</em> and <em>y</em>, the <em>bbox</em> parameter
will choose values of <em>Latitude</em> and <em>Longitude</em> within the given values
and then apply the resulting bounding box to those variables and any
other variables that use the same named dimensions as those variables.
The named (i.e., <em>shared</em>) dimensions form the linkage between the
subsetting of the variables named in the <em>bbox</em> value subset operation
and the other variables in the list of <em>var</em>s to return.</p>
</div>
<div class="paragraph">
<p>You can find out if variables in a dataset share named dimensions by
looking at the DDS (DAP2) or DMR (DAP4) for the dataset. Note that for
DAP4, in the example used in the previous paragraph, <em>Latitude</em>,
<em>longitude</em> and <em>Optical_Depth</em> form a 'coverage' where <em>Latitude</em> and
<em>longitude</em> are the domain and <em>Optical_Depth</em> is the 'range'.</p>
</div>
<div class="paragraph">
<p>Note that the variables in the <em>bbox</em> range requests must also be listed
in the <em>var</em> parameter if you want their values to be returned.</p>
</div>
<div class="paragraph">
<p>The next two sections describe how the return format (zipped collection
of files or CSV table of data) affects the way the <em>bbox</em> subset request
is interpreted.</p>
</div>
<div class="sect5">
<h6 id="_bbox_zip_formatted_returns"><em>bbox &amp; zip-formatted returns</em></h6>
<div class="paragraph">
<p>When the Aggregation Service is asked to provide a zipped collection of
files (<em>operation</em> = <em>netcdf3</em>, <em>netcdf4</em> or <em>ascii</em>), the
resulting data is stored as N-dimensional arrays in those kinds of
responses. This limits how <em>bbox</em> can form subsets, particularly when
the values are in the form of 'swath data.' For this request type,
<em>bbox</em> forms a bounding box for each variable in the list of range
requests and then forms the <em>union</em> of those bounding boxes. For swath
data, this means that some extra values will be returned both because
the data rarely fit perfectly in a box for any given domain variable and
then the union of those two (imperfect) subsets usually results in some
data that are actually in neither bounding box. The <em>bbox</em> operation
(which maps to a Hyrax server function) was designed to be liberal in
applying the subset to as to include all data points that meet the
subset criteria at the cost of including some that don&#8217;t. The
alternative would be to exclude some matching data. Similarly, the
bounding box for the set of variables is the union for the same reason.
Hyrax contains server functions that can form both the union and
intersection of several bounding boxes returned by the <em>bbox</em> function.</p>
</div>
</div>
<div class="sect5">
<h6 id="_bbox_the_csv_response"><em>bbox &amp; the csv response</em></h6>
<div class="paragraph">
<p>The <em>csv</em> response format is treated differently because the data values
are returned in a table and not arrays. Because of this, the
interpretation of <em>bbox</em> is quite different. The subset request syntax
is interpreted as a set of <em>value filters</em> that can be expressed as an
series of relational expressions that are combined using a logical AND
operation. Returning to the original example</p>
</div>
<div class="paragraph">
<p>&amp;bbox="[49,Latitude,50][167,Longitude,170]"</p>
</div>
<div class="paragraph">
<p>a corresponding relational expression for this subset request would be</p>
</div>
<div class="paragraph">
<p>49 &#8656; Latitude &#8656; 50 AND 167 &#8656; Longitude &#8656; 170</p>
</div>
<div class="paragraph">
<p>Because the response is a single table, each variable named in the
request appears as a column. If there are <em>N</em> variables listed in
<em>var</em>, then <em>N</em> columns will appear in the resulting table (with one
potential exception where <em>N+1</em> columns may appear). The filter
expression built from the <em>bbox</em> subset request will be applied to each
row of this table, and only those rows with values that satisfy it will
be included in the output.</p>
</div>
<div class="paragraph">
<p>A tabular response like this implies that all of the values of a
particular row are related. For this kind of response (<em>operation</em> =
<em>csv</em>) to work, each variable listed by use a common set of named
dimensions (i.e., shared dimensions). The one exception to this rule is
when the variables listed with <em>var</em> fall into two groups, one of which
has <em>M</em> dimensions (e.g., 2) and another group has <em>N</em> (e.g., 3) and the
second group&#8217;s named dimensions contains the first group&#8217;s as a proper
subset. In this case, the extra dimension(s) of the second group will
appear as additional columns in the response. It sounds confusing, but
in practice it is pretty straightforward. Here&#8217;s a concrete example.
Suppose a dataset has <em>Latitude</em>, <em>Longitude</em> and
<em>Corrected_Optical_Depth</em> and both Latitude and Longitude are two
dimensional arrays with named dimensions <em>x</em> and <em>y</em> and
Corrected_Optical_Depth is a three dimensional array with named
dimensions <em>Solution_3_Land</em>, <em>x</em> and <em>y</em>. The <em>csv</em> response would
include four columns, one each for Latitude, Longitude and
Corrected_Optical_Depth and a fourth for Solution_3_Land where the value
would be the index number.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_and_implementation">11.F.4. Performance and Implementation</h4>
<div class="paragraph">
<p>Performance is linear in terms of the number of granules. The response
is streamed as it is built, so even very large responses use only a
little memory on the server. Of course, that won&#8217;t be the case on the
client.</p>
</div>
<div class="sect4">
<h5 id="_implementation">Implementation</h5>
<div class="paragraph">
<p>The interface described here is built using a Servlet that talks to the
Hyrax BES - a C/C++ Unix daemon that reads and processes data building
the raw DAP2/4 response objects. The Servlet builds the response objects
it returns using the response objects returned by the BES. In the case
of the 'zipped files' response, the BES is told one by one to subset the
granules and return the result as <em>netcdf3</em>, et cetera. It streams
each returned file using a <em>ZipPOutputStream</em> object from the Apache
Commons set of Java libraries. In the case of the <em>csv</em> response the BES
is told to return the filtered data as ASCII and the servlet uses the
Java FilteredOutputStream class to strip away redundant header
information from the second, &#8230;&#8203;, Nth file/granule.</p>
</div>
<div class="paragraph">
<p>For each type of request, most of the work of subsetting the values is
performed by the BES, its constraint evaluator and a small set of server
functions. The server functions used for this service are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">roi</dt>
<dd>
<p>subsetting based on indices of shared dimensions</p>
</dd>
<dt class="hdlist1">bbox</dt>
<dd>
<p>building bounding boxes described in array index space</p>
</dd>
<dt class="hdlist1">bbox_union</dt>
<dd>
<p>building bounding boxes for forming the union or intersection of two
or more bounding boxes</p>
</dd>
<dt class="hdlist1">tabular</dt>
<dd>
<p>building a DAP Sequence from <em>N</em> arrays, where when <em>N</em> &gt; 1, each
array must be a member of the same DAP4 'coverage'</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is possible to access the essential functionality of the Aggregation
Service using these functions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_design">Design</h5>
<div class="paragraph">
<p>The design of the <a href="#use-cases-for-s-a-t-s-g">Aggregation Service</a>
is documented as well, although some aspects of that document
are old and incorrect. it may also be useful to look at the source code,
which can be found on GitHub at <a href="https://github.com/opendap/olfs">olfs</a>
and <a href="https://github.com/opendap/bes">bes</a> in the
<a href="https://github.com/OPENDAP/olfs/tree/master/src/opendap/aggregation">aggregation</a>
and <a href="https://github.com/OPENDAP/bes/tree/master/functions">functions</a>
parts of those repos, respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_6">Examples</h5>
<div class="paragraph">
<p>This section lists a number of examples of the aggregation service. We
have only a handful of data on our test server, but these examples
should work. Because the aggregation service is a machine interface, the
examples require that use of curl and text files that contain the POST
requests (except for the version operation).</p>
</div>
</div>
<div class="sect4">
<h5 id="_version">Version</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Request</dt>
<dd>
<p><a href="http://test.opendap.org/dap/aggregation/?&amp;operation=version" class="bare">http://test.opendap.org/dap/aggregation/?&amp;operation=version</a></p>
</dd>
<dt class="hdlist1">Returns</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Aggregation Interface Version: 1.1
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;response xmlns="http://xml.opendap.org/ns/bes/1.0#" reqID="[ajp-bio-…"&gt;
  &lt;showVersion&gt;
    &lt;Administrator&gt;support@opendap.org&lt;/Administrator&gt;
    &lt;library name="bes"&gt;3.16.0&lt;/library&gt;
    &lt;module name="dap-server/ascii"&gt;4.1.5&lt;/module&gt;
    &lt;module name="csv_handler"&gt;1.1.2&lt;/module&gt;
    &lt;library name="libdap"&gt;3.16.0&lt;/library&gt;
…
&lt;/response&gt;</pre>
</div>
</div>
<div class="sect5">
<h6 id="_returning_an_archive">Returning an Archive</h6>
<div class="paragraph">
<p><strong>NB:</strong> To get these examples, clone <a href="https://github.com/opendap/olfs" class="bare">https://github.com/opendap/olfs</a>, then
cd to <em>resources/aggregation/tests/demo</em>.</p>
</div>
<div class="paragraph">
<p>The example files are also available here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./extra_files/D1_netcdf3_variable_subset.txt">d1_netcdf3_variable_subset.txt</a></p>
</li>
<li>
<p><a href="./extra_files/D2_netcdf3_bbox_subset.txt">d2_netcdf3_bbox_subset.txt</a></p>
</li>
<li>
<p><a href="./extra_files/D3_csv_subset.txt">d3_csv_subset.txt</a></p>
</li>
<li>
<p><a href="./extra_files/D4_csv_subset_dim.txt">d4_csv_subset_dim.txt</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the OLFS repo on github, you&#8217;ll see a file named
<em>resources/aggregation/tests/demo/short_names/d1_netcdf3_variable_subset.txt</em>.
Here&#8217;s what it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ more short_names/d1_netcdf3_variable_subset.txt
&amp;operation=netcdf3
&amp;var=Latitude,Longitude,Optical_Depth_Land_And_Ocean
&amp;file=/data/modis/MOD04_L2.A2015021.0020.051.NRT.hdf
&amp;file=/data/modis/MOD04_L2.A2015021.0025.051.NRT.hdf
&amp;file=/data/modis/MOD04_L2.A2015021.0030.051.NRT.hdf</pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how the DAP2 projection constraint can be given once
and applied to a number of files. It&#8217;s also possible to provide a unique
constraint for each file.</p>
</div>
<div class="paragraph">
<p>Each of the parameters begins with an ampersand (<em>&amp;</em>). This command,
which will be sent to the service using POST, specifies the <em>netcdf3</em>
response, three files, and the DAP projection constraint
<em>Latitude,Longitude,Optical_Depth_Land_And_Ocean</em>. It may be that the
parameter name <em>&amp;var</em> is a bit misleading since you can actually provide
array subsetting there as well (but not the filtering-type DAP2/DAP4
constraints).</p>
</div>
<div class="paragraph">
<p>To send this command to the service, use <em>curl</em> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ curl -X POST -d @short_names/d1_netcdf3_variable_subset.txt http://test.opendap.org/opendap/aggregation &gt; d1.zip
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                                     Dload  Upload   Total   Spent    Left  Speed
100  552k    0  552k  100   226   305k    124  0:00:01  0:00:01 --:--:--  305k</pre>
</div>
</div>
<div class="paragraph">
<p>The output of <em>curl</em> is redirected to a file (<em>d1.zip</em>) and we can
list its contents</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">verifying that it contains the files we expect.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ unzip -t d1.zip
Archive:  d1.zip
    testing: MOD04_L2.A2015021.0020.051.NRT.hdf.nc   OK
    testing: MOD04_L2.A2015021.0025.051.NRT.hdf.nc   OK
    testing: MOD04_L2.A2015021.0030.051.NRT.hdf.nc   OK
No errors detected in compressed data of d1.zip.</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_returning_a_table">Returning a Table</h6>
<div class="paragraph">
<p>In this example, a request is made for data from the same three
variables from the same files, but the data are returned in a single
table. This request file is in the same directory as the previous
example.</p>
</div>
<div class="paragraph">
<p>The command file is close to the same as before, but uses the
<em>&amp;operation</em> or <em>csv</em> and also adds a <em>&amp;bbox</em> command, the latter
provides a way to specify filtering based on latitude/longitude bounding
boxes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ more short_names/d3_csv_subset.txt
&amp;operation=csv
&amp;var=Latitude,Longitude,Image_Optical_Depth_Land_And_Ocean
&amp;bbox="[49,Latitude,50][167,Longitude,170]"
&amp;file=/data/modis/MOD04_L2.A2015021.0020.051.NRT.hdf
&amp;file=/data/modis/MOD04_L2.A2015021.0025.051.NRT.hdf
&amp;file=/data/modis/MOD04_L2.A2015021.0030.051.NRT.hdf</pre>
</div>
</div>
<div class="paragraph">
<p>The command is sent using '<em>curl</em> as before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ curl -X POST -d @short_names/d3_csv_subset.txt http://test.opendap.org/opendap/aggregation &gt; d3.csv
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  4141    0  3870  100   271   5150    360 --:--:-- --:--:-- --:--:--  5153</pre>
</div>
</div>
<div class="paragraph">
<p>However, the response is now an ASCII table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">edamame:demo jimg$ more d3.csv
Dataset: function_result_MOD04_L2.A2015021.0020.051.NRT.hdf
table.Latitude, table.Longitude, table.Image_Optical_Depth_Land_And_Ocean
49.98, 169.598, -9999
49.9312, 169.82, -9999
49.9878, 169.119, -9999
49.9423, 169.331, -9999
49.8952, 169.548, -9999
49.8464, 169.77, -9999
49.7958, 169.998, -9999
49.9897, 168.659, -9999
49.9471, 168.862, -9999
...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_potential_extensions_to_the_service">11.F.5. Potential Extensions to the Service</h4>
<div class="paragraph">
<p>This service was purpose-built for the NASA CMR system, but it could be
extended in several useful ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support general DAP2 and DAP4 constraint expressions, including
function calls (functions are used behind the scenes already)</p>
</li>
<li>
<p>Increased parallelism.</p>
</li>
<li>
<p>Support for the <strong>tar.gz</strong> return type.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Server_Side_Processing_Functions">Appendix G: Server Side Processing Functions</h3>
<div class="sect3">
<h4 id="_server_functions_invocation_and_composition">11.G.1. Server Functions, Invocation, and Composition</h4>
<div class="paragraph">
<p>To run a server function, you call the function with its arguments in
the 'query string' part of a URL. The server function call is a kind of
DAP Constraint Expression. Here are some examples:</p>
</div>
<div class="paragraph">
<p>Get the U and V components of the fnoc1 dataset, but apply the
dataset&#8217;s scale_factor attribute (the 'm' in y=mx+b; for these
variables, 'b' is zero). Compare the values returned by the
linear_scale() server function to those returned by accessing the
variables without using the function</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Normal accees versus Using a server function</div>
<div class="content">
<div class="paragraph">
<p><a href="http://test.opendap.org/dap/data/nc/fnoc1.nc.ascii?u,v" class="bare">http://test.opendap.org/dap/data/nc/fnoc1.nc.ascii?u,v</a></p>
</div>
<div class="paragraph">
<p><a href="http://test.opendap.org/dap/data/nc/fnoc1.nc.ascii?linear_scale(u),linear_scale(v" class="bare">http://test.opendap.org/dap/data/nc/fnoc1.nc.ascii?linear_scale(u),linear_scale(v</a>)</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_function_composition">Function Composition</h5>
<div class="paragraph">
<p>Server-side functions provide a way to access the processing power of
the data server and perform operations that fall outside the scope of
the DAP constraint mechanism of projection and selection. Each server
can load functions at run-time, so the set of functions supported may be
different than those documented here. Use the <em>version()</em> function to
get a list of functions supported by a particular server. To get
information about a particular function, call that function with no
arguments. The 'help' response from both <em>version()</em> and a function such
as <em>linear_scale()</em> is a simple XML document listing the function&#8217;s
name, version and URL to more complete documentation.</p>
</div>
<div class="paragraph">
<p>All the functions listed here are included in the Hyrax server, versions 1.6 and
later. Other servers may also support these.</p>
</div>
<div class="paragraph">
<p>All of these functions can be composed. Thus, the values from the
geogrid() function can be used by the linear_scale() function. Here&#8217;s an
example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Functional Composition: The output of one function and serve as input to another</div>
<div class="content">
<div class="literalblock">
<div class="content">
<pre class="nowrap">linear_scale(geogrid(SST, 45, -82, 40, -78)) // spaces added for clarity</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This first subsets the variable <em>SST</em>, so only those values in latitude
45 to 40 and longitude -82 to -78 are returned; it then passes those
values to the linear_scale() function, which will scale them and return
those new values to the caller.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_functions_in_the_bes_functions_module">11.G.2. Server Functions in the <em>BES functions</em> Module</h4>
<div class="paragraph">
<p>For Hyrax 1.9, the server functions listed here were moved from libdap,
where they were 'hard coded' into the constraint evaluator to a module
that is loaded like the other BES modules. Currently, this 'functions'
module is part of the BES source code while we decide where it should
reside. Also note that <em>make_array()</em>, the <em>#Type</em> special form,
<em>bind_name()</em> and <em>bind_shape()</em> are new functions designed to pass
large arrays filled with constant values into custom server functions.
We will expand on these as part of an NSF-sponsored project in the
coming two years.</p>
</div>
<div class="sect4">
<h5 id="SSF_geogrid">geogrid()</h5>
<div class="sect5">
<h6 id="_version_documented_1_2">Version Documented: 1.2</h6>
<div class="paragraph">
<p>The geogrid() function applies a constraint given in latitude and
longitude to a DAP Grid variable. The arguments to the function are&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">There are two ways to call <strong>geogrid()</strong></div>
<div class="content">
<pre class="nowrap">geogrid(grid variable, top, left, bottom, right[, expression ...])
geogrid(grid variable, latitude map, longitude map, top, left, bottom, right[, expression ...])</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>grid variable</em> is the data to be sub-sampled and must be a Grid.
The optional latitude and longitude maps must be Maps in the named Grid
and specifying these overrides the <em>geogrid</em> heuristics for choosing the
lat/lon maps. The Top, left, bottom, right are the latitude and
longitude coordinates of the northwesterm and southeastern corners of
the selection box. The expressions consist of one or more quoted
relational expressions. See grid() for more information about the
expressions.</p>
</div>
<div class="paragraph">
<p>The function will always return a single Grid variable whose values
completely cover the given region, although there may be cases when some
additional data are also returned. If the longitude values 'wrap around'
the right edge of the data, the function will make two requests and
return those joined together as a single Grid. If the data are stored
with the southern latitudes at the top of the array, the return result
will be flipped so that the northern latitudes are at the top. If the
Longitude values are offset, the function will correct for that as
well.</p>
</div>
<hr>
</div>
<div class="sect5">
<h6 id="_version_documented_1_1">Version Documented: 1.1</h6>
<div class="paragraph">
<p>The geogrid() function applies a constraint given in latitude and
longitude to a DAP Grid variable. The arguments to the function are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> geogrid(variable, top, left, bottom, right[, expression ...])</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>variable</em> is the data to be sub-sampled. The Top, left, bottom,
right are the latitude and longitude coordinates of the northwesterm and
southeastern corners of the selection box. The expressions consist of
one or more quoted relational expressions. See grid() for more
information about the expressions.</p>
</div>
<div class="paragraph">
<p>The function will always return a single Grid variable whose values
completely cover the given region, although there may be cases when some
additional data are also returned. If the longitude values 'wrap around'
the right edge of the data, then the function will make two requests and
return those joined together as a single Grid. If the data are stored
with the southern latitudes at the top of the array, the return result
will be flipped so that the northern latitudes are at the top.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="SSF_grid">grid</h5>
<div class="sect5">
<h6 id="_version_documented_1_0">Version Documented: 1.0</h6>
<div class="paragraph">
<p>The grid() function takes a DAP Grid variable and zero or more
relational expressions. Each relational expression is applied to the
grid using the server&#8217;s constraint evaluator and the resulting grid is
returned. The expressions may use constants and the grid&#8217;s map vectors
but may not use any other variables. In particular, you cannot use the
grid values themselves</p>
</div>
<div class="paragraph">
<p>Two forms of expression are provided:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>var relop const</code></p>
</li>
<li>
<p><code>const relop var relop const</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Where <em>relop</em> stands for one of the relational operators, such as <code>=</code>
<code>&gt;</code>, or <code>&lt;</code></p>
</div>
<div class="paragraph">
<p>For example: <code>grid(sst,"20&gt;TIME&gt;=10")</code> and <code>grid(sst,"20&gt;TIME","TIME&gt;=10")</code>
are both legal and, in this case, also equivalent.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="SSF_linear_scale">linear_scale</h5>
<div class="sect5">
<h6 id="_version_documented_1_0b1">Version Documented: 1.0b1</h6>
<div class="paragraph">
<p>The linear_scale() function applies the familiar y = mx + b equation to
data. It has three forms:</p>
</div>
<div class="listingblock">
<div class="title">There are three ways to call <strong>linear_scale()</strong></div>
<div class="content">
<pre class="nowrap">linear_scale(var)
linear_scale(var,scale_factor,add_offset)
linear_scale(var,scale_factor,add_offset,missing_value)</pre>
</div>
</div>
<div class="paragraph">
<p>If only the name of a variable is given, the function looks for the
COARDS/CF-1.0 <em>scale_factor</em>, <em>add_offset</em> and <em>missing_value</em>
attributes. In the equation, 'm' is scale_factor, 'b' is add_offset and
data values that match missing_value are not scaled.</p>
</div>
<div class="paragraph">
<p>If add_offset cannot be found, it defaults to zero; if missing_value
cannot be found, the test for it is not performed.</p>
</div>
<div class="paragraph">
<p>In the second and third form, if the given values conflict with the
dataset&#8217;s attributes, the given values override.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_make_array_function">The make_array() Function</h5>
<div class="paragraph">
<p>The <em>make_array()</em> function takes three or more arguments and returns a
DAP2 Array with the values passed to the function.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">make_array(&lt;<em>type</em>&gt;, &lt;<em>shape</em>&gt;, &lt;<em>values</em>&gt;, &#8230;&#8203;)</dt>
<dd>
<p>&lt;<em>type</em>&gt; is any of the DAP2 numeric types (Byte, Int16, UInt16,
Int32, UInt32, Float32, Float64); &lt;<em>shape</em>&gt; is a string that
indicates the size and number of the array&#8217;s dimensions. Following
those two arguments are N arguments that are the values of the array.
The number of values must equal the product of the dimension sizes.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example: make_array(Byte,"[4][4]",2,3,4,5,2,3,4,5,2,3,4,5,2,3,4,5) will
return a DAP2 four by four Array of Bytes with the values 2, 3, &#8230;&#8203; .
The Array will be named <em>g&lt;int&gt;</em> where &lt;int&gt; is 1, 2, &#8230;&#8203;, such that the
name does not conflict with any existing variable in the dataset. Use
<em>bind_name()</em> to change the name.</p>
</div>
<div class="paragraph">
<p>This function can build an array with 1024 X 1024 Int32 elements in
about 4 seconds.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_make_array_special_forms">The 'make array' Special Forms</h5>
<div class="paragraph">
<p>These special forms can build vectors with specific values and return
them as DAP2 Arrays. The Array variables can be named using the
<em>bind_name()</em> function and have their shape set using <em>bind_shape()</em>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$&lt;type&gt;(<em>size hint</em>,: <em>values</em>, &#8230;&#8203;)</dt>
<dd>
<p>The <em>$&lt;type&gt;</em> (<em>$Byte</em>, <em>$Int32</em>, &#8230;&#8203;) literal starts the special
form. The first argument <em>size hint</em> provides a way to preallocate the
memory needed to hold the vector of values. Following that, the values
are listed. Unlike <em>make_array()</em>, it is not necessary to provide
the exact size of the vector; the size hint is just that, a hint. If a
size hint of zero is supplied, it will be ignored. Any of the DAP2
numeric types can be used with this special form. This is called a
'special form' because it invokes a custom parser that can process
values very efficiently.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example: $Byte(16:2,3,4,5,2,3,4,5,2,3,4,5,2,3,4,5) will return a one
dimensional (i.e., a vector) Array of Bytes with values 2, 3, &#8230;&#8203; . The
vector is named <em>g&lt;int&gt;</em> just like the array returned by make_array().
The vector can be turned in to a N-dimensional Array using
<em>bind_shape()</em> using
<em>bind_shape("[4][4]",$Byte(16:2,3,4,5,2,3,4,5,2,3,4,5,2,3,4,5)).</em></p>
</div>
<div class="paragraph">
<p>The special forms can make a 1,047,572 element vector on Int32 in 0.4
seconds, including the time required to parse the million plus values.</p>
</div>
<div class="sect5">
<h6 id="_performance_measurements">Performance Measurements</h6>
<div class="paragraph">
<p>Time to make 1,000,000 (actually 1,048,576) element Int32 array using
the special form, where the argument vector&lt;int&gt; was preset to 1,048,576
elements. Times are for 50 repeats.</p>
</div>
<div class="paragraph">
<p>Summary: Using the special for $Int32(size_hint, values&#8230;&#8203;) is about 10
times faster for a 1 million element vector than
make_array(Int32,[1048576],values&#8230;&#8203;). As part of the performance
testing, the scanner and parser were run under a sampling runtime
analyzer ('Instruments' on OS/X) and the code was optimized so that long
sequences of numbers would scan and parse more efficiently. This
benefits both the make_array() function and $type() special form.</p>
</div>
</div>
<div class="sect5">
<h6 id="_raw_timing_data">Raw Timing Data</h6>
<div class="paragraph">
<p>In all cases, a 1,048,576 element vector of Int32 was built 50 times.
The values were serialized and written to /dev/null using the command
<em>time besstandalone -c bes.conf -i bescmd/fast_array_test_3.dods.bescmd
-r 50 &gt; /dev/null</em> where the <em>.bescmd</em> file lists a massive constraint
expression (a million values). The same values were used.</p>
</div>
<div class="paragraph">
<p>NB: The DAP2 consraint expression scanner was improved based on info
from 'instruments', an OS/X profiling tool. Copying values and applying
www2id escaping was moved from the scanner, where it was applied it to
every token that matched SCAN_WORD, to the parser, where it was used
only for non-numeric tokens. This performance tweak makes a big
difference in this case since there are a million SCAN_WORD tokens that
are not symbols.</p>
</div>
<div class="paragraph">
<p>Runtimes for make_array() and $type, scanner/parser optimized, two
trials</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Using the make_array function is almost twelve times slower than the builtin operator</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top" colspan="3">Time in Seconds</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">What</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Real (s)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">System</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$type, with hint</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.844</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.355</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.437</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$type, with hint</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.817</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.369</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.427</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$type, no hint</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.912</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.444</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.430</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$type, no hint</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.988</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">19.444</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.428</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">make_array()</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">195.332</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">189.271</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6.058</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">make_array()</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">197.900</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">191.628</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6.254</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_bind_name_and_bind_shape">bind_name() and bind_shape()</h5>
<div class="paragraph">
<p>These functions take a BaseType* object and bind a name or shape to it
(in the latter case the BaseType* must be an Array*). They are intended
to be used with <em>make_array()</em> and the <em>$type</em> special forms, but they
can be used with any variable in a dataset.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bind_name(<em>name</em>,<em>variable</em>)</dt>
<dd>
<p>The <em>name</em> must not exist in the dataset; <em>variable</em> may be the name
of a variable in the dataset (so this function can rename an existing
variable) or it can be a variable returned by another function or
special form.</p>
</dd>
<dt class="hdlist1">bind_shape(<em>shape expression</em>,<em>variable</em>)</dt>
<dd>
<p>The <em>shape expression</em> is a string that gives the number and size of
the array&#8217;s dimensions; the <em>variable</em> may be the name of a variable
in the dataset (so this function can rename an existing variable) or
it can be a variable returned by another function or special form.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here&#8217;s an example showing how to combine <em>bind_name</em>, <em>bind_shape</em> and
<em>$Byte</em> to build an array of constants:
<em>bind_shape("[4][4]",bind_name("bob",$Byte(0:2,3,4,5,2,3,4,5,2,3,4,5,2,3,4,5)))</em>.
The result, in a browser, is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dataset: function_result_coads_climatology.nc
bob[0], 2, 3, 4, 5
bob[1], 2, 3, 4, 5
bob[2], 2, 3, 4, 5
bob[3], 2, 3, 4, 5</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unstructured_grid_subsetting">Unstructured Grid Subsetting</h5>
<div class="paragraph">
<p>The <strong>ugr5()</strong> function subsets an Unstructured Grid (aka flexible mesh)
if it conforms to the
<a href="https://github.com/ugrid-conventions/ugrid-conventions/blob/master/ugrid-conventions.md">Ugrid
Conventions</a> built around netCDf and CF. More information on subsetting
files that conform to this convention can be found
<a href="https://github.com/ugrid-conventions/ugrid-conventions/blob/master/ugrid-subsetting.md">here</a>.</p>
</div>
<div class="paragraph">
<p>See ../index.php/OPULS:_UGrid_Subsetting[ugr5 documentation] for more
information.</p>
</div>
<div class="paragraph">
<p>This function is optional with Hyrax and is provided by the
ugrid_functions module.</p>
</div>
</div>
<div class="sect4">
<h5 id="SSF_version">version()</h5>
<div class="paragraph">
<p>The <em>version</em> function provides a list of the server-side processing
functions available on a given server along with their versions. For
information on a specific function, call it with no arguments or look at
this page.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tabular">tabular()</h5>
<div class="paragraph">
<p>Brief: Transform one or more arrays to a sequence.</p>
</div>
<div class="paragraph">
<p>This function will transform one or more arrays into a sequence, where
each array becomes a column in the sequence, with one exception. If each
array has the same shape, then the number of columns in the resulting
table is the same as the number of arrays. If one or more arrays has
more dimensions than the others, an extra column is added for each of
those extra dimensions. Arrays are enumerated in row-major order (the
right-most dimension varies fastest).</p>
</div>
<div class="paragraph">
<p>It&#8217;s assumed that for each of the arrays, elements (i0, i1, &#8230;&#8203;, in) are
all related. However, the function makes no test to ensure that.</p>
</div>
<div class="paragraph">
<p>Note: While this version of tabular() will work when some arrays have
more dimensions than others, the collection of arrays must have shapes
that 'fit together'. This is case the arrays are limited in two ways.
First the function is limited to <em>N</em> and <em>N+1</em> dimension arrays, nothing
else, regardless of the value of <em>N</em>. Second, the arrays with <em>N+1</em>
dimensions must all share the same named dimension for the 'additional
dimension' and that named shred dimension will appear in the output
Sequence as a new column.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">tabular(<em>array1</em>, <em>array2</em>, &#8230;&#8203;, <em>arrayN</em>) </dt>
<dd>
<p>Returns a Sequence with N or N+1 columns</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_roi">roi()</h5>
<div class="paragraph">
<p>Brief: Subset N arrays using index slicing information</p>
</div>
<div class="paragraph">
<p>This function should be called with a series of array variables, each of
which are N-dimensions or greater, where the N common dimensions should
all be the same size. The intent of this function is that a
N-dimensional bounding box, provided in indicial space, will be used to
subset each of the arrays. There are other functions that can be used to
build these bounding boxes using values of dataset variables - see
bbox() and bbox_union(). Taken together, the roi(), bbox() and
bbox_union() functions can be used to subset a collection of Arrays
where some arrays are taken to be dependent variables and others
independent variables. The result is a subset of 'discrete coverage' the
collection of independent and dependent variables define.</p>
</div>
<div class="paragraph">
<p>roi(<em>array1</em>, <em>array2</em>, &#8230;&#8203;, <em>arrayN</em>, bbox(&#8230;&#8203;))<br>
roi(<em>array1</em>, <em>array2</em>, &#8230;&#8203;, <em>arrayN</em>, bbox_union(bbox(&#8230;&#8203;),
bbox(&#8230;&#8203;), &#8230;&#8203;, "union")) ::
  Subset <em>array1</em>, &#8230;&#8203;, using the bound box given as the last
  argument. The assumption is that the arrays will be the range
  variables of a coverage and that the bounding boxes will be computed
  using the range variables. See the <em>bbox()</em> and <em>bbox_union()</em>
  function descriptions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bbox">bbox()</h5>
<div class="paragraph">
<p>Brief: Return the bounding box for an array</p>
</div>
<div class="paragraph">
<p>Given an N-dimensional Array of simple numeric types and two minimum and
maximum values, return the indices of a N-dimensional bounding box. The
indices are returned using an Array of Structure, where each element of
the array holds the name, start index and stop index in fields with
those names.</p>
</div>
<div class="paragraph">
<p>It is up to the caller to make use of the returned values; the array is
not modified in any way other than to read in it&#8217;s values (and set the
variable&#8217;s read_p property).</p>
</div>
<div class="paragraph">
<p>The returned Structure Array has the same name as the variable it
applies to, so that error messages can reference the source variable.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bbox(<em>array</em>, <em>min-value</em>, <em>max-value</em>) </dt>
<dd>
<p>Given that <em>array</em> is an N-dimensional array, return a DAP Array with
N elements. Each element is a DAP Structure with two fields, the
indices corresponding to the first and last occurrence of the values
<em>min-value</em> and <em>max-value</em>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_bbox_union">bbox_union()</h5>
<div class="paragraph">
<p>Brief: Combine several bounding boxes, forming their union.</p>
</div>
<div class="paragraph">
<p>This combines N BBox variables (Array of Structure) forming either their
union or intersection, depending on the last parameter&#8217;s value ("union"
or "inter[section]").</p>
</div>
<div class="paragraph">
<p>If the function is passed bboxes that have no intersection, an exception
is thrown. This is so that callers will know why no data were returned.
Otherwise, an empty response, while correct, could be baffling to the
caller.</p>
</div>
<div class="paragraph">
<p>bbox_union(bbox(<em>a1</em>, <em>min-value-1</em>, <em>max-value-1</em>), bbox(<em>a2</em>,
<em>min-2</em>, <em>max-2</em>), &#8230;&#8203;, "union"|"intersection") ::
  Given 1 or more bounding box Array of Structures (as returned by the
  <em>bbox()</em> function) form their union or intersection and return that
  bounding box (using the same Array of Structures representation).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_functions_included_freeform_module">11.G.3. Functions Included <em>FreeForm Module</em></h4>
<div class="paragraph">
<p>There are a number of date and time functions supported by the FreeForm
server.</p>
</div>
<div class="sect4">
<h5 id="_projection_functions">Projection Functions</h5>

</div>
<div class="sect4">
<h5 id="_selection_functions">Selection Functions</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="BES_XML">Appendix H: BES XML Commands</h3>
<div class="paragraph">
<p>2020-12-30
:numbered:
:toc:</p>
</div>
<div class="sect3">
<h4 id="_bes_xml_command_syntax">11.H.1. BES XML Command Syntax</h4>
<div class="paragraph">
<p>The BES will accept commands encoded in XML documents (BES XML
Commands), and provide responses in kind. Some requests specifically
indicate a non XML response (such as a DAP2 binary response) in which
case the response will be as requested.</p>
</div>
<div class="sect4">
<h5 id="_requests">Requests</h5>
<div class="paragraph">
<p>All elements mentioned in the following are in the
<a href="http://xml.opendap.org/ns/bes/1.0#" class="bare">http://xml.opendap.org/ns/bes/1.0#</a> namespace unless otherwise noted.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each request document <strong>must</strong> have a &lt;request&gt; root element.</p>
</li>
<li>
<p>Each &lt;request&gt; <strong>must</strong> contain one or more BesCommand elements.</p>
</li>
<li>
<p>A &lt;request&gt; <strong>may</strong> contain multiple BesCommands as long as zero more
of those commands returns a response.<br>
Examples (expand with abbreviated xml):</p>
<div class="ulist">
<ul>
<li>
<p>We can do a set context, set container, define and a get das in the
same request document as only the get das request command returns a
response.</p>
</li>
<li>
<p>There can not be two show commands within the request document, or a
show and a get, or multiple gets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Each request element <strong>must</strong> have an attribute <em>reqID</em> the value of
which will be used in the response document. There is no guarantee that
the value of <em>reqID</em> be unique within the operational domain of the BES.
(It might be unique within the software of the requesting client, but
that&#8217;s of no concern to the BES).</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="_responses">Responses</h6>
<div class="paragraph">
<p>*Need a description and such here.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bes-error-response">11.H.2. BES Error Response</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">&lt;BES&gt;
    &lt;response reqID="####"&gt;
        &lt;BESError&gt;
            &lt;Type&gt;3&lt;/Type&gt;
            &lt;Message&gt;Unable to find command for showVersions&lt;/Message&gt;
            &lt;Administrator&gt;ndp@opendap.org&lt;/Administrator&gt;
        &lt;/BESError&gt;
    &lt;/response&gt;
&lt;/BES&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where Type is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. Internal Error - the error is internal to the BES Server</p>
</li>
<li>
<p>2. Internal Fatal Error - error is fatal, can not continue</p>
</li>
<li>
<p>3. Syntax User Error - the requester has a syntax error in request or
config</p>
</li>
<li>
<p>4. Forbidden Error - the requester is forbidden to see the resource</p>
</li>
<li>
<p>5. Not Found Error - the resource can not be found</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If debugging is enabled during build, the Error object will include
the file name and line number where the exception was thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bes_command_set">11.H.3. BES Command Set</h4>
<div class="sect4">
<h5 id="_setcontext">setContext</h5>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;setContext  name="contextName&gt;Value&lt;/setContext&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Changes the state of the BES for the current client connection. This
allows the client to ask the BES to utilize various response formats.</p>
</div>
<div class="sect5">
<h6 id="_name_attribute_2"><em>name</em> Attribute</h6>
<div class="paragraph">
<p>Identifies which context value is being set.</p>
</div>
<div class="paragraph">
<p><strong>dap_format</strong> context</p>
</div>
<div class="paragraph">
<p>Value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Major.Minor</em> where both <em>Major</em> and <em>Minor</em> are integer values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>errors</strong> context</p>
</div>
<div class="paragraph">
<p>Current Values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>xml</em> -</p>
</li>
<li>
<p><em>dap2</em> - When error context is set to <em>dap2</em> then all errors will
returned as DAP2 error objects (definitely <strong>not</strong> XML).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Proposed Values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>dap</em> - When error context is set to <em>dap</em>, all errors will
returned as DAP error objects. The version of the DAP that error must
conform to is controlled by the dap_format context. It is possible
(likely) that in the future DAP errors will be XML documents.</p>
</li>
<li>
<p><em>bes</em> - Returns a BES Error response XML Document:</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_request_example">Request Example</h7>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
       &lt;setContext name="errors"&gt;dap2&lt;/setContext&gt;
   &lt;/request&gt;</pre>
</div>
</div>
<div class="sect7">
<h8 id="_response_example">Response Example</h8>
<div class="paragraph">
<p>Normally no response. May return a <a href="#bes-error-response">BESError</a>.</p>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setcontainer">setContainer</h5>
<div class="sect5">
<h6 id="_request_example_2">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
       &lt;setContainer name="c" space="catalog"&gt;data/nc/fnoc1.nc&lt;/setContainer&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_2">Response Example</h6>
<div class="paragraph">
<p>Normally no response. May return a <a href="#bes-error-response">BESError</a>.</p>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="BES_XML_Define">Define</h5>
<div class="sect5">
<h6 id="_request_example_3">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;define name="d" space="default"&gt;
            &lt;constraint&gt;a valid default ce&lt;/constraint&gt;
            &lt;container name="c1"&gt;
                &lt;constraint&gt;a valid ce&lt;/constraint&gt;
               &lt;attributes&gt;list of attributes&lt;/attributes&gt;
            &lt;/container&gt;
            &lt;container name="c2"&gt;
                &lt;constraint&gt;a valid ce&lt;/constraint&gt;
               &lt;attributes&gt;list of attributes&lt;/attributes&gt;
            &lt;/container&gt;
            &lt;aggregate handler="someHandler" cmd="someCommand" /&gt;
        &lt;/define&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_3">Response Example</h6>
<div class="paragraph">
<p>Normally no response. May return a <a href="#bes-error-response">BESError</a>.</p>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_get">get</h5>
<div class="paragraph">
<p><strong>This needs to be expanded to illuminate the missing details from the
previoius command set:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>get 'type' for 'definition' using 'URL';</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>dds</strong> -</p>
</li>
<li>
<p><strong>das</strong> -</p>
</li>
<li>
<p><strong>dods</strong> -</p>
</li>
<li>
<p><strong>stream</strong> -</p>
</li>
<li>
<p><strong>ascii</strong> -</p>
</li>
<li>
<p><strong>html_form</strong> -</p>
</li>
<li>
<p><strong>info_page</strong> -</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_request_example_4">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;get type="data_product" definition="def_name" returnAs="name" url="url" /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_command_example">Multiple Command Example</h5>
<div class="paragraph">
<p>Multiple command transaction resulting in a DDS (non XML DAP2) response:</p>
</div>
<div class="sect5">
<h6 id="_request_example_5">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
       &lt;setContext name="error"&gt;dap2&lt;/setContext&gt;
       &lt;setContainer name="c" space="catalog"&gt;data/nc/fnoc1.nc&lt;/setContainer&gt;
        &lt;define name="d" space="default"&gt;
            &lt;container name="c"&gt;
                &lt;constraint&gt;a valid ce&lt;/constraint&gt;
               &lt;attributes&gt;list of attributes&lt;/attributes&gt;
            &lt;/container&gt;
            &lt;aggregate handler="someHandler" cmd="someCommand" /&gt;
        &lt;/define&gt;
        &lt;get  type="dds" definition="d" returnAs="name" /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_show_version">Show Version</h5>
<div class="sect5">
<h6 id="_request_example_6">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showVersion /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
<div class="sect6">
<h7 id="_response">Response</h7>
<div class="paragraph">
<p>Current:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;showVersion&gt;
       &lt;response&gt;
           &lt;DAP&gt;
               &lt;version&gt;2.0&lt;/version&gt;
               &lt;version&gt;3.0&lt;/version&gt;
               &lt;version&gt;3.2&lt;/version&gt;
           &lt;/DAP&gt;
           &lt;BES&gt;
               &lt;lib&gt;
                   &lt;name&gt;libdap&lt;/name&gt;
                   &lt;version&gt;3.5.3&lt;/version&gt;
               &lt;/lib&gt;
               &lt;lib&gt;
                   &lt;name&gt;bes&lt;/name&gt;
                   &lt;version&gt;3.1.0&lt;/version&gt;
               &lt;/lib&gt;
           &lt;/BES&gt;
           &lt;Handlers&gt;
               &lt;lib&gt;
                   &lt;name&gt;libnc-dods&lt;/name&gt;
                   &lt;version&gt;0.9&lt;/version&gt;
               &lt;/lib&gt;
           &lt;/Handlers&gt;
        &lt;/response&gt;
   &lt;/showVersion&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Proposed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showVersion&gt;
           &lt;service name="dap"&gt;
               &lt;version&gt;2.0&lt;/version&gt;
               &lt;version&gt;3.0&lt;/version&gt;
               &lt;version&gt;3.2&lt;/version&gt;
           &lt;/service&gt;
           &lt;library name="bes"&gt;3.5.3&lt;/library&gt;
           &lt;library name="libdap"&gt;3.10.0&lt;/library&gt;
           &lt;module name="netcdf_handler"&gt;3.7.9&lt;/module&gt;
           &lt;module name="freeform_handler"&gt;3.7.9&lt;/module&gt;
       &lt;/showVersion&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_show_help">Show help</h5>
<div class="sect5">
<h6 id="_request_example_7">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showHelp /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_4">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response  reqID="####"&gt;
       &lt;showHelp&gt;
           &lt;module name="bes" version="3.6.2"&gt;&lt;html xmlns= http://www.w3.org/1999/xhtml &gt;Help Information&lt;/html&gt;&lt;/module&gt;
           &lt;module name="dap" version="3.10.1"&gt;Help Information&lt;/module&gt;
           &lt;module name="netcdf_handler" version="3.7.9"&gt;Help Information including supported responses&lt;/module&gt;
       &lt;/showHelp&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showprocess">showProcess</h5>
<div class="paragraph">
<p>This is available only if the BES is compiled in developer mode. A
'production' BES does not support this command.</p>
</div>
<div class="sect5">
<h6 id="_request_example_8">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showProcess /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_5">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showProcess&gt;
           &lt;process pid="10831" /&gt;
       &lt;/showProcess&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showconfig">showConfig</h5>
<div class="paragraph">
<p>This is available only if the BES is compiled in developer mode. A
'production' BES does not support this command.</p>
</div>
<div class="sect5">
<h6 id="_request_example_9">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showConfig /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_6">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showConfig&gt;
           &lt;file&gt;/Users/pwest/opendap/chunking/etc/bes/bes.conf&lt;/file&gt;
           &lt;key name="BES.CacheDir"&gt;/tmp&lt;/key&gt;
           ....
       &lt;/showConfig&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showstatus">showStatus</h5>
<div class="sect5">
<h6 id="_request_example_10">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showStatus /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_7">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showStatus&gt;
           &lt;status&gt;MST Thu Dec 18 11:51:36 2008&lt;/status&gt;
       &lt;/showStatus&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showcontainers">showContainers</h5>
<div class="sect5">
<h6 id="_request_example_11">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showContainers /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_8">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response  reqID="####"&gt;
       &lt;showContainers&gt;
           &lt;store name="volatile"&gt;
               &lt;container name="c" type="nc"&gt;data/nc/fnoc1.nc&lt;/container&gt;
           &lt;/store&gt;
       &lt;/showContainers&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_deletecontainers_deletedefinitions">deleteContainer(s), deleteDefinition(s)</h5>
<div class="sect5">
<h6 id="_request_example_12">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;deleteContainers store="storeName" /&gt;
        &lt;deleteContainer name="containerName" store="storeName" /&gt;
        &lt;deleteDefinitions store="storeName" /&gt;
        &lt;deleteDefinition name="defName" store="storeName" /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_9">Response Example</h6>
<div class="paragraph">
<p>Normally no response. May return a <a href="#bes-error-response">BESError</a>.</p>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showdefinitions">showDefinitions</h5>
<div class="sect5">
<h6 id="_request_example_13">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showDefinitions /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_10">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response  reqID="####"&gt;
       &lt;showDefinitions&gt;
           &lt;store name="volatile"&gt;
               &lt;definition name="d"&gt;
                   &lt;container name="c" type="nc" constraint=""&gt;data/nc/fnoc1.nc&lt;/container&gt;
                   &lt;aggregation handler="agg"&gt;aggregation_command&lt;/aggregation&gt;
               &lt;/definition&gt;
           &lt;/store&gt;
       &lt;/showDefinitions&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showcontext">showContext</h5>
<div class="sect5">
<h6 id="_request_example_14">Request Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID ="####" &gt;
        &lt;showContext /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_example_11">Response Example</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;response reqID ="####" &gt;
       &lt;showContext&gt;
            &lt;context name="name1"&gt;value1&lt;/context&gt;
            &lt;context name="name2"&gt;value2&lt;/context&gt;
             ...
            &lt;context name="namen"&gt;valuen&lt;/context&gt;
       &lt;showContext&gt;
  &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showcatalog">showCatalog</h5>
<div class="sect5">
<h6 id="_request">Request</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID="####" &gt;
        &lt;showCatalog node="[catalog:]nodeName" /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The catalog name is optional, defaulting to the default catalog
specified in the BES configuration file. So if you had a catalog named
rdh you could specify node="rdh:/" and it would give you the root node
for the rdh catalog.</p>
</div>
</div>
<div class="sect5">
<h6 id="_response_2">Response</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####" &gt;
       &lt;showCatalog&gt;
           &lt;dataset name="nc/test" size="408" lastModified="2006-01-04T19:48:24" catalog="catalog" node="true" count="5"&gt;
               &lt;dataset name="test.nc" size="12148" lastModified="2005-09-29T16:31:28" node="false"&gt;
                   &lt;service&gt;DAP&lt;/service&gt;
               &lt;/dataset&gt;
               &lt;dataset name="testfile.nc" size="43392" lastModified="2005-09-29T16:31:28" catalog="catalog" node="false"&gt;
                   &lt;service&gt;DAP&lt;/service&gt;
               &lt;/dataset&gt;
               &lt;dataset name="TestPat.nc" size="262452" lastModified="2005-09-29T16:31:27" catalog="catalog" node="false"&gt;
                   &lt;service&gt;DAP&lt;/service&gt;
               &lt;/dataset&gt;
               &lt;dataset name="TestPatDbl.nc" size="2097464" lastModified="2005-09-29T16:31:28" catalog="catalog" node="false"&gt;
                   &lt;service&gt;DAP&lt;/service&gt;
               &lt;/dataset&gt;
               &lt;dataset name="TestPatFlt.nc" size="1048884" lastModified="2005-09-29T16:31:27" catalog="catalog" node="false"&gt;
                   &lt;service&gt;DAP&lt;/service&gt;
               &lt;/dataset&gt;
           &lt;/dataset&gt;
       &lt;/showCatalog&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="_showinfo">showInfo</h5>
<div class="sect5">
<h6 id="_request_2">Request</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID="####" &gt;
        &lt;showInfo node="nodeName /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_current_response">Current Response</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showInfo&gt;
           &lt;dataset thredds_container="true"&gt;
               &lt;name&gt;nc/test&lt;/name&gt;
               &lt;size&gt;408&lt;/size&gt;
               &lt;lastmodified&gt;
                   &lt;date&gt;2006-01-04&lt;/date&gt;
                   19:48:24
               &lt;/lastmodified&gt;
               &lt;count&gt;5&lt;/count&gt;
           &lt;/dataset&gt;
       &lt;/showInfo&gt;
   &lt;/response&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showInfo&gt;
           &lt;dataset thredds_container="false"&gt;
               &lt;name&gt;nc/test/TestPatFlt.nc&lt;/name&gt;
               &lt;size&gt;1048884&lt;/size&gt;
               &lt;lastmodified&gt;
                   &lt;date&gt;2005-09-29&lt;/date&gt;
                   16:31:27
               &lt;/lastmodified&gt;
           &lt;/dataset&gt;
       &lt;/showInfo&gt;
   &lt;/response&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_proposed_response">Proposed Response</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;dataset name="testfile.nc" size="43392" lastModified="YYYY-MM-DDThh:mm:ss" catalog="catalog"
                    node="true|false" count="#ofChildDatSets"&gt;
       &lt;service&gt;DAP&lt;/service&gt;
   &lt;/dataset&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_showservices">showServices</h5>
<div class="sect5">
<h6 id="_request_3">Request</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;request reqID="####" &gt;
        &lt;showServiceDescriptions /&gt;
   &lt;/request&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_response_3">Response</h6>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;response reqID="####"&gt;
       &lt;showServices&gt;
           &lt;service name="DAP"&gt;
               &lt;command name="ddx"&gt;
                   &lt;description&gt;Words For Humans&lt;/description&gt;
                   &lt;format name="dap2"/&gt;
               &lt;/command&gt;
               &lt;command name="dds"&gt;
                   &lt;description&gt;Words For Humans&lt;/description&gt;
                   &lt;format name="dap2"/&gt;
               &lt;/command&gt;
           &lt;/service&gt;
       &lt;/showServices&gt;
   &lt;/response&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This material is based upon work supported by the National Science Foundation under Grant No. 0430822. Any opinions, findings and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation (NSF).
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. The request comes via http. The DAP2 server is, in reality, an ordinary http server, equipped with a set of CGI programs to process requests from DAP2 clients. See Section  and The OPeNDAP User Guide for more information.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2020-12-30 11:21:20 -0600
</div>
</div>
</body>
</html>